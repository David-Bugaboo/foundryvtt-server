{
  "version": 3,
  "sources": ["../src/config.mjs", "../src/utility/i18n.mjs", "../src/core/icons.mjs", "../src/common.mjs", "../src/context/actor/details-tab/providers/token-info.mjs", "../src/context/actor/details-tab/providers/wealth-by-level.mjs", "../src/context/actor/details-tab/providers/actor-stats.mjs", "../src/context/actor/details-tab/providers/benchpress.mjs", "../src/context/actor/details-tab/providers/active-effects.mjs", "../src/context/actor/details-tab/providers/_init.mjs", "../src/tests/unit-tests.mjs", "../src/little-helper.mjs", "../src/core/settings.mjs", "../src/core/feature.mjs", "../src/core/settings-client.mjs", "../src/data/conditions.mjs", "../src/ancillary.mjs", "../src/core/shared-data.mjs", "../src/core/feature-setup.mjs", "../src/core/news.mjs", "../src/context/chat/quick-same-roll.mjs", "../src/context/chat/apply-buff.mjs", "../src/context/chat/inline-roll-expansion-hook.mjs", "../src/context/chat/inline-formula.mjs", "../src/context/chat/card/additional-properties.mjs", "../src/context/chat/card/header-enrichment.mjs", "../src/context/chat/card/card-tooltips.mjs", "../src/core/tooltip.mjs", "../src/context/chat/check-hint-tags.mjs", "../src/context/chat/roll-enhancement/attacks.mjs", "../src/context/chat/inline-roll-minmax-enhancer.mjs", "../src/context/chat/meld-damage-rolls.mjs", "../src/context/chat/ensure-chat-log-end-position.mjs", "../src/context/chat/apply-damage-sanity-check.mjs", "../src/context/actor/_init-shared-data.mjs", "../src/core/tab-data.mjs", "../src/context/actor/actor-config.mjs", "../src/context/actor/attributes/creature-type-info.mjs", "../src/context/actor/buffs/condition-durations.mjs", "../src/common.time.mjs", "../src/context/actor/buffs/buff-duration-tooltips.mjs", "../src/context/actor/buffs/condition-tooltips.mjs", "../src/context/actor/combat/attack-details.mjs", "../src/context/actor/combat/thacoh.mjs", "../src/context/actor/details-tab/details-tab.mjs", "../src/context/actor/generic/item-counts.mjs", "../src/context/actor/generic/new-actor-guide.mjs", "../src/context/actor/inventory/coin-weight.mjs", "../src/context/actor/inventory/item-slot-issues.mjs", "../src/context/actor/items/item-slots.mjs", "../src/context/actor/items/item-summary-enhancer.mjs", "../src/context/actor/skills/excess-ranks.mjs", "../src/context/actor/spells/caster-progression-table.mjs", "../src/context/actor/spells/spell-level-dc.mjs", "../src/context/actor/spells/spell-tooltips.mjs", "../src/context/actor/summary/quick-skills.mjs", "../src/context/actor/summary/quick-skills-common.mjs", "../src/context/actor/summary/quick-skills-model.mjs", "../src/context/actor/summary/quick-skills-editor.mjs", "../src/context/actor/summary/actor-link-status.mjs", "../src/helpers/wounds.mjs", "../src/context/actor/summary/death-proximity.mjs", "../src/context/actor/summary/race-display.mjs", "../src/context/actor/summary/ability-scores.mjs", "../src/context/actor/summary/token-image-mismatch.mjs", "../src/context/actor/summary/token-name.mjs", "../src/context/actor/quick-action-tooltips.mjs", "../src/context/actor/language-selection.mjs", "../src/context/actor/discourage-sourceless.mjs", "../src/context/actor/missing-bits.mjs", "../src/context/actor/missing-settings.mjs", "../src/context/actor/tab-popout.mjs", "../src/context/item/use/keen.mjs", "../src/context/item/use/auto-power-attack.mjs", "../src/context/item/use/force-default-roll.mjs", "../src/context/item/use/force-rollmode.mjs", "../src/context/item/use/hide-attacks.mjs", "../src/context/item/_init-shared-data.mjs", "../src/context/item/_use-wrapper.mjs", "../src/context/item/item-header-details.mjs", "../src/context/item/disabled-feature.mjs", "../src/context/item/extra-icons.mjs", "../src/context/item/hitpoint-retrain-capacity.mjs", "../src/context/item/buff-duration-display.mjs", "../src/context/item/missing-bits.mjs", "../src/context/item/resolve-values.mjs", "../src/context/item/no-actions.mjs", "../src/context/item/disable-unusable-elements.mjs", "../src/context/item/skip-dialog.mjs", "../src/context/item/unidentified-view.mjs", "../src/context/dialog/create-consumable.mjs", "../src/context/dialog/point-buy-enricher.mjs", "../src/context/dialog/xp-settings.mjs", "../src/context/platform/compendiums/compendium-migration.mjs", "../src/context/platform/tokenhud-status-effects.mjs", "../src/context/platform/macro/macro-access.mjs", "../src/context/platform/macro/macro-directory.mjs", "../src/context/platform/macro/default-type.mjs", "../src/context/platform/id-tag.mjs", "../src/context/platform/token-vision-hints.mjs", "../src/context/platform/world-identity.mjs", "../src/context/platform/sidebar/auto-expand-folders.mjs", "../src/context/platform/wider-sidebar.mjs", "../src/context/platform/actors/actor-list-enrichment.mjs", "../src/context/platform/actors/actor-list-tooltip.mjs", "../src/context/platform/items/item-directory-enrichment.mjs", "../src/helpers/item.mjs", "../src/context/platform/items/item-directory-tooltip.mjs", "../src/context/platform/rolltables/rolltable-directory-tooltip.mjs", "../src/context/platform/scenes/compress-scenes.mjs", "../src/context/platform/scenes/scene-directory-tooltip.mjs", "../src/context/platform/journals/journal-directory-tooltip.mjs", "../src/context/platform/chat/chat-log-open-action.mjs", "../src/context/platform/chat/chat-log-open-item.mjs", "../src/context/platform/chat/chat-log-open-actor.mjs", "../src/context/platform/refresh-button.mjs", "../src/context/platform/combat/auto-popout-combat.mjs", "../src/context/platform/combat/combat-tracker-tooltip.mjs", "../src/context/platform/combat/initiative-display.mjs", "../src/context/platform/boost.mjs", "../src/context/style/chat-card.mjs", "../src/context/generic/resolve-formulas.mjs", "../src/core/formula.mjs", "../src/context/generic/easy-export.mjs", "../src/context/generic/input-quick-access.mjs", "../src/context/generic/roll-dialog-take-x.mjs", "../src/context/hud/active-buffs.mjs", "../src/context/scene/no-vision-scene.mjs", "../src/context/scene/no-default-view.mjs", "../src/context/scene/scene-config.mjs", "../src/context/scene/scene-scale-rule-mismatch.mjs", "../src/modules/feature-sources.mjs", "../src/info/item/theory-dialog.mjs", "../src/info/item/theory.mjs", "../src/config/item-config.mjs", "../src/core/keybindings.mjs", "../src/migration/migration.mjs"],
  "sourcesContent": [
    "export const CFG = /** @type {const} */ ({\n\tid: 'koboldworks-pf1-little-helper',\n\tSETTINGS: {\n\t\tgeneralWorldConfiguration: 'config-world',\n\t\tgeneralClientConfiguration: 'config-client',\n\t\tfeatureKey: 'features',\n\t\tinlineFormulaDetail: 'inline-formula-detail',\n\t\tchat: 'chat',\n\t\twbl: 'wblRatio',\n\t\ttransparencySham: 'gmtransparencysham',\n\t\ttransparency: 'transparency',\n\t},\n\tROLLMODES: {\n\t\t'': 'LittleHelper.Options.NoOverride',\n\t\tpublicroll: 'CHAT.RollPublic',\n\t\tgmroll: 'CHAT.RollPrivate',\n\t\tselfroll: 'CHAT.RollSelf',\n\t\tblindroll: 'CHAT.RollBlind',\n\t},\n\tsystem: {\n\t\tget version() {\n\t\t\treturn game.system.version;\n\t\t},\n\t\tatLeast: function (v) {\n\t\t\tconst v0 = this.version;\n\t\t\treturn foundry.utils.isNewerVersion(v0, v) || v == v0;\n\t\t},\n\t\tnewerThan: function (v) {\n\t\t\treturn foundry.utils.isNewerVersion(this.version, v);\n\t\t},\n\t},\n\tcore: {\n\t\tget version() {\n\t\t\treturn game.version;\n\t\t},\n\t\tatLeast: function (v) {\n\t\t\tconst curVer = this.version;\n\t\t\treturn foundry.utils.isNewerVersion(curVer, v) || v == curVer;\n\t\t},\n\t\tnewerThan: function (v) {\n\t\t\treturn foundry.utils.isNewerVersion(this.version, v);\n\t\t},\n\t},\n\tstate: {\n\t\talt: false,\n\t},\n\tAPI: {\n\t\tutility: {},\n\t\tformula: {},\n\t\tclasses: {},\n\t\tslots: {},\n\t},\n\ti18n: {},\n\tconsole: {\n\t\tcolors: {\n\t\t\tmain: 'color:yellowgreen',\n\t\t\tnumber: 'color:mediumpurple',\n\t\t\tstring: 'color:mediumseagreen',\n\t\t\tlabel: 'color:goldenrod',\n\t\t\tid: 'color:darkseagreen',\n\t\t\tunset: 'color:unset',\n\t\t\terror: 'color:red',\n\t\t},\n\t},\n\tisStream: undefined,\n\tversion: {\n\t\tfeature: undefined,\n\t\tpatch: undefined,\n\t},\n});\n\nHooks.once('init', () => {\n\tCFG.isStream = game.view === 'stream';\n\tconst version = game.system.version.split('.').map(Number);\n\tCFG.version.feature = version.shift();\n\tCFG.version.patch = version.shift();\n\tconst C = CFG.console.colors;\n\tconsole.log('%cLittle Helper%c ðŸ¦Ž', C.main, C.unset, '| Detected System Version | Feature:', CFG.version.feature, '| Patch:', CFG.version.patch);\n\tObject.freeze(CFG);\n});\n",
    "// eslint-disable-next-line unicorn/no-static-only-class\nexport class i18n {\n\t/**\n\t * Tests if translation key exists.\n\t *\n\t * @param {string} string\n\t * @returns {boolean} - Whether the i18n string exists.\n\t */\n\tstatic has = (string) => game.i18n.has(string);\n\n\t/**\n\t * @param {string} string i18n string path\n\t * @param {Record<string,string>} [mapping] - Mapping of keys to strings\n\t * @returns {string} - Localized string\n\t */\n\tstatic get = (string, mapping) => mapping ? game.i18n.format(string, mapping) : game.i18n.localize(string);\n}\n",
    "class Icon {\n\t#cls;\n\t#string;\n\n\t/**\n\t * @param {string} icon\n\t * @param {string} type\n\t */\n\tconstructor(icon, type = 'fa-solid') {\n\t\tthis.#cls = new Set([type, icon]);\n\t\tthis.#string = [...this.#cls].join(' ');\n\t}\n\n\ttoString() {\n\t\treturn this.#string;\n\t}\n\n\tget string() {\n\t\treturn this.toString();\n\t}\n}\n\nexport const FAIcons = {\n\tlink: new Icon('fa-link'),\n\tunlink: new Icon('fa-unlink'),\n\theart: new Icon('fa-heart'),\n\theartBroken: new Icon('fa-heart-broken'),\n\tbox: new Icon('fa-box'),\n\tcoins: new Icon('fa-coins'),\n\thourglass: new Icon('fa-hourglass'),\n\thourglassStart: new Icon('fa-hourglass-start'),\n\tseedling: new Icon('fa-seedling'),\n\tskull: new Icon('fa-skull'),\n\tdice: new Icon('fa-dice'),\n\td20: new Icon('fa-dice-d20'),\n\tquestionCircle: new Icon('fa-question-circle'),\n\tinfoCircle: new Icon('fa-info-circle'),\n\texclamationTriangle: new Icon('fa-exclamation-triangle'),\n\tcog: new Icon('fa-cog'),\n\tshieldAlt: new Icon('fa-shield-alt'),\n\truler: new Icon('fa-ruler-combined'),\n\trulerCombined: new Icon('fa-ruler-combined'),\n\tbullseye: new Icon('fa-bullseye'),\n\ttable: new Icon('fa-table'),\n\tsignLanguage: new Icon('fa-sign-language'),\n\tpuzzlePiece: new Icon('fa-puzzle-piece'),\n\tsave: new Icon('fa-floppy-disk'),\n\tmitten: new Icon('fa-mitten'),\n\tspinner: new Icon('fa-spinner'),\n\tbatteryHalf: new Icon('fa-battery-half'),\n\teye: new Icon('fa-eye'),\n\teyeSlash: new Icon('fa-eye-slash'),\n\tsearch: new Icon('fa-search'),\n\tbook: new Icon('fa-book'),\n\tglobe: new Icon('fa-globe'),\n\tfilter: new Icon('fa-filter'),\n\tuser: new Icon('fa-user'),\n\tinfinity: new Icon('fa-infinity'),\n\tstar: new Icon('fa-star'),\n\tcrown: new Icon('fa-crown'),\n\trecycle: new Icon('fa-recycle'),\n\treset: new Icon('fa-rotate-left'),\n\tsync: new Icon('fa-sync'),\n\tsyncAlt: new Icon('fa-sync-alt'),\n\tfile: new Icon('fa-file'),\n\tfileAlt: new Icon('fa-file-alt'),\n\tfileExport: new Icon('fa-file-export'),\n\tfolder: new Icon('fa-folder'),\n\tfolderOpen: new Icon('fa-folder-open'),\n};\n",
    "import { CFG } from './config.mjs';\nimport { FAIcons } from '@core/icons.mjs';\n\n// HACK: Silence v12 deprecation warnings.\nexport const clampNum = Math.clamp ?? Math.clamped;\n\n/**\n * @param {Event} event - Event\n * @returns {Event} - Original event\n */\nexport function stopEventPropagation(event) {\n\tevent.preventDefault();\n\tevent.stopPropagation();\n\treturn event;\n}\n\nclass UserDataShim {\n\tid;\n\trole;\n\tname;\n\tget isGM() {\n\t\treturn this.role >= CONST.USER_ROLES.ASSISTANT;\n\t}\n\n\tconstructor({ name, role, id } = {}) {\n\t\tthis.id = id;\n\t\tthis.name = name;\n\t\tthis.role = role;\n\t}\n}\n\nexport function getUserFromData() {\n\tconst data = game.data; // Same for v9 and onwards\n\tconst id = data?.userId;\n\tconst userData = id ? data.users?.find(u => u._id === id) ?? {} : {};\n\treturn new UserDataShim({ id, name: userData.name, role: userData.role ?? 0 });\n}\n\nexport const setSheetMarker = (sheet, flag, id, callback) => {\n\tsheet.___littleHelper ??= {};\n\tconst h = sheet.___littleHelper;\n\tif (h[flag]?.fn) h[flag].fn(sheet);\n\th[flag] = { fn: callback, id };\n};\n\nexport const delSheetMarker = (sheet, flag, id) => {\n\tsheet.___littleHelper ??= {};\n\tconst h = sheet.___littleHelper;\n\tif (h[flag]?.id === id) delete h[flag];\n};\n\nexport function getTransparency() {\n\treturn game.settings.get(CFG.id, 'transparency');\n}\n\nexport function testTransparency(user, doc) {\n\tif (!doc) return true;\n\tswitch (getTransparency()) {\n\t\tcase 3:\n\t\t\treturn doc.testUserPermission(user, CONST.DOCUMENT_OWNERSHIP_LEVELS.OWNER);\n\t\tcase 2:\n\t\t\treturn doc.testUserPermission(user, CONST.DOCUMENT_OWNERSHIP_LEVELS.OBSERVER);\n\t\tcase 1:\n\t\t\treturn doc.hasPlayerOwner ?? doc.document?.hasPlayerOwner;\n\t\tdefault:\n\t\t\treturn true;\n\t}\n}\n\n/**\n * Scrubs details from a formula.\n *\n * @param {string} formula\n * @param {boolean} stripDetail\n * @returns {string} - Stripped formula\n */\nexport function compressFormula(formula, stripDetail = true) {\n\tif (stripDetail) {\n\t\tformula = formula\n\t\t\t.replaceAll(/\\s+/g, '') // remove whitespace\n\t\t\t.replaceAll(/\\[[^\\]]+]/g, ''); // remove flairs\n\t}\n\treturn formula.replaceAll(/\\s+\\+\\s*-\\s+/g, ' - '); // Combine + -\n}\n\n/**\n * @param {User} user\n * @returns {boolean} Returns true if GM content should be hidden regardless of transparency.\n */\nexport function hideFromNonGM(user) {\n\tif (user.isGM) return false; // is GM so not hidden\n\treturn game.settings.get(CFG.id, CFG.SETTINGS.transparencySham);\n}\n\nexport function enrichRoll(roll, formula, label, rollData = {}) {\n\tconst a = createNode('a', undefined, ['inline-roll', 'inline-result'], { tooltip: formula.replace('@check', rollData.check) });\n\ta.dataset.roll = escape(JSON.stringify(roll));\n\ta.innerHTML = `<i class='${FAIcons.d20}'></i> ${label}`;\n\treturn a;\n}\n\nconst trimProfs = (profs) => {\n\tif (Array.isArray(profs)) return profs;\n\telse return profs?.split(';').map(p => p?.trim()).filter(p => p?.length > 0) ?? [];\n};\n\nexport function unifyProficiency(prof) {\n\tif (prof == undefined) return [];\n\n\tif (prof.total) {\n\t\treturn [\n\t\t\t...prof.total,\n\t\t\t...trimProfs(prof.customTotal),\n\t\t]; // weapon/armor\n\t}\n\t// languaegs\n\treturn [\n\t\t...prof.value,\n\t\t...trimProfs(prof.custom),\n\t\t...trimProfs(prof.customTotal),\n\t];\n}\n\nexport const signNum = new Intl.NumberFormat(undefined, { signDisplay: 'always' }).format;\nexport const formatNum = new Intl.NumberFormat(undefined).format;\n\nexport function warningSymbol() {\n\tconst i = document.createElement('i');\n\ti.classList.add('fa-solid', 'fa-exclamation-triangle');\n\treturn i;\n}\n\nexport function constructWarning(warning, css = []) {\n\tconst symbol = warningSymbol();\n\taddCoreTooltip(symbol, warning);\n\tsymbol.classList.add('lil-warning-symbol', ...css);\n\treturn symbol;\n}\n\nexport function addWarning(el, warning) {\n\tif (!el) return;\n\tel.classList.add('lil-warning');\n\tel.prepend(constructWarning(warning));\n\treturn el;\n}\n\n/**\n * @param {string} node\n * @param {string | null} text\n * @param {string[]} classes\n * @param {object} options\n * @param {string | null} options.title\n * @param {boolean} options.isHTML\n * @param {Element[]} options.children\n * @param {object} [options.data] Object mapping for data-${key}=${value} values.\n * @param {object} [options.attr] Object mapping for arbitrary attributes.\n * @param options.tooltip\n * @returns {HTMLElement}\n */\nexport function createNode(node = 'span', text, classes = [], { tooltip, isHTML = false, children = [], data, attr } = {}) {\n\tconst n = document.createElement(node);\n\tif (text) {\n\t\tif (isHTML) n.innerHTML = text;\n\t\telse n.textContent = text;\n\t}\n\tif (classes.length > 0) n.classList.add(...classes.filter(c => !!c));\n\tif (children.length > 0) n.append(...children.filter(c => !!c));\n\tif (data) {\n\t\tfor (const [key, value] of Object.entries(data))\n\t\t\tn.setAttribute(`data-${key}`, value);\n\t}\n\tif (attr) {\n\t\tfor (const [key, value] of Object.entries(attr)) {\n\t\t\tif (value !== undefined)\n\t\t\t\tn.setAttribute(key, value);\n\t\t}\n\t}\n\tif (tooltip) addCoreTooltip(n, tooltip);\n\treturn n;\n}\n\n/**\n * Append elements in to el and return el.\n *\n * @param {HTMLElement} el Parent\n * @param {Element[]} els Children\n * @todo Remove the use of this\n */\nexport function appendElements(el, ...els) {\n\tel.append(...els);\n\treturn el;\n}\n\n/**\n * Basic testing to see if the user is allowed to view a message.\n *\n * @param {ChatMessage} cm\n * @param {User|null} user\n */\nexport function canViewChatMessage(cm, user = game.user) {\n\tconst whisper = cm.whisper;\n\n\t// GM sees all\n\tif (user.isGM) return true;\n\n\tconst isAuthor = cm.isAuthor;\n\n\tif (whisper.length > 0) {\n\t\t// Display if whisper target regardless of anything else\n\t\tif (!isAuthor) return whisper.includes(user.id);\n\n\t\t// Hide blind rolls from owner\n\t\tif (cm.blind) return false;\n\t}\n\n\t// Creator always sees as long as they pass above tests\n\tif (isAuthor) return true;\n\n\t// Hide GM rolls for non-GMs if transparency sham is enabled.\n\tif (cm.author?.role >= CONST.USER_ROLES.ASSISTANT && hideFromNonGM(user)) return false;\n\n\t// Show for all others.\n\treturn true;\n}\n\n/**\n * @param {number} num\n * @param {number} decimalPlaces\n * @param {\"round\"|\"ceil\"|\"floor\"} type Rounding function\n */\nexport function maxPrecision(num, decimalPlaces = 0, type = 'round') {\n\tconst p = Math.pow(10, decimalPlaces || 0),\n\t\tn = num * p * (1 + Number.EPSILON);\n\treturn Math[type](n) / p;\n}\n\n/**\n * @param {Actor} actor\n * @param {object} options\n * @param {Item} options.item Item instance\n * @param {string} options.condition Condition key\n * @returns {ActiveEffect|undefined}\n */\nexport const getRelevantAE = (actor, { item, condition } = {}) => {\n\tif (item && !condition) {\n\t\tconst ae = item.effect;\n\t\tif (ae) return ae;\n\t}\n\n\tconst effects = [...actor.allApplicableEffects()].filter(ae => ae.active);\n\tif (item) {\n\t\tconst options = { relative: actor };\n\t\treturn effects.find(ae => ae.origin ? fromUuidSync(ae.origin || '', options) === item : false);\n\t}\n\telse if (condition) {\n\t\tconst relevant = effects.filter(ae => ae.statuses.has(condition));\n\t\t// Attempt to establish order\n\t\trelevant.sort((a, b) => {\n\t\t\tif (a.origin && !b.origin) return -1;\n\t\t\tif (b.origin && !a.origin) return 1;\n\t\t\treturn a.statuses.size - b.statuses.size;\n\t\t});\n\t\treturn relevant[0];\n\t}\n};\n\n/**\n * @param {HTMLElement} element - Element to enrich\n * @param {string} content - Tooltip content\n * @param {\"UP\"|\"DOWN\"|\"LEFT\"|\"RIGHT\"} direction - Direction where to go\n * @param {string} css - Space deliminated list of CSS classes\n * @returns {HTMLElement} - Enriched element\n */\nexport function addCoreTooltip(element, content, direction, css) {\n\tconst tm = CONFIG.ux.TooltipManager;\n\n\tdirection ??= tm.TOOLTIP_DIRECTIONS.UP;\n\n\telement.dataset.tooltip = content;\n\tif (direction) element.dataset.tooltipDirection = direction;\n\tif (css) element.dataset.tooltipClass = css;\n\treturn element;\n}\n",
    "import { createNode, appendElements } from '@root/common.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nfunction benchPressBasics(content, shared) {\n\tconst actor = shared.actor;\n\tconst c = createNode('div', '', ['token-info', 'flexcol']);\n\n\tconst protoToken = actor.prototypeToken,\n\t\thasVision = protoToken.sight.enabled,\n\t\tlinkData = protoToken.actorLink,\n\t\tdisposition = `${protoToken.disposition}`,\n\t\tdisplayName = protoToken.displayName,\n\t\tdisplayBars = protoToken.displayBars;\n\n\tconst dispositionLabel = {\n\t\t0: 'TOKEN.DISPOSITION.NEUTRAL',\n\t\t1: 'TOKEN.DISPOSITION.FRIENDLY',\n\t\t'-1': 'TOKEN.DISPOSITION.HOSTILE',\n\t};\n\tconst dispositionStyle = {\n\t\t0: 'neutral',\n\t\t1: 'friendly',\n\t\t'-1': 'hostile',\n\t};\n\n\tconst displayLabel = {\n\t\t0: 'TOKEN.DISPLAY_NONE',\n\t\t10: 'TOKEN.DISPLAY_CONTROL',\n\t\t20: 'TOKEN.DISPLAY_OWNER_HOVER',\n\t\t30: 'TOKEN.DISPLAY_HOVER',\n\t\t40: 'TOKEN.DISPLAY_OWNER',\n\t\t50: 'TOKEN.DISPLAY_ALWAYS',\n\t};\n\n\tc.append(\n\t\tcreateNode('h2', 'Token Info'),\n\t\tappendElements(\n\t\t\tcreateNode('div', null, ['detail-content']),\n\t\t\tappendElements(\n\t\t\t\tcreateNode('div', '', ['flexrow']),\n\t\t\t\tcreateNode('h4', i18n.get('LittleHelper.Details.Token.Disposition'), ['header', 'width6']),\n\t\t\t\tcreateNode('label', i18n.get(dispositionLabel[disposition]), ['disposition', dispositionStyle[disposition], 'width14', 'value', 'center-text']),\n\t\t\t),\n\t\t\tappendElements(\n\t\t\t\tcreateNode('div', '', ['flexrow']),\n\t\t\t\tcreateNode('h4', i18n.get('Vision'), ['header', 'width6']),\n\t\t\t\tcreateNode('label', i18n.get(hasVision ? 'LittleHelper.Details.Token.Sighted' : 'LittleHelper.Details.Token.Blind'), [hasVision ? 'sighted' : 'blind', 'vision', 'width14', 'value', 'center-text']),\n\t\t\t),\n\t\t\tappendElements(\n\t\t\t\tcreateNode('div', '', ['flexrow']),\n\t\t\t\tcreateNode('h4', i18n.get('LittleHelper.Details.Token.Linked'), ['header', 'width6']),\n\t\t\t\tcreateNode('label', linkData ? 'Linked' : 'Unlinked', [linkData ? 'linked' : 'unlinked', 'linkstate', 'width14', 'value', 'center-text']),\n\t\t\t),\n\t\t\tappendElements(\n\t\t\t\tcreateNode('div', '', ['flexrow']),\n\t\t\t\tcreateNode('h4', i18n.get('TOKEN.CharShowNameplate'), ['header', 'width6']),\n\t\t\t\tcreateNode('label', i18n.get(displayLabel[displayName]), ['name-display', 'width14', 'value', 'center-text']),\n\t\t\t),\n\t\t\tappendElements(\n\t\t\t\tcreateNode('div', '', ['flexrow']),\n\t\t\t\tcreateNode('h4', i18n.get('TOKEN.ResourceDisplay'), ['header', 'width6']),\n\t\t\t\tcreateNode('label', i18n.get(displayLabel[displayBars]), ['bar-display', 'width14', 'value', 'center-text']),\n\t\t\t),\n\t\t),\n\t);\n\n\tcontent.append(c);\n}\n\nHooks.on('little-helper.details-tab.content', benchPressBasics);\n",
    "// Display Wealth by Level information\n\nimport { CFG } from '@root/config.mjs';\nimport { createNode, signNum, formatNum, appendElements, maxPrecision } from '@root/common.mjs';\n\nfunction convertToStandard(v) {\n\treturn v / pf1.config.currency.standardRate;\n}\n\nfunction formatCurrency(value, signed = false) {\n\tconst rate = pf1.config.currency.standardRate;\n\tconst unit = pf1.config.currency.standard;\n\n\tconst formatter = signed ? signNum : formatNum;\n\n\treturn game.i18n.format(`PF1.Currency.Inline.${unit}`, { value: formatter(pf1.utils.limitPrecision(value / rate, 2)) });\n}\n\n/**\n * Gets all coinage\n *\n * @param {ActorPF} actor\n * @returns {number} - Total coinage in lowest denomination\n */\nfunction getTotalCurrency(actor) {\n\tconst items = this.actor.allItems.filter(item => item.isPhysical);\n\n\tlet cp;\n\n\tfor (const item of items) {\n\t\t//\n\t}\n\n\tconst total = items.reduce((current, index) => {\n\t\treturn current + index.getValue({ recursive: true, sellValue: 1, inLowestDenomination: true });\n\t}, 0);\n\n\treturn total;\n}\n\nconst wealthByLevel = {\n\t2: 1000,\n\t3: 3000,\n\t4: 6000,\n\t5: 10_500,\n\t6: 16_000,\n\t7: 23_500,\n\t8: 33_000,\n\t9: 46_000,\n\t10: 62_000,\n\t11: 82_000,\n\t12: 108_000,\n\t13: 140_000,\n\t14: 185_000,\n\t15: 240_000,\n\t16: 315_000,\n\t17: 410_000,\n\t18: 530_000,\n\t19: 685_000,\n\t20: 880_000,\n};\n\nconst getValue = (index) => index.getValue({ inLowestDenomination: true, sellValue: 1 });\n\nfunction getItemValue(item, grouped, contained = false) {\n\tlet currency = item.getTotalCurrency?.({ inLowestDenomination: true }) ?? 0;\n\tconst value = item.getValue({ sellValue: 1, inLowestDenomination: true, recursive: false });\n\n\tswitch (item.type) {\n\t\tcase 'loot':\n\t\t\tswitch (item.subType) {\n\t\t\t\tcase 'treasure':\n\t\t\t\tcase 'tradeGoods':\n\t\t\t\t\tgrouped.tradeGoods = value;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'ammo':\n\t\t\t\t\tgrouped.ammunition += value;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'weapon': {\n\t\t\tconst equipped = item.isActive;\n\t\t\tif (!contained && equipped) break;\n\t\t\tgrouped.unusedWeapons += value;\n\t\t\tbreak;\n\t\t}\n\t\tcase 'equipment': {\n\t\t\tconst equipped = item.isActive;\n\t\t\tif (!contained && equipped) break;\n\n\t\t\tswitch (item.subType) {\n\t\t\t\tcase 'armor':\n\t\t\t\tcase 'shield':\n\t\t\t\t\tgrouped.unusedArmor += value;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tgrouped.unusedGear += value;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tcase 'consumable':\n\t\t\tgrouped.consumables += value;\n\t\t\tbreak;\n\t}\n\n\tlet items = 0;\n\tif (item.type === 'container') {\n\t\tfor (const sitem of item.items) {\n\t\t\tconst iv = getItemValue(sitem, grouped, true);\n\t\t\titems += iv.items + iv.value;\n\t\t\tcurrency += iv.currency;\n\t\t}\n\t}\n\n\treturn {\n\t\tcurrency,\n\t\titems,\n\t\tvalue,\n\t\tget total() {\n\t\t\treturn this.currency || 0 + this.items || 0 + this.value || 0;\n\t\t},\n\t};\n}\n\n/**\n * Get total item value\n *\n * @param {ActorPF} actor\n * @param grouped\n */\nfunction getTotalInventoryValue(actor, grouped) {\n\tlet inventory = 0;\n\tlet currency = 0;\n\tlet contents = 0;\n\n\tfor (const item of actor.items) {\n\t\tif (!item.isPhysical) continue;\n\n\t\tconst iv = getItemValue(item, grouped);\n\t\tinventory += iv.value;\n\t\tcurrency += iv.currency;\n\t\tcontents += iv.items;\n\t}\n\n\treturn {\n\t\tcontents,\n\t\tcurrency,\n\t\tinventory,\n\t};\n}\n\n/**\n *\n * @param {*} content\n * @param {SharedData} shared\n */\nfunction wealthByLevelProvider(content, shared) {\n\t/** @type {ActorPF} */\n\tconst actor = shared.actor;\n\tconst actorData = actor.system;\n\n\t/** @type {number} */\n\tconst ratio = game.settings.get(CFG.id, CFG.SETTINGS.wbl);\n\tconst standardRate = pf1.config.currency.standardRate;\n\n\t/** @type {number} */\n\tconst lv = actorData.details.level.value;\n\n\tconst typedValue = {\n\t\ttradegoods: 0,\n\t\tconsumables: 0,\n\t\tammunition: 0,\n\t\tunusedWeapons: 0,\n\t\tunusedArmor: 0,\n\t\tunusedGear: 0,\n\t};\n\n\t/** @type {number} */\n\tconst tvt = getTotalInventoryValue(actor, typedValue); // Total value, not counting coins\n\n\tconst inventoryValue = tvt.inventory + tvt.contents;\n\n\tconst directCoinage = actor.getTotalCurrency?.({ inLowestDenomination: true }) ?? 0;\n\tconst currency = directCoinage + tvt.currency;\n\n\tconst totalWealth = inventoryValue + currency;\n\n\t/** @type {number} */\n\tconst normalWbl = wealthByLevel[lv] ?? Number.NaN;\n\tconst wbl = normalWbl * ratio;\n\tconst diff = totalWealth - wbl * 100;\n\n\tlet wblTooltip;\n\tif (ratio !== 1) wblTooltip = `${Math.round(ratio * 100)}% of ${formatCurrency(normalWbl * standardRate)}`;\n\n\tconst unused = 0;\n\n\tconst headerLabel = createNode('h2', 'Wealth by Level');\n\tif (ratio !== 1) headerLabel.append(createNode('span', `${Math.round(ratio * 100)}%`, ['ratio']));\n\n\tconst c = createNode('div', '', ['wealth-by-level', 'flexcol']);\n\tc.append(\n\t\theaderLabel,\n\t\tappendElements(\n\t\t\tcreateNode('div', undefined, ['detail-content']),\n\t\t\tappendElements(\n\t\t\t\tcreateNode('div', '', ['flexrow']),\n\t\t\t\tcreateNode('h4', 'Expected', ['header', 'width8']),\n\t\t\t\tcreateNode('label', formatCurrency(wbl * standardRate), ['expected', 'width8', 'value', 'number'], { tooltip: wblTooltip }),\n\t\t\t),\n\t\t\tappendElements(\n\t\t\t\tcreateNode('div', '', ['flexrow']),\n\t\t\t\tcreateNode('h4', 'Possessed', ['header', 'width8']),\n\t\t\t\tcreateNode('label', formatCurrency(totalWealth), ['total-value', 'width8', 'value', 'number']),\n\t\t\t\tcreateNode('label', `[${maxPrecision((totalWealth) / (wbl * standardRate) * 100, 2)}% of WBL]`, ['percentage']),\n\t\t\t),\n\t\t\tappendElements(\n\t\t\t\tcreateNode('div', '', ['flexrow']),\n\t\t\t\tcreateNode('h4', 'â€“ Unused', ['header', 'width8']),\n\t\t\t\tcreateNode('label', formatCurrency(unused), ['unused', 'width8', 'value', 'number']),\n\t\t\t\tcreateNode('label', `[${inventoryValue > 0 ? maxPrecision(unused / inventoryValue * 100, 2) : 0}% wealth]`, ['unused', 'percentage']),\n\t\t\t),\n\t\t\tappendElements(\n\t\t\t\tcreateNode('div', '', ['flexrow']),\n\t\t\t\tcreateNode('h4', 'â€“ Consumables', ['header', 'width8']),\n\t\t\t\tcreateNode('label', formatCurrency(typedValue.consumables), ['consumables', 'width8', 'value', 'number']),\n\t\t\t\tcreateNode('label', `[${inventoryValue > 0 ? maxPrecision(typedValue.consumables / inventoryValue * 100, 2) : 0}% wealth]`, ['unused', 'percentage']),\n\t\t\t),\n\t\t\tappendElements(\n\t\t\t\tcreateNode('div', '', ['flexrow']),\n\t\t\t\tcreateNode('h4', 'â€“ Ammunition', ['header', 'width8']),\n\t\t\t\tcreateNode('label', formatCurrency(typedValue.ammunition), ['ammunition', 'width8', 'value', 'number']),\n\t\t\t\tcreateNode('label', `[${inventoryValue > 0 ? maxPrecision(typedValue.ammunition / inventoryValue * 100, 2) : 0}% wealth]`, ['unused', 'percentage']),\n\t\t\t),\n\t\t\tappendElements(\n\t\t\t\tcreateNode('div', '', ['flexrow']),\n\t\t\t\tcreateNode('h4', 'â€“ Trade goods', ['header', 'width8']),\n\t\t\t\tcreateNode('label', formatCurrency(typedValue.tradegoods), ['trade-goods', 'width8', 'value', 'number']),\n\t\t\t\tcreateNode('label', `[${inventoryValue > 0 ? maxPrecision(typedValue.tradegoods / inventoryValue, 2) : 0}% wealth]`, ['unused', 'percentage']),\n\t\t\t),\n\t\t\tappendElements(\n\t\t\t\tcreateNode('div', '', ['flexrow']),\n\t\t\t\tcreateNode('h4', 'â€“ Coinage', ['header', 'width8']),\n\t\t\t\tcreateNode('label', formatCurrency(currency), ['total-coinage', 'width8', 'value', 'number']),\n\t\t\t\tcreateNode('label', `[${currency > 0 ? maxPrecision(currency / totalWealth * 100, 2) : 0}% wealth]`, ['unused', 'percentage']),\n\t\t\t),\n\t\t\tappendElements(\n\t\t\t\tcreateNode('div', '', ['flexrow']),\n\t\t\t\tcreateNode('h4', 'Difference', ['header', 'width8']),\n\t\t\t\tcreateNode('label', formatCurrency(diff, true), ['diff', 'width8', 'value', 'number']),\n\t\t\t\tcreateNode('label', diff >= 0 ? 'ahead' : 'behind'),\n\t\t\t),\n\t\t\tcreateNode('p', 'This does not take into account fine untrackable details, such as carrying items for other people, nor can it identify backup gear or similar reliably.'),\n\t\t),\n\t);\n\n\tcontent.append(c);\n}\n\nHooks.on('little-helper.details-tab.content', wealthByLevelProvider);\n",
    "import { createNode, appendElements, maxPrecision } from '@root/common.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nconst getPackedSize = (obj) => JSON.stringify(obj).length;\n\nconst actorStats = (content, shared) => {\n\tconst actor = shared.actor;\n\tconst c = createNode('div', '', ['actor-stats', 'flexcol']);\n\n\tconst obj = actor.toObject();\n\tconst actorSize = getPackedSize(obj);\n\tconst itemsSize = getPackedSize(obj.items);\n\tconst itemCount = obj.items.length;\n\n\tconst itemTypeSizes = {};\n\tfor (const item of actor.items) {\n\t\tconst type = item.type;\n\t\titemTypeSizes[type] ??= { size: 0, count: 0, biggest: { size: 0, name: null } };\n\t\tconst t = itemTypeSizes[type];\n\t\tt.count += 1;\n\t\tconst size = getPackedSize(item);\n\t\tt.size += size;\n\t\tif (size > t.biggest.size) {\n\t\t\tt.biggest.size = size;\n\t\t\tt.biggest.name = item.name;\n\t\t}\n\t}\n\n\tlet itemTypeSizeArray = [];\n\tfor (const [type, value] of Object.entries(itemTypeSizes)) itemTypeSizeArray.push({ type, ...value });\n\titemTypeSizeArray = itemTypeSizeArray.sort((a, b) => b.size - a.size).slice(0, 3);\n\n\tconst itemRows = [];\n\tfor (const stack of itemTypeSizeArray) {\n\t\tif (stack.size === 0) continue;\n\n\t\tconst typeSize = appendElements(\n\t\t\tcreateNode('div', '', ['flexrow']),\n\t\t\tcreateNode('h4', `â€“ ${stack.type}`, ['header', 'width8']),\n\t\t\tcreateNode('label', `${maxPrecision(stack.size / 1_000, 2)} kB`, ['items-size', 'width8', 'value', 'number']),\n\t\t\tcreateNode('label', `[${stack.count} entries; ${maxPrecision(stack.size / itemsSize * 100, 2)}% of all items]`, ['count', 'percentage']),\n\t\t);\n\t\t/*\n\t\tconst typeBiggestSize = appendElements(\n\t\t\tcreateNode('div', '', ['flexrow']),\n\t\t\tcreateNode('h4', `â€“ ${stack.type}: ${stack.biggest.name}`, ['header', 'width8']),\n\t\t\tcreateNode('label', `${maxPrecision(stack.biggest.size / 1_000, 2)} kB`, ['items-size', 'width8', 'value', 'number']),\n\t\t\tcreateNode('label', `[${maxPrecision(stack.biggest.size / stack.size * 100, 2)}% of type]`, ['percentage']),\n\t\t);\n\t\t*/\n\t\titemRows.push(typeSize /* , typeBiggestSize*/);\n\t}\n\n\tc.append(\n\t\tcreateNode('h2', 'Stats'),\n\t\tappendElements(\n\t\t\tcreateNode('div', null, ['detail-content']),\n\t\t\tappendElements(\n\t\t\t\tcreateNode('div', '', ['flexrow']),\n\t\t\t\tcreateNode('h4', 'Total Size', ['header', 'width8']),\n\t\t\t\tcreateNode('label', `${maxPrecision(actorSize / 1_000, 2)} kB`, ['size', 'width8', 'value', 'number']),\n\t\t\t),\n\t\t\tappendElements(\n\t\t\t\tcreateNode('div', '', ['flexrow']),\n\t\t\t\tcreateNode('h4', 'Items', ['header', 'width8']),\n\t\t\t\tcreateNode('label', `${(itemsSize / 1_000).toFixed(2)} kB`, ['items-size', 'width8', 'value', 'number']),\n\t\t\t\tcreateNode('label', `[${maxPrecision(itemsSize / actorSize * 100, 2)}% of total; ${itemCount} entries]`, ['count', 'percentage']),\n\t\t\t),\n\t\t\t...itemRows,\n\t\t),\n\t);\n\n\tcontent.append(c);\n};\n\nHooks.on('little-helper.details-tab.content', actorStats);\n",
    "/* eslint-disable style/key-spacing */\n/* eslint-disable style/array-bracket-spacing */\n/* eslint-disable style/no-multi-spaces */\n\nimport { i18n } from '@root/utility/i18n.mjs';\nimport { createNode, signNum, appendElements, clampNum } from '@root/common.mjs';\n\nconst BP = {\n\tbase: {\n\t\tlevel:   [ 1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20], // for reference\n\t},\n\ttake2: {\n\t\t// Source: https://docs.google.com/spreadsheets/d/1CvlqyaockPeeL56je7y1Fba7npoJXeJoYNPUOtprBEs/edit#gid=0\n\t\tattack:  [ 9, 10, 11, 13, 14, 15, 17, 18, 19, 23, 24, 27, 28, 30, 34, 34, 35, 37, 42, 43],\n\t\tarmor:   [18, 20, 21, 22, 24, 26, 28, 29, 31, 32, 34, 35, 37, 38, 39, 41, 42, 46, 47, 47],\n\t\tsave:    [ 5,  6,  7,  8,  8,  9, 10, 11, 11, 12, 13, 14, 14, 15, 16, 17, 17, 18, 19, 20],\n\t\t// spellcasting\n\t\tbaddc:   [19, 20, 21, 21, 22, 23, 24, 25, 25, 26, 26, 28, 28, 30, 31, 29, 31, 33, 32, 35],\n\t\tgooddc:  [20, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 36, 38, 38, 40],\n\t},\n\ttake4: {\n\t\t// Source: https://docs.google.com/spreadsheets/d/1YEH6soDFkmGYi-BJI625UkfOb_Wjjw2D6oUApj0XFjo/edit#gid=0\n\t\tattack:  [ 7,  8,  9, 10, 11, 12, 13, 14, 16, 17, 18, 20, 21, 22, 23, 24, 25, 27, 27, 30],\n\t\tarmor:   [18, 20, 21, 23, 25, 27, 28, 30, 31, 32, 34, 36, 37, 38, 40, 42, 45, 45, 47, 48],\n\t\tsave:    [ 5,  6,  7,  8,  9, 10, 11, 12, 13, 13, 15, 15, 15, 17, 18, 19, 20, 22, 24, 24],\n\t\t// spellcasting\n\t\tbaddc:   [16, 17, 17, 18, 19, 20, 21, 22, 22, 24, 24, 25, 25, 27, 27, 27, 28, 29, 30, 31],\n\t\tgooddc:  [18, 19, 20, 20, 22, 23, 24, 25, 26, 25, 28, 29, 29, 31, 31, 32, 34, 35, 36, 38],\n\t},\n};\n\nfunction benchPressBasics(content, shared) {\n\tconst actor = shared.actor;\n\tconst c = createNode('div', '', ['benchpress', 'flexcol']);\n\n\tconst actorData = actor.system;\n\n\tconst press = BP.take4;\n\n\tconst level = actorData.details.level.value,\n\t\tindex = clampNum(level - 1, 0, 19);\n\tconst saves = Object.values(actorData.attributes.savingThrows).map(s => signNum(s.total)).join('/');\n\n\tconst coreAttack = actorData.attributes.attack.shared + actorData.attributes.attack.general,\n\t\tszMod = pf1.config.sizeMods[actorData.traits.size],\n\t\tmeleeAtkAbl = foundry.utils.getProperty(actorData, `abilities.${actorData.attributes.attack.meleeAbility}.mod`) ?? 0,\n\t\trangedAtkAbl = foundry.utils.getProperty(actorData, `abilities.${actorData.attributes.attack.rangedAbility}.mod`) ?? 0,\n\t\trAtk = coreAttack + szMod + actorData.attributes.attack.ranged + rangedAtkAbl,\n\t\tmAtk = coreAttack + szMod + actorData.attributes.attack.melee + meleeAtkAbl,\n\t\tbestAtk = Math.max(rAtk, mAtk);\n\n\tc.append(\n\t\tcreateNode('h2', 'Bench-Pressing'),\n\t\tappendElements(createNode('div', null, ['detail-content']),\n\t\t\tappendElements(createNode('div', null, ['flexrow', 'header']),\n\t\t\t\tcreateNode('label', null, ['header', 'width6']),\n\t\t\t\tcreateNode('label', 'Armor', ['header', 'width4', 'number']),\n\t\t\t\tcreateNode('label', 'Attack', ['header', 'width4', 'number']),\n\t\t\t\tcreateNode('label', 'Saves', ['header', 'width6', 'number']),\n\t\t\t),\n\t\t\tappendElements(createNode('div', null, ['flexrow', 'have']),\n\t\t\t\tcreateNode('label', 'Possessed', ['header', 'width6']),\n\t\t\t\tcreateNode('label', `${actorData.attributes.ac.normal.total}`, ['have', 'value', 'number', 'width4']),\n\t\t\t\tcreateNode('label', `${signNum(bestAtk)}`, ['have', 'value', 'number', 'width4']),\n\t\t\t\tcreateNode('label', `${saves}`, ['have', 'value', 'number', 'width6']),\n\t\t\t),\n\t\t\tappendElements(createNode('div', null, ['flexrow']),\n\t\t\t\tcreateNode('label', 'Expected', ['header', 'width6', 'number']),\n\t\t\t\tcreateNode('label', `${press.armor[index]}`, ['expected', 'value', 'number', 'width4']),\n\t\t\t\tcreateNode('label', `${signNum(press.attack[index])}`, ['expected', 'value', 'number', 'width4']),\n\t\t\t\tcreateNode('label', `${signNum(press.save[index])}`, ['expected', 'value', 'number', 'width6']),\n\t\t\t),\n\t\t\t/*\n\t\t\tappendElements(createNode('div', null, ['flexrow']),\n\t\t\t\tcreateNode('label', 'Difference', ['header', 'width4', 'number'])\n\t\t\t\tcreateNode('label', `??`, ['diff', 'value', 'number','header', 'width4']),\n\t\t\t\tcreateNode('label', `??`, ['diff', 'value', 'number','header', 'width4']),\n\t\t\t\tcreateNode('label', `??`, ['diff', 'value', 'number','header', 'width4']),\n\t\t\t)\n\t\t\t*/\n\t\t\tcreateNode('p', i18n.get('LittleHelper.Details.BenchPressing.Disclaimer'), [], { isHTML: true }),\n\t\t),\n\t);\n\n\tcontent.append(c);\n}\n\nHooks.on('little-helper.details-tab.content', benchPressBasics);\n",
    "import { createNode, appendElements } from '@root/common.mjs';\n\nasync function openAESheet(ev, actor) {\n\tev.preventDefault();\n\n\tconst el = ev.target.closest('.active-effects .active-effect[data-effect-uuid]');\n\tif (!el) return;\n\n\tconst aeId = el.dataset.effectUuid;\n\tconst ae = await fromUuid(aeId);\n\tae.sheet.render(true, { focus: true });\n}\n\nfunction detailActiveEffects(content, shared) {\n\tconst actor = shared.actor;\n\tconst c = createNode('div', undefined, ['flexcol']);\n\n\tconst g = createNode('ul', undefined, ['active-effects']);\n\tc.append(\n\t\tcreateNode('h2', 'Active Effects', ['lil-details-active-effects']),\n\t\tappendElements(createNode('div', undefined, ['detail-content']), g),\n\t);\n\n\tg.append(createNode('li', undefined, ['header'], {\n\t\tchildren: [\n\t\t\tcreateNode('span', 'Â ', ['image']),\n\t\t\tcreateNode('span', 'Name', ['name']),\n\t\t\tcreateNode('span', 'Â ', ['image']),\n\t\t\tcreateNode('span', 'Origin', ['origin']),\n\t\t\tcreateNode('span', 'Duration', ['duration']),\n\t\t],\n\t}));\n\n\tconst effects = [...actor.allApplicableEffects()];\n\n\tif (effects.length > 0) {\n\t\tfor (const ae of effects) {\n\t\t\tconst icon = ae.img,\n\t\t\t\toriginLink = ae.origin;\n\n\t\t\tlet origin = originLink ? fromUuidSync(originLink, { relative: actor }) : undefined;\n\t\t\tconst parent = ae.parent;\n\t\t\torigin ??= parent;\n\t\t\tconst itemImage = origin?.img ?? '',\n\t\t\t\thaveOrigin = !!origin;\n\n\t\t\tg.append(createNode('li', undefined, ['active-effect'], {\n\t\t\t\tdata: { 'effect-uuid': ae.uuid },\n\t\t\t\tchildren: [\n\t\t\t\t\tcreateNode('span', icon ? undefined : 'Â ', ['image', 'image-ae'], { children: icon ? [createNode('img', undefined, [], { attr: { src: icon } })] : [] }),\n\t\t\t\t\tcreateNode('span', ae.name || ae.label, ['name', 'ae-label']),\n\t\t\t\t\tcreateNode('span', haveOrigin ? undefined : 'Â ', ['image', 'image-ae', haveOrigin ? 'present' : 'missing'], { children: haveOrigin ? [createNode('img', undefined, [], { attr: { src: itemImage } })] : [] }),\n\t\t\t\t\tcreateNode('span', origin?.name ?? (originLink ? '[missing]' : '[n/a]'), ['name', 'origin', haveOrigin ? 'present' : 'missing']),\n\t\t\t\t\tcreateNode('span', ae.duration.seconds, ['duration']),\n\t\t\t\t],\n\t\t\t}));\n\t\t}\n\t}\n\telse {\n\t\tg.append('', createNode('p', 'No active effects found.', ['hint', 'span-all']));\n\t}\n\n\tg.addEventListener('contextmenu', ev => openAESheet(ev, actor));\n\n\tcontent.append(c);\n}\n\nHooks.on('little-helper.details-tab.content', detailActiveEffects);\n",
    "import './token-info.mjs';\nimport './wealth-by-level.mjs';\nimport './actor-stats.mjs';\nimport './benchpress.mjs';\nimport './active-effects.mjs';\n",
    "const MODULE_ID = 'koboldworks-pf1-little-helper';\n\nexport function registerTests() {\n\ttry {\n\t\tconst api = game.modules.get(MODULE_ID).api;\n\n\t\t/* global quench */\n\t\tquench.registerBatch(\n\t\t\t`${MODULE_ID}.formulas`,\n\t\t\tasync function formulaResolution({ describe, it, expect, before, after } = {}) {\n\t\t\t\tdescribe('Formula Resolution', function resolveFormulas() {\n\t\t\t\t\tconst rollData = {\n\t\t\t\t\t\tdex: 2,\n\t\t\t\t\t\tbab: 17,\n\t\t\t\t\t\tsize: 4,\n\t\t\t\t\t};\n\n\t\t\t\t\tconst formulas = {\n\t\t\t\t\t\t'3d6+(@dex)d6+2': '3d6+2d6+2',\n\t\t\t\t\t\t'@dex > 1 ? 5 : 2': '5',\n\t\t\t\t\t\t'@dex > 1 ? (2 < 1 ? 3 : 4) : 5': '4',\n\t\t\t\t\t\t'sizeRoll(1,12,@size)+1d8+6+2+1-2-6+2': '1d12+1d8+3',\n\t\t\t\t\t\t'-(1 + (floor(@bab / 4))) + 1': '-4',\n\t\t\t\t\t\t'@formulaicAttack * -5': '0',\n\t\t\t\t\t\t'2 <= 4 ? 1 : (floor(2 / 11 + 1)d6)': '1',\n\t\t\t\t\t\t'2 <= 4 ? 1 : floor(2 / 11 + 1)d6': '1',\n\t\t\t\t\t\t'4>=10 ? 0 : 4>=5 ? -2 : -4': '-4',\n\t\t\t\t\t\t'2 + 2 * 2 ** 2': '10',\n\t\t\t\t\t\t'2 + 2 ** 2 * 2': '10',\n\t\t\t\t\t\t'-5 + 1': '-4',\n\t\t\t\t\t\t'2 * 2 + -6 / 2': '1',\n\t\t\t\t\t\t'4d6-0+2': '4d6+2',\n\t\t\t\t\t\t'sizeRoll(1, 12)': '1d12',\n\t\t\t\t\t\t'sizeRoll(2, 6, 5) + 5 + 2': '3d6+7',\n\t\t\t\t\t\t'(floor(5/2))d6': '2d6',\n\t\t\t\t\t\t'max(1d6,4)': 'max(1d6,4)',\n\t\t\t\t\t\t'(--2 + 3)': '5', // Resulted in NaN before\n\t\t\t\t\t\t'1d8 + min(2,3)': '1d8+2',\n\t\t\t\t\t\t'sizeRoll(1, 8, @size) + 2 + 2': '1d8+4',\n\t\t\t\t\t};\n\n\t\t\t\t\tfor (const [formula, expected] of Object.entries(formulas)) {\n\t\t\t\t\t\tit(formula, function () {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tconst rv = api.formula.simplify(formula, rollData, { debug: true });\n\t\t\t\t\t\t\t\tconsole.log('Formula Testing:', rv.formula, '=', expected, rv);\n\t\t\t\t\t\t\t\texpect(rv.formula).to.equal(expected);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcatch (err) {\n\t\t\t\t\t\t\t\tconsole.warn('Failed to parse:', formula);\n\t\t\t\t\t\t\t\tthrow err;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t{ displayName: 'Koboldworks â€“ Little Helper ðŸ¦Ž' },\n\t\t);\n\t}\n\tcatch (err) {\n\t\tconsole.error(err);\n\t}\n}\n",
    "import { CFG } from './config.mjs';\n\nimport { i18n } from './utility/i18n.mjs';\n\nimport './common.mjs';\nimport '@core/settings.mjs';\n\nimport './data/_init.mjs';\n\nimport './ancillary.mjs';\nimport '@core/feature.mjs';\n\nimport '@core/feature-setup.mjs';\n\nimport './context/_init.mjs';\nimport './modules/_init.mjs';\n\nimport './info/_init.mjs';\n\nimport './config/_init.mjs';\n\nimport '@core/keybindings.mjs';\n\nimport './migration/migration.mjs';\n\n// Load HBS templates\nHooks.once('setup', () => {\n\tfoundry.applications.handlebars.loadTemplates([`modules/${CFG.id}/templates/subsettings.hbs`]);\n});\n\n// i18n support\nHooks.once('setup', function i18nSetup() {\n\t// Hack to counter Foundry allowing dependencies to be disabled\n\tif (!game.modules.get('lib-wrapper')?.active)\n\t\tui.notifications.error('Little Helper requires libWrapper module to be enabled to function correctly', { permanent: true });\n\n\tconst C = CFG.console.colors;\n\tconsole.debug('%cLittle Helper%c ðŸ¦Ž | i18n | Calling pre-translation hooks', C.main, C.unset);\n\tHooks.callAll('little-helper.i18n', CFG.i18n);\n\n\tconsole.debug('%cLittle Helper%c ðŸ¦Ž | i18n | Pre-translating', C.main, C.unset);\n\tfor (const category of Object.values(CFG.i18n)) {\n\t\tfor (const [key, value] of Object.entries(category)) {\n\t\t\ttry {\n\t\t\t\tcategory[key] = i18n.has(value) ? i18n.get(value) : value;\n\t\t\t\tcategory[key] = category[key].replaceAll('\\n\\n', '<p>').replaceAll('\\n', '<br>'); // Add line-breaks\n\t\t\t}\n\t\t\tcatch (err) {\n\t\t\t\tconsole.error(category, key, value);\n\t\t\t\tdelete category[key];\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t}\n\t}\n});\n\nHooks.once('init', () => {\n\tgame.modules.get(CFG.id).api = CFG.API;\n\n\tif (game.modules.get('quench')?.active) {\n\t\t// This import fails for unknown reasons\n\t\tHooks.on('quenchReady', async function () {\n\t\t\ttry {\n\t\t\t\tawait import('./tests/unit-tests.mjs')\n\t\t\t\t\t.then(m => m.registerTests())\n\t\t\t\t\t.catch(err => console.error(err));\n\t\t\t}\n\t\t\tcatch (err) {\n\t\t\t\tconsole.error(err);\n\t\t\t}\n\t\t});\n\t}\n});\n",
    "import { CFG } from '../config.mjs';\n\nimport { ClientSettingsData } from './feature.mjs';\nimport { ClientSettingsDialog } from './settings-client.mjs';\n// import { WorldSettingsData, WorldSettingsDialog } from './settings-world.mjs';\n\nimport { FAIcons } from './icons.mjs';\n\nHooks.once('init', function registerSettings() {\n\tconst fields = foundry.data.fields;\n\n\tconst C = CFG.console.colors;\n\tconsole.debug('%cLittle Helper%c ðŸ¦Ž | Registering Settings', C.main, C.unset);\n\n\t/*\n\tgame.settings.register(\n\t\tCFG.id,\n\t\tCFG.SETTINGS.generalWorldConfiguration,\n\t\t{\n\t\t\ttype: Object,\n\t\t\tdefault: WorldSettingsData.default(),\n\t\t\tscope: 'world',\n\t\t\tconfig: false,\n\t\t}\n\t);\n\t*/\n\n\tgame.settings.register(\n\t\tCFG.id,\n\t\tCFG.SETTINGS.generalClientConfiguration,\n\t\t{\n\t\t\ttype: Object,\n\t\t\tdefault: ClientSettingsData.default(),\n\t\t\tscope: 'client',\n\t\t\tconfig: false,\n\t\t\t// onChange: () => debouncedReload()\n\t\t},\n\t);\n\n\t// game.settings.get(CFG.id, CFG.SETTINGS.generalClientConfiguration);\n\t// game.settings.get(CFG.id, CFG.SETTINGS.generalWorldConfiguration);\n\n\tgame.settings.register(\n\t\tCFG.id,\n\t\tCFG.SETTINGS.transparency,\n\t\t{\n\t\t\tname: 'Transparency',\n\t\t\thint: 'What permission level is required to display certain potentially sensitive information.',\n\t\t\tconfig: true,\n\t\t\tscope: 'world',\n\t\t\ttype: Number,\n\t\t\tdefault: 3,\n\t\t\tchoices: {\n\t\t\t\t3: 'Owner',\n\t\t\t\t2: 'Observer',\n\t\t\t\t1: 'Player-owned',\n\t\t\t\t0: 'Any (full transparency)',\n\t\t\t},\n\t\t\trequiresReload: true,\n\t\t},\n\t);\n\n\tgame.settings.register(\n\t\tCFG.id,\n\t\tCFG.SETTINGS.transparencySham,\n\t\t{\n\t\t\tname: 'GM special case for transparency',\n\t\t\thint: 'GM is treated as special case for transparency. If enabled, various information enhancements are not applied to GM generated content regardless of the general transparency setting. This exists mostly as compatibility shim with other modules that want to obfuscate information.',\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t\tconfig: true,\n\t\t\tscope: 'world',\n\t\t\trequiresReload: true,\n\t\t},\n\t);\n\n\t/*\n\tgame.settings.register(\n\t\tCFG.id,\n\t\tCFG.SETTINGS.chat,\n\t\t{\n\t\t\ttype: Object,\n\t\t\tdefault: {},\n\t\t\tconfig: false,\n\t\t\tscope: 'client',\n\t\t\trequiresReload: true,\n\t\t}\n\t);\n\t*/\n\n\tgame.settings.register(\n\t\tCFG.id,\n\t\tCFG.SETTINGS.inlineFormulaDetail,\n\t\t{\n\t\t\tname: 'Detailed inline formulas',\n\t\t\thint: 'Display greater detail for inline formulas. If disabled, flairs and excess details are scrubbed.',\n\t\t\tconfig: true,\n\t\t\tscope: 'client',\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t\trequiresReload: true,\n\t\t},\n\t);\n\n\tgame.settings.register(CFG.id, CFG.SETTINGS.wbl, {\n\t\tname: 'Wealth by Level Ratio',\n\t\tconfig: true,\n\t\tscope: 'world',\n\t\ttype: new foundry.data.fields.NumberField({\n\t\t\tpositive: true,\n\t\t\tmin: 0.01,\n\t\t\tstep: 0.01,\n\t\t\tmax: 3,\n\t\t\tinitial: 1,\n\t\t}),\n\t});\n\n\t// delete game.settings.register(CFG.id, 'tokenhud-label', { ... });\n\n\t/*\n\tgame.settings.registerMenu(\n\t\tCFG.id,\n\t\tCFG.SETTINGS.generalWorldConfiguration,\n\t\t{\n\t\t\tid: `${CFG.id}-config-world`,\n\t\t\t// name: 'World config',\n\t\t\tlabel: 'World Configuration',\n\t\t\ticon: FAIcons.globe, // button icon\n\t\t\ttype: WorldSettingsDialog,\n\t\t\trestricted: true,\n\t\t}\n\t);\n\t*/\n\n\tgame.settings.registerMenu(\n\t\tCFG.id,\n\t\tCFG.SETTINGS.generalClientConfiguration,\n\t\t{\n\t\t\tid: `${CFG.id}-config-client`,\n\t\t\tname: 'Client-side settings',\n\t\t\tlabel: 'Client Configuration',\n\t\t\ticon: FAIcons.user, // button icon\n\t\t\ttype: ClientSettingsDialog,\n\t\t\trestricted: false,\n\t\t},\n\t);\n\n\tgame.settings.register(\n\t\tCFG.id,\n\t\t'ignoreActors',\n\t\t{\n\t\t\tname: 'LittleHelper.Settings.IgnoreActorTypes',\n\t\t\thint: 'LittleHelper.Settings.IgnoreActorTypesHint',\n\t\t\tdefault: [],\n\t\t\ttype: new fields.SetField(new fields.StringField({\n\t\t\t\tchoices: () => {\n\t\t\t\t\tconst l = foundry.utils.deepClone(CONFIG.Actor.typeLabels);\n\t\t\t\t\t// Remove the pointless base type\n\t\t\t\t\tdelete l.base;\n\t\t\t\t\t// Remove module types\n\t\t\t\t\tfor (const key of Object.keys(l)) {\n\t\t\t\t\t\tif (key.includes('.')) delete l[key];\n\t\t\t\t\t}\n\t\t\t\t\treturn l;\n\t\t\t\t},\n\t\t\t})),\n\t\t\tscope: 'client',\n\t\t\tconfig: true,\n\t\t},\n\t);\n\n\tgame.settings.register(CFG.id, 'migration', {\n\t\ttype: String,\n\t\tdefault: '0.6.0', // Oldest supported pre-migration version.\n\t\tscope: 'world',\n\t\tconfig: false,\n\t});\n});\n",
    "import { CFG } from '../config.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nexport class SubSetting {\n\tlabel;\n\thint;\n\ttype;\n\tvalue;\n\tfallback;\n\n\tcallback;\n\tget display() { return this.#displayFn(this.value); }\n\t#displayFn = () => 'undefined';\n\n\tconstructor({ setting, label, value, hint, type = Boolean, fallback, display, callback } = {}, key) {\n\t\tthis.key = key;\n\t\tthis.label = label || `LittleHelper.Feature.${setting}.${key}.Label`;\n\t\tthis.hint = hint || `LittleHelper.Feature.${setting}.${key}.Hint`;\n\t\tthis.type = type;\n\t\tthis.fallback = fallback;\n\t\tthis.value = value ?? fallback;\n\t\tif (typeof display === 'function')\n\t\t\tthis.#displayFn = display;\n\t\tthis.callback = callback;\n\t}\n}\n\n// eslint-disable-next-line unicorn/no-static-only-class\nexport class ClientSettingsData {\n\tstatic default() {\n\t\tconst settings = new this;\n\n\t\tfor (const feature of Feature.collection) {\n\t\t\tconst subSettings = { enabled: feature.defaultState };\n\n\t\t\tif (feature.subsettings !== undefined && !foundry.utils.isEmpty(feature.subsettings)) {\n\t\t\t\tsubSettings.config = {};\n\t\t\t\tfor (const [key, cfg] of Object.entries(feature.subsettings)) {\n\t\t\t\t\tsubSettings.config[key] = cfg.fallback;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsettings[feature.setting] = subSettings;\n\t\t}\n\n\t\treturn settings;\n\t}\n}\n\nclass Conflict {\n\tsystem;\n\tcore;\n\tmodule;\n\n\tget obsolete() {\n\t\tconst d = this.details;\n\t\tif (d.system.active) return true;\n\t\tif (d.core.active) return true;\n\t\tif (d.module.active) return true;\n\t\treturn false;\n\t}\n\n\t/**\n\t * @param {object} options\n\t * @param {string | undefined} options.system System version number\n\t * @param {string | undefined} options.core Core version number\n\t * @param {string | undefined} options.module Module name\n\t */\n\tconstructor({ system, core, module } = {}) {\n\t\tthis.system = system;\n\t\tthis.core = core;\n\t\tthis.module = module;\n\t}\n\n\t#details;\n\tget details() {\n\t\tthis.#details ??= {\n\t\t\tsystem: {\n\t\t\t\tget active() { return this.obsolete; },\n\t\t\t\t_active: this.system != undefined,\n\t\t\t\tobsolete: this.system ? CFG.system.atLeast(this.system) : false,\n\t\t\t\tversion: {\n\t\t\t\t\tthreshold: this.system,\n\t\t\t\t\tcurrent: CFG.system.version,\n\t\t\t\t},\n\t\t\t},\n\t\t\tcore: {\n\t\t\t\tget active() { return this.obsolete; },\n\t\t\t\t_active: this.core != undefined,\n\t\t\t\tobsolete: this.core ? CFG.core.atLeast(this.core) : false,\n\t\t\t\tversion: {\n\t\t\t\t\tthreshold: this.core,\n\t\t\t\t\tcurrent: CFG.core.version,\n\t\t\t\t},\n\t\t\t},\n\t\t\tmodule: {\n\t\t\t\tget active() { return this.obsolete; },\n\t\t\t\t_active: this.module?.length > 0,\n\t\t\t\tobsolete: this.module?.some(m => game.modules.get(m)?.active) ?? false,\n\t\t\t\tcause: this.module?.filter(m => game.modules.get(m)?.active),\n\t\t\t},\n\t\t};\n\n\t\treturn this.#details;\n\t}\n}\n\nclass Requirements {\n\tcore;\n\tsystem;\n\tmodule;\n\n\tget satisfied() {\n\t\tif (this.module && !game.modules.get(this.module)?.active)\n\t\t\treturn false;\n\t\tif (this.system && !CFG.system.atLeast(this.system))\n\t\t\treturn false;\n\t\tif (this.core && !CFG.core.atLeast(this.core))\n\t\t\treturn false;\n\t\treturn true;\n\t}\n\n\tconstructor(data) {\n\t\tthis.module = data.module;\n\t\tthis.system = data.system;\n\t\tthis.core = data.core;\n\t}\n\n\t#details;\n\tget details() {\n\t\tconst mod = game.modules.get(this.module);\n\t\tthis.#details ??= {\n\t\t\tcore: {\n\t\t\t\tget active() { return this._active; },\n\t\t\t\t_active: this.core != undefined,\n\t\t\t\tversion: {\n\t\t\t\t\tthreshold: this.system,\n\t\t\t\t\tcurrent: CFG.core.version,\n\t\t\t\t},\n\t\t\t\tsatisfied: this.core == undefined ? true : CFG.core.atLeast(this.core),\n\t\t\t},\n\t\t\tsystem: {\n\t\t\t\tget active() { return this._active; },\n\t\t\t\t_active: this.system != undefined,\n\t\t\t\tversion: {\n\t\t\t\t\tthreshold: this.system,\n\t\t\t\t\tcurrent: CFG.system.version,\n\t\t\t\t},\n\t\t\t\tsatisfied: this.system == undefined ? true : CFG.system.atLeast(this.system),\n\t\t\t},\n\t\t\tmodule: {\n\t\t\t\tget active() { return this._active; },\n\t\t\t\t_active: this.module != undefined,\n\t\t\t\tid: this.module,\n\t\t\t\tpresent: !!mod,\n\t\t\t\tenabled: mod?.active,\n\t\t\t\tsatisfied: mod?.active ?? false,\n\t\t\t},\n\t\t};\n\n\t\treturn this.#details;\n\t}\n}\n\nexport class Feature {\n\t/**\n\t * Enabled by user configuration.\n\t *\n\t * @private\n\t */\n\tenabled = false;\n\n\tget active() {\n\t\tif (CFG.isStream && !this.stream) return false;\n\t\treturn this.enabled && !this.disabled;\n\t}\n\n\t/** @private */\n\tdefaultState = true;\n\n\t/**\n\t * Disabled by some rule.\n\t *\n\t * @private\n\t */\n\tdisabled = false;\n\n\t/** Need restart if toggled */\n\trestart = false;\n\n\t/** Is the setting only useful for GMs?  */\n\tgmOnly = false;\n\n\t/** Scope */\n\tscope;\n\n\tget world() {\n\t\treturn this.scope === 'world';\n\t}\n\n\t/** Label */\n\tlabel;\n\t/** Description */\n\thint;\n\t/** Generic notification */\n\tnotification;\n\t/** Generic warning */\n\twarning;\n\t/** Setting name */\n\tsetting;\n\t/** Category for organizing */\n\tcategory;\n\n\t/** Related requirements, if any. */\n\trequirements; // { module: \"id\", system: \"version\", core: \"version\" }\n\n\t/** Obsoleted by versions. */\n\tconflict;\n\n\t/** What if anything the feature impacts heavily. */\n\timpact;\n\t/** Should this feature be enabled in stream view? */\n\tstream;\n\n\tsubsettings;\n\n\tenable() {}\n\tdisable() {}\n\n\t/**\n\t * @type {Collection<Feature>}\n\t * @private\n\t */\n\tstatic collection = new Collection();\n\n\t/**\n\t * Feature initialization stages.\n\t *\n\t * @type {{init: Feature[], setup: Feature[], ready: Feature[]}}\n\t */\n\tstatic stage = {\n\t\tinit: [],\n\t\tsetup: [],\n\t\tready: [],\n\t};\n\n\t/**\n\t * @param {string} setting setting key\n\t * @param {string} label Display name key\n\t * @param {string} hint Explanation for the setting.\n\t * @param {string} notification Notification associated with the setting.\n\t * @param {string} warning Warning associated with the setting.\n\t * @param {string} category Grouping ID.\n\t * @param {boolean} restart Requires restart to take effect.\n\t * @param {boolean} gm Meaningful for GM only\n\t * @param {boolean} disabled\n\t * @param {Function} enable Callback for enabling\n\t * @param {Function} disable Callback for disabling\n\t * @param {boolean} enabledByDefault Initial state when this feature is first discovered.\n\t * @param {\"init\"|\"setup\"|\"ready\"} stage Stage at which to enable\n\t * @param requirements\n\t * @param conflict\n\t * @param subsettings\n\t * @param impact Structure for feature's impact on overall experience.\n\t */\n\tconstructor({ setting, label, hint, notification, warning, category, enable, disable, stage = 'init', scope = 'client', restart = false, gm = false, disabled = false, requirements, conflict, enabledByDefault = true, subsettings, impact, stream = false } = {}) {\n\t\tthis.setting = setting;\n\t\tthis.label = label || `LittleHelper.Feature.${setting}.Label`;\n\t\tthis.hint = hint || `LittleHelper.Feature.${setting}.Hint`;\n\t\tthis.notification = notification;\n\t\tthis.warning = warning;\n\t\tthis.category = category;\n\t\tthis.enable = enable;\n\t\tthis.disable = disable;\n\t\tthis.scope = scope;\n\t\tthis.restart = restart;\n\t\tthis.gmOnly = gm ?? false;\n\t\tthis.disabled = disabled;\n\t\tthis.defaultState = enabledByDefault;\n\t\tthis.subsettings = subsettings;\n\t\tthis.impact = impact;\n\t\tthis.stream = stream;\n\n\t\tif (conflict) this.conflict = new Conflict(conflict);\n\t\tif (requirements) this.requirements = new Requirements(requirements);\n\n\t\tif (Feature.collection.has(setting)) throw new Error(`Little Helper ðŸ¦Ž | Attempting to re-define \"${setting}\"`);\n\t\tFeature.collection.set(setting, this);\n\t\tif (!Feature.stage[stage]) throw new Error(`Little Helper ðŸ¦Ž | Registered \"${setting}\" for invalid or already passed stage: \"${stage}\".`);\n\t\tFeature.stage[stage].push(this);\n\t}\n\n\tstatic create({ setting, label, hint, notification, warning, category, enableCallback, disableCallback, stage = 'init', gm = false, disabled = false, conflict, requirements, enabledByDefault = true, impact } = {}) {\n\t\tnew Feature({ setting, label, hint, notification, warning, category, enableCallback, disableCallback, stage, gm, disabled, conflict, requirements, enabledByDefault, impact });\n\t}\n\n\ttoggle() {\n\t\tthis.enabled = !this.enabled;\n\t\tthis.enabled ? this.enable() : this.disable();\n\t}\n\n\ttestToggle() {\n\t\tconst scope = this.world ? CFG.SETTINGS.generalWorldConfiguration : CFG.SETTINGS.generalClientConfiguration;\n\t\tconst settings = game.settings.get(CFG.id, scope);\n\t\tconst doToggle = this.enabled !== (settings[this.setting]?.enabled ?? true);\n\t\tif (doToggle) this.toggle();\n\t\treturn doToggle;\n\t}\n\n\tfirstTimeLaunch = false;\n\tget firstTime() {\n\t\tconst scope = this.world ? CFG.SETTINGS.generalWorldConfiguration : CFG.SETTINGS.generalClientConfiguration;\n\t\tconst settings = game.settings.get(CFG.id, scope);\n\t\treturn settings[this.setting]?.enabled === undefined;\n\t}\n\n\tinit(user, settings) {\n\t\tthis.firstTimeLaunch = this.firstTime;\n\n\t\tconst scope = this.world ? CFG.SETTINGS.generalWorldConfiguration : CFG.SETTINGS.generalClientConfiguration;\n\t\tsettings ??= foundry.utils.mergeObject(ClientSettingsData.default(), game.settings.get(CFG.id, scope), { inplace: false });\n\n\t\tconst cfg = settings[this.setting];\n\t\tthis.enabled = cfg?.enabled ?? this.defaultState;\n\n\t\tif (this.subsettings !== undefined)\n\t\t\tfor (const [key, ss] of Object.entries(this.subsettings)) {\n\t\t\t\tss.value = cfg.config[key] ?? ss.fallback;\n\t\t\t\tthis.subsettings[key] = new SubSetting(ss, key);\n\t\t\t}\n\n\t\tconst C = CFG.console.colors;\n\t\tif (this.conflict?.obsolete) {\n\t\t\tconst d = this.conflict.details;\n\t\t\tconst o = ['%cLittle Helper%c ðŸ¦Ž', C.main, C.unset, '| Feature:', this.setting, '| âš ï¸ Obsoleted |'];\n\t\t\tconst coreConflict = d.core.active,\n\t\t\t\tsystemConflict = d.system.active,\n\t\t\t\tmoduleConflict = d.module.active;\n\t\t\tif (coreConflict) o.push('Foundry', d.core.version);\n\t\t\tif (systemConflict) {\n\t\t\t\tif (coreConflict) o.push('|');\n\t\t\t\to.push('Game System', d.system.version);\n\t\t\t}\n\t\t\tif (moduleConflict) {\n\t\t\t\tif (coreConflict || systemConflict) o.push('|');\n\t\t\t\to.push('Module(s)', d.module.cause);\n\t\t\t}\n\t\t\tconsole.log(...o);\n\t\t\tthis.disabled = true;\n\t\t}\n\n\t\tif (!this.disabled && this.requirements?.satisfied === false) {\n\t\t\tconst d = this.requirements.details;\n\n\t\t\tconst o = ['%cLittle Helper%c ðŸ¦Ž', C.main, C.unset, '| Feature:', this.setting, '| âš ï¸ Requirements Not Met |'];\n\t\t\tconst coreReq = d.core.active,\n\t\t\t\tsystemReq = d.system.active,\n\t\t\t\tmoduleReq = d.module.active,\n\t\t\t\tcoreAndSysReq = coreReq && systemReq,\n\t\t\t\tversionAndMod = (coreReq || systemReq) && moduleReq;\n\t\t\tif (coreReq) o.push('Foundry', d.core.version.threshold);\n\t\t\tif (coreAndSysReq) o.push('|');\n\t\t\tif (systemReq) o.push('Game System', d.system.version.threshold);\n\t\t\tif (versionAndMod) o.push('|');\n\t\t\tif (moduleReq) o.push('Module', { id: d.module.id });\n\t\t\tconsole.log(...o);\n\t\t\tthis.disabled = true;\n\t\t}\n\n\t\tif (this.gmOnly && !user.isGM)\n\t\t\tthis.disabled = true;\n\t}\n\n\tload() {\n\t\tif (this.active) this.enable();\n\t}\n\n\tsave() {\n\t\tconst scope = this.world ? CFG.SETTINGS.generalWorldConfiguration : CFG.SETTINGS.generalClientConfiguration;\n\t\tconst settings = game.user.getFlag(CFG.id, scope);\n\t\tsettings[this.setting].enabled = this.enabled;\n\t\tgame.user.setFlag(CFG.id, scope, settings);\n\t}\n\n\tstatic saveAll(settings) {\n\t\tconst oldSettings = foundry.utils.deepClone(game.settings.get(CFG.id, CFG.SETTINGS.generalClientConfiguration));\n\t\tthis.settings = foundry.utils.mergeObject(ClientSettingsData.default(), oldSettings, { inplace: false });\n\t\tthis.settings = foundry.utils.mergeObject(this.settings, settings, { inplace: false });\n\n\t\treturn game.settings.set(CFG.id, CFG.SETTINGS.generalClientConfiguration, this.settings)\n\t\t\t.then(_ => {\n\t\t\t\tlet refreshRequired = false;\n\t\t\t\tfor (const [id, cfg] of Object.entries(settings)) {\n\t\t\t\t\t/** @type {Feature} */\n\t\t\t\t\tconst feature = Feature.collection.get(id);\n\n\t\t\t\t\tif (cfg.config !== undefined)\n\t\t\t\t\t\tfor (const [key, ss] of Object.entries(cfg.config)) feature.subsettings[key].value = ss;\n\n\t\t\t\t\t// Toggle only if the setting changed\n\t\t\t\t\tif (cfg.enabled !== feature.enabled) {\n\t\t\t\t\t\tconst noOldSettings = oldSettings[id]?.enabled === undefined;\n\t\t\t\t\t\tconst rv = cfg.enabled ? feature.enable() : feature.disable();\n\t\t\t\t\t\tif (!noOldSettings && rv === false) refreshRequired = true;\n\t\t\t\t\t\tfeature.enabled = cfg.enabled;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (refreshRequired) {\n\t\t\t\t\tui.notifications?.warn(i18n.get('LittleHelper.Warning.RefreshNeeded'));\n\t\t\t\t}\n\t\t\t});\n\t}\n}\n",
    "import { CFG } from '../config.mjs';\nimport { stopEventPropagation } from '../common.mjs';\nimport { Feature, ClientSettingsData } from './feature.mjs';\nimport { FAIcons } from './icons.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\n/* global FormApplication */\nexport class ClientSettingsDialog extends FormApplication {\n\tsettings;\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.settings = foundry.utils.mergeObject(ClientSettingsData.default(), foundry.utils.deepClone(game.settings.get(CFG.id, CFG.SETTINGS.generalClientConfiguration)));\n\n\t\tthis.features = Feature.collection.filter(f => !f.world);\n\t\t// if (!game.user.isGM) this.features = this.features.filter(f => !f.gmOnly);\n\n\t\tthis.groups = {};\n\t\tfor (const feature of this.features) {\n\t\t\tconst cat = feature.category;\n\t\t\tthis.groups[cat] ??= [];\n\t\t\tthis.groups[cat].push(feature);\n\t\t}\n\t}\n\n\tget template() {\n\t\treturn `modules/${CFG.id}/templates/client-settings.hbs`;\n\t}\n\n\tgetData() {\n\t\tconst data = super.getData();\n\t\tdata.features = this.features;\n\t\tdata.groups = this.groups;\n\t\tdata.sorted = Object.entries(this.groups)\n\t\t\t.map(([id, group]) => ({ id, group, label: i18n.get(`LittleHelper.Settings.Category.${id}`) }))\n\t\t\t.sort((a, b) => a.label.localeCompare(b.label, undefined, { sensitivity: 'base' }));\n\t\tdata.icons = FAIcons;\n\t\treturn data;\n\t}\n\n\tstatic get defaultOptions() {\n\t\tconst _default = super.defaultOptions;\n\t\treturn {\n\t\t\t..._default,\n\t\t\ttitle: i18n.get('LittleHelper.Settings.Client', { module: 'Little Helper ðŸ¦Ž' }),\n\t\t\tclasses: [..._default.classes, 'koboldworks', 'settings'],\n\t\t\twidth: 460,\n\t\t\theight: 720,\n\t\t\tid: 'little-helper-client-settings',\n\t\t\tscrollY: ['section.content'],\n\t\t\tcloseOnSubmit: true,\n\t\t\tsubmitOnChange: false,\n\t\t\tsubmitOnClose: false,\n\t\t\tresizable: true,\n\t\t};\n\t}\n\n\t_updateObject(event, data) {\n\t\tFeature.saveAll(foundry.utils.expandObject(data));\n\t}\n\n\t_reset() {\n\t\tfor (const f of this.features) {\n\t\t\tif (!f.disabled) f.enabled = f.defaultState;\n\t\t}\n\t\tthis.render();\n\t}\n\n\t_clear() {\n\t\tfor (const f of this.features) {\n\t\t\tif (!f.disabled) f.enabled = false;\n\t\t}\n\t\tthis.render();\n\t}\n\n\tsearchTimer;\n\tlastTerm;\n\t/**\n\t * @param {HTMLElement} area\n\t * @param {Event} event\n\t * @param term\n\t */\n\tdoSearch(area, term) {\n\t\t// Clear all search related classes\n\t\tfor (const el of area.querySelectorAll('.search-mismatch,.search-match,.search-match-inner')) {\n\t\t\tel.classList.remove('search-mismatch', 'search-match', 'search-match-inner');\n\t\t}\n\n\t\tif (term.length === 0) return;\n\n\t\t// Hide unmatched results\n\t\tfor (const group of area.querySelectorAll('.group ul')) {\n\t\t\tlet matches = 0;\n\t\t\tfor (const setting of group.querySelectorAll('.setting[data-setting-id]')) {\n\t\t\t\tlet match = false;\n\t\t\t\tif (setting.querySelector('label')?.textContent.trim().toLocaleLowerCase().includes(term)) {\n\t\t\t\t\tmatch = true;\n\t\t\t\t\tsetting.classList.add('search-match');\n\t\t\t\t}\n\t\t\t\telse if (setting.querySelector('.hint')?.textContent.trim().toLocaleLowerCase().includes(term)) {\n\t\t\t\t\tmatch = true;\n\t\t\t\t\tsetting.classList.add('search-match');\n\t\t\t\t}\n\n\t\t\t\tif (match) matches++;\n\t\t\t\telse setting.classList.add('search-mismatch');\n\t\t\t}\n\n\t\t\tif (group.querySelector('.title')?.textContent.trim().toLocaleLowerCase().includes(term)) {\n\t\t\t\tmatches++;\n\t\t\t\tgroup.classList.add('search-match');\n\t\t\t}\n\n\t\t\tif (matches === 0)\n\t\t\t\tgroup.classList.add('search-mismatch');\n\t\t\telse\n\t\t\t\tgroup.classList.add('search-match-inner');\n\t\t}\n\t}\n\n\t/**\n\t * @param {HTMLElement} html\n\t * @param {Event} event\n\t */\n\tdebounceSearch(html, event) {\n\t\tstopEventPropagation(event);\n\t\tclearTimeout(this.searchTimer);\n\n\t\tconst term = event.target.value.trim();\n\t\tif (term === this.lastTerm) return;\n\t\tthis.lastTerm = term;\n\n\t\tsetTimeout(() => this.doSearch(html, term.toLocaleLowerCase()), 250);\n\t}\n\n\t/**\n\t * @param {HTMLElement} jq\n\t */\n\tactivateListeners(jq) {\n\t\tsuper.activateListeners(jq);\n\n\t\tconst html = jq[0];\n\n\t\thtml.querySelector('button[type=\"reset\"]')\n\t\t\t.addEventListener('click', event => this._reset(stopEventPropagation(event)));\n\n\t\thtml.querySelector('button[type=\"clear\"]')\n\t\t\t.addEventListener('click', event => this._clear(stopEventPropagation(event)));\n\n\t\tconst searchArea = html.querySelector('section.content');\n\t\tconst search = html.querySelector('input.search-input');\n\t\tsearch.addEventListener('change', this.debounceSearch.bind(this, searchArea));\n\t\tsearch.addEventListener('input', this.debounceSearch.bind(this, searchArea));\n\n\t\tfor (const el of html.querySelectorAll('button[data-callback]')) {\n\t\t\tconst p = el.dataset.callback;\n\t\t\tconst [fId, _, fsId] = p.split('.');\n\t\t\tconst f = Feature.collection.get(fId);\n\t\t\tconst ss = f?.subsettings[fsId];\n\t\t\tif (!ss) continue;\n\t\t\tel.addEventListener('click', ev => {\n\t\t\t\tev.preventDefault();\n\t\t\t\tev.stopPropagation();\n\t\t\t\tss.callback.fn(ev, f, ss);\n\t\t\t});\n\t\t}\n\t}\n}\n",
    "import { CFG } from '../config.mjs';\n\nconst ConditionHelp = {};\n\nHooks.once('setup', function conditions_i18n() {\n\tconst C = CFG.console.colors;\n\tconsole.debug('%cLittle Helper%c ðŸ¦Ž | i18n | Building condition help', C.main, C.unset);\n\n\tfor (const k of pf1.registry.conditions.keys()) {\n\t\tConditionHelp[k] = `LittleHelper.Conditions.${k}`;\n\t}\n\n\tCFG.i18n.conditions = ConditionHelp;\n});\n",
    "import { getUserFromData } from './common.mjs';\nimport { SharedData } from '@core/shared-data.mjs';\n\nclass AncillaryCallback {\n\t/** @type {Function.<ItemSheet | ActorSheet, HTMLElement, object, SharedData>} */\n\tfn;\n\t/** @type {number} */\n\tpriority;\n\t/** @type {number} */\n\tid;\n\n\t/**\n\t * @param {Function} fn\n\t * @param {number} priority\n\t * @param {number} id\n\t */\n\tconstructor(fn, priority = 0, id) {\n\t\tthis.fn = fn;\n\t\tthis.priority = priority;\n\t\tthis.id = id;\n\t}\n}\n\n/**\n * @callback AncillaryCallback\n * @param {Application|DocumentSheet|ChatMessage} app\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\n\n/** @typedef {\"item\"|\"actor\"|\"chat\"|\"action\"|\"compendium\"} AncillaryContext */\n\n/**\n * Hook proxy for providing shared data and hook handler ordering.\n */\nclass HookAncillary {\n\t#callbacks = {\n\t\t/** @type {AncillaryCallback[]} */\n\t\titem: [],\n\t\t/** @type {AncillaryCallback[]} */\n\t\tactor: [],\n\t\t/** @type {AncillaryCallback[]} */\n\t\tchat: [],\n\t\t/** @type {AncillaryCallback[]} */\n\t\taction: [],\n\t\t/** @type {AncillaryCallback[]} */\n\t\tcompendium: [],\n\t};\n\n\t/**\n\t * @param {AncillaryContext} context\n\t * @param {AncillaryCallback} callback\n\t * @param {object} options\n\t * @param {number} options.priority Higher value ensures earlier calling.\n\t * @param options.id\n\t */\n\tregister(context, callback, { priority = 0, id } = {}) {\n\t\tif (context === 'chat' && game?.ready) console.warn('Chat hook registered very late');\n\t\tthis.#callbacks[context].push(new AncillaryCallback(callback, priority, id));\n\t\tthis.#callbacks[context].sort((a, b) => b.priority - a.priority);\n\t}\n\n\t/**\n\t * @param {AncillaryContext} context\n\t * @param {AncillaryCallback} callback\n\t */\n\tunregister(context, callback) {\n\t\t/** @type {AncillaryCallback[]} */\n\t\tconst list = this.#callbacks[context];\n\t\tconst i = list.findIndex((e) => e.fn == callback);\n\t\tif (i !== -1) list.splice(i, 1);\n\t}\n\n\t/**\n\t * @param {string} context\n\t * @param {Application|DocumentSheet|ChatMessage} app\n\t * @param  {...any} args\n\t */\n\t#call(context, app, ...args) {\n\t\tif (context === 'actor' && !['character', 'npc'].includes(app.actor.type)) return;\n\n\t\tconst shared = new SharedData(game.user ?? getUserFromData(), app.object ?? app.document ?? app.action ?? app.item ?? app);\n\t\tif (['actor', 'item'].includes(context) && !shared.isObserver) return;\n\t\tif (context !== 'chat') app.__littleHelper ??= {};\n\n\t\t// Convert any JQuery args to HTML\n\t\targs = args.map(a => a instanceof jQuery ? a[0] : a);\n\n\t\tconst list = this.#callbacks[context];\n\t\tfor (const li of list) {\n\t\t\ttry {\n\t\t\t\tli.fn(app, ...args, shared);\n\t\t\t}\n\t\t\tcatch (err) {\n\t\t\t\tconsole.error(err);\n\t\t\t\tthis.unregister(context, li);\n\t\t\t}\n\t\t}\n\t}\n\n\tconstructor() {\n\t\tHooks.once('init', this.#init.bind(this));\n\t\tHooks.once('setup', this.#setup.bind(this));\n\t\tHooks.once('ready', this.#ready.bind(this));\n\t}\n\n\t_oldMsgId;\n\t#init() {\n\t\tHooks.on('renderCompendiumDirectory', this.#call.bind(this, 'compendium'));\n\n\t\t// Deal with chat messages\n\t\tconst user = getUserFromData();\n\t\tif (user.role > 0) {\n\t\t\t// User info could be gained early.\n\t\t\tHooks.on('renderChatMessageHTML', this.#call.bind(this, 'chat'));\n\n\t\t\tHooks.once('ready', () => this._startCleanup());\n\t\t}\n\t\telse {\n\t\t\t// TODO: This seems no longer necessary in v13?\n\t\t\tconsole.warn('Little Helper ðŸ¦Ž | Could not retrieve user information; delaying processing.');\n\t\t\tthis._oldMsgId = Hooks.on('renderChatMessageHTML', this._collectOldMessages.bind(this));\n\t\t\tHooks.once('ready', this._finishCollection.bind(this));\n\t\t}\n\t}\n\n\t#setup() {\n\t\t// NOP\n\t}\n\n\t#ready() {\n\t\tHooks.on('renderActorSheet', this.#call.bind(this, 'actor'));\n\t\tHooks.on('renderItemSheet', this.#call.bind(this, 'item'));\n\t\tHooks.on('renderItemActionSheet', this.#call.bind(this, 'action'));\n\t}\n\n\t_initialCMs = [];\n\n\t_collectOldMessages(cm, jq) {\n\t\tthis._initialCMs.push([cm, jq]);\n\t}\n\n\t_finishCollection() {\n\t\tHooks.off('renderChatMessage', this._oldMsgId);\n\t\tHooks.on('renderChatMessageHTML', this.#call.bind(this, 'chat'));\n\n\t\tfor (const msgArgs of this._initialCMs)\n\t\t\tthis.#call('chat', ...msgArgs);\n\n\t\tthis._startCleanup();\n\t}\n\n\t_startCleanup() {\n\t\t// Permanent cleanup\n\t\tdelete this._initialCMs;\n\t\tdelete this._finishCollection;\n\t\tdelete this._collectOldMessages;\n\t\tdelete this._oldMsgId;\n\t\tdelete this._startCleanup;\n\t}\n}\n\nexport const Ancillary = new HookAncillary();\n",
    "/** @import { TabData } from '@core/tab-data.mjs' */\n\nexport class SharedData {\n\t/** @type {User} */\n\tuser;\n\t/** @type {Actor|Item} */\n\tdocument;\n\n\t/** @type {boolean} - Is one of the system sheets? */\n\tsysSheet = false;\n\t/** @type {boolean} - Is one of the core large sheets?  */\n\tcoreSheet = false;\n\t/** @type {boolean} - Is module introduced sheet? */\n\taltSheet = false;\n\n\t/** @returns {boolean} True if user has at least observer permission. */\n\tget isObserver() {\n\t\treturn this.document.permission >= CONST.DOCUMENT_OWNERSHIP_LEVELS.OBSERVER;\n\t}\n\n\t/** @type {boolean} - Is system defined documen type */\n\tget systemDocument() {\n\t\tconst doc = this.document;\n\t\tif (doc instanceof Actor) return Object.keys(game.system.documentTypes.Actor).includes(doc.type);\n\t\telse if (doc instanceof Item) return Object.keys(game.system.documentTypes.Item).includes(doc.type);\n\t\telse return false;\n\t}\n\n\t/**\n\t * Return system data for this.document or .data for action.\n\t *\n\t * @type {object}\n\t */\n\tget systemData() {\n\t\tconst doc = this.document;\n\t\tif (doc instanceof Actor || doc instanceof Item) return doc.system;\n\t\tif (doc instanceof pf1.components.ItemAction) return doc;\n\t}\n\n\tget sourceData() {\n\t\treturn this.document.toObject().system;\n\t}\n\n\t/** @type {object} */\n\t#rollData;\n\t/**\n\t * @returns {object}\n\t */\n\tget rollData() {\n\t\tif (!this.#rollData) {\n\t\t\tif (!this.document.actor && !(this.document instanceof Actor))\n\t\t\t\t// Fill in game.user.character roll data if no actor is otherwise present\n\t\t\t\tthis.#rollData = { ...game.user.character?.getRollData(), ...this.document.getRollData() };\n\t\t\telse\n\t\t\t\tthis.#rollData = { ...this.document.getRollData() };\n\t\t}\n\t\treturn this.#rollData;\n\t}\n\n\t#dc;\n\t/**\n\t * @returns {number | undefined}\n\t */\n\tget dc() {\n\t\tthis.#dc ??= this.document.getDC(this.rollData);\n\t\treturn this.#dc;\n\t}\n\n\t/** @type {Record<string, TabData>} */\n\ttabs = {};\n\n\t#items;\n\tget items() {\n\t\tif (!this.#items) {\n\t\t\tconst actor = this.document,\n\t\t\t\tbooks = actor.system.attributes?.spells?.spellbooks;\n\n\t\t\tthis.#items = { byType: {} };\n\n\t\t\tconst itemTypes = this.document.itemTypes;\n\t\t\tfor (const [key, list] of Object.entries(itemTypes)) {\n\t\t\t\tthis.#items.byType[key] ??= {};\n\t\t\t\tObject.defineProperty(this.#items.byType[key], 'all', {\n\t\t\t\t\tvalue: list,\n\t\t\t\t\tenumerable: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst typed = this.#items.byType;\n\t\t\tfor (const type of Object.keys(typed)) {\n\t\t\t\tconst activeCache = [], subTypes = {};\n\n\t\t\t\tconst items = typed[type];\n\n\t\t\t\tfor (const item of items.all) {\n\t\t\t\t\titems.active = true;\n\t\t\t\t\tif (item.isActive) activeCache.push(item);\n\n\t\t\t\t\tif (item.type === 'spell') {\n\t\t\t\t\t\tconst itemData = item.system;\n\t\t\t\t\t\tconst bookId = itemData.spellbook;\n\t\t\t\t\t\tif (!bookId) continue;\n\t\t\t\t\t\titems._book ??= {};\n\t\t\t\t\t\titems._book[bookId] ??= {\n\t\t\t\t\t\t\tall: [],\n\t\t\t\t\t\t\tbook: books?.[bookId],\n\t\t\t\t\t\t};\n\t\t\t\t\t\tconst book = items._book[bookId];\n\t\t\t\t\t\tbook.all.push(item);\n\t\t\t\t\t\tbook[itemData.level] ??= [];\n\t\t\t\t\t\tbook[itemData.level].push(item);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tconst subType = item.subType;\n\t\t\t\t\t\titems[subType] ??= { all: [] };\n\t\t\t\t\t\titems[subType].all.push(item);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst props = {\n\t\t\t\t\tactive: {\n\t\t\t\t\t\tvalue: activeCache,\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tfor (const [key, data] of Object.entries(subTypes)) {\n\t\t\t\t\tprops[key] = {\n\t\t\t\t\t\tvalue: data,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tObject.defineProperties(items, props);\n\t\t\t}\n\t\t}\n\t\treturn this.#items;\n\t}\n\n\t/** @returns {ActorPF|undefined} */\n\tget actor() {\n\t\tconst doc = this.document;\n\t\tif (doc instanceof Actor) return doc;\n\t\tif (doc instanceof Item) return doc.actor ?? game.user.character;\n\t\tif (doc instanceof pf1.components.ItemAction) return doc.item?.actor ?? game.user.character;\n\t}\n\n\tget actorData() {\n\t\treturn this.actor.system;\n\t}\n\n\t/** @type {ItemPF|undefined} */\n\tget item() {\n\t\tconst doc = this.document;\n\t\tif (doc instanceof Item) return doc;\n\t\tif (doc instanceof Actor) return;\n\t\treturn doc.item;\n\t}\n\n\tget itemData() {\n\t\treturn this.item.system;\n\t}\n\n\t/** @type {ItemAction|undefined} */\n\tget action() {\n\t\tconst doc = this.document;\n\t\tif (doc instanceof Item) return;\n\t\tif (doc instanceof Actor) return;\n\t\treturn doc;\n\t}\n\n\t#mindless;\n\tget isMindless() {\n\t\tthis.#mindless ??= this.actor?.system.abilities?.int?.value === null;\n\t\treturn this.#mindless;\n\t}\n\n\t/**\n\t * @param {User} user\n\t * @param {Item|Actor} doc\n\t */\n\tconstructor(user, doc) {\n\t\tthis.user = user;\n\t\tthis.document = doc;\n\t}\n}\n",
    "import { CFG } from '../config.mjs';\nimport { getUserFromData } from '../common.mjs';\nimport { Feature, ClientSettingsData } from './feature.mjs';\nimport { NewsDialog } from './news.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\n// Feature initialization\n\nconst init = () => {\n\tconst C = CFG.console.colors;\n\tconsole.log('%cLittle Helper%c ðŸ¦Ž | Initializing Features', C.main, C.unset);\n\n\tconst user = game.user ?? getUserFromData();\n\n\tconst settings = foundry.utils.mergeObject(ClientSettingsData.default(), game.settings.get(CFG.id, CFG.SETTINGS.generalClientConfiguration), { inplace: false });\n\n\tfor (const f of Feature.collection) f.init(user, settings);\n\n\tCFG.API.features = Feature.collection;\n\tCFG.API.utility.deleteClientSettings = () => game.settings.set(CFG.id, CFG.SETTINGS.generalClientConfiguration, {});\n};\n\nfunction load(stage) {\n\tfor (const f of Feature.stage[stage]) {\n\t\ttry {\n\t\t\tf.load();\n\t\t}\n\t\tcatch (error) {\n\t\t\tf.error = error;\n\t\t\tconsole.error(error);\n\t\t}\n\t}\n}\n\nHooks.once('init', init);\n\nHooks.once('i18nInit', () => {\n\tfor (const feature of Feature.collection) {\n\t\tconst { label, hint } = feature;\n\t\tfeature.label = i18n.has(label) ? i18n.get(label) : label;\n\t\tfeature.hint = i18n.has(hint) ? i18n.get(hint) : hint;\n\t}\n});\n\nHooks.once('init', function initStageSubFeatures() {\n\tload('init');\n});\n\nHooks.once('setup', function setupStageSubFeatures() {\n\tload('setup');\n});\n\nHooks.once('ready', function readyStageSubFeatures() {\n\tload('ready');\n\tdelete Feature.stage;\n\n\tconst firstTime = Feature.collection.filter(f => f.firstTimeLaunch);\n\tif (firstTime.length > 0) NewsDialog.display(firstTime);\n});\n",
    "import { CFG } from '../config.mjs';\nimport { Feature } from './feature.mjs';\nimport { FAIcons } from './icons.mjs';\n\n/* global FormApplication */\nexport class NewsDialog extends FormApplication {\n\tconstructor(features) {\n\t\tsuper();\n\n\t\tthis.features = features;\n\t\tthis.groups = {};\n\t\tfor (const feature of this.features) {\n\t\t\tconst cat = feature.category;\n\t\t\tthis.groups[cat] ??= [];\n\t\t\tthis.groups[cat].push(feature);\n\t\t}\n\t}\n\n\tget template() {\n\t\treturn `modules/${CFG.id}/templates/news.hbs`;\n\t}\n\n\tstatic get defaultOptions() {\n\t\tconst options = super.defaultOptions;\n\t\treturn {\n\t\t\t...options,\n\t\t\ttitle: 'Little Helper ðŸ¦Ž new features',\n\t\t\twidth: 460,\n\t\t\tclasses: [...options.classes, 'koboldworks', 'news'],\n\t\t\tcloseOnSubmit: true,\n\t\t\tsubmitOnClose: false,\n\t\t\tsubmitOnChange: false,\n\t\t};\n\t}\n\n\tgetData() {\n\t\tconst data = super.getData();\n\t\tdata.features = this.features;\n\t\tdata.groups = this.groups;\n\t\tdata.sorted = Object.entries(this.groups)\n\t\t\t.map(([id, group]) => ({ id, group, label: `LittleHelper.Settings.Category.${id}` }))\n\t\t\t.sort((a, b) => a.id.localeCompare(b.id));\n\t\tdata.icons = FAIcons;\n\t\treturn data;\n\t}\n\n\t_updateObject(event, formData) {\n\t\tFeature.saveAll(foundry.utils.expandObject(formData));\n\t}\n\n\tstatic display(newfeatures) {\n\t\tnew NewsDialog(newfeatures).render(true, { focus: false });\n\t}\n}\n",
    "import { Ancillary } from '@root/ancillary.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { canViewChatMessage, createNode } from '@root/common.mjs';\n\n/**\n * @param {PointerEvent} ev\n * @param {HTMLElement} button\n */\nfunction rollAgain(ev, button) {\n\tev.preventDefault();\n\tev.stopPropagation();\n\n\tconst skillId = button.dataset.skillId,\n\t\tabilityId = button.dataset.abilityId,\n\t\tsaveId = button.dataset.saveId;\n\n\tlet roll;\n\tif (skillId) roll = 'skill';\n\telse if (abilityId) roll = 'ability';\n\telse if (saveId) roll = 'save';\n\n\tif (!roll) {\n\t\tui.notifications.warn('Undefined roll received.');\n\t\tconsole.warn('ROLL | Undefined roll received');\n\t}\n\n\tlet actors = canvas.tokens.controlled.map(t => t.actor).filter(a => a != undefined);\n\tif (actors.length === 0 && game.user.character) actors = [game.user.character];\n\tif (actors.length === 0) return ui.notifications.warn('No valid actor selected for rolling.');\n\n\tconst isShift = ev.shiftKey;\n\n\tconst skipDialog = game.settings.get('pf1', 'skipActionDialogs') && !isShift ||\n\t\t!game.settings.get('pf1', 'skipActionDialogs') && isShift;\n\n\tconst msg = game.messages.get(button.closest('.chat-message[data-message-id]').dataset.messageId);\n\tconst reference = msg?.uuid;\n\tconst dc = msg?.system.dc;\n\n\tfor (const a of actors) {\n\t\tif (skillId)\n\t\t\ta.rollSkill(skillId, { skipDialog, reference, dc });\n\t\telse if (abilityId)\n\t\t\ta.rollAbilityTest(abilityId, { skipDialog, reference, dc });\n\t\telse if (saveId)\n\t\t\ta.rollSavingThrow(saveId, { skipDialog, reference, dc });\n\t}\n}\n\n/**\n * @param {ChatMessage} cm\n * @param {HTMLElement} html\n * @param {string} subject\n */\nfunction handleCMbySubject(cm, html, subject) {\n\tif (!cm.isContentVisible) return;\n\n\tconst skillId = subject.skill,\n\t\tabilityId = subject.ability,\n\t\tsaveId = subject.save,\n\t\totherId = subject.core;\n\n\t/** Add me-too roller */\n\t// TODO: Make the button listener global to the chatlog\n\tif (skillId || abilityId || saveId) {\n\t\tconst button = createNode('span', 'Roll', ['lil-roll-button']);\n\t\tif (skillId) button.dataset.skillId = skillId;\n\t\tif (abilityId) button.dataset.abilityId = abilityId;\n\t\tif (saveId) button.dataset.saveId = saveId;\n\t\tif (otherId) button.dataset.coreId = otherId;\n\t\tbutton.prepend(createNode('i', null, ['fa-solid', 'fa-dice']));\n\t\tbutton.addEventListener('click', ev=>rollAgain(ev, button));\n\n\t\thtml.querySelector('.flavor-text')\n\t\t\t?.after(button, createNode('div', null, ['kbwks-flow-break']));\n\t}\n}\n\n/**\n * @param {ChatMessage} cm\n * @param {HTMLElement} html\n * @param {object} options\n * @param {object} shared\n */\nfunction handleMessage(cm, html, options, shared) {\n\tif (!canViewChatMessage(cm, shared.user)) return;\n\n\tconst subject = cm.system?.subject;\n\tif (subject) handleCMbySubject(cm, html, subject);\n}\n\nfunction enable() {\n\tAncillary.register('chat', handleMessage);\n\treturn false;\n}\n\nfunction disable() {\n\tAncillary.unregister('chat', handleMessage);\n\treturn false;\n}\n\nnew Feature({ setting: 'quick-roller', category: 'chat-card', enable, disable, stage: 'init' });\n",
    "import { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { createNode } from '@root/common.mjs';\n\n/**\n * @param {Actor} actor\n * @param {Item} buff\n * @param {object} createData\n */\nfunction applyBuff(actor, buff, createData) {\n\tconst old = actor.items.find(i => i.type === 'buff' && i.name === createData.name);\n\tif (old) {\n\t\t// Update existing buff\n\t\tif (old.isActive) return;\n\t\tconst updateData = { 'system.active': true };\n\t\tconst level = createData.system?.level;\n\t\tif (old.system.level !== level)\n\t\t\tupdateData['system.level'] = level;\n\t\treturn old.update(updateData);\n\t}\n\telse {\n\t\t// Add non-existent buff\n\t\treturn actor.createEmbeddedDocuments('Item', [createData]);\n\t}\n}\n\n/**\n * @param {Event} ev\n * @param {Item} buff\n */\nfunction applyBuffTriage(ev, buff) {\n\tev.preventDefault();\n\tev.stopPropagation();\n\n\tconst actors = canvas.tokens.controlled.map(t => t.actor).filter(a => a?.isOwner);\n\tif (actors.length === 0)\n\t\treturn ui.notifications?.warn('No valid actors selected.');\n\n\tconst buffData = buff.toObject();\n\n\t// Delete some unnecessary data\n\tdelete buffData.ownership;\n\tdelete buffData.sort;\n\tdelete buffData.folder;\n\tdelete buffData.system.links;\n\tdelete buffData.system.duration?.start;\n\n\t// Ensure buff is active\n\tbuffData.system.active = true;\n\t// TODO: Add source identifier?\n\n\tfor (const a of actors) applyBuff(a, buff, buffData);\n}\n\n/**\n * @param {ChatMessage} cm\n * @param {HTMLElement} html\n */\nfunction addApplyBuff(cm, html) {\n\tif (!cm.isContentVisible) return;\n\n\tconst item = cm.itemSource;\n\tif (item?.type !== 'buff') return;\n\n\tconst metadata = cm.getFlag('pf1', 'metadata');\n\tif (metadata?.action) return;\n\n\tconst content = html.querySelector('.card-content');\n\n\tconst d = createNode('div', null, ['lil-apply-buff', 'flexrow']);\n\tconst button = createNode('button', 'Apply to Selected', ['apply-button']);\n\td.append(button);\n\n\tbutton.addEventListener('click', ev => applyBuffTriage(ev, item));\n\n\tcontent?.after(d);\n}\n\nfunction enable() {\n\tAncillary.register('chat', addApplyBuff);\n}\n\nfunction disable() {\n\tAncillary.unregister('chat', addApplyBuff);\n\treturn false;\n}\n\nnew Feature({ setting: 'card-apply-buff', label: 'Apply Buff Button', hint: 'Adds button to apply a buff to selected tokens to buff chat cards.', category: 'chat-card', enable, disable, stage: 'init' });\n",
    "// Common mutation observer for chat message roll expanded view.\n\n/**\n * @param {Node} node\n * @param {MutationRecord} mutation\n */\nfunction mutationNodeHandler(node, mutation) {\n\tif (!node.classList?.contains('dice-tooltip')) return;\n\n\tconst parentEl = mutation.target;\n\tconst rollData = JSON.parse(unescape(parentEl.dataset.roll));\n\tconst roll = RollPF.fromData(rollData);\n\tconst formula = parentEl.title; // roll.formula instead maybe?\n\tconst data = { roll, rollData, formula };\n\n\t// Call anything listening to us.\n\tHooks.callAll('little-helper.cm.dice-tooltip', node, parentEl, data);\n}\n\n/**\n * @param {MutationRecord} mutation\n */\nfunction mutationListHandler(mutation) {\n\tif (mutation.type !== 'childList') return;\n\tfor (const node of mutation.addedNodes) mutationNodeHandler(node, mutation);\n}\n\n/**\n * @param {MutationRecord[]} mutations\n */\nfunction mutationCallback(mutations) {\n\tfor (const mut of mutations) mutationListHandler(mut);\n}\n\nconst observerConfig = { subtree: true, childList: true, attributes: false };\nconst observer = new MutationObserver(mutationCallback);\n\nfunction initMutationObserver() {\n\tconst chatLog = document.getElementById('chat-log') ?? document.getElementById('chat');\n\t// observer.disconnect(); // Would break with chat log popout\n\tobserver.observe(chatLog, observerConfig);\n}\n\nHooks.once('init', () => {\n\tHooks.on('renderChatLog', initMutationObserver);\n});\n",
    "/**\n * Adds formula display on top of the inline roll expansion.\n */\n\nimport { CFG } from '@root/config.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { compressFormula, createNode } from '@root/common.mjs';\n\nfunction inlineFormulaDetails(node, _, data) {\n\tconst formula = compressFormula(data.roll._formula, !game.settings.get(CFG.id, CFG.SETTINGS.inlineFormulaDetail))\n\t\t.replaceAll(/([)\\d])\\s*([+*\\-/])\\s*/g, (_, m1, m2) => `${m1} ${m2} <wbr>`); // Ensure line-breaks\n\tconst formulaEl = createNode('div', formula, ['inline-formula', 'lil-dice-tooltip-source'], { isHTML: true });\n\tnode.prepend(formulaEl, document.createElement('hr'));\n}\n\nfunction enable() {\n\tHooks.on('little-helper.cm.dice-tooltip', inlineFormulaDetails);\n}\n\nfunction disable() {\n\tHooks.off('little-helper.cm.dice-tooltip', inlineFormulaDetails);\n}\n\nnew Feature({ setting: 'inline-roll-formula', label: 'Inline Roll Formula', hint: 'Display formula at top of inline roll expanded view in chat log.', category: 'chat-card', enable, disable, stage: 'init' });\n",
    "/*\n * Add additional properties to chat cards.\n */\n\nimport { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { createNode, canViewChatMessage, testTransparency } from '@root/common.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nconst newProp = (text, classes = [], tooltip) => createNode('span', text, ['tag', ...classes], { tooltip });\n\n/**\n * @param {ChatMessage} cm\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction additionalProperties(cm, html, options, shared) {\n\tconst item = cm.itemSource;\n\tif (!item) return; // Only item has the data needed\n\n\tif (!canViewChatMessage(cm, shared.user)) return;\n\tif (!testTransparency(game.user, item)) return;\n\n\tconst cardContent = html.querySelector('.pf1.item-card');\n\tif (!cardContent) return;\n\n\tconst extraProps = [];\n\n\tconst props = html.querySelector('.property-group.gm-sensitive div');\n\tif (!props) return;\n\n\t// const { itemId, actionId, tokenUuid, actorId } = cardContent.dataset ?? {};\n\tconst actionId = cardContent.dataset.actionId;\n\tconst action = item.actions?.get(actionId);\n\n\t// const itemData = item.system;\n\n\tif (action && action.attackType == 'natural' && !action.naturalAttack.primaryAttack) {\n\t\textraProps.push(newProp(i18n.get('PF1.SecondaryAttack'), ['lil-potentially-invalid'], 'Matches only default choice.'));\n\t}\n\n\tif (extraProps.length > 0)\n\t\tprops.append(...extraProps);\n}\n\nfunction enable() {\n\tAncillary.register('chat', additionalProperties);\n}\n\nfunction disable() {\n\tAncillary.unregister('chat', additionalProperties);\n\treturn false;\n}\n\nnew Feature({ setting: 'card-additional-properties', label: 'Additional Properties', hint: 'Adds additional properties to chat cards, such as secondary natural attack identifier.', category: 'chat-card', enable, disable, stage: 'init', stream: true });\n",
    "/*\n * Add more information to chat card header.\n */\n\nimport { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { createNode, canViewChatMessage, testTransparency } from '@root/common.mjs';\n\n/**\n * @param {ChatMessage} cm\n * @param {HTMLElement} html\n */\nfunction cardHeaderEnrichment(cm, html) {\n\tconst item = cm.itemSource;\n\tif (!canViewChatMessage(cm)) return;\n\tif (!testTransparency(game.user, item)) return;\n\n\tconst metadata = cm.system;\n\tif (!item) return;\n\tif (item.isPhysical && !item.system.identified) return;\n\n\tconst cl = metadata?.config?.cl ?? item.casterLevel;\n\tconst sl = metadata?.config?.sl ?? item.spellLevel;\n\tif (!(cl > 0 || sl > 0)) return;\n\n\tconst hd = createNode('div', '', ['lil-header-details', 'flexcol']);\n\tif (cl > 0) hd.append(createNode('span', `CL ${cl}`, ['lil-cl', 'lil-detail']));\n\tif (Number.isFinite(sl)) hd.append(createNode('span', `SL ${sl}`, ['lil-sl', 'lil-detail']));\n\n\tif (hd.children.length > 0)\n\t\thtml.querySelector('.card-header .item-name')?.after(hd);\n}\n\nfunction enable() {\n\tAncillary.register('chat', cardHeaderEnrichment);\n}\n\nfunction disable() {\n\tAncillary.unregister('chat', cardHeaderEnrichment);\n\treturn false;\n}\n\nnew Feature({ setting: 'card-header-enrichment', label: 'Header Enrichment', hint: 'Adds additional details to card headers, such as spell level and caster level.', category: 'chat-card', enable, disable, stage: 'init', stream: true });\n",
    "// Metadata Tooltips\n// @deprecated - severely broken on v13\n\nimport { Feature, SubSetting } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { setStaticToolTipListener } from '@core/tooltip.mjs';\n\n/**\n * @param {HTMLElement} tip\n * @param {ChatMessage} cm\n * @param {object} options\n * @param {Item} options.item\n * @param {HTMLElement} options.element\n * @param {object} options.metadata\n * @param {boolean} options.hasAttack\n * @param {boolean} options.hasDamage\n * @param options.attacks\n * @param options.tagGroups\n */\nasync function fillCardTooltip(tip, cm, { tagGroups = [] } = {}) {\n\t// const modeName = getRollModeName(cm);\n\t// const msgType = cmData.type;\n\n\tconst speaker = ChatMessage.getSpeakerActor(cm.speaker),\n\t\tisVisible = cm.isContentVisible,\n\t\twhisper = cm.whisper,\n\t\tisWhisper = whisper.length > 0,\n\t\tisBlind = isWhisper && cm.blind,\n\t\tauthor = cm.author,\n\t\tauthorId = author?.id,\n\t\tisSelfWhisper = whisper.length == 1 && whisper[0] == authorId;\n\n\t// Author\n\tconst nameDetails = [];\n\tif (!authorId) nameDetails.push(' ', createNode('span', '(Missing)', ['hint']));\n\telse if (authorId === game.user.id) nameDetails.push(' ', createNode('span', '(You)', ['hint']));\n\tconst ul = createNode('ul', undefined, ['details'], {\n\t\tchildren: [\n\t\t\tcreateNode('li', undefined, ['author'], {\n\t\t\t\tchildren: [\n\t\t\t\t\tcreateNode('label', 'Author'),\n\t\t\t\t\tcreateNode('span', `${author?.name}`, ['name', 'author-name', 'value'], { children: nameDetails }),\n\t\t\t\t],\n\t\t\t}),\n\t\t],\n\t});\n\n\tconst addLine = () => ul.append(createNode('hr', undefined, ['span-2']));\n\n\t// Speaker\n\tif (speaker && isVisible) {\n\t\taddLine();\n\n\t\tconst alias = cm.speaker.alias,\n\t\t\ttokenName = speaker.token?.name,\n\t\t\tactorName = speaker.name,\n\t\t\tprimaryName = alias ?? tokenName ?? actorName;\n\t\tconst lis = createNode('li', undefined, ['speaker'], {\n\t\t\tchildren: [\n\t\t\t\tcreateNode('label', 'Speaker'),\n\t\t\t\tcreateNode('span', primaryName, ['name', 'speaker-name', 'value']),\n\t\t\t],\n\t\t});\n\t\tul.append(lis);\n\n\t\tif (speaker.testUserPermission(game.user, 'OBSERVER')) {\n\t\t\tif (!!tokenName && primaryName !== tokenName) {\n\t\t\t\tconst lit = createNode('li', undefined, ['speaker'], {\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tcreateNode('label', 'Token'),\n\t\t\t\t\t\tcreateNode('span', tokenName, ['name', 'token-name', 'value']),\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t\tul.append(lit);\n\t\t\t}\n\n\t\t\tif (!!actorName && primaryName !== actorName && tokenName !== actorName) {\n\t\t\t\tconst lia = createNode('li', undefined, ['speaker'], {\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tcreateNode('label', 'Actor'),\n\t\t\t\t\t\tcreateNode('span', actorName, ['name', 'actor-name', 'value']),\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t\tul.append(lia);\n\t\t\t}\n\t\t}\n\t}\n\n\taddLine();\n\n\t// Roll Mode\n\tlet modeLabel;\n\tif (!isWhisper) modeLabel = 'Public';\n\telse if (isBlind) modeLabel = 'Blind GM Whisper';\n\telse if (isSelfWhisper) modeLabel = 'Self';\n\telse if (whisper.every(u => game.users.get(u)?.isGM)) modeLabel = 'GM Whisper';\n\telse modeLabel = 'Whisper';\n\n\tconst rlmode = createNode('li', undefined, ['roll-mode'], {\n\t\tchildren: [\n\t\t\tcreateNode('label', 'Visibility'),\n\t\t\tcreateNode('span', modeLabel, ['name', 'speaker-name', 'value']),\n\t\t],\n\t});\n\tul.append(rlmode);\n\n\t// Is Blind\n\tif (isBlind) {\n\t\tconst li = createNode('li', undefined, ['blind'], {\n\t\t\tchildren: [\n\t\t\t\tcreateNode('label', 'Blind'),\n\t\t\t\tcreateNode('span', isBlind ? 'Yes' : 'No', ['blind-mode', isBlind ? 'enabled' : 'disabled', 'value']),\n\t\t\t],\n\t\t});\n\t\tul.append(li);\n\t}\n\n\t// Is Self Roll\n\tif (isSelfWhisper) {\n\t\tconst li = createNode('li', undefined, ['selfroll'], {\n\t\t\tchildren: [\n\t\t\t\tcreateNode('label', 'Self'),\n\t\t\t\tcreateNode('span', isSelfWhisper ? 'Yes' : 'No', ['self-roll-mode', isSelfWhisper ? 'enabled' : 'disabled', 'value']),\n\t\t\t],\n\t\t});\n\t\tul.append(li);\n\t}\n\t// Is Whisper\n\telse if (isWhisper) {\n\t\tconst lipre = createNode('li', undefined, ['whisper'], {\n\t\t\tchildren: [\n\t\t\t\tcreateNode('label', 'Whisper'),\n\t\t\t\tcreateNode('span', isWhisper ? 'Yes' : 'No', ['whisper-mode', isWhisper ? 'enabled' : 'disabled', 'value']),\n\t\t\t],\n\t\t});\n\t\tul.append(lipre);\n\n\t\tif (isVisible) {\n\t\t\tconst targets = cm.whisper.map(uid => game.users.get(uid) ?? { id: uid, missing: true });\n\t\t\tfor (const t of targets) {\n\t\t\t\tconst isSelf = game.user.id === t.id,\n\t\t\t\t\tisGM = t.isGM === true,\n\t\t\t\t\tlabel = t.name ?? `[${t.id}]`,\n\t\t\t\t\ttargetNames = [];\n\t\t\t\tif (isSelf) targetNames.push(' ', createNode('span', '(You)', ['hint']));\n\t\t\t\tconst li = createNode('li', undefined, ['whisper-target'], {\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tcreateNode('label', ' â€“ ', ['preformatted']),\n\t\t\t\t\t\tcreateNode('span', label, ['name', 'whisper-target', isSelf ? 'self' : 'other', isGM ? 'gm' : 'player', 'value'], { data: { 'user-id': t.id }, children: targetNames }),\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t\tul.append(li);\n\t\t\t}\n\t\t}\n\t}\n\n\taddLine();\n\n\tconst timestamp = cm.timestamp;\n\n\tconst date = new Date(timestamp);\n\tconst dateLabel = date.toLocaleString();\n\tconst lidate = createNode('li', undefined, ['date-time'], {\n\t\tchildren: [\n\t\t\tcreateNode('label', 'Date & Time'),\n\t\t\tcreateNode('time', dateLabel, ['date-time', 'value']),\n\t\t],\n\t});\n\tul.append(lidate);\n\n\tif (feature.subsettings.stealTimestamp.value) {\n\t\tconst lifuzzy = createNode('li', undefined, ['relative-time'], {\n\t\t\tchildren: [\n\t\t\t\tcreateNode('label', 'Relative'),\n\t\t\t\tcreateNode('time', tip.querySelector('.message-timestamp')?.textContent, ['message-timestamp', 'value']),\n\t\t\t],\n\t\t});\n\t\tul.append(lifuzzy);\n\t}\n\n\tif (isVisible && tagGroups.length > 0) {\n\t\taddLine();\n\t\tconst tagEl = createNode('div', undefined, ['property-group-tags', 'span-2']);\n\t\tfor (const g of tagGroups) {\n\t\t\tconst tagGEl = createNode('div', undefined, ['tags']);\n\t\t\ttagGEl.append(...g.tags);\n\t\t\ttagEl.append(\n\t\t\t\tcreateNode('h3', `Tags: ${g.label}`, ['group-title']),\n\t\t\t\ttagGEl,\n\t\t\t);\n\t\t}\n\t\tul.append(tagEl);\n\t}\n\n\tconst rv = Hooks.call('little-helper.chat.tooltip.meta', cm, ul);\n\tif (rv === false) return;\n\n\ttip.replaceChildren(ul);\n};\n\n/**\n * @param {ChatMessage} cm\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction injectChatTooltip(cm, html, options, shared) {\n\tconst tip = createNode('div', null, ['lil-tooltip', 'lil-card-tooltip']);\n\n\tif (feature.subsettings.stealRecipients.value)\n\t\thtml.querySelector('.message-header .whisper-to')?.remove();\n\tif (feature.subsettings.stealTimestamp.value)\n\t\ttip.append(html.querySelector('.message-metadata .message-timestamp')); // Temporary location to avoid foundry crapping out\n\tconst tagGroups = [];\n\tif (feature.subsettings.stealTags.value) {\n\t\tconst footer = html.querySelector('footer.card-footer');\n\t\tfor (const el of footer?.querySelectorAll('.property-group.general-notes') ?? []) {\n\t\t\tconst label = el.firstElementChild?.textContent?.trim();\n\t\t\tconst tags = [...el.querySelectorAll('.tag')];\n\t\t\tif (tags.length > 0) {\n\t\t\t\ttagGroups.push({ label, tags });\n\t\t\t\tel.remove();\n\t\t\t}\n\t\t}\n\t}\n\n\thtml.addEventListener('pointerenter', () => fillCardTooltip(tip, cm, { tagGroups }), { passive: true, once: true });\n\n\tsetStaticToolTipListener(html, tip, { aligned: false });\n\n\thtml.append(tip);\n}\n\nfunction enable() {\n\tAncillary.register('chat', injectChatTooltip);\n}\n\nfunction disable() {\n\tAncillary.unregister('chat', injectChatTooltip);\n\treturn false;\n}\n\nconst feature = new Feature({\n\tsetting: 'card-tooltips',\n\tlabel: 'Metadata Tooltips',\n\thint: 'Display card metadata in a tooltip.',\n\tcategory: 'chat-card',\n\tenable,\n\tdisable,\n\tstage: 'init',\n\tsubsettings: {\n\t\tstealRecipients: new SubSetting({\n\t\t\tlabel: 'Steal Recipients',\n\t\t\thint: 'Remove recipient display from the main card, only displaying it in the tooltip.',\n\t\t\tfallback: true,\n\t\t\ttype: Boolean,\n\t\t}),\n\t\tstealTimestamp: new SubSetting({\n\t\t\tlabel: 'Steal Timestamp',\n\t\t\thint: 'Move timestamp display from the main card into the tooltip.',\n\t\t\tfallback: true,\n\t\t\ttype: Boolean,\n\t\t}),\n\t\tstealTags: new SubSetting({\n\t\t\tlabel: 'Steal Property Tags',\n\t\t\thint: 'Move property tags into the tooltip.',\n\t\t\tfallback: false,\n\t\t\ttype: Boolean,\n\t\t}),\n\t},\n\tconflict: { core: 13 },\n});\n",
    "function boundingWidth(b) {\n\tif (!b) return { l: 0, w: window.innerWidth, t: 0 };\n\n\tconst bv = b.getBoundingClientRect();\n\treturn { l: bv.left, w: bv.width, t: bv.top, h: bv.height };\n}\n\n/**\n * @param {HTMLElement} parentEl\n * @param {HTMLElement} tooltip\n * @param {object} options\n * @param {boolean} [options.aligned]\n * @param {HTMLElement} [options.boundedBy] Bounding element. Window if nothing is specified\n */\nexport function setStaticToolTipListener(parentEl, tooltip, { aligned = true, boundedBy } = {}) {\n\tparentEl.addEventListener('pointerenter', function onHover() {\n\t\tconst p = parentEl.getBoundingClientRect();\n\t\tconst { l, w, t } = boundingWidth(boundedBy);\n\t\ttooltip.style.cssText += `--p-left:${p.left};--p-bottom:${p.bottom};--width:${tooltip.clientWidth};--p-right:${p.right};--height:${tooltip.clientHeight};--p-height:${p.height};--p-width:${p.width};--p-right:${p.right};--p-top:${Math.max(t, p.top)};`;\n\t\tif (aligned) tooltip.classList.toggle('right-aligned', p.left > l + Math.floor(w / 2));\n\t}, { passive: true });\n}\n\n/**\n * @param {HTMLElement} el\n * @param {object} options\n * @param {TooltipManager.TOOLTIP_DIRECTIONS} options.direction\n * @param {Function} options.fn - Content generating callback\n * @param {any} options.context - Context data for the content function\n * @param {string} options.css - Space separated CSS class strings\n */\nexport function hookCoreTooltip(el, { css, direction, fn, context } = {}) {\n\tconst tm = CONFIG.ux.TooltipManager;\n\tdirection ??= tm.TOOLTIP_DIRECTIONS.UP;\n\n\tel.addEventListener('pointerover', async event => {\n\t\tconst content = await fn(event, el, context);\n\t\tif (!content) return;\n\n\t\tconst tt = { direction };\n\n\t\tif (typeof content === 'string') tt.text = content;\n\t\telse tt.html = content;\n\n\t\tif (css) tt.cssClass = css;\n\n\t\tgame.tooltip.activate(el, tt);\n\t}, { passive: true });\n\n\tel.addEventListener('pointerleave', () => game.tooltip.deactivate(), { passive: true });\n}\n",
    "// Little hint tags on checks to speed up their use.\n\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { enrichRoll, canViewChatMessage, createNode, addCoreTooltip } from '@root/common.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nconst getSkillName = (id) => pf1.config.skills[id] || id;\n\nclass Tag {\n\tcheck;\n\tsuccess;\n\tfailure;\n\tpossible;\n\tcontent;\n\thint;\n\tconstructor(label, { hint, check = 0, success = false, possible = false, failure = false } = {}) {\n\t\tthis.check = check;\n\t\tthis.content = label;\n\t\tthis.hint = hint;\n\t\tthis.success = success;\n\t\tthis.possible = possible;\n\t\tthis.failure = failure;\n\t}\n}\n\nfunction appendCustomTags(html, tags = []) {\n\tconst div = createNode('div', undefined, ['property-group', 'reminders', 'lil-check-notes']);\n\n\tconst tagList = createNode('div', undefined, ['tag-list', 'flexrow']);\n\tdiv.append(tagList);\n\n\tfor (const t of tags) {\n\t\tconst tag = createNode('span', undefined, ['tag', 'enriched']);\n\t\ttag.innerHTML = t.content;\n\t\tif (t.check) {\n\t\t\ttag.classList.add('check');\n\t\t\tif (t.success) tag.classList.add('success');\n\t\t\tif (t.possible) tag.classList.add('possible');\n\t\t\tif (t.failure) tag.classList.add('failure');\n\t\t}\n\t\tif (t.hint) {\n\t\t\ttag.classList.add('hint');\n\t\t\taddCoreTooltip(tag, t.hint);\n\t\t}\n\t\ttagList.append(tag);\n\t}\n\n\thtml.querySelector('.message-content')?.append(div);\n}\n\nfunction handleSkillCheck({ skillId, tags, check, cm, actor } = {}) {\n\tconst isMetric = pf1.utils.getDistanceSystem() === 'metric';\n\n\tconst rank = cm.system.config.rank ?? 0;\n\tconst trained = rank > 0;\n\n\tswitch (skillId) {\n\t\tcase 'apr':\n\t\t\t// Appraise\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.Checks.BaseDC', { dc: 20 }), { check, failure: check < 10, possible: check >= 10 && check < 20, success: check >= 20 }));\n\t\t\tbreak;\n\t\tcase 'spl': {\n\t\t\t// Spellcraft\n\t\t\t// Display what level of spell the roll is good for.\n\t\t\tconst rollData = { check };\n\t\t\tconst formula = '@check[Result] - 15[Base DC]';\n\t\t\tconst roll = RollPF.safeRollSync(formula, rollData);\n\t\t\tconst enriched = enrichRoll(roll, formula, roll.total, rollData).outerHTML;\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.CardHints.IdentifyMaxLevel', { level: enriched }), { hint: 'LittleHelper.CardHints.IdentifyMaxLevelHint', check, possible: check >= 15, success: check > 33, failure: check < 15 }));\n\t\t\tbreak;\n\t\t}\n\t\tcase 'dip':\n\t\t\t// Diplomacy\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.CardHints.IndifferentBaseDC', { dc: 15 }), { hint: '', check, failure: check < 5, possible: check >= 5 && check < 15, success: check > 15 }));\n\t\t\tbreak;\n\t\tcase 'int':\n\t\t\t// Intimidate\n\t\t\ttags.push(\n\t\t\t\tnew Tag(i18n.get('LittleHelper.CardHints.DemoralizeDC'), { check, failure: check < 10, possible: check >= 10 }),\n\t\t\t\tnew Tag(i18n.get('LittleHelper.CardHints.DemoralizeSizeBonus'), { hint: 'LittleHelper.CardHints.DemoralizeSizeBonusHint' }),\n\t\t\t);\n\t\t\tbreak;\n\t\tcase 'fly':\n\t\t\t// Fly\n\t\t\ttags.push(\n\t\t\t\tnew Tag(i18n.get('LittleHelper.CardHints.FlySlowDC', { dc: 10 }), { check, success: check >= 10, failure: check < 10 }),\n\t\t\t\tnew Tag(i18n.get('LittleHelper.CardHints.FlyHoverDC', { dc: 15 }), { check, success: check >= 15, failure: check < 15 }),\n\t\t\t\tnew Tag(i18n.get('LittleHelper.CardHints.FlyOtherDC', { dc: '15/20' }), { check, success: check >= 20, possible: check >= 15 && check < 20, failure: check < 15 }),\n\t\t\t);\n\t\t\tbreak;\n\t\tcase 'acr': {\n\t\t\t// Acrobatics\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.CardHints.TumbleDC'), { hint: 'LittleHelper.CardHints.TumbleDCHint', check, failure: check < 0, possible: check >= 0 }));\n\t\t\tconst actor = ChatMessage.getSpeakerActor(cm.speaker);\n\t\t\t// tags.push({ content: 'Through DC=5+CMD', failure: check < 15, possible: check >= 15 }); // it's just +5 DC\n\t\t\tconst unit = isMetric ? pf1.config.measureUnitsShort.m : pf1.config.measureUnitsShort.ft;\n\t\t\tif (!actor) return;\n\t\t\tconst speed = actor.system.attributes?.speed?.land?.total ?? 0;\n\t\t\tconst rollData = { attributes: { speed: { land: { total: speed } } }, check };\n\t\t\tconst hformula = 'floor((@check[Result] + floor(((@attributes.speed.land.total - 30) / 10)[Speed Modifier] * 4[Check Adjust])) / 4)';\n\t\t\tconst hroll = RollPF.safeRollSync(hformula, rollData);\n\t\t\tconst hcv = pf1.utils.convertDistance(hroll.total)[0];\n\t\t\tconst henriched = hroll.err ? '<i>NaN</i>' : enrichRoll(hroll, hformula, `${hcv} ${unit}`, rollData).outerHTML;\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.CardHints.JumpHeight', { value: henriched }), { check, failure: hroll.total <= 0, possible: hroll.total > 0, hint: hroll.err?.message }));\n\n\t\t\tconst dformula = '@check[Check] + floor((@attributes.speed.land.total - 30) / 10)[Speed Modifier] * 4[Check Adjust]';\n\t\t\tconst droll = RollPF.safeRollSync(dformula, rollData);\n\t\t\tconst dcv = pf1.utils.convertDistance(droll.total)[0];\n\t\t\tconst denriched = droll.err ? '<i>NaN</i>' : enrichRoll(droll, dformula, `${dcv} ${unit}`, rollData).outerHTML;\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.CardHints.JumpLength', { value: denriched }), { check, failure: droll.total <= 0, possible: droll.total > 0, hint: droll.err?.message }));\n\t\t\tbreak;\n\t\t}\n\t\tcase 'blf':\n\t\t\t// Bluff\n\t\t\ttags.push(\n\t\t\t\tnew Tag(i18n.get('LittleHelper.CardHints.FeintDC', { dc: 10 }), { hint: 'LittleHelper.CardHints.FeintDCHint', check, failure: check < 10, possible: check >= 10 }),\n\t\t\t\tnew Tag(i18n.get('LittleHelper.CardHints.OpposedBy', { skill: getSkillName('sen') })),\n\t\t\t);\n\t\t\tbreak;\n\t\tcase 'clm': { // Climb\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.CardHints.ClimbNaturalRockDC', { dc: 15 }), { check, possible: check >= 5, failure: check < 5 }));\n\t\t\tconst clmb = actor?.system.attributes?.speed?.climb?.total ?? 0;\n\t\t\tlet speed = clmb;\n\t\t\tif (clmb == 0) {\n\t\t\t\tconst base = (actor?.system.attributes?.speed?.land?.total ?? 0) / 5;\n\t\t\t\tspeed = Math.floor(base / 4) * 5; // Quarter normal speed\n\t\t\t}\n\t\t\tconst [cspeed, unit] = pf1.utils.convertDistance(speed);\n\t\t\tconst lspeed = i18n.get('Koboldworks.Missing.PF1.Distance', { distance: cspeed, unit: pf1.config.measureUnitsShort[unit] || unit });\n\t\t\tconst hint = clmb > 0 ? 'LittleHelper.CardHints.NaturalSpeed' : 'LittleHelper.CardHints.ClimbSpeedHint';\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.CardHints.ClimbSpeed', { speed: lspeed }), { hint }));\n\t\t\tif (speed > 0) {\n\t\t\t\tconst aspeed = i18n.get('Koboldworks.Missing.PF1.Distance', { distance: cspeed * 2, unit: pf1.config.measureUnitsShort[unit] || unit });\n\t\t\t\ttags.push(new Tag(i18n.get('LittleHelper.CardHints.FastClimb', { speed: aspeed }), { hint: 'LittleHelper.CardHints.FastClimbHint' }));\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tcase 'dev': // Disable Device\n\t\t\ttags.push(\n\t\t\t\tnew Tag(i18n.get('LittleHelper.CardHints.DisableDeviceBaseDC', { dc: 10 }), { check, failure: check < 10, possible: check >= 10 }),\n\t\t\t\tnew Tag(i18n.get('LittleHelper.CardHints.DisableLockBaseDC', { dc: 20 }), { check, failure: check < 20, possible: check >= 20 }),\n\t\t\t);\n\t\t\tbreak;\n\t\tcase 'dis': // Disguise\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.CardHints.OpposedBy', { skill: getSkillName('per') })));\n\t\t\tbreak;\n\t\tcase 'esc': // Escape Artist\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.CardHints.EscapeArtistBaseDC', { dc: 20 }), { check, failure: check < 20, possible: check >= 20 }));\n\t\t\tbreak;\n\t\tcase 'han': // Handle Animal\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.CardHints.HandleAnimalBaseDC', { dc: 10 }), { check, failure: check < 10, possible: check >= 10 }));\n\t\t\tbreak;\n\t\tcase 'hea':\n\t\t\t// Heal\n\t\t\ttags.push(\n\t\t\t\tnew Tag(i18n.get('LittleHelper.CardHints.HealCommonDC', { dc: 15 }), { check, success: check >= 15, possible: check >= 13 && check < 15, failure: check < 13 }),\n\t\t\t\tnew Tag(i18n.get('LittleHelper.CardHints.HealDeadlyDC', { dc: 20 }), { hint: 'LittleHelper.CardHints.HealDeadlyDCHint', check, success: check >= 24, possible: check >= 18 && check < 23, failure: check < 18 }),\n\t\t\t);\n\t\t\tbreak;\n\t\tcase 'rid':\n\t\t\t// Ride\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.CardHints.RideFastMountDC', { dc: 20 }), { check, failure: check < 20, success: check >= 20 }));\n\t\t\tbreak;\n\t\tcase 'sen':\n\t\t\t// Sense Motive\n\t\t\ttags.push(\n\t\t\t\tnew Tag(i18n.get('LittleHelper.Checks.BaseDC', { dc: 20 }), { check, failure: check < 20, possible: check >= 20 }),\n\t\t\t\tnew Tag(i18n.get('LittleHelper.CardHints.OpposedBy', { skill: getSkillName('blf') })),\n\t\t\t);\n\t\t\tbreak;\n\t\tcase 'slt':\n\t\t\t// Sleight of Hand\n\t\t\ttags.push(\n\t\t\t\tnew Tag(i18n.get('LittleHelper.CardHints.PalmDC', { dc: 20 }), { check, failure: check < 10, possible: check >= 10 }),\n\t\t\t\tnew Tag(i18n.get('LittleHelper.CardHints.StealDC', { dc: 20 }), { check, failure: check < 20, possible: check >= 20 }),\n\t\t\t\tnew Tag(i18n.get('LittleHelper.CardHints.OpposedBy', { skill: getSkillName('per') })),\n\t\t\t);\n\t\t\tbreak;\n\t\tcase 'per':\n\t\t\t// Perception\n\t\t\ttags.push(\n\t\t\t\tnew Tag(i18n.get('LittleHelper.CardHints.OpposedBy', { skill: getSkillName('ste') })),\n\t\t\t\tnew Tag(i18n.get('LittleHelper.CardHints.OpposedBy', { skill: getSkillName('slt') })),\n\t\t\t);\n\t\t\tbreak;\n\t\tcase 'ste':\n\t\t\t// Stealth\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.CardHints.OpposedBy', { skill: getSkillName('per') })));\n\t\t\tbreak;\n\t\tcase 'sur': {\n\t\t\t// Survival\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.CardHints.SubsistDC', { dc: 10 }), { hint: 'LittleHelper.CardHints.SubsistDCHint', check, failure: check < 10, success: check >= 10 }));\n\t\t\t// TODO: Simply display how many are fed?\n\t\t\tconst count = Math.max(0, Math.floor((check - 8) / 2));\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.CardHints.SubsistFed', { count })));\n\t\t\tbreak;\n\t\t}\n\t\tcase 'swm': {\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.Checks.BaseDC', { dc: 10 }), { check, failure: check < 10, possible: check >= 10 }));\n\t\t\tconst swm = actor?.system.attributes?.speed?.swim?.total ?? 0;\n\t\t\tlet speed = swm;\n\t\t\tif (swm == 0) {\n\t\t\t\tconst base = (actor?.system.attributes?.speed?.land?.total ?? 0) / 5;\n\t\t\t\tspeed = Math.floor(base / 4) * 5; // Quarter normal speed\n\t\t\t}\n\t\t\tconst [cspeed, unit] = pf1.utils.convertDistance(speed);\n\t\t\tconst lspeed = i18n.get('Koboldworks.Missing.PF1.Distance', { distance: cspeed, unit: pf1.config.measureUnitsShort[unit] || unit });\n\t\t\tconst hint = swm > 0 ? 'LittleHelper.CardHints.NaturalSpeed' : 'LittleHelper.CardHints.SwimSpeedHint';\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.CardHints.SwimSpeed', { speed: lspeed }), { hint }));\n\n\t\t\tbreak;\n\t\t}\n\t\tcase 'umd': {\n\t\t\t// Use Magic Device\n\t\t\tconst rollData = { check };\n\t\t\tconst formula = '@check[Result] - 20[Base DC]';\n\t\t\tconst roll = RollPF.safeRollSync(formula, rollData);\n\t\t\tconst enriched = enrichRoll(roll, formula, roll.total, rollData).outerHTML;\n\t\t\ttags.push(\n\t\t\t\tnew Tag(i18n.get('LittleHelper.CardHints.UMDWandDC', { dc: 20 }), { check, failure: check < 20, possible: check >= 20 }),\n\t\t\t\tnew Tag(i18n.get('LittleHelper.CardHints.UMDScrollMaxLevel', { level: enriched }), { hint: 'LittleHelper.CardHints.UMDScrollMaxLevelHint', check, possible: check >= 20, failure: check < 20, success: check >= 29 }),\n\t\t\t);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'kar':\n\t\tcase 'kdu':\n\t\tcase 'ken':\n\t\tcase 'kge':\n\t\tcase 'khi':\n\t\tcase 'klo':\n\t\tcase 'kna':\n\t\tcase 'kno':\n\t\tcase 'kpl':\n\t\tcase 'kre':\n\t\t\tif (!trained)\n\t\t\t\ttags.push(new Tag(i18n.get('LittleHelper.CardHints.UntrainedKnowledgeMaxDC', { dc: 10 }), { hint: 'LittleHelper.CardHints.CommonKnowledgeHint', check, success: check >= 10, failure: check < 5, possible: check < 10 && check >= 5 }));\n\t\t\tif (rank !== 0)\n\t\t\t\ttags.push(new Tag(i18n.get('LittleHelper.CardHints.KnowledgeBaseDC', { dc: 15 }), { hint: 'LittleHelper.CardHints.KnowledgeBaseDCHint', check, failure: check < 15, possible: check >= 15 && check < 33, success: check >= 33 }));\n\t\t\tbreak;\n\t\tcase undefined:\n\t\t\tbreak;\n\t\tdefault:\n\t\t\t/*\n\t\t\t// craft skills\n\t\t\t// The DCs are all over the place (0 to 35 with no clear base\n\t\t\t}\n\t\t\t*/\n\t\t\tbreak;\n\t}\n}\n\nfunction handleAbilityCheck({ abilityId, tags, check, cm, actor } = {}) {\n\tswitch (abilityId) {\n\t\tcase 'str':\n\t\t\t// Strength\n\t\t\ttags.push(\n\t\t\t\tnew Tag(i18n.get('LittleHelper.Checks.BaseDC', { dc: 5 }), { check, failure: check < 5, possible: check >= 5 }),\n\t\t\t\tnew Tag(i18n.get('LittleHelper.CardHints.DoorDC'), { hint: 'LittleHelper.CardHints.DoorDC', check, possible: check < 30, success: check >= 30, failure: check < 0 }),\n\t\t\t);\n\t\t\tbreak;\n\t\tcase 'dex':\n\t\t\t// Dexterity\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.Checks.BaseDC', { dc: 5 }), { check, failure: check < 5, possible: check >= 5 }));\n\t\t\tbreak;\n\t\tcase 'con': {\n\t\t\t// Constitution\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.Checks.BaseDC', { dc: 5 }), { check, failure: check < 5, possible: check >= 5 }));\n\t\t\tconst actor = ChatMessage.getSpeakerActor(cm.speaker);\n\t\t\tif (!actor) return;\n\n\t\t\tconst hp = actor.system.attributes?.hp;\n\t\t\tconst eHP = hp.value + hp.temp;\n\t\t\tif (eHP < 0) {\n\t\t\t\tconst rollData = { attributes: { hp } };\n\t\t\t\tconst formula = '10[Base] - (@attributes.hp.value + @attributes.hp.temp)[Effective HP]';\n\t\t\t\tconst roll = RollPF.safeRollSync(formula, rollData);\n\t\t\t\tconst dc = roll.total;\n\t\t\t\tconst enriched = enrichRoll(roll, formula, roll.total, rollData).outerHTML;\n\t\t\t\ttags.push(new Tag(i18n.get('LittleHelper.CardHints.StabilizeDC') + ' ' + enriched, { check, failure: dc > check, success: dc <= check }));\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconst conditions = actor.system.conditions;\n\t\t\t\tconst b = conditions.bleed;\n\t\t\t\ttags.push(new Tag(i18n.get('PF1.Condition.stable'), { check, success: !b, possible: b }));\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tcase 'int':\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.Checks.BaseDC', { dc: 5 }), { check, failure: check < 5, possible: check >= 5 }));\n\t\t\tbreak;\n\t\tcase 'wis':\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.Checks.BaseDC', { dc: 5 }), { check, failure: check < 5, possible: check >= 5 }));\n\t\t\tbreak;\n\t\tcase 'cha':\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.Checks.BaseDC', { dc: 10 }), { check, failure: check < 10, possible: check >= 10 }));\n\t\t\tbreak;\n\t}\n}\n\nfunction handleOtherCheck({ otherId, tags, check, cm, actor } = {}) {\n\tswitch (otherId) {\n\t\tcase 'concentration': {\n\t\t\tconst rollData = { check };\n\t\t\tconst formulaDefensiveCasting = 'floor((@check[Result] - 15[Base DC]) / 2)';\n\t\t\tconst formulaEntangledCasting = 'floor(@check[Result] - 15[Base DC])';\n\t\t\tconst defensiveRoll = RollPF.safeRollSync(formulaDefensiveCasting, rollData);\n\t\t\tconst entangledRoll = RollPF.safeRollSync(formulaEntangledCasting, rollData);\n\t\t\tconst enrichedDef = enrichRoll(defensiveRoll, formulaDefensiveCasting, defensiveRoll.total, rollData).outerHTML;\n\t\t\tconst enrichedEtgl = enrichRoll(entangledRoll, formulaEntangledCasting, entangledRoll.total, rollData).outerHTML;\n\n\t\t\ttags.push(\n\t\t\t\t// new Tag('Defensive DC 15+SLÃ—2', { hint: `Max spell level: ${defensiveRoll.total}`, check, failure: check < 15, possible: check >= 15, success: check > 33 }),\n\t\t\t\tnew Tag(i18n.get('LittleHelper.Checks.Other.concentration.DefensiveMaxSL', { level: enrichedDef }), { hint: 'DC 15+SLÃ—2', check, failure: check < 15, possible: check >= 15, success: check > 33 }),\n\t\t\t\tnew Tag(i18n.get('LittleHelper.Checks.Other.concentration.DamagedDC'), { hint: 'LittleHelper.CardHints.ContinuousDamageHint', check, failure: check < 10, possible: check >= 10 }),\n\t\t\t\tnew Tag(i18n.get('LittleHelper.Checks.Other.concentration.GrappledDC'), { check, failure: check < 10, possible: check >= 10 }),\n\t\t\t\t// new Tag('Entangled DC 15+SL', { hint: `Max spell level: ${entangledRoll.total}`, check, failure: check < 15, possible: check >= 15, success: check >= 15 + 9 }),\n\t\t\t\tnew Tag(i18n.get('LittleHelper.Checks.Other.concentration.EntangledMaxSL', { level: enrichedEtgl }), { hint: 'LittleHelper.Checks.Other.concentration.EntangledMaxSLHint', check, failure: check < 15, possible: check >= 15, success: check >= 15 + 9 }),\n\t\t\t);\n\t\t\tbreak;\n\t\t}\n\t\tcase undefined:\n\t\t\tbreak;\n\t}\n}\n\nfunction handleSaveCheck({ saveId, tags, check, cm, actor }) {\n\tswitch (saveId) {\n\t\tcase 'ref':\n\t\tcase 'will':\n\t\tcase 'fort':\n\t\t\ttags.push(new Tag(i18n.get('LittleHelper.Checks.BaseDC', { dc: 10 }), { check, failure: check < 10, possible: check >= 10 }));\n\t\t\tbreak;\n\n\t\tcase undefined:\n\t\t\tbreak;\n\t}\n}\n\n/**\n * @param {ChatMessage} cm\n * @param {HTMLElement} html\n * @param {string} subject\n * @param options\n * @param shared\n */\nfunction handleCheckMessages(cm, html, options, shared) {\n\tif (!canViewChatMessage(cm, shared.user)) return;\n\n\tconst metadata = cm.system;\n\tconst subject = metadata.subject;\n\tif (!subject) return;\n\n\tconst actor = ChatMessage.getSpeakerActor(cm.speaker);\n\n\tconst roll = cm.rolls[0],\n\t\tcheck = roll ? roll.total : 0,\n\t\ttags = [];\n\n\tconst skillId = subject.skill,\n\t\tabilityId = subject.ability,\n\t\tsaveId = subject.save,\n\t\totherId = subject.core;\n\n\t// const chatCfg = game.settings.get(CFG.id, CFG.SETTINGS.chat);\n\n\tif (skillId) handleSkillCheck({ skillId, tags, check, cm, actor });\n\tif (abilityId) handleAbilityCheck({ abilityId, tags, check, cm, actor });\n\tif (saveId) handleSaveCheck({ saveId, tags, check, cm, actor });\n\tif (otherId) handleOtherCheck({ otherId, tags, check, cm, actor });\n\n\tHooks.call('little-helper.checks.hints', tags, { subject, cm, roll, result: check, element: html, cls: Tag });\n\n\tif (tags.length > 0) appendCustomTags(html, tags);\n}\n\nfunction enable() {\n\tAncillary.register('chat', handleCheckMessages);\n\treturn false;\n}\n\nfunction disable() {\n\tAncillary.unregister('chat', handleCheckMessages);\n\treturn false;\n}\n\nnew Feature({ setting: 'card-hints', category: 'chat-card', enable, disable, stage: 'init', stream: true });\n",
    "/**\n * Expands inline rolls for attacks to show natural rolls.\n */\n\nimport { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { signNum, createNode, canViewChatMessage } from '@root/common.mjs';\n\nfunction enhanceAttackRoll(el, roll, total) {\n\t/** Crushes die rolls to dust: Tries to simplify the input. */\n\tconst rolls = roll.dice.length === 1 ?\n\t\troll.dice.map(d => `${d.values.join(', ')}`) :\n\t\t[`${roll.terms[0].total}`];\n\n\tconst diceTotal = roll.dice.length === 1 ? roll.dice.reduce((a, r) => a + r.total, 0) : roll.terms[0].total;\n\tconst hasDice = roll.dice.length > 0;\n\tconst bonus = roll.total - diceTotal;\n\n\t// Normal roll\n\tif (hasDice) {\n\t\tconst rollEl = createNode('span', rolls.join('+'), ['lil-roll', 'roll', 'die', 'd20']);\n\t\tconst bonusEl = createNode('span', signNum(bonus), ['lil-bonus']),\n\t\t\ttotalEl = createNode('span', total, ['lil-total']);\n\t\tel.append(rollEl, bonusEl, createNode('span', 'â‡’', ['lil-arrow']), totalEl);\n\t}\n\t// Obfuscated roll\n\telse {\n\t\tconst rollEl = createNode('span', '?', ['lil-roll', 'roll', 'die', 'd20']);\n\t\tconst bonusEl = createNode('span', '+?', ['lil-bonus']),\n\t\t\ttotalEl = createNode('span', total, ['lil-total']);\n\t\tel.append(rollEl, bonusEl, createNode('span', 'â‡’', ['lil-arrow']), totalEl);\n\t}\n\n\tel.classList.add('lil-enhanced-roll');\n}\n\n/**\n * @param {ChatMessage} cm\n * @param {HTMLElement} html\n */\nfunction attackRollEnricher(cm, html) {\n\tif (!cm.isContentVisible) return;\n\n\t// const item = cm.itemSource;\n\tconst metadata = cm.system;\n\tconst attacks = metadata?.rolls?.attacks;\n\tconst hasAttacks = attacks?.length > 0;\n\t// const hasDamage = attacks?.[0]?.damage?.[0] !== undefined;\n\tif (!hasAttacks) return;\n\n\tif (!canViewChatMessage(cm)) return;\n\n\t// Get only main attack rolls\n\t/** @type {Element[]} */\n\tconst ir = html.querySelectorAll('.chat-attack td[colspan] .inline-roll.inline-result[data-roll]');\n\n\tfor (const irEl of ir) {\n\t\tif (irEl.classList.contains('defense-dc')) return;\n\n\t\ttry {\n\t\t\tirEl.classList.add('lil-expanded-inline-roll', 'lil-roll-restyle');\n\n\t\t\tconst faIcon = irEl.firstElementChild;\n\t\t\tconst faText = faIcon?.nextSibling; // text node after child <i>\n\t\t\tif (!faText) continue;\n\n\t\t\tenhanceAttackRoll(irEl, Roll.fromJSON(unescape(irEl.dataset.roll)), faText.textContent?.trim());\n\t\t\tfaIcon.remove();\n\t\t\tfaText.remove();\n\t\t}\n\t\tcatch (err) {\n\t\t\tconsole.error(err);\n\t\t}\n\t}\n}\n\nfunction enable() {\n\tAncillary.register('chat', attackRollEnricher);\n}\n\nfunction disable() {\n\tAncillary.unregister('chat', attackRollEnricher);\n}\n\nnew Feature({\n\tsetting: 'attack-roll-enhancer', label: 'Enrich Attack Rolls', hint: 'Enriches display of attack rolls.', category: 'chat-card', enable, disable, stage: 'init', stream: true,\n});\n",
    "/*\n * Makes inline rolls show how good they rolled like attack rolls.\n */\n\nimport { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\n\n/**\n * @param {HTMLElement} el\n * @param {Roll} roll\n */\nfunction enhanceInlineRoll(el, roll) {\n\tel.classList.add('lil-roll-restyle');\n\n\tif (roll.dice.length === 0) {\n\t\tel.classList.add('diceless');\n\t\treturn;\n\t}\n\n\tlet tMin = 0, tMax = 0, tRatio = 0;\n\n\tlet dice = 0;\n\n\tfor (const d of roll.dice) {\n\t\tlet min = 0, max = 0, ratio = 0;\n\t\tfor (const r of d.results) {\n\t\t\tif (!r.active) continue;\n\t\t\tdice++;\n\t\t\tif (r.result == 1) min++;\n\t\t\telse if (r.result == d.faces) max++;\n\t\t\tratio += r.result;\n\t\t}\n\t\tconst pMin = dice, pMax = d.number * d.faces, pAvg = Math.floor((pMax + pMin) / 2 * 10) / 10;\n\t\tratio /= dice;\n\t\tratio = Math.floor(ratio / d.faces * 1000) / 1000;\n\t\ttMin += min; tMax += max; tRatio += ratio;\n\t}\n\n\ttRatio = Math.floor(tRatio / roll.dice.length * 100) / 100;\n\n\t// Enrich with classes\n\tif (tMin > 0) el.classList.add('has-min-roll');\n\tif (tMax > 0) el.classList.add('has-max-roll');\n\tif (tMin === dice) el.classList.add('minimum-roll' /* , 'failure'*/);\n\tif (tMax === dice) el.classList.add('maximum-roll' /* , 'success'*/);\n\n\tif (tRatio > 0.9) el.classList.add('great-roll');\n\tif (tRatio > 0.75) el.classList.add('good-roll');\n\telse if (tRatio > 0.5) el.classList.add('decent-roll');\n\tif (tRatio < 0.1) el.classList.add('horrible-roll');\n\tif (tRatio < 0.25) el.classList.add('bad-roll');\n\telse if (tRatio < 0.5) el.classList.add('poor-roll');\n\tif (tRatio < 0.6 && tRatio > 0.4) el.classList.add('middling-roll');\n\n\tel.dataset.rollGrade = Math.round(tRatio * 10);\n\n\t// Record natural roll\n\tconst firstTerm = roll.terms[0];\n\tif (firstTerm.constructor.name === 'Die') {\n\t\tconst results = firstTerm.results.filter(r => r.active);\n\t\tif (results.length === 1) {\n\t\t\tconst natural = results[0].result;\n\t\t\tel.dataset.rollNatural = natural;\n\t\t}\n\t}\n}\n\n/**\n * @param {ChatMessage} cm\n * @param {HTMLElement} html\n */\nfunction inlineRollEnricher(cm, html) {\n\tfor (const el of html.querySelectorAll('a.inline-roll.inline-result')) {\n\t\tconst rollString = unescape(el.dataset.roll);\n\t\tif (!el.dataset.roll) continue;\n\n\t\tconst json = JSON.parse(rollString);\n\t\tif (!json) return; // void console.warn('Missing roll data:', { element: el, message: cm });\n\t\ttry {\n\t\t\tenhanceInlineRoll(el, Roll.fromData(json));\n\t\t}\n\t\tcatch (err) {\n\t\t\tconsole.error({ json, element: el, message: cm }, err);\n\t\t}\n\t}\n}\n\nfunction enable() {\n\tAncillary.register('chat', inlineRollEnricher);\n}\n\nfunction disable() {\n\tAncillary.unregister('chat', inlineRollEnricher);\n}\n\nnew Feature({\n\tsetting: 'inline-roll-grading', label: 'Inline Roll Grading', hint: 'Grades inline rolls with how well or poorly they went.', category: 'chat-card', enable, disable, stage: 'init', stream: true,\n});\n",
    "// Meld damage inline-rolls\n\nimport { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\n/**\n * @param {ChatMessage} cm\n * @param {HTMLElement} html\n */\nfunction meldDamageRolls(cm, html) {\n\tconst item = cm.itemSource;\n\n\tconst metadata = cm.system;\n\tif (!metadata) return;\n\n\tconst hasDamage = metadata.rolls?.attacks?.[0]?.damage?.[0] !== undefined;\n\tif (!(hasDamage || item?.hasDamage)) return;\n\n\t// Rows\n\tfor (const tr of html.querySelectorAll('.chat-attack tr')) for (const [index, el] of tr.querySelectorAll('td').entries()) {\n\t\tif ((index + 1) % 2 === 0) continue;\n\t\tif (el.colSpan > 1) continue; // skip attack rolls\n\t\tconst ir = el.querySelector('.inline-roll,span');\n\t\tconst next = el.nextElementSibling;\n\t\tif (ir) {\n\t\t\tir.classList.add('lil-melded-roll');\n\t\t\tel.classList.add('lil-melded-type');\n\t\t\tif (next) {\n\t\t\t\tconst noType = next.textContent.length === 0;\n\t\t\t\tel.append('Â ', ...el.nextElementSibling.childNodes);\n\t\t\t\tel.colSpan = 2;\n\t\t\t\tif (noType) el.append(i18n.get('PF1.Unknown'));\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// Meld empty cell pairs\n\t\t\tif (el.textContent === '' && next.textContent === '')\n\t\t\t\tel.colSpan = 2;\n\t\t}\n\t\tnext?.remove();\n\t}\n}\n\nfunction enable() {\n\tAncillary.register('chat', meldDamageRolls, { priority: -100 });\n}\n\nfunction disable() {\n\tAncillary.unregister('chat', meldDamageRolls);\n\treturn false;\n}\n\nnew Feature({ setting: 'card-damage-melding', label: 'Meld Damage & Type', hint: 'Combines damage and type into single cell.', category: 'chat-card', enable, disable, stage: 'init', stream: true });\n",
    "/*\n * Attempt to rectify chat card modifications twitching the chat log scroll position at start.\n */\n\nimport { CFG } from '@root/config.mjs';\n\nfunction scrollToEnd() {\n\t// Scroll to end\n\tconst log = document.getElementById('chat-log');\n\tif (!log) return;\n\tconst position = log.clientHeight + log.scrollTop;\n\t// const distance = log.scrollHeight - position;\n\tconst target = log.scrollHeight;\n\tif (position == target) return;\n\tconst C = CFG.console.colors;\n\tconsole.log(`%cLittle Helper%c ðŸ¦Ž | Scrolling from %c${position}%c to %c${target}%c`,\n\t\tC.main, C.unset, C.number, C.unset, C.number, C.unset);\n\tlog.scrollTo(0, target);\n\n\t// Foundry method, works less reliably despite being almost identical.\n\t// ui.chat?.scrollBottom();\n}\n\nHooks.once('ready', () => setTimeout(scrollToEnd, 1000)); // attempt to delay scrolling arbitrarily but not too much\n",
    "import { CFG } from '@root/config.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\n/* global libWrapper */\n\n/**\n * @param {Function} wrapped\n * @param {number} value\n * @param {object} options\n */\nasync function cardDamageSanityCheck(wrapped, value, options = {}) {\n\tconst msg = options.message;\n\tif (!(msg instanceof ChatMessage)) return wrapped(value, options);\n\n\tconst metadata = msg.system;\n\tconst trueTargets = metadata?.targets?.map(id => canvas.scene?.tokens.get(id) ?? fromUuidSync(id)) ?? [];\n\tif (trueTargets.length === 0) return wrapped(value, options);\n\n\tconst selected = canvas.tokens.controlled.map(t => t.document);\n\tconst notInTargets = selected.filter(t => !trueTargets.includes(t));\n\tif (notInTargets.length > 0) {\n\t\tconst targets = notInTargets.map(t => ({ token: t, targeted: false, selected: true }));\n\t\tconst actualTargets = trueTargets.map(t => ({ token: t, targeted: true, selected: selected.includes(t) }));\n\n\t\tconst templateData = {\n\t\t\ttargets,\n\t\t\tincluded: actualTargets.filter(t => t.selected),\n\t\t\texcluded: actualTargets.filter(t => !t.selected),\n\t\t};\n\n\t\tconst rt = foundry.applications.handlebars.renderTemplate;\n\n\t\tconst rv = await foundry.applications.api.DialogV2.confirm({\n\t\t\twindow: { title: i18n.get('LittleHelper.Untargeted.Title') },\n\t\t\tcontent: await rt(`modules/${CFG.id}/templates/dialog/target-validation.hbs`, templateData),\n\t\t\tclasses: ['lil-target-sanity-check'],\n\t\t});\n\n\t\tif (rv !== true) return false;\n\t}\n\n\treturn wrapped(value, options);\n};\n\nconst enable = () => {\n\tif (pf1.utils.chat?.onButton)\n\t\tlibWrapper.register(CFG.id, 'pf1.documents.actor.ActorPF.applyDamage', cardDamageSanityCheck, libWrapper.MIXED);\n};\n\nconst disable = () => {\n\tif (pf1.utils.chat?.onButton)\n\t\tlibWrapper.unregister(CFG.id, 'pf1.documents.actor.ActorPF.applyDamage');\n};\n\nnew Feature({ setting: 'apply-damage-sanity', label: 'Apply Damage Sanity Checks', hint: 'Perform minor sanity check on applying damage by checking your selected tokens are among targets. If discrepancies are found, confirmation dialog is displayed.', category: 'chat-card', enable, disable, stage: 'init' });\n",
    "import { Ancillary } from '@root/ancillary.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { TabData } from '@core/tab-data.mjs';\n\nconst systemSheets = new Set();\n\nfunction detectSheets() {\n\tfor (const data of Object.values(CONFIG.Actor.sheetClasses.character)) {\n\t\tif (data.id.startsWith('pf1.'))\n\t\t\tsystemSheets.add(data.cls.name);\n\t}\n\tfor (const data of Object.values(CONFIG.Actor.sheetClasses.npc)) {\n\t\tif (data.id.startsWith('pf1.'))\n\t\t\tsystemSheets.add(data.cls.name);\n\t}\n\tfor (const types of Object.values(CONFIG.Item.sheetClasses)) {\n\t\tfor (const data of Object.values(types)) {\n\t\t\tif (data.id.startsWith('pf1.'))\n\t\t\t\tsystemSheets.add(data.cls.name);\n\t\t}\n\t}\n\t// Action sheet\n\tfor (const sheet of Object.values(pf1.applications.component)) {\n\t\tsystemSheets.add(sheet.name);\n\t}\n}\n\n/**\n * @param {ItemSheet|ActorSheet} sheet\n * @param {HTMLElement} html\n * @param _opts\n * @param {SharedData} shared\n */\nfunction initSharedDocData(sheet, html, _opts, shared) {\n\tconst sheetClass = sheet.constructor.name;\n\tshared.sysSheet = systemSheets.has(sheetClass);\n\tshared.coreSheet = sheet.document instanceof Actor ? ['ActorSheetPFCharacter', 'ActorSheetPFNPC'].includes(sheetClass) : shared.sysSheet;\n\n\tif (!shared.sysSheet)\n\t\tshared.altSheetZenvy = sheet.options.classes.includes('pf1alt');\n\n\tfor (const tab of html.querySelectorAll('section .tab[data-tab]')) {\n\t\tshared.tabs[tab.dataset.tab] = new TabData(tab);\n\t}\n}\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param _opts\n * @param {SharedData} shared\n */\nfunction initSharedActorData(sheet, html, _opts, shared) {\n\tif (html instanceof jQuery) html = html[0];\n\n\t// Add shared containers to spellbooks\n\tconst spellbook = shared.tabs.spellbook;\n\tif (spellbook?.tab) {\n\t\t// Lazy spellbook getter\n\t\tObject.defineProperty(spellbook, 'tabs', {\n\t\t\t_spellbooks: undefined,\n\t\t\tget: function getSpellbooks() {\n\t\t\t\tif (!this._spellbooks) {\n\t\t\t\t\tthis._spellbooks = this.tab.querySelectorAll('.tab[data-group=\"spellbooks\"]');\n\n\t\t\t\t\tif (!this._spellbooks) return;\n\n\t\t\t\t\t// Add spell detail holder\n\t\t\t\t\tif (this._spellbooks) {\n\t\t\t\t\t\tfor (const tab of this._spellbooks) {\n\t\t\t\t\t\t\tfor (const node of tab.querySelectorAll('.spellbook-header')) {\n\t\t\t\t\t\t\t\tnode.querySelector('.item-name')\n\t\t\t\t\t\t\t\t\t?.append(createNode('div', undefined, ['lil-spell-details', 'lil-right-justify']));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn this._spellbooks;\n\t\t\t},\n\t\t});\n\t}\n\n\tconst summary = shared.tabs.summary;\n\tif (summary?.tab) {\n\t\t// Lazy attributes section getter\n\t\tObject.defineProperty(summary, 'attributes', {\n\t\t\t_attributes: undefined,\n\t\t\tget: function getAttributes() {\n\t\t\t\tthis._attributes ??= this.tab?.querySelector('.attributes');\n\t\t\t\treturn this._attributes;\n\t\t\t},\n\t\t});\n\t}\n}\n\nAncillary.register('actor', initSharedDocData, { priority: 1100 });\nAncillary.register('item', initSharedDocData, { priority: 1100 });\nAncillary.register('action', initSharedDocData, { priority: 1100 });\n\nAncillary.register('actor', initSharedActorData, { priority: 1000 });\n\nHooks.once('ready', detectSheets);\n",
    "export class TabData {\n\t/** @type {HTMLElement} */\n\ttab;\n\n\t/**\n\t * @param {HTMLElement} tab\n\t */\n\tconstructor(tab) {\n\t\tthis.tab = tab;\n\t}\n}\n",
    "import { CFG } from '@root/config.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nclass ActorOverrideConfig extends foundry.applications.api.HandlebarsApplicationMixin(foundry.applications.api.DocumentSheetV2) {\n\tget title() {\n\t\treturn i18n.get('LittleHelper.Settings.ActorOverridesTitle') + ` â€“ ${this.actor.name}`;\n\t}\n\n\tget actor() {\n\t\treturn this.document;\n\t}\n\n\tstatic DEFAULT_OPTIONS = {\n\t\ttag: 'form',\n\t\tclasses: ['little-helper', 'lil-overrides-config'],\n\t\tform: {\n\t\t\thandler: this._onSubmit,\n\t\t\tsubmitOnChange: true,\n\t\t},\n\t\twindow: {\n\t\t\ticon: 'fa-solid fa-screwdriver-wrench',\n\t\t\theight: 'auto',\n\t\t\twidth: 'auto',\n\t\t},\n\t\tsheetConfig: false,\n\t};\n\n\tstatic PARTS = {\n\t\tform: {\n\t\t\ttemplate: `modules/${CFG.id}/templates/actor-config.hbs`,\n\t\t},\n\t};\n\n\t_initializeApplicationOptions(options) {\n\t\toptions = super._initializeApplicationOptions(options);\n\n\t\toptions.uniqueId = `app-lh-overrides-${options.document.uuid}`;\n\n\t\treturn options;\n\t}\n\n\t/** @override */\n\t_prepareContext() {\n\t\tconst api = CFG.API;\n\t\tconst keys = [\n\t\t\t'new-actor-guide',\n\t\t\t'missing-bits',\n\t\t\t'excess-skill-ranks',\n\t\t\t'duplicate-slots',\n\t\t];\n\n\t\treturn {\n\t\t\tid: CFG.id,\n\t\t\tflags: this.actor.getFlag(CFG.id, 'overrides'),\n\t\t\tfeatures: Object.fromEntries(keys.map(key => [key, api.features.get(key).enabled])),\n\t\t};\n\t}\n\n\tstatic async open(ev, actor, options = {}) {\n\t\tev.preventDefault();\n\n\t\tconst el = ev.target;\n\t\tconst { bottom, right } = el.getBoundingClientRect();\n\n\t\toptions.document = actor;\n\n\t\tconst app = Object.values(ui.windows).find(app => app instanceof ActorOverrideConfig && app.document === actor) ?? new this(options);\n\n\t\tapp.render({ position: { top: bottom + 6, left: right - 320 }, force: true, focus: true });\n\n\t\treturn app;\n\t}\n\n\t/**\n\t * @this {ActorOverrideConfig}\n\t * @param {Event} event\n\t * @param {HTMLFormElement} form\n\t * @param {FormData} formData\n\t */\n\tstatic async _onSubmit(event, form, formData) {\n\t\tthis._toggleDisabled?.(true); // V12 doesn't have toggle disabled\n\n\t\tformData = foundry.utils.expandObject(formData.object);\n\n\t\tconst update = await this.document.update(formData);\n\n\t\tif (foundry.utils.isEmpty(update)) {\n\t\t\t// Update didn't result in anything being changed, re-enable dialog\n\t\t\tthis._toggleDisabled?.(false);\n\t\t}\n\t}\n}\n\n/**\n *\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nasync function injectActorSetup(sheet, html, options, shared) {\n\tif (html instanceof jQuery) html = html[0];\n\n\tconst tab = shared.tabs.settings?.tab;\n\tif (!tab) return void console.debug('Little Helper | Actor Config | Settings tab not found');\n\n\tconst buttons = tab.querySelector('.base-setup .pointbuy-calculator')?.parentElement;\n\tif (!buttons) return void console.debug('Little Helper | Actor Config | Buttons not found!');\n\n\tconst acb = document.createElement('button');\n\tacb.classList.add('lil-overrides-config');\n\tacb.type = 'button';\n\tacb.innerHTML = i18n.get('LittleHelper.Settings.ActorOverridesButton');\n\tacb.addEventListener('click', ev => ActorOverrideConfig.open(ev, sheet.actor));\n\tbuttons?.append(acb);\n}\n\nAncillary.register('actor', injectActorSetup);\n",
    "// Display extra info pertaining to creature type.\n// https://gitlab.com/foundryvtt_pathfinder1e/foundryvtt-pathfinder1/-/merge_requests/494\n\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction enrichCreatureTypeInfo(sheet, html, options, shared) {\n\tif (!shared.coreSheet) return;\n\n\tconst tab = shared.tabs.attributes?.tab;\n\tif (!tab) return;\n\n\t/** @type {HTMLElement} */\n\tconst qr = tab.querySelector('input[name=\"system.attributes.quadruped\"]');\n\n\tconst actor = sheet.actor;\n\n\tconst humtoggle = createNode('input');\n\thumtoggle.type = 'checkbox';\n\thumtoggle.readOnly = true; // Not respected by checkbox\n\thumtoggle.disabled = true; // Only way to make it readonly\n\thumtoggle.checked = actor.system.traits?.humanoid ?? false;\n\tif (!actor.race) humtoggle.indeterminate = true;\n\n\tconst hum = createNode('div', null, ['form-group'], {\n\t\tchildren: [\n\t\t\tcreateNode('label', i18n.get('PF1.CreatureTypes.humanoid')),\n\t\t\tcreateNode('label', null, ['checkbox'], { children: [humtoggle] }),\n\t\t],\n\t});\n\n\tqr.parentElement?.parentElement.after(hum);\n}\n\nfunction enable() {\n\tAncillary.register('actor', enrichCreatureTypeInfo);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', enrichCreatureTypeInfo);\n}\n\nnew Feature({ setting: 'creature-type-info', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "// Display condition durations\n\nimport { createNode } from '@root/common.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { getHumanTime, humanTimeUnit } from '@root/common.time.mjs';\n\nconst openSheets = {};\n\nfunction addDurationDisplay(el, ae, time) {\n\tconst { n, u } = getHumanTime(time);\n\tconst text = `${n} ${humanTimeUnit[u].short}`;\n\tel ??= createNode('i', undefined, ['lil-condition-duration']);\n\tel.innerHTML = text;\n\treturn el;\n}\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction initializeConditionDurations(sheet, html, options, shared) {\n\tconst actor = sheet.actor;\n\n\t// Active conditions?\n\tif (actor.statuses.size === 0) {\n\t\tdelete openSheets[sheet.appId];\n\t\treturn;\n\t}\n\n\tconst wt = game.time.worldTime;\n\topenSheets[sheet.appId] = sheet;\n\n\tconst statusAEs = {};\n\tfor (const ae of actor.allApplicableEffects()) {\n\t\tif (!ae.active) continue;\n\n\t\tfor (const status of ae.statuses) {\n\t\t\tstatusAEs[status] ??= [];\n\t\t\tstatusAEs[status].push(ae);\n\t\t}\n\t}\n\n\tfor (const el of shared.tabs.buffs?.tab?.querySelectorAll('.buffs-conditions .condition.active a[data-condition-id]') ?? []) {\n\t\tconst statusId = el.dataset.conditionId;\n\t\tconst aes = statusAEs[statusId];\n\t\tif (!(aes?.length > 0)) continue;\n\t\taes.sort((a, b) => (a.duration?.startTime ?? -Infinity) - (b.duration?.startTime ?? -Infinity));\n\t\tconst ae = aes[0];\n\t\tconst nel = addDurationDisplay(undefined, ae, Math.floor(wt - ae.duration.startTime));\n\t\tel.append(nel);\n\t\tel.classList.add('lil-stretched-condition');\n\t}\n}\n\n/**\n * @param {ActorSheet} sheet\n */\nfunction closeActorSheet(sheet) {\n\tdelete openSheets[sheet.appId];\n}\n\n/**\n * @param {number} wt New world time\n * @param {number} _delta\n */\nfunction refreshSheetDurations(wt, _delta) {\n\tfor (const sheet of Object.values(openSheets)) {\n\t\tconst conds = sheet.element?.[0].querySelector('.tab.buffs[data-tab=\"buffs\"] .buffs-conditions');\n\t\tif (!conds) continue;\n\t\tconst actor = sheet.actor;\n\n\t\tconst statusAEs = {};\n\t\tfor (const ae of actor.allApplicableEffects()) {\n\t\t\tfor (const status of ae.statuses) {\n\t\t\t\tstatusAEs[status] ??= [];\n\t\t\t\tstatusAEs[status].push(ae);\n\t\t\t}\n\t\t}\n\n\t\tfor (const el of conds.querySelectorAll('.buffs-conditions .condition.active a[data-condition-id]')) {\n\t\t\tconst dEl = el.querySelector('.lil-condition-duration');\n\t\t\tif (!dEl) continue;\n\t\t\tconst statusId = el.dataset.conditionId;\n\t\t\tconst aes = statusAEs[statusId];\n\t\t\tif (!(aes?.length > 0)) continue;\n\t\t\taes.sort((a, b) => (a.duration?.startTime ?? -Infinity) - (b.duration?.startTime ?? -Infinity));\n\t\t\tconst ae = aes[0];\n\t\t\taddDurationDisplay(dEl, ae, wt - ae.duration.startTime);\n\t\t}\n\t}\n}\n\nfunction enable() {\n\tAncillary.register('actor', initializeConditionDurations);\n\tHooks.on('closeActorSheet', closeActorSheet);\n\tHooks.on('updateWorldTime', refreshSheetDurations);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', initializeConditionDurations);\n\tHooks.off('closeActorSheet', closeActorSheet);\n\tHooks.off('updateWorldTime', refreshSheetDurations);\n\tfor (const k of Object.keys(openSheets)) delete openSheets[k];\n}\n\nnew Feature({ setting: 'actor-sheet-condition-durations', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "import { maxPrecision, getRelevantAE } from './common.mjs';\n\n/**\n * Turn buff time into seconds.\n *\n * @param {number} t\n * @param {\"round\"|\"hour\"|\"turn\"|\"minute\"} unit\n */\nexport const timeTransform = (t, unit) => {\n\tswitch (unit) {\n\t\tcase 'round':\n\t\tcase 'rounds':\n\t\t\treturn t * CONFIG.time.roundTime;\n\t\tcase 'hour':\n\t\tcase 'hours':\n\t\t\treturn t * 60 * 60;\n\t\tcase 'minute':\n\t\tcase 'minutes':\n\t\t\treturn t * 60;\n\t\tcase 'turn':\n\t\tcase 'turns':\n\t\t\treturn t * CONFIG.time.roundTime;\n\t\tcase 'second':\n\t\tcase 'seconds':\n\t\tcase 'sec': return t;\n\t}\n};\n\nexport const humanTimeUnit = {\n\tr: { short: 'rnd(s)', long: 'round(s)' },\n\tm: { short: 'min(s)', long: 'minute(s)' },\n\th: { short: 'hr(s)', long: 'hour(s)' },\n\td: { short: 'd(s)', long: 'day(s)' },\n\tw: { short: 'w(s)', long: 'week(s)' },\n\tmo: { short: 'mo(s)', long: 'month(s)' },\n\ty: { short: 'y(s)', long: 'year(s)' },\n};\n\nconst TIME = /** @type {const} */ ({\n\tMINUTE: 60,\n\tHOUR: 3_600,\n\tDAY: 86_400,\n\tWEEK: 86_400 * 7,\n\tMONTH: 86_400 * 30,\n\tYEAR: 86_400 * 365,\n});\n\n/**\n * @param {number} t Seconds\n * @returns {{n:number, u:string}} N[umber] U[nits]\n */\nexport const getHumanTime = (t) => {\n\tlet num, unit;\n\tconst ta = Math.abs(t);\n\tif (ta < CONFIG.time.roundTime * 15) {\n\t\tnum = Math.floor(t / CONFIG.time.roundTime);\n\t\tunit = 'r';\n\t}\n\telse if (ta < (TIME.HOUR * 2)) { // less than about 2 hours\n\t\tnum = maxPrecision(t / TIME.MINUTE, 2);\n\t\tunit = 'm';\n\t}\n\telse if (ta < (TIME.DAY * 1.3)) { // less than slightly over a day\n\t\tnum = maxPrecision(t / TIME.HOUR, 2);\n\t\tunit = 'h';\n\t}\n\telse if (ta < TIME.DAY * 14) {\n\t\tnum = maxPrecision(t / TIME.DAY, 2);\n\t\tunit = 'd';\n\t}\n\telse if (ta < TIME.DAY * 60) {\n\t\tnum = maxPrecision(t / TIME.WEEK, 2);\n\t\tunit = 'w';\n\t}\n\telse if (ta < TIME.YEAR) {\n\t\tnum = maxPrecision(t / TIME.MONTH, 2);\n\t\tunit = 'mo';\n\t}\n\telse {\n\t\tnum = maxPrecision(t / TIME.YEAR, 2);\n\t\tunit = 'y';\n\t}\n\n\treturn { n: num, u: unit };\n};\n\nclass Duration {\n\t/** @type {number} */\n\tstart = 0;\n\t/** @type {number} */\n\tduration = 0;\n\t/** @type {number} */\n\toffset = 0;\n\n\tget world() { return game.time.worldTime + this.offset; }\n\tget remaining() { return (this.start + this.duration) - this.world; }\n\tget passed() { return this.world - this.start; }\n\n\t/**\t@type {ActiveEffect} */\n\teffect;\n\t/** @type {Item} */\n\titem;\n\n\t/**\n\t * @param {number} start\n\t * @param {number} duration\n\t * @param {object} options\n\t * @param {ActiveEffect} options.activeEffect\n\t * @param {Item} options.item\n\t * @param options.offset\n\t */\n\tconstructor(start, duration, { activeEffect, item, offset } = {}) {\n\t\tthis.start = start ?? 0;\n\t\tthis.duration = duration ?? 0;\n\t\tthis.offset = offset ?? 0;\n\n\t\tthis.effect = activeEffect ?? undefined;\n\t\tthis.item = item ?? undefined;\n\t\tif (!item && activeEffect.parent instanceof Item) this.item = activeEffect.parent;\n\t}\n}\n\nexport const getAEDuration = (ae, { offset = 0 } = {}) => {\n\tconst dur = ae?.duration;\n\tif (!dur) return;\n\treturn new Duration(dur.startTime, dur.seconds, { activeEffect: ae, offset });\n};\n\n/**\n * Get buff time information.\n *\n * @param {Item} item\n * @param {object} rollData\n */\nexport const getTimeFromItem = (item, rollData) => {\n\tconst actor = item?.actor;\n\tconst ae = actor ? getRelevantAE(actor, { item }) : undefined;\n\n\tif (ae) return getAEDuration(ae);\n\n\tconst dur = item.system.duration;\n\tconst roll = RollPF.safeRollSync(dur.value, rollData ?? item.getRollData(), undefined, undefined, { minimize: true });\n\tlet value;\n\tif (roll.isDeterministic) value = roll.total;\n\telse value = pf1.utils.formula.simplify(roll.formula);\n\treturn new Duration(dur.start, timeTransform(value, dur.units), { item });\n};\n",
    "import { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { getHumanTime, humanTimeUnit, getTimeFromItem } from '@root/common.time.mjs';\n\nconst getTimeStr = (sdur) => {\n\tconst { n, u } = getHumanTime(sdur);\n\treturn `${n} ${humanTimeUnit[u].long}`;\n};\n\n/**\n * @param {HTMLElement} el\n * @param {Item} buff\n */\nconst activateDurationTooltip = async (el, buff) => {\n\tconst fragment = document.createDocumentFragment();\n\n\tconst dur = getTimeFromItem(buff);\n\n\tconst durStr = getTimeStr(dur?.duration ?? 0),\n\t\tremStr = getTimeStr(dur?.remaining ?? 0),\n\t\tpasStr = getTimeStr(dur?.passed ?? 0);\n\n\tfragment.append(\n\t\tcreateNode('label', 'Active:'), createNode('span', pasStr, ['active', 'value']),\n\t\tcreateNode('label', 'Remaining:'), createNode('span', remStr, ['remaining', 'value']),\n\t\tcreateNode('label', 'Max duration:'), createNode('span', durStr, ['duration', 'value']),\n\t);\n\n\tconst tm = CONFIG.ux.TooltipManager;\n\n\tconst tooltip = {\n\t\thtml: fragment,\n\t\tcssClass: 'pf1 lil-duration-tooltip',\n\t\tdirection: tm.TOOLTIP_DIRECTIONS.LEFT,\n\t};\n\n\tgame.tooltip.activate(el, tooltip);\n};\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction addBuffDurationTooltips(sheet, html, options, shared) {\n\tconst tab = shared.tabs.buffs?.tab;\n\tif (!tab) return;\n\n\tconst actor = sheet.actor;\n\tconst buffs = actor.itemTypes.buff?.filter(i => i.isActive) ?? [];\n\tif (buffs.length === 0) return;\n\n\tfor (const el of tab.querySelectorAll('li.item[data-item-id]')) {\n\t\tconst itemId = el.dataset.itemId;\n\t\tconst buff = actor.items.get(itemId);\n\t\tif (!buff?.isActive) continue;\n\n\t\tconst durEl = el.querySelector('.item-detail.item-duration');\n\t\tif (!durEl) continue;\n\n\t\tdurEl.addEventListener('pointerenter', _ => activateDurationTooltip(durEl, buff), { passive: true });\n\t\tdurEl.addEventListener('pointerleave', () => game.tooltip.deactivate());\n\t}\n}\n\nfunction enable() {\n\tAncillary.register('actor', addBuffDurationTooltips);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', addBuffDurationTooltips);\n}\n\nnew Feature({ setting: 'buff-tooltips', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "import { CFG } from '@root/config.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { setStaticToolTipListener } from '@core/tooltip.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction addConditionTooltips(sheet, html, options, shared) {\n\t/** @type {HTMLElement} */\n\tconst tab = shared.tabs.buffs?.tab;\n\n\tconst conds = tab?.querySelector('.buffs-conditions');\n\tif (!conds) return;\n\n\tconst ConditionHelp = CFG.i18n.conditions;\n\n\tconst fillTooltip = async (tip, condition) => tip.innerHTML = ConditionHelp[condition] ?? i18n.get('LittleHelper.Conditions._missing');\n\n\tfor (const el of conds.querySelectorAll('.condition [data-condition-id]')) {\n\t\tconst condition = el.dataset.conditionId;\n\t\tconst tip = createNode('div', null, ['lil-tooltip']);\n\t\tconst p = el.parentElement;\n\t\tp.append(tip);\n\t\tp?.addEventListener('pointerenter', _ => fillTooltip(tip, condition), { passive: true, once: true });\n\t\tsetStaticToolTipListener(p, tip, { aligned: true, boundedBy: conds });\n\t}\n}\n\nfunction enable() {\n\tAncillary.register('actor', addConditionTooltips);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', addConditionTooltips);\n}\n\nnew Feature({ setting: 'actor-condition-tooltips', label: 'Condition Tooltips', hint: 'Display tooltips describing effects of a conditon in buffs tab.', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "/*\n * Add some extra details to attacks.\n */\n\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { createNode, addCoreTooltip } from '@root/common.mjs';\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} _options\n * @param {SharedData} shared\n */\nfunction attackDetailsInjection(sheet, html, _options, shared) {\n\tconst actor = sheet.actor;\n\n\tconst rollData = shared.rollData;\n\n\tif (rollData.shield.type <= 1) return;\n\n\tconst tab = shared.tabs.combat?.tab;\n\tif (!tab) return; // BUG: alt sheet?\n\tconst items = tab?.querySelectorAll('.item[data-item-id]');\n\tif (!items) return;\n\n\tfor (const node of items) {\n\t\tconst item = actor.items.get(node.dataset.itemId);\n\t\tif (!item) continue;\n\n\t\tif (item.system.held !== '2h') continue;\n\n\t\tnode.classList.add('lil-awkward-shield');\n\t\tconst name = node.querySelector('.item-name');\n\t\tif (!name) continue;\n\n\t\tconst twohanded = createNode('i', undefined, ['fa-solid', 'fa-sign-language', 'lil-icon', 'right-floater', 'hands-of-effort']);\n\t\taddCoreTooltip(twohanded, 'LittleHelper.Warning.NoShieldWithTwohanded');\n\t\t// hookCoreTooltip(twohanded);\n\t\tname.append(twohanded);\n\t}\n}\n\nAncillary.register('actor', attackDetailsInjection);\n\n// TODO: FEATURE\n",
    "import { Ancillary } from '@root/ancillary.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { createNode, clampNum } from '@root/common.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} _options\n * @param {SharedData} shared\n */\nfunction showThacoh(sheet, html, _options, shared) {\n\tconst actor = shared.actor;\n\tif (!['character', 'npc'].includes(actor.type)) return;\n\n\tconst acEl = html.querySelector('section > .tab.combat .combat-defenses .ac-normal');\n\tif (!acEl) return;\n\n\t// Make assumptions\n\tconst isPC = actor.type == 'character';\n\tconst bab = isPC ? actor.system.attributes?.hd?.total : Math.min(Math.floor(actor.system.details?.cr?.total * 0.9), 20);\n\n\tconst abilities = actor.system.abilities;\n\tconst abl = Math.max(...Object.values(abilities).map(a => a.mod));\n\t// Weapon focus and greater weapon focus (or any other arbitrary bonus)\n\tconst feats = 1 + (bab > 6 ? 1 : 0);\n\t// Simulate arbitrary bonuses (fighter-ish features, rogue debilitating injury, etc.)\n\tconst wt = clampNum(Math.floor((bab - 1) / 4), 0, 4);\n\t// Simulate enhancement bonus\n\tlet enh = clampNum(Math.floor((bab - 2) / 3), 0, 5);\n\tif (bab > 1 && enh == 0) enh += 1;\n\n\tconst ac = actor.system.attributes.ac.normal.total;\n\n\tlet buffs = 0;\n\t// buffs += clampNum(Math.floor(bab / 4) * 2, 0, 6); // Heroism-isms\n\tbuffs += clampNum(Math.floor((bab + 4) / 5), 0, 4); // Inspire courage\n\n\tconst hitTotal = bab + abl + enh + wt + feats + buffs;\n\tconst formula = `+${bab}[BAB] +${abl}[Abl] +${enh}[Enh]<br>+${wt}[WT] +${feats}[Feats] +${buffs}[Buffs]<br>= <span class=\"value\">+${hitTotal} to-hit</span>`;\n\n\t// Minimum needed roll to hit\n\tconst minRoll = clampNum(ac - hitTotal, 1, 20);\n\n\tconst el = createNode('span', ` ${minRoll}+`, ['lil-thacoh']);\n\tconst die = createNode('i', null, ['fa-solid', 'fa-dice-d20']);\n\tel.prepend(die);\n\tel.dataset.tooltip = i18n.get('LittleHelper.Info.Thacoh') + '<br>' + formula;\n\tel.dataset.tooltipClass = 'pf1 lil-tooltip';\n\tacEl.append(el);\n}\n\nfunction enable() {\n\tAncillary.register('actor', showThacoh);\n}\nfunction disable() {\n\tAncillary.unregister('actor', showThacoh);\n}\n\nnew Feature({ setting: 'actor-thacoh', label: 'To Hit AC', hint: 'Display estimation of high likely you\\'re to be hit on combat tab.', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "import { CFG } from '@root/config.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { SharedData } from '@core/shared-data.mjs';\n\nasync function fillDetailsTab(content, actor) {\n\tconst C = CFG.console.colors;\n\tconsole.debug(`%cLittle Helper%c ðŸ¦Ž | Rendering details tab on-demand for %c${actor.name}%c [%c${actor.id}%c]`,\n\t\tC.main, C.unset, C.label, C.unset, C.id, C.unset);\n\tawait import('./providers/_init.mjs');\n\n\tconst shared = new SharedData(game.user, actor);\n\tHooks.call('little-helper.details-tab.content', content, shared);\n}\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n */\nfunction insertDetailsTab(sheet, html) {\n\tif (/Loot/.test(sheet.constructor.name)) return;\n\n\tconst content = createNode('div', undefined, ['tab', 'lil-details-content']);\n\tcontent.dataset.group = 'primary';\n\tcontent.dataset.tab = 'lil-details';\n\n\tconst navbutton = createNode('a', undefined, ['item', 'lil-sheet-tab']);\n\tnavbutton.dataset.tab = 'lil-details';\n\n\tconst icon = createNode('i', undefined, ['far', 'fa-file-alt']);\n\tnavbutton.append(icon);\n\n\tconst shc = html.querySelector('section.primary-body');\n\tconst nav = html.querySelector('nav.sheet-navigation.tabs[data-group=\"primary\"]');\n\tif (!shc || !nav) return;\n\n\tshc.append(content);\n\tnav.append(navbutton);\n\n\tnavbutton.addEventListener('click', () => fillDetailsTab(content, sheet.actor), { passive: true, once: true });\n}\n\nfunction enable() {\n\tAncillary.register('actor', insertDetailsTab);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', insertDetailsTab);\n}\n\nnew Feature({ setting: 'details-tab', label: 'Details Tab', hint: 'Add extra tab with random extra details.', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "// Display current CL at spellbook name.\n\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nfunction addFeatCount(parentEl, count, typed) {\n\tconst name = parentEl.querySelector('.item-list-header .item-name');\n\tconst rjust = createNode('div', null, ['lil-right-justify']);\n\tconst iCount = createNode('label', i18n.get('LittleHelper.Count') + `: ${Math.max(0, count)}`, ['lil-box', 'lil-feats-possessed']);\n\trjust.append(iCount);\n\tname.append(rjust);\n}\n\nfunction addSpellCount(parentEl, count, level) {\n\tconst actualCount = Math.max(0, count),\n\t\tpageCount = level >= 0 ? actualCount * Math.max(1, level) : null,\n\t\ttooltip = level >= 0 ? i18n.get('LittleHelper.PageCount') + `: ${pageCount}` : undefined;\n\n\tparentEl.querySelector('.lil-spell-details')\n\t\t.append(createNode('label', i18n.get('LittleHelper.Known') + `: ${actualCount}`, ['lil-box', 'lil-spells-known'], { tooltip }));\n}\n\n/**\n * @param {ActorSheet} _sheet\n * @param {HTMLElement} _jq\n * @param {object} _opts\n * @param {SharedData} shared\n */\nfunction itemCountInjector(_sheet, _jq, _opts, shared) {\n\tconst typed = shared.items.byType,\n\t\tspells = typed.spell;\n\n\t/** @type {Element[]} */\n\tconst spellTabs = shared.tabs.spellbook?.tabs ?? [];\n\tfor (const tab of spellTabs) {\n\t\tif (!spells) return;\n\t\tif (spells.all.length === 0) continue;\n\n\t\tconst bookId = tab.dataset.tab;\n\t\tconst book = spells._book?.[bookId];\n\t\tif (!book) continue;\n\n\t\tfor (const ol of tab.querySelectorAll('.item-list[data-level]')) {\n\t\t\tconst level = ol.dataset.level;\n\t\t\tconst spellCount = book[level]?.length ?? 0;\n\t\t\taddSpellCount(ol, spellCount, level);\n\t\t}\n\t}\n\n\tfor (const ol of shared.tabs.feats?.tab?.querySelectorAll('ol.item-list[data-type]') ?? []) {\n\t\tconst type = ol.dataset.type,\n\t\t\tsubtype = ol.dataset.subtype;\n\t\tconst count = typed[type][subtype]?.all?.length ?? 0;\n\t\taddFeatCount(ol, count, typed);\n\t}\n}\n\nAncillary.register('actor', itemCountInjector);\n",
    "import { CFG } from '@root/config.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { createNode } from '@root/common.mjs';\n\nfunction calculateSkills(actor, rollData) {\n\tconst result = {};\n\n\tconst useBGSkills = game.settings.get('pf1', 'allowBackgroundSkills');\n\n\tconst abilities = actor.system.abilities;\n\n\tconst isMindless = abilities?.int?.value === null;\n\tconst intMod = isMindless ? 0 : (abilities?.int?.mod ?? 0);\n\n\t// Rank counting\n\tconst ranks = { allowed: 0, used: 0, bgAllowed: 0, bgUsed: 0, transferred: 0 };\n\n\t// Count used skill ranks\n\tfor (const sklId of actor.allSkills) {\n\t\tconst skill = actor.getSkillInfo(sklId, { rollData });\n\t\tif (skill.background && useBGSkills)\n\t\t\tranks.bgUsed += skill.rank || 0;\n\t\telse\n\t\t\tranks.used += skill.rank || 0;\n\t}\n\n\tconst bgSkillClasses = new Set(pf1.config.backgroundSkillClasses);\n\n\t// Allowed skill ranks from HD, classes, intelligence, FCB, etc.\n\tfor (const cls of actor.itemTypes.class.filter((cls) => cls.system.subType !== 'mythic')) {\n\t\t// Favoured Class Bonus\n\t\tif (pf1.config.favoredClassTypes.includes(cls.subType))\n\t\t\tranks.allowed += cls.system.fc?.skill?.value || 0;\n\n\t\t// Mindless get nothing else\n\t\tif (isMindless) continue;\n\n\t\tconst hd = cls.hitDice;\n\t\tif (hd === 0) continue;\n\n\t\tconst perLevel = cls.system.skillsPerLevel || 0;\n\n\t\t// Int from HD still applies even if skills per level is zero.\n\t\tranks.allowed += Math.max(1, perLevel + intMod) * hd;\n\n\t\t// Background skills\n\t\tif (useBGSkills && bgSkillClasses.has(cls.subType)) {\n\t\t\tconst bgRanks = hd * pf1.config.backgroundSkillsPerLevel;\n\t\t\tif (bgRanks > 0) ranks.bgAllowed += bgRanks;\n\t\t}\n\t}\n\n\t// Calculate from changes\n\tranks.allowed += actor.system.details?.skills?.bonus || 0;\n\n\t// Adventure skills transferred to background skills\n\tif (useBGSkills && ranks.bgUsed > ranks.bgAllowed) {\n\t\tranks.transferred = ranks.bgUsed - ranks.bgAllowed;\n\t\tranks.allowed -= ranks.transferred;\n\t\tranks.bgAllowed += ranks.transferred;\n\t}\n\n\treturn ranks;\n}\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction newActorGuide(sheet, html, options, shared) {\n\tif (!sheet.isEditable) return;\n\n\tif (sheet.actor.getFlag(CFG.id, 'overrides')?.ready) return;\n\n\t// Only support specific sheets\n\tif (!['ActorSheetPFCharacter', 'ActorSheetPFNPC'].includes(sheet.constructor.name)) return;\n\n\tconst actor = shared.actor;\n\tif (!['character', 'npc'].includes(actor.type)) return;\n\tif (actor._newActor === false) return;\n\n\tconst abls = actor.system.abilities;\n\tconst undefinedAbilities = Object.values(abls).every(abl => abl.value === 10);\n\n\tconst itemTypes = shared.items.byType;\n\tconst noClass = itemTypes.class?.all.length == 0;\n\tconst noRace = itemTypes.race?.all.length == 0;\n\tconst noEquipment = itemTypes.weapon?.all.length == 0 && itemTypes.equipment?.all.length == 0 && itemTypes.loot?.all.length == 0 && itemTypes.container?.all.length == 0 && itemTypes.consumable?.all.length == 0;\n\n\t// Use system sheet's calculations\n\tconst ranks = calculateSkills(actor, shared.rollData);\n\tconst noSkills = ranks.allowed !== ranks.used || ranks.bgAllowed !== ranks.bgUsed;\n\n\tconst classLevels = itemTypes.class?.all\n\t\t.filter(cls => ['base', 'npc', 'prestige', 'racial'].includes(cls.subType))\n\t\t.reduce((cur, o) => cur + o.hitDice, 0);\n\tconst baseFeatCount = Math.ceil(classLevels / 2);\n\tconst noFeats = baseFeatCount > 0 ? itemTypes.feat?.all.filter(f => f.subType === 'feat').length == 0 : false;\n\n\tif (!undefinedAbilities && !noClass && !noRace && !noFeats && !noEquipment && !noSkills) {\n\t\tconsole.debug('LH | Marking', actor.name, actor.id, 'as finished.');\n\t\tactor._newActor = false;\n\t\treturn;\n\t}\n\n\tconst warningClass = 'lil-new-actor-warning',\n\t\ttabWarningClass = 'lil-new-actor-tab-warning';\n\n\tconst tabs = html.querySelector('nav.tabs');\n\n\tconst form = html.querySelector('form') ?? html;\n\tlet haveWarning = form.querySelector('form > .warning') != undefined;\n\n\tfunction addWarning(text) {\n\t\tif (haveWarning) return;\n\t\thaveWarning = true;\n\t\tform.prepend(createNode('span', text, ['warning', 'charactermancer']));\n\t}\n\n\tconst stab = shared.tabs.summary?.tab;\n\tif (noClass) {\n\t\tstab.querySelector('.classes-body')?.classList.add(warningClass);\n\t\ttabs.querySelector('.item[data-tab=\"summary\"]')?.classList.add(tabWarningClass);\n\t}\n\n\tif (noRace) {\n\t\tstab.querySelector('.race-container')?.classList.add(warningClass);\n\t\ttabs.querySelector('.item[data-tab=\"summary\"]')?.classList.add(tabWarningClass);\n\t\taddWarning('The character has no race. Go to Summary tab to fix this.');\n\t}\n\n\tif (undefinedAbilities) {\n\t\tconst atab = shared.tabs.attributes?.tab;\n\t\tatab?.querySelector('button.pointbuy-calculator')\n\t\t\t?.classList.add(warningClass);\n\n\t\tfor (const el of atab?.querySelector('.ability-scores')\n\t\t\t?.querySelectorAll('tr.ability > th + td') ?? []) {\n\t\t\tel.classList.add(warningClass);\n\t\t}\n\n\t\ttabs.querySelector('.item[data-tab=\"attributes\"]')\n\t\t\t?.classList.add(tabWarningClass);\n\n\t\taddWarning('The character has no ability scores set. Go to Attributes tab to fix this.');\n\t}\n\n\tif (noFeats) {\n\t\tconst f = shared.tabs.feats.tab?.querySelector('ol.feats-feat');\n\t\tf?.classList.add(warningClass, 'unpadded');\n\t\ttabs.querySelector('.item[data-tab=\"feats\"]')?.classList.add(tabWarningClass);\n\t\taddWarning('The character has no feats. Go to Features tab to fix this.');\n\t}\n\n\tif (noSkills) {\n\t\ttabs.querySelector('.item[data-tab=\"skills\"]')?.classList.add(tabWarningClass);\n\t\taddWarning('The character has not used all their skill ranks or has used too many. Go to Skills tab to fix this.');\n\t}\n\n\tif (noEquipment) {\n\t\ttabs.querySelector('.item[data-tab=\"inventory\"]')?.classList.add(tabWarningClass);\n\t\taddWarning('The character has no equipment. Go to Inventory tab to fix this.');\n\t}\n}\n\nfunction enable() {\n\tAncillary.register('actor', newActorGuide);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', newActorGuide);\n}\n\nnew Feature({ setting: 'new-actor-guide', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "import { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { createNode, maxPrecision } from '@root/common.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} opts\n * @param {SharedData} shared\n */\nfunction insertCoinWeightDisplay(sheet, html, opts, shared) {\n\tconst weight = sheet.actor._calculateCoinWeight();\n\tif (weight < Number.EPSILON) return;\n\n\tconst { light } = sheet.actor.getCarryCapacity();\n\n\tconst ratio = maxPrecision(weight / light, 2);\n\n\tlet weightCSS = 'smart-weight';\n\tif (ratio >= 0.5) weightCSS = 'heavy-weight';\n\telse if (ratio >= 0.35) weightCSS = 'moderate-weight';\n\telse if (ratio >= 0.2) weightCSS = 'light-weight';\n\telse if (ratio >= 0.1) weightCSS = 'feather-weight';\n\n\tconst label = shared.tabs.inventory?.tab?.querySelector('.currency h3');\n\tif (!label) return;\n\n\tconst units = pf1.utils.getWeightSystem() === 'metric' ? i18n.get('PF1.Kgs') : i18n.get('PF1.Lbs');\n\n\tconst weightLabel = createNode('label', `(${maxPrecision(weight, 1)} ${units})`, ['lil-currency-weight', weightCSS]);\n\tweightLabel.dataset.ratio = ratio;\n\tweightLabel.dataset.grade = Math.round(ratio * 10);\n\tlabel?.append(weightLabel);\n}\n\nfunction enable() {\n\tAncillary.register('actor', insertCoinWeightDisplay);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', insertCoinWeightDisplay);\n}\n\nnew Feature({ setting: 'currency-weight-display', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "import { CFG } from '@root/config.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { Feature, SubSetting } from '@core/feature.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nfunction cloneSlots(slots) {\n\tslots = { ...slots };\n\tfor (const [key, slot] of Object.entries(slots)) {\n\t\tslots[key] = slot.clone();\n\t}\n\treturn slots;\n}\n\n/**\n * @param {Item[]} eq\n * @param {Function} getSlot\n * @returns {object}\n */\nfunction groupItems(eq, getSlot) {\n\tconst all = {};\n\n\tfor (const item of eq) {\n\t\tconst slot = getSlot(item);\n\t\tif (slot != undefined) {\n\t\t\tif (all[slot] === undefined) all[slot] = [];\n\t\t\tall[slot].push(item);\n\t\t}\n\t}\n\n\treturn all;\n}\n\n/**\n * @param {object} info\n * @param {object} grouped\n */\nfunction countSlotUsage(info, grouped) {\n\tfor (const key of Object.keys(info)) {\n\t\tinfo[key] = info[key].clone();\n\t\tconst value = info[key];\n\t\tif (grouped[key] === undefined) continue;\n\t\tvalue.count = grouped[key].length;\n\t}\n}\n\n/**\n * @param {HTMLElement} section\n * @param {object} info\n * @param {Actor} actor\n * @param {object} grouped\n * @param {Function} getSlot\n */\nfunction markItems(section, info, actor, grouped, getSlot) {\n\tconst items = section.querySelectorAll('.item[data-item-id]');\n\tfor (const el of items) {\n\t\tconst item = actor.items.get(el.dataset.itemId);\n\t\tconst slot = getSlot(item);\n\t\tif (info[slot]?.warn) {\n\t\t\tif (!grouped[slot].some(i => i.id === item.id)) continue;\n\t\t\tconst st = el.querySelector('.item-slot');\n\t\t\tconst soft = info[slot].soft;\n\t\t\tst.classList.add(soft ? 'lil-warning' : 'lil-error');\n\n\t\t\tconst sel = st.firstElementChild || st;\n\t\t\t// TODO: Improve messageing\n\t\t\tlet msg = i18n.get('LittleHelper.Warning.TooManySlotItems', { used: info[slot].count, limit: info[slot].limit });\n\t\t\tif (soft) msg += '<br>' + i18n.get('LittleHelper.Clarify.NoActionNeeded');\n\t\t\tsel.dataset.tooltip += '<br>' + msg;\n\t\t}\n\t}\n}\n\nfunction notifyLackingUsage(el, info, labels) {\n\tconst unusedSlots = [];\n\tfor (const [slot, sInfo] of Object.entries(info)) {\n\t\tif (Number.isFinite(sInfo.limit) && sInfo.count < sInfo.limit) {\n\t\t\t// const label = sInfo.limit > 1 ? `${sInfo.limit - sInfo.count}Ã— ${slot}` : slot;\n\t\t\tunusedSlots.push(slot);\n\t\t}\n\t}\n\n\tif (unusedSlots.length > 0) {\n\t\tconst unusedMsg = i18n.get('LittleHelper.Warning.UnusedSlots') + ': ' + unusedSlots.map(s => labels[s] || s).sort((a, b) => a.localeCompare(b, undefined, { sensitivity: 'base' })).join(', ');\n\t\tconst holder = createNode('div', null, ['lil-unused-slots']);\n\t\tholder.append(createNode('i', null, ['fa-solid', 'fa-info-circle', 'lil-info-symbol']), unusedMsg);\n\n\t\tel.append(holder);\n\t}\n}\n\n/**\n * @param {HTMLElement} tab\n * @param {Actor} actor\n */\nfunction armorAndShieldConflicts(tab, actor) {\n\tconst eq = actor.itemTypes.equipment?.filter(i => i.isActive && ['armor', 'shield'].includes(i.subType)) ?? [];\n\n\t// Group by slot\n\tconst grouped = groupItems(eq, i => i.subType);\n\n\tconst info = cloneSlots(CFG.API.slots.armor);\n\tcountSlotUsage(info, grouped);\n\n\t// Check slotted items\n\tconst eqSec = tab?.querySelector('.item-list[data-list=\"armor\"]');\n\tif (!eqSec) return;\n\n\tmarkItems(eqSec, info, actor, grouped, i => i?.subType);\n\n\t// Unused slots\n\tif (feature.subsettings.unused.value && info.armor.count == 0) {\n\t\tconst unusedMsg = i18n.get('LittleHelper.Warning.NoArmor');\n\t\tconst holder = createNode('div', null, ['lil-unused-slots']);\n\t\tholder.append(createNode('i', null, ['fa-solid', 'fa-info-circle', 'lil-info-symbol']), unusedMsg);\n\n\t\teqSec.append(holder);\n\t}\n}\n\n/**\n * @param {HTMLElement} tab\n * @param {Actor} actor\n */\nfunction magicItemConflicts(tab, actor) {\n\tconst eq = actor.itemTypes.equipment?.filter(i => i.isActive && i.hasSlots) ?? [];\n\tif (eq.length === 0) return;\n\n\t// Group by slot\n\tconst grouped = groupItems(eq, i => i.system.slot);\n\n\tconst info = cloneSlots(CFG.API.slots.wondrous);\n\tcountSlotUsage(info, grouped);\n\n\t// Check slotted items\n\tconst eqSec = tab?.querySelector('.item-list[data-list=\"equipment\"]');\n\tif (!eqSec) return;\n\n\tmarkItems(eqSec, info, actor, grouped, i => i?.system.slot);\n\n\t// Unused slots\n\tif (feature.subsettings.unused.value) {\n\t\tnotifyLackingUsage(eqSec, info, pf1.config.equipmentSlots.wondrous);\n\t}\n}\n\n/**\n * @param {HTMLElement} tab\n * @param {Actor} actor\n */\nfunction implantConflicts(tab, actor) {\n\tconst eq = actor.itemTypes.implant?.filter(i => i.isActive) ?? [];\n\tif (eq.length === 0) return;\n\n\t// Group by slot\n\tconst grouped = groupItems(eq, i => i.system.slot);\n\n\tconst info = cloneSlots(CFG.API.slots.implants);\n\tcountSlotUsage(info, grouped);\n\n\t// Check slotted items\n\tconst eqSec = tab?.querySelector('.item-list[data-list=\"implants\"]');\n\tif (!eqSec) return;\n\n\tmarkItems(eqSec, info, actor, grouped, i => i?.system.slot);\n\n\t// Unused slots\n\tif (feature.subsettings.unused.value) {\n\t\t// notifyLackingUsage(eqSec, info, pf1.config.implantSlots.cybertech);\n\t}\n}\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {import('@core/shared-data.mjs').SharedData} shared\n */\nfunction slotUsageConflict(sheet, html, options, shared) {\n\tif (!sheet.isEditable) return;\n\tif (!shared.coreSheet) return;\n\n\tif (sheet.actor.getFlag(CFG.id, 'overrides')?.equipped) return;\n\n\tconst tab = shared.tabs?.inventory?.tab;\n\tif (!tab) return;\n\n\tconst actor = sheet.actor;\n\n\tarmorAndShieldConflicts(tab, actor);\n\tmagicItemConflicts(tab, actor);\n\timplantConflicts(tab, actor);\n}\n\nfunction enable() {\n\tAncillary.register('actor', slotUsageConflict);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', slotUsageConflict);\n}\n\nconst feature = new Feature({\n\tsetting: 'duplicate-slots',\n\tcategory: 'actor-sheet',\n\tenable,\n\tdisable,\n\tstage: 'ready',\n\tsubsettings: {\n\t\tunused: new SubSetting({\n\t\t\tlabel: 'Unused Slots',\n\t\t\thint: 'Display summary of unused slots at end of the slotted item list.',\n\t\t\ttype: Boolean,\n\t\t\tfallback: true,\n\t\t}),\n\t},\n});\n",
    "import { CFG } from '@root/config.mjs';\n\n// WIP\n\n/**\n * Slot information\n */\nexport class Slot {\n\t/**\n\t * @type {number} - Maximum number of items in this slot.\n\t */\n\tlimit = 1;\n\n\t/**\n\t * @type {boolean} - Is the limit soft?\n\t */\n\tsoft = false;\n\n\t/**\n\t * @type {number} - Number of matching items on actor.\n\t */\n\tcount = 0;\n\n\t/**\n\t * @param {number} limit - Maximum number of items\n\t * @param {object} [options] - Additional options\n\t * @param {boolean} [options.soft] - Soft limit\n\t * @param {number} [options.count] - Number of items\n\t */\n\tconstructor(limit = 1, { soft = false, count = 0 } = {}) {\n\t\tthis.limit = limit;\n\t\tthis.soft = soft;\n\t\tthis.count = count;\n\t}\n\n\tget warn() {\n\t\treturn this.count > this.limit;\n\t}\n\n\tclone() {\n\t\treturn new Slot(this.limit, { soft: this.soft, count: this.count });\n\t}\n}\n\n/* Humanoid default */\nexport const wondrousSlots = {\n\tbelt: new Slot(1),\n\tbody: new Slot(1),\n\tchest: new Slot(1),\n\teyes: new Slot(1),\n\tfeet: new Slot(1),\n\thands: new Slot(1),\n\thead: new Slot(1),\n\theadband: new Slot(1),\n\tneck: new Slot(1),\n\tring: new Slot(2),\n\tshoulders: new Slot(1),\n\tslotless: new Slot(Number.POSITIVE_INFINITY),\n\twrists: new Slot(1),\n};\n\nexport const implantSlots = {\n\tarm: new Slot(1),\n\tbody: new Slot(1, { soft: true }), // cybersoldier can equip 2\n\tbrain: new Slot(1, { soft: true }), // cybersoldier can equip 2\n\tears: new Slot(1),\n\teyes: new Slot(1),\n\thead: new Slot(1),\n\tlegs: new Slot(1),\n};\n\nexport const armorSlots = {\n\tarmor: new Slot(1, { soft: true }),\n\tshield: new Slot(1),\n};\n\nCFG.API.slots = {\n\twondrous: wondrousSlots,\n\timplants: implantSlots,\n\tarmor: armorSlots,\n};\n\nCFG.API.classes.slot = Slot;\n",
    "import { createNode, signNum } from '@root/common.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { getTimeFromItem, getHumanTime, humanTimeUnit } from '@root/common.time.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nconst addFASIcon = (el, iconCss) => {\n\tel.prepend(createNode('i', undefined, iconCss));\n\treturn el;\n};\n\nfunction getBaseGearInfo(sheet, shared) {\n\tconst cache = {};\n\tconst types = shared.items.byType;\n\n\tcache['equipment'] = {};\n\tcache['weapon'] = [];\n\tfor (const i of types.equipment.active) {\n\t\tconst subType = i.subType;\n\t\tif (['shield', 'armor'].includes(subType))\n\t\t\tcache[i.type][subType] = i;\n\t}\n\tfor (const i of types.weapon.active) {\n\t\tcache[i.type].push(i);\n\t}\n\treturn cache;\n}\n\nfunction getItemInfo(item, rv = {}, { isIdentified = true } = {}) {\n\tconst type = item.type,\n\t\tsubType = item.subType,\n\t\titemData = item.system;\n\n\tif (game.user.isGM)\n\t\tisIdentified = true;\n\n\trv.weight = itemData.weight;\n\trv.size = itemData.size;\n\trv.resizing = itemData.resizing;\n\trv.broken = itemData.broken ?? false;\n\n\tswitch (type) {\n\t\tcase 'equipment':\n\t\t\tswitch (subType) {\n\t\t\t\tcase 'shield':\n\t\t\t\tcase 'armor':\n\t\t\t\t\trv.armor = itemData.armor;\n\t\t\t\t\trv.masterwork = itemData.masterwork ?? false;\n\t\t\t\t\trv.enhancement = isIdentified ? (rv.armor.enh ?? 0) : 0;\n\t\t\t\t\trv.ac = rv.armor.value + rv.enhancement;\n\t\t\t\t\trv.maxDex = rv.armor.dex;\n\t\t\t\t\trv.acp = Math.max(0, rv.armor.acp + (rv.masterwork ? -1 : 0));\n\t\t\t\t\trv.asf = itemData.spellFailure;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase 'weapon':\n\t\t\trv.masterwork = itemData.masterwork;\n\t\t\trv.enhancement = isIdentified ? rv.enh : 0;\n\t\t\tbreak;\n\n\t\tcase 'attack':\n\t\t\tbreak;\n\t}\n\n\tconst act = item.defaultAction;\n\trv.action ??= {};\n\tif (act?.hasAttack) {\n\t\trv.action.critRange = act.critRange ?? 20;\n\t\trv.action.critMult = act.ability?.critMult ?? 2;\n\t}\n\n\treturn rv;\n}\n\nfunction artificialSubType(item) {\n\tswitch (item.type) {\n\t\tcase 'weapon': return 'any';\n\t}\n}\n\nconst sizeMap = {\n\tfine: 0, dim: 1, tiny: 2, sm: 3, med: 4, lg: 5, huge: 6, grg: 7, col: 8,\n};\n\n/**\n * @param {ItemPF} item\n * @param {HTMLElement} node\n * @param {ActorPF} actor\n */\nasync function enrichItemSummary(item, node, { actor, gear } = {}) {\n\tlet props = node.querySelector('.tag-list');\n\n\tif (!props) {\n\t\tprops = document.createElement('div');\n\t\tprops.classList.add('tag-list');\n\t\tnode.append(props);\n\t}\n\n\tconst itemData = item.system,\n\t\tactorData = actor.system,\n\t\ttype = item.type,\n\t\tsubType = item.subType ?? artificialSubType(item),\n\t\t// isEphemeral = ['attack', 'feat', 'race', 'class', 'spell', 'buff'].includes(type),\n\t\tisPhysical = ['weapon', 'equipment', 'consumable', 'loot', 'container'].includes(type),\n\t\tisIdentified = itemData.identified ?? true,\n\t\taction = item.defaultAction;\n\n\tconst info = getItemInfo(item, undefined, { isIdentified });\n\n\tconst acAbility = actorData.attributes.ac.normal.ability,\n\t\tdexMod = actorData.abilities[acAbility]?.mod;\n\n\tif (isPhysical) {\n\t\tconst isWeapon = item.type === 'weapon',\n\t\t\tisArmor = !isWeapon && ['armor', 'shield'].includes(subType);\n\n\t\tif (isArmor) {\n\t\t\tconst acText = i18n.get('LittleHelper.Info.AC', { ac: info.ac });\n\t\t\tprops.append(createNode('span', acText, ['tag', 'ac', info.enhancement > 0 ? 'enhanced' : 'mundane']));\n\n\t\t\tif (Number.isFinite(info.maxDex)) {\n\t\t\t\tconst emDex = Math.min(info.maxDex, dexMod);\n\t\t\t\tconst mdText = i18n.get('LittleHelper.Info.MDexAC', { mdex: info.maxDex, ac: emDex });\n\t\t\t\tprops.append(createNode('span', mdText, ['tag', 'mdex']));\n\t\t\t}\n\n\t\t\tconst acpText = i18n.get('LittleHelper.Info.ACP', { acp: info.acp });\n\t\t\tprops.append(createNode('span', acpText, ['tag', 'acp']));\n\n\t\t\tif (info.asf > 0) {\n\t\t\t\tconst text = i18n.get('LittleHelper.Info.ASF', { asf: info.asf });\n\t\t\t\tprops.append(createNode('span', text, ['tag', 'asf']));\n\t\t\t}\n\t\t}\n\n\t\tconst price = item.getValue({ recurivse: false, sellValue: 1, inLowestDenomination: true });\n\t\tif (price !== undefined) {\n\t\t\tconst valueText = i18n.get('LittleHelper.Info.Value', { gp: pf1.utils.limitPrecision(price / 100, 2) });\n\t\t\tprops.append(createNode('span', valueText, ['tag', 'value']));\n\t\t}\n\n\t\tconst hp = itemData.hp;\n\t\tif (hp?.value !== undefined) {\n\t\t\tconst hpText = i18n.get('LittleHelper.Info.HP', { current: hp.value, max: hp.max });\n\t\t\tconst hpTag = createNode('span', hpText, ['tag', 'hit-points']);\n\t\t\tif (info.broken || hp.value < hp.max / 2) addFASIcon(hpTag, ['fa-solid', 'fa-heart-broken']);\n\t\t\telse addFASIcon(hpTag, ['fa-solid', 'fa-heart']);\n\t\t\tprops.append(hpTag);\n\t\t}\n\n\t\tconst hardness = itemData.hardness?.total;\n\t\tif (hardness !== undefined) {\n\t\t\tconst hardText = i18n.get('LittleHelper.Info.Hardness', { hardness });\n\t\t\tprops.append(createNode('span', hardText, ['tag', 'hardness']));\n\t\t}\n\n\t\t// TODO: Item size\n\t\tif (info.size !== undefined && !info.resizing) {\n\t\t\tconst sizeNum = sizeMap[info.size],\n\t\t\t\tactorSize = actorData.traits.size?.value ?? sizeMap.med;\n\t\t\tif (sizeNum !== actorSize && !['consumable'].includes(item.type)) {\n\t\t\t\tconst sizeLabel = pf1.config.actorSizes[info.size];\n\t\t\t\tprops.append(createNode('span', sizeLabel.capitalize(), ['tag', 'size', 'bad-fit']));\n\t\t\t}\n\t\t}\n\n\t\tif (type === 'container') {\n\t\t\tconst items = item.items;\n\t\t\tconst countLabel = i18n.get('LittleHelper.Info.ItemCount', { count: items.contents.length });\n\t\t\tprops.append(createNode('span', countLabel, ['tag', 'items']));\n\t\t\tif (items.some(i => i.type === 'container')) {\n\t\t\t\tconst subcontainers = i18n.get('LittleHelper.Info.Subcontainers');\n\t\t\t\tprops.append(addFASIcon(createNode('span', subcontainers, ['tag', 'sub-containers']), ['fa-solid', 'fa-box']));\n\t\t\t}\n\n\t\t\tconst cp = item.getTotalCurrency({ inLowestDenomination: true });\n\t\t\tif (cp != 0) {\n\t\t\t\tconst currencyLabel = i18n.get('LittleHelper.Info.Currency', { gp: cp / 100 });\n\t\t\t\tprops.append(addFASIcon(createNode('span', currencyLabel, ['tag', 'container-currency']), ['fa-solid', 'fa-coins']));\n\t\t\t}\n\t\t}\n\t}\n\n\tif (info.action?.critRange !== undefined) {\n\t\tconst text = i18n.get('LittleHelper.Info.Critical', { range: info.action.critRange, mult: info.action.critMult });\n\t\tprops.append(addFASIcon(createNode('span', text, ['tag', 'critical']), ['fa-solid', 'fa-bullseye']));\n\t}\n\n\tconst area = action?.area;\n\tif (area) {\n\t\tprops.append(addFASIcon(createNode('span', area, ['tag', 'area']), ['fa-solid', 'fa-ruler-combined']));\n\t}\n\n\tif (itemData.duration?.value) {\n\t\tconst ti = getTimeFromItem(item, item.getRollData())?.duration;\n\t\tconst ht = getHumanTime(ti);\n\t\tprops.append(addFASIcon(createNode('span', `${ht.n} ${humanTimeUnit[ht.u].long}`, ['tag', 'duration', 'scaling']), ['fa-solid', 'fa-hourglass']));\n\t}\n\n\tif (itemData.spellDuration) {\n\t\tprops.append(addFASIcon(createNode('span', itemData.spellDuration, ['tag', 'duration', 'descriptive']), ['fa-solid', 'fa-hourglass']));\n\t}\n\n\t// ITEM COMPARISON\n\n\t/** @type {Item} */\n\tconst comparedItem = gear[type]?.[subType]?.id === item.id ? undefined : gear[type]?.[subType];\n\tif (comparedItem) {\n\t\tconst diffs = [],\n\t\t\tcItemData = comparedItem.system,\n\t\t\titemInfoC = getItemInfo(comparedItem, undefined, { isIdentified: cItemData.identified ?? true });\n\n\t\tswitch (type) {\n\t\t\tcase 'equipment': {\n\t\t\t\t// ARMOR stats\n\t\t\t\tconst acD = info.ac - itemInfoC.ac,\n\t\t\t\t\tacpD = info.acp - itemInfoC.acp,\n\t\t\t\t\tasfD = info.asf - itemInfoC.asf,\n\t\t\t\t\tmdexD = info.maxDex - itemInfoC.maxDex,\n\t\t\t\t\teDexCurrent = Number.isFinite(info.maxDex) ? Math.min(dexMod, info.maxDex) : undefined,\n\t\t\t\t\teDexOther = Number.isFinite(itemInfoC.maxDex) ? Math.min(dexMod, itemInfoC.maxDex) : undefined,\n\t\t\t\t\teDexD = (eDexCurrent ?? Number.POSITIVE_INFINITY) - (eDexOther ?? Number.POSITIVE_INFINITY);\n\n\t\t\t\tif (acD !== 0) {\n\t\t\t\t\tconst acText = i18n.get('LittleHelper.Info.AC', { ac: signNum(acD) });\n\t\t\t\t\tdiffs.push(createNode('span', acText, ['tag', 'ac']));\n\t\t\t\t}\n\t\t\t\tif (mdexD !== null) {\n\t\t\t\t\tconst mdexText = Number.isFinite(eDexD) ? i18n.get('LittleHelper.Info.MDexAC', { mdex: signNum(mdexD), ac: signNum(eDexD) }) : i18n.get('LittleHelper.Info.MDex', { mdex: signNum(mdexD) });\n\t\t\t\t\tdiffs.push(createNode('span', mdexText, ['tag', 'mdex']));\n\t\t\t\t}\n\t\t\t\tif (acpD !== 0) {\n\t\t\t\t\tconst acpText = i18n.get('LittleHelper.Info.ACP', { acp: signNum(acpD) });\n\t\t\t\t\tdiffs.push(createNode('span', acpText, ['tag', 'acp']));\n\t\t\t\t}\n\t\t\t\tif (asfD !== 0) {\n\t\t\t\t\tconst asfText = i18n.get('LittleHelper.Info.ASF', { asf: signNum(asfD) });\n\t\t\t\t\tdiffs.push(createNode('span', asfText, ['tag', 'asf']));\n\t\t\t\t}\n\n\t\t\t\tconst compareText = i18n.get('LittleHelper.Info.ComparedAgainst', { name: comparedItem.name });\n\t\t\t\tdiffs.push(createNode('span', compareText, ['lil-short-label']));\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tconst cprops = createNode('div', undefined, ['item-comparison', 'item-properties', 'tag-list']);\n\t\tcprops.append(createNode('span', i18n.get('LittleHelper.Info.Comparison')), ': ', ...diffs);\n\t\tprops.after(cprops);\n\t}\n\n\t// Weapon qualities\n\tif (item.type === 'weapon') {\n\t\tconst qualities = Object\n\t\t\t.entries(itemData.properties ?? {})\n\t\t\t.filter(([_, enabled]) => enabled)\n\t\t\t.map(([key]) => createNode('div', pf1.config.weaponProperties[key], ['tag']));\n\n\t\tif (qualities.length > 0) {\n\t\t\tconst wprops = createNode('div', undefined, ['weapon-qualities', 'item-properties', 'tag-list']);\n\t\t\twprops.append(createNode('span', i18n.get('Koboldworks.Missing.PF1.Qualities')), ': ', ...qualities);\n\t\t\tprops.after(wprops);\n\t\t}\n\t}\n}\n\nconst config = { subtree: false, childList: true, attributes: false };\n\nconst observers = {};\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction enrichOpenSummaries(sheet, html, options, shared) {\n\tconst actor = sheet.document,\n\t\tgearCache = getBaseGearInfo(sheet, shared);\n\n\tfor (const el of html.querySelectorAll('.item-list > .item[data-item-id] > .item-summary')) {\n\t\tconst itemId = el.closest('.item[data-item-id]')?.dataset.itemId,\n\t\t\titem = actor.items.get(itemId);\n\t\tif (item)\n\t\t\tenrichItemSummary(item, el, { actor, gear: gearCache });\n\t}\n}\n\nfunction mutHandler(mut, actor, gearCache) {\n\tconst node = mut.addedNodes[0];\n\tif (!node.classList.contains('item-summary')) return;\n\n\tconst item = actor?.items.get(mut.target.dataset.itemId);\n\tif (!item) return;\n\tenrichItemSummary(item, node, { actor, gear: gearCache });\n}\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction observeItems(sheet, html, options, shared) {\n\tconst actor = sheet.actor;\n\n\tconst gearCache = getBaseGearInfo(sheet, shared);\n\n\tconst mutationCallback = (mutList) => {\n\t\tfor (const mut of [...mutList].filter(m => m.addedNodes.length)) {\n\t\t\tmutHandler(mut, actor, gearCache);\n\t\t}\n\t};\n\n\tobservers[sheet.appId]?.observer?.disconnect(); // kill old observer if it exists\n\n\tconst observer = new MutationObserver(mutationCallback);\n\tobservers[sheet.appId] = {\n\t\t_sheet: new WeakRef(sheet),\n\t\tget sheet() {\n\t\t\treturn this._sheet.deref();\n\t\t},\n\t\t_actor: new WeakRef(sheet.actor),\n\t\tget actor() {\n\t\t\treturn this._actor.deref();\n\t\t},\n\t\t_observer: new WeakRef(observer),\n\t\tget observer() {\n\t\t\treturn this._observer.deref();\n\t\t},\n\t};\n\n\tfor (const el of html.querySelectorAll('.item-list .item[data-item-id]')) {\n\t\tobserver.observe(el, config);\n\t}\n}\n\nconst endObserver = (appId) => {\n\tobservers[appId]?.observer?.disconnect();\n\tdelete observers[appId];\n};\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} jq\n */\nconst closeSheetEvent = (sheet, jq) => {\n\tendObserver(sheet.appId);\n};\n\nfunction enable() {\n\tAncillary.register('actor', observeItems);\n\tAncillary.register('actor', enrichOpenSummaries);\n\tHooks.on('closeActorSheet', closeSheetEvent);\n}\n\nfunction disable() {\n\tfor (const appid of Object.keys(observers)) {\n\t\tobservers[appid]?.observer?.disconnect();\n\t\tdelete observers[appid];\n\t}\n\n\tAncillary.unregister('actor', observeItems);\n\tAncillary.unregister('actor', enrichOpenSummaries);\n\tHooks.off('closeActorSheet', closeSheetEvent);\n}\n\nnew Feature({\n\tsetting: 'item-summary-enhancer', label: 'Item Summary Enricher', hint: 'Enriches item summary with additional info, such as item value, hit points, and hardness.', category: 'actor-sheet', enable, disable, stage: 'ready',\n});\n",
    "import { CFG } from '@root/config.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} data\n * @param {SharedData} shared\n */\nfunction checkExcessSkillRanks(sheet, html, data, shared) {\n\tconst actor = sheet.actor,\n\t\tactorData = shared.systemData;\n\n\tif (actor.getFlag(CFG.id, 'overrides')?.excess) return;\n\n\tconst hd = actorData.attributes.hd.total;\n\n\tfor (const el of shared.tabs.skills?.tab?.querySelectorAll('[data-skill]') ?? []) {\n\t\tconst parentSkill = el.dataset.mainSkill,\n\t\t\tskill = el.dataset.skill,\n\t\t\tkey = parentSkill ? `${parentSkill}.${skill}` : `${skill}`,\n\t\t\tsk = actor.getSkillInfo(key);\n\n\t\tif (sk.rank > hd) el.classList.add('lil-excess-skill-ranks');\n\t}\n}\n\nfunction enable() {\n\tAncillary.register('actor', checkExcessSkillRanks);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', checkExcessSkillRanks);\n}\n\nnew Feature({ setting: 'excess-skill-ranks', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "import { CFG } from '@root/config.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { FAIcons } from '@core/icons.mjs';\nimport { hookCoreTooltip } from '@core/tooltip.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nfunction fillLevels(list) {\n\tfor (const l of list) {\n\t\tconst max = list.at(-1).length,\n\t\t\tol = l.length;\n\t\tif (l.length < max) {\n\t\t\tl.length = list.at(-1).length;\n\t\t\tl.fill(null, ol, max);\n\t\t}\n\t}\n}\n\nfunction processCastingLevels(list) {\n\treturn list.map((cl, i0) => {\n\t\treturn {\n\t\t\tlevel: i0 + 1,\n\t\t\tslots: cl.map((sl, i1) => {\n\t\t\t\treturn {\n\t\t\t\t\tlevel: i1,\n\t\t\t\t\tslots: sl,\n\t\t\t\t\tactive: sl >= 0,\n\t\t\t\t\tinfinite: Number.POSITIVE_INFINITY === sl,\n\t\t\t\t};\n\t\t\t}),\n\t\t};\n\t});\n}\n\nconst { ApplicationV2, HandlebarsApplicationMixin } = foundry.applications.api;\n\nclass CasterProgressionTable extends HandlebarsApplicationMixin(ApplicationV2) {\n\t/** @type {Item|ItemClassPF} */\n\tcasterClass;\n\n\t/** @type {string} */\n\tbookId;\n\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\toptions.document.apps[this.id] = this;\n\n\t\tthis.bookId = options.bookId;\n\n\t\tconst actor = options.document;\n\t\tconst actorData = actor.system;\n\n\t\tthis.book = actorData.attributes?.spells?.spellbooks?.[this.bookId] ?? {};\n\n\t\tif (this.book.class && this.book.class !== '_hd') {\n\t\t\tthis.casterClass = actor.itemTypes.class.find(i => i.system.tag == this.book.class);\n\t\t}\n\t}\n\n\t/** @override */\n\t_initializeApplicationOptions(options) {\n\t\toptions = super._initializeApplicationOptions(options);\n\n\t\toptions.uniqueId = options.uniqueId + '-' + options.bookId;\n\n\t\treturn options;\n\t}\n\n\t/** @override */\n\t_getHeaderControls() {\n\t\treturn [];\n\t}\n\n\t/** @override */\n\t_preClose() {\n\t\tdelete this.actor.apps[this.id];\n\t}\n\n\t/** @type {Actor} */\n\tget actor() {\n\t\treturn this.options.document;\n\t}\n\n\tget title() {\n\t\tconst bookName = this.book.name || this.casterClass?.name || i18n.get(`PF1.SpellBook${this.bookId.capitalize()}`);\n\t\treturn i18n.get('LittleHelper.CasterProgressionTitle', { actor: this.actor.name, book: bookName });\n\t}\n\n\tstatic DEFAULT_OPTIONS = {\n\t\t// resizable: true,\n\t\tclasses: ['lil-caster-progression'],\n\t\tposition: {\n\t\t\t// width: 560,\n\t\t\t// height: 700,\n\t\t\twidth: 'auto',\n\t\t},\n\t\twindow: {\n\t\t\ticon: 'fa-solid fa-book',\n\t\t\tsubmitOnClose: false,\n\t\t\tsubmitOnChange: false,\n\t\t\tcloseOnSubmit: true,\n\t\t},\n\t\tsheetConfig: false,\n\t};\n\n\tstatic PARTS = {\n\t\tform: {\n\t\t\ttemplate: `modules/${CFG.id}/templates/dialog/caster-progression.hbs`,\n\t\t},\n\t};\n\n\t_preparePartContext(partId, context, options) {\n\t\tconst actor = this.actor,\n\t\t\tactorData = actor.system,\n\t\t\tbook = actorData.attributes.spells.spellbooks[this.bookId],\n\t\t\ttype = book.casterType,\n\t\t\tprepMode = book.spellPreparationMode,\n\t\t\tconfig = foundry.utils.deepClone(pf1.config.casterProgression),\n\t\t\tcasts = config.castsPerDay[prepMode][type],\n\t\t\tprep = config.spellsPreparedPerDay[prepMode][type];\n\n\t\tfillLevels(casts);\n\t\tfillLevels(prep);\n\n\t\tconst actualCasts = processCastingLevels(casts);\n\t\tconst actualPrep = processCastingLevels(prep);\n\n\t\t/** @type {Item} */\n\t\tconst casterClass = this.casterClass,\n\t\t\tcasterClassData = casterClass?.system;\n\n\t\t// Get class level\n\t\tlet classLevel = casterClassData?.level || actorData.attributes?.hd?.total || 0;\n\t\tconst rollData = actor.getRollData();\n\t\tconst bonusLevelFormula = book.cl?.autoSpellLevelCalculationFormula || '0';\n\t\tclassLevel += RollPF.safeRollSync(bonusLevelFormula, rollData).total;\n\n\t\tObject.assign(context, {\n\t\t\tbook,\n\t\t\ttype,\n\t\t\tprepMode,\n\t\t\tconfig,\n\t\t\tcasts: actualCasts,\n\t\t\tprep: actualPrep,\n\t\t\tcl: classLevel,\n\t\t\tcantrips: true,\n\t\t\tisSpontaneous: book.spontaneous,\n\t\t\tcastsLevels: Array.fromRange(casts.at(-1).length),\n\t\t\tprepLevels: Array.fromRange(casts[prep.length - 1].length),\n\t\t\tmaxLevel: casts[prep.length - 1].length,\n\t\t\ticons: FAIcons,\n\t\t});\n\n\t\treturn context;\n\t}\n\n\t/**\n\t * @param {Actor} actor\n\t * @param {string} bookId\n\t */\n\tstatic open(actor, bookId) {\n\t\tconst uid = `${actor.uuid.replace('.', '-')}-${bookId}-caster-progression`;\n\n\t\tconst window = Object.values(ui.windows).find(app => app.id == uid) ?? new CasterProgressionTable({ document: actor, bookId });\n\n\t\twindow.render({ force: true, focus: true });\n\t}\n}\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction injectCasterProgressionTable(sheet, html, options, shared) {\n\tconst books = shared.tabs.spellbook;\n\tconst tab = books?.tab;\n\tif (!tab) return;\n\n\tconst actor = sheet.actor;\n\n\tconst tabs = books.tabs ?? [];\n\tfor (const el of tabs) {\n\t\tconst bookId = el.dataset.tab,\n\t\t\tr = el.querySelector(`[name=\"system.attributes.spells.spellbooks.${bookId}.spellPreparationMode\"]`);\n\n\t\tif (!r) return;\n\n\t\tconst b = createNode('i', null, ['fa-solid', 'fa-table', 'fa-fw', 'lil-progression-table-button']);\n\t\thookCoreTooltip(b, { fn: () => 'Display Progression Table' });\n\n\t\tb.addEventListener('click', _ => CasterProgressionTable.open(actor, bookId));\n\t\tr.after(b);\n\t}\n}\n\nfunction enable() {\n\tAncillary.register('actor', injectCasterProgressionTable);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', injectCasterProgressionTable);\n}\n\nnew Feature({ setting: 'caster-progression-table', label: 'Caster Progression Table', hint: 'Dialog for displaying currently configured caster progression. Accessed near spellbook progression configuration.', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "import { Ancillary } from '@root/ancillary.mjs';\nimport { createNode, addCoreTooltip } from '@root/common.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\n// Display DC per spell level\nfunction spellLevelDCInjector(sheet, _jq, _opts, shared) {\n\tconst rd = shared.rollData;\n\n\tfor (const tab of shared.tabs.spellbook?.tabs ?? []) {\n\t\tconst bookId = tab.dataset.tab;\n\t\tconst bookData = rd.spells[bookId];\n\t\tif (!bookData) continue;\n\t\trd.ablMod = rd.abilities[bookData.ability]?.mod ?? 0;\n\t\trd.cl = bookData.cl.total;\n\n\t\tfor (const node of tab.querySelectorAll('.spellbook-header')) {\n\t\t\trd.sl = Number(node.dataset.level);\n\t\t\tif (!Number.isFinite(rd.sl)) continue;\n\t\t\tconst roll = RollPF.safeRollSync(bookData.baseDCFormula, rd);\n\t\t\tdelete rd.sl;\n\n\t\t\tconst holder = node.querySelector('.lil-spell-details');\n\t\t\tconst b = createNode('label', null, ['lil-box', 'lil-spell-dc']);\n\t\t\tlet tt;\n\t\t\tif (roll.err) {\n\t\t\t\tb.textContent = i18n.get('PF1.DCThreshold', { threshold: 'Error' });\n\t\t\t\ttt = roll.err.message;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tb.textContent = i18n.get('PF1.DCThreshold', { threshold: roll.total });\n\t\t\t\ttt = roll.formula;\n\t\t\t}\n\n\t\t\taddCoreTooltip(b, tt);\n\n\t\t\tholder?.append(b);\n\t\t}\n\n\t\tdelete rd.cl;\n\t\tdelete rd.ablMod;\n\t}\n}\n\nAncillary.register('actor', spellLevelDCInjector);\n",
    "import { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { setStaticToolTipListener } from '@core/tooltip.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction addSpellTooltips(sheet, html, options, shared) {\n\tconst actor = shared.actor;\n\t/** @type {HTMLElement[]} */\n\tconst bookTabs = shared.tabs.spellbook?.tabs;\n\n\tconst formatter = new Intl.ListFormat(game.i18n.lang, { style: 'short', type: 'unit' });\n\tconst listFormat = (str) => formatter.format(str);\n\n\t/**\n\t * @param {HTMLElement} tip\n\t * @param {HTMLElement} el\n\t * @param {pf1.documents.item.ItemSpellPF} spell\n\t */\n\tconst fillTooltip = async (tip, el, spell) => {\n\t\tconst itemData = spell.system,\n\t\t\tact = spell.defaultAction;\n\n\t\tconst ul = createNode('ul', undefined, ['details']);\n\t\ttip.append(createNode('h2', spell.name, ['name']), ul);\n\t\tif (!act) {\n\t\t\tul.append(createNode('li', 'No Actions', ['warning', 'span-2']));\n\t\t\treturn;\n\t\t}\n\n\t\tconst rollData = act.getRollData();\n\n\t\t// Actual details\n\n\t\t// School\n\t\tconst schoolParts = [createNode('span', pf1.config.spellSchools[itemData.school], ['school', 'value', 'text'])];\n\t\tif (itemData.subschool) {\n\t\t\tlet subschool;\n\t\t\tif (typeof itemData.subschool === 'string' && itemData.subschool)\n\t\t\t\tsubschool = itemData.subschool ? [itemData.subschool] : [];\n\t\t\telse\n\t\t\t\tsubschool = listFormat(itemData.subschool.names ?? []);\n\n\t\t\tif (subschool?.length)\n\t\t\t\tschoolParts.push(' (', createNode('span', subschool, ['subschool', 'value', 'text']), ')');\n\t\t}\n\t\tif (itemData.descriptors) {\n\t\t\tconst descriptors = itemData.descriptors.names;\n\t\t\tif (descriptors.length > 0)\n\t\t\t\tschoolParts.push(' [', createNode('span', listFormat(descriptors), ['descriptors', 'value', 'text']), ']');\n\t\t}\n\t\tul.append(\n\t\t\tcreateNode('li', undefined, ['school'], {\n\t\t\t\tchildren: [\n\t\t\t\t\tcreateNode('label', 'School'),\n\t\t\t\t\tcreateNode('span', undefined, ['school', 'composite'], { children: schoolParts }),\n\t\t\t\t],\n\t\t\t}),\n\t\t);\n\n\t\t// Material\n\t\tif (itemData.components.material) {\n\t\t\tconst mats = itemData.materials;\n\t\t\tconst materialDetails = createNode('span', undefined, ['material', 'composite']);\n\t\t\tmaterialDetails.append(createNode('span', mats.value, ['detail', 'value', 'text']));\n\t\t\tif (mats.gpValue > 0) materialDetails.append(' [', createNode('span', `${mats.gpValue} gp`, ['cost', 'value', 'number']), ']');\n\t\t\tul.append(\n\t\t\t\tcreateNode('li', undefined, ['material'], {\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tcreateNode('label', 'Material'),\n\t\t\t\t\t\tmaterialDetails,\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\t// Focus\n\t\tif (itemData.components.focus) {\n\t\t\tconst focus = itemData.materials.focus;\n\t\t\tul.append(\n\t\t\t\tcreateNode('li', undefined, ['focus'], {\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tcreateNode('label', 'Focus'),\n\t\t\t\t\t\tcreateNode('span', focus, ['value', 'text', 'focus']),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\t// Range\n\t\tconst rUnits = act.range.units; // Hack for 0.82.x bug in .hasRange\n\t\tif (act.hasRange && !!rUnits) {\n\t\t\tconst rangeDetails = createNode('span', undefined, ['range', 'composite']);\n\t\t\tconst isBasic = ['ft', 'km', 'm'].includes(rUnits);\n\t\t\tconst isIndistinct = ['personal', 'seeText', 'special', 'unlimited', 'none'].includes(rUnits);\n\t\t\tif (!isBasic) rangeDetails.append(createNode('span', pf1.config.distanceUnits[rUnits], ['units', 'text']));\n\t\t\tif (!isIndistinct) {\n\t\t\t\tconst range = act.getRange();\n\t\t\t\tconst [_, unit] = pf1.utils.convertDistance(0, isBasic ? rUnits : undefined);\n\t\t\t\tconst uLabel = pf1.config.measureUnitsShort[unit] ?? pf1.config.distanceUnits[unit];\n\t\t\t\tconst rl = `${range} ${uLabel}`;\n\t\t\t\tconst rd = createNode('span', rl, ['measured', 'value', 'number']);\n\t\t\t\tif (isBasic) { rangeDetails.append(rd); }\n\t\t\t\telse { rangeDetails.append(' (', rd, ')'); }\n\t\t\t}\n\n\t\t\tul.append(createNode('li', undefined, ['range'], {\n\t\t\t\tchildren: [\n\t\t\t\t\tcreateNode('label', 'Range'),\n\t\t\t\t\trangeDetails,\n\t\t\t\t],\n\t\t\t}));\n\n\t\t\tconst mi = act.range.maxIncrements ?? 1;\n\t\t\tif (mi > 1) {\n\t\t\t\tul.append(createNode('li', undefined, ['range'], {\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tcreateNode('label', 'Max Increments'),\n\t\t\t\t\t\tcreateNode('span', `${mi}`, ['value']),\n\t\t\t\t\t],\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\n\t\t// Area\n\t\tconst area = act.area;\n\t\tif (area?.length > 0) {\n\t\t\tul.append(\n\t\t\t\tcreateNode('li', undefined, ['area'], {\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tcreateNode('label', 'Area'),\n\t\t\t\t\t\tcreateNode('span', area, ['value', 'text', 'area']),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\t// Targets\n\t\tconst target = act.target?.value;\n\t\tif (target) {\n\t\t\tul.append(\n\t\t\t\tcreateNode('li', undefined, ['target'], {\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tcreateNode('label', 'Target'),\n\t\t\t\t\t\tcreateNode('span', target, ['value', 'text', 'target']),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\t// Duration\n\t\tif (act.duration && act.duration.value?.length && act.duration.units) {\n\t\t\tlet d = act.duration.value, enriched = false;\n\t\t\tif (act.duration?.units === 'spec') {\n\t\t\t\tif (/\\[\\[.*]]/.test(d)) {\n\t\t\t\t\td = await pf1.utils.enrichHTMLUnrolled(d, { rollData });\n\t\t\t\t\tenriched = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\ttry {\n\t\t\t\t\t/** @type {Roll} */\n\t\t\t\t\tconst roll = Roll.create(d, rollData);\n\t\t\t\t\tif (roll.isDeterministic) {\n\t\t\t\t\t\troll.evaluateSync();\n\t\t\t\t\t\td = i18n.get('PF1.Time.Format', { value: roll.total, unit: pf1.config.timePeriods[act.duration.units] });\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tconst minRoll = roll.evaluateSync({ minimize: true });\n\t\t\t\t\t\tconst maxRoll = roll.clone().evaluateSync({ maximize: true });\n\t\t\t\t\t\td = i18n.get('PF1.Time.Format', { value: `${minRoll.total} â€“ ${maxRoll.total}`, unit: pf1.config.timePeriods[act.duration.units] });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcatch (err) {\n\t\t\t\t\tconsole.error('Formula:', d, '\\n', err, '\\n', sheet.document);\n\t\t\t\t}\n\t\t\t}\n\t\t\tul.append(\n\t\t\t\tcreateNode('li', undefined, ['duration'], {\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tcreateNode('label', 'Duration'),\n\t\t\t\t\t\tcreateNode('span', d, ['value', 'text'], { isHTML: enriched }),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\t// Save\n\t\tif (act.hasSave) {\n\t\t\tconst dc = act.getDC(rollData);\n\t\t\tconst type = act.save.type;\n\t\t\t// const desc = actData.save.description;\n\n\t\t\tconst saveDetails = createNode('span', undefined, ['save', 'composite']);\n\t\t\tsaveDetails.append(\n\t\t\t\t'DC ',\n\t\t\t\tcreateNode('span', dc, ['value', 'number']),\n\t\t\t\t' ',\n\t\t\t\tpf1.config.savingThrows[type],\n\t\t\t);\n\n\t\t\tul.append(\n\t\t\t\tcreateNode('li', undefined, ['save'], {\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tcreateNode('label', i18n.get('PF1.Save')),\n\t\t\t\t\t\tsaveDetails,\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\t};\n\n\tif (bookTabs) for (const bookTab of bookTabs) {\n\t\tconst bookId = bookTab.dataset.tab;\n\t\tfor (const spellEl of bookTab.querySelectorAll('.item[data-item-id]')) {\n\t\t\tconst tip = createNode('div', null, ['lil-tooltip']);\n\t\t\tconst item = actor.items.get(spellEl.dataset.itemId);\n\t\t\tif (!item) continue; // Shouldn't happen\n\n\t\t\t// const actEl = spellEl.querySelector('.item-actions');\n\n\t\t\tspellEl.append(tip);\n\t\t\tspellEl.addEventListener('pointerenter', () => fillTooltip(tip, spellEl, item), { passive: true, once: true });\n\t\t\tsetStaticToolTipListener(spellEl, tip, { aligned: false, boundedBy: bookTab });\n\t\t\t/*\n\t\t\t\t// Move tooltip to right of actions\n\t\t\t\tspellEl.addEventListener('pointerenter', () => {\n\t\t\t\t\tconst r = actEl?.getBoundingClientRect();\n\t\t\t\t\tspellEl.style.setProperty('--act-l', r?.left ?? (spellEl.style.getProperty('--p-left') + 24));\n\t\t\t\t});\n\t\t\t\t*/\n\t\t\t// Move tooltip with mouse\n\t\t\tspellEl.addEventListener('pointermove', ev => {\n\t\t\t\tspellEl.style.setProperty('--mx', ev.clientX);\n\t\t\t\tconst tp = tip.getBoundingClientRect();\n\t\t\t\tconst { left, width } = spellEl.getBoundingClientRect();\n\t\t\t\t// Toggle alignment. Condition to avoid alignment going wild near the threshold.\n\t\t\t\t// TODO: Make the position instead smooth instead of flippy by maintaining offset based on left and right distance\n\t\t\t\t// - Mouse X to width percentage offset\n\t\t\t\t// - Width - tip width max left offset\n\t\t\t\t// - Adjust left offset percentage of max left offset equal to mouse offset percentage\n\t\t\t\tif (tip.classList.contains('right-aligned'))\n\t\t\t\t\ttip.classList.toggle('right-aligned', (tp.right + 10) > (left + width / 2));\n\t\t\t\telse\n\t\t\t\t\ttip.classList.toggle('right-aligned', tp.left > (left + width / 2));\n\t\t\t}, { passive: true });\n\t\t}\n\t}\n}\n\nfunction enable() {\n\tAncillary.register('actor', addSpellTooltips);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', addSpellTooltips);\n}\n\nnew Feature({ setting: 'actor-spell-tooltips', label: 'Spell Tooltips', hint: 'Display tooltips describing some spell details.', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "import { CFG } from '@root/config.mjs';\nimport { createNode, signNum } from '@root/common.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\nimport { hookCoreTooltip } from '@core/tooltip.mjs';\n\nimport { QuickSkillsModel } from './quick-skills-model.mjs';\nimport { SkillEditor } from './quick-skills-editor.mjs';\nimport { getActorSkills, getActorQuickSkillsConfig, getGetUserDefaultQuickSkills } from './quick-skills-common.mjs';\n\nHooks.once('ready', () => {\n\tconst fields = foundry.data.fields;\n\n\tgame.settings.register(\n\t\tCFG.id,\n\t\t'quickSkills',\n\t\t{\n\t\t\ttype: new fields.StringField({ initial: () => [...QuickSkillsModel.DEFAULT_SKILLS].join(',') }),\n\t\t\tscope: 'world',\n\t\t\tdefault: [...QuickSkillsModel.DEFAULT_SKILLS].join(','), // v12 requires this. v13 it's unnecessary\n\t\t\tconfig: false,\n\t\t},\n\t);\n\n\tgame.settings.registerMenu(\n\t\tCFG.id,\n\t\t'quickSkillsMenu',\n\t\t{\n\t\t\tname: 'Quick Skills',\n\t\t\tlabel: 'Default Skills',\n\t\t\ttype: SkillEditor,\n\t\t\trestricted: true,\n\t\t},\n\t);\n});\n\nconst skipConfirm = () => game.settings.get('pf1', 'skipActionDialogs') && !pf1.skipConfirmPrompt ||\n\t!game.settings.get('pf1', 'skipActionDialogs') && pf1.skipConfirmPrompt;\n\nasync function onSkillEdit(ev, actor) {\n\tev.preventDefault();\n\tev.stopPropagation();\n\n\tconst app = Object.values(ui.windows)\n\t\t.find(a => a instanceof SkillEditor && a.actor === actor) ?? new SkillEditor({ document: actor });\n\n\tapp.render({ force: true, focus: true });\n}\n\nfunction onSkillClick(ev, actor) {\n\tconst el = ev.target.dataset.skill ? ev.target : ev.target.closest('.lil-quick-skills [data-skill-id]');\n\tif (!el) return;\n\tev.preventDefault();\n\tev.stopPropagation();\n\n\tconst skillId = el.dataset.skillId;\n\n\tactor.rollSkill(skillId, { skipDialog: skipConfirm() });\n}\n\nconst fillTooltip = async (event, el, { actor, skillId } = {}) => {\n\tconst tip = document.createElement('div');\n\n\tconst si = actor.getSkillInfo(skillId);\n\n\ttip.append(\n\t\tcreateNode('h2', si.fullName),\n\t\tcreateNode('div', null, ['row', 'rank'], { children: [createNode('label', i18n.get('PF1.Rank')), createNode('span', `${si.rank ?? 0}`, ['rank', 'value', si.rank == 0 ? 'null' : ''])] }),\n\t\tcreateNode('div', null, ['row', 'modifier'], { children: [createNode('label', i18n.get('PF1.Modifier')), createNode('span', signNum(si.mod), ['modifier', 'value', si.mod === 0 ? 'null' : ''])] }),\n\t\tcreateNode('h3', i18n.get('LittleHelper.QuickSkills.Sources')),\n\t);\n\n\t// Reproduce normal source details\n\n\tconst sourceDetails = actor.getSourceDetails(`system.skills.${skillId}.mod`);\n\n\tfor (const source of sourceDetails) {\n\t\ttip.append(createNode('div', null, ['row', 'source'], { children: [createNode('label', source.name), createNode('span', signNum(source.value), ['value', source.value == 0 ? 'null' : ''])] }));\n\t}\n\n\treturn tip;\n};\n\n/**\n *\n * @param {Event} ev\n * @param {HTMLElement} tip\n * @param {object} options\n * @param {Actor} options.actor\n * @param {string} options.skillId\n */\nfunction activateQuickSkillTooltip(ev, tip, { actor, skillId } = {}) {\n\tconst content = document.createElement('div');\n\n\tfillTooltip(content, { actor, skillId });\n\n\tconst tm = CONFIG.ux.TooltipManager;\n\n\tconst tooltip = {\n\t\thtml: content,\n\t\tdirection: tm.TOOLTIP_DIRECTIONS.LEFT,\n\t\tcssClass: 'lil-quick-skills-tooltip',\n\t};\n\n\tgame.tooltip.activate(ev.target, tooltip);\n}\n\n/**\n * @param {Event} ev\n */\nfunction deactivateQuickSkillTooltip(ev) {\n\tgame.tooltip.deactivate();\n}\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction addQuickSkills(sheet, html, options, shared) {\n\tconst tab = shared.tabs.summary?.tab,\n\t\tsd = tab?.querySelector('.subdetails-body');\n\tif (!sd) return;\n\tconst qsEl = createNode('div', null, ['lil-quick-skills']);\n\tconst actor = sheet.actor,\n\t\tactorData = actor.system;\n\n\tconst setup = getActorQuickSkillsConfig(actor);\n\tconst qs = new QuickSkillsModel(setup ?? {});\n\tconst hd = actorData.attributes.hd.total,\n\t\tmaxRank = hd;\n\n\tconst skopts = { maxMod: Number.NEGATIVE_INFINITY };\n\tconst skills = getActorSkills(actor, skopts);\n\n\tconst bannedIds = game.settings.get('pf1', 'allowBackgroundSkills') ? new Set() : new Set(pf1.config.backgroundOnlySkills);\n\n\tfor (const skId of qs.skills) {\n\t\tconst sklData = skills[skId];\n\t\tif (sklData) {\n\t\t\tif (bannedIds.has(skId)) continue;\n\n\t\t\tsklData.enabled = true;\n\t\t}\n\t\telse {\n\t\t\tconsole.warn('Invalid skill ID found:', skId);\n\t\t}\n\t}\n\n\t// Add default skills if none are set\n\tif (!setup) {\n\t\tconst dsq = getGetUserDefaultQuickSkills();\n\t\tfor (const skId of dsq) skills[skId].autoSelect = true;\n\n\t\tconst casterSkills = new Set();\n\t\tfor (const book of Object.values(actorData.attributes?.spells?.spellbooks ?? {})) {\n\t\t\tif (book.inUse === false) continue;\n\t\t\tswitch (book.kind) {\n\t\t\t\tcase 'arcane':\n\t\t\t\t\tif (!book.spontaneous) casterSkills.add('spl');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'alchemy':\n\t\t\t\t\tif (!book.spontaneous) casterSkills.add('spl');\n\t\t\t\t\tcasterSkills.add('crf.alchemy');\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tfor (const skId of casterSkills) {\n\t\t\tconst skill = skills[skId];\n\t\t\tif (!skill) continue;\n\t\t\tskills[skId].autoSelect = true;\n\t\t}\n\t}\n\n\t// Add skills by threshold\n\tif (qs.threshold > 0 || qs.minRank > 0) {\n\t\tfor (const sk of Object.values(skills)) {\n\t\t\tlet mVal = false, mRank = false;\n\t\t\tif (qs.threshold > 0) {\n\t\t\t\tconst val = qs.useMod ? sk.mod : sk.rank,\n\t\t\t\t\tthval = qs.useMod ? skopts.maxMod : maxRank;\n\t\t\t\tif (val >= Math.floor(thval * qs.threshold))\n\t\t\t\t\tmVal = true;\n\t\t\t}\n\t\t\telse\n\t\t\t\tmVal = true;\n\n\t\t\tif (qs.minRank > 0) {\n\t\t\t\tif (sk.rank >= qs.minRank)\n\t\t\t\t\tmRank = true;\n\t\t\t}\n\t\t\telse\n\t\t\t\tmRank = true;\n\n\t\t\tif (mVal && mRank)\n\t\t\t\tsk.autoSelect = true;\n\t\t}\n\t}\n\n\tconst ul = createNode('ul', null, ['skill-list']);\n\n\tconst acp = actorData.attributes.acp.total;\n\n\tlet quickSkillCount = 0;\n\tfor (const skId of Object.keys(skills)) {\n\t\tconst sk = skills[skId];\n\t\tif (!sk.enabled && !sk.autoSelect) continue;\n\n\t\tquickSkillCount++;\n\t\tconst li = createNode('li', null, ['skill']);\n\t\tconst [parentId, subId] = skId.split('.');\n\t\tli.dataset.skillId = skId;\n\t\tli.dataset.skill = parentId;\n\t\tli.dataset.subSkill = subId;\n\t\tli.append(\n\t\t\tcreateNode('h4', sk.fullName, ['name']),\n\t\t\tcreateNode('span', signNum(sk.mod), ['mod']),\n\t\t\tcreateNode('i', null, ['acp', sk.acp ? 'affected' : 'unaffected', acp > 0 ? 'penalty' : 'no-penalty', 'fa-solid', 'fa-shield-alt'], { tooltip: sk.acp ? (i18n.get('PF1.ACPLong') + `<br>-${acp}`) : null }),\n\t\t);\n\n\t\tconst tm = CONFIG.ux.TooltipManager;\n\n\t\t// Delayed filling of tooltip\n\t\tconst context = { actor, skillId: skId };\n\t\thookCoreTooltip(li, { direction: tm.TOOLTIP_DIRECTIONS.LEFT, fn: fillTooltip, context, css: 'lil-quick-skills-tooltip' });\n\t\tul.append(li);\n\t}\n\n\t// Add notification about lacking matching skills.\n\tif (quickSkillCount == 0)\n\t\tul.append(createNode('span', i18n.get('LittleHelper.QuickSkills.NoneMatched'), ['lil-quick-skills-notification']));\n\n\tconst skEdit = createNode('span', null, ['edit', 'action']);\n\tskEdit.dataset.action = 'edit';\n\tskEdit.append(createNode('i', null, ['fa-solid', 'fa-cog']));\n\tskEdit.dataset.tooltip = 'LittleHelper.Action.Configure';\n\n\tconst h = createNode('div', null, ['quick-skills-header']);\n\th.append(createNode('h2', i18n.get('LittleHelper.QuickSkills.Title')), skEdit);\n\n\tqsEl.append(h, ul);\n\n\tskEdit.addEventListener('click', ev => onSkillEdit(ev, actor));\n\tqsEl.addEventListener('click', ev => onSkillClick(ev, actor));\n\n\tconst sdc = createNode('div', null, ['flexrow', 'lil-subdetails-reorganizer']);\n\tsd.before(sdc);\n\tsdc.append(sd, qsEl);\n}\n\nfunction enable() {\n\tAncillary.register('actor', addQuickSkills);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', addQuickSkills);\n}\n\nnew Feature({ setting: 'summary-quick-skills', label: 'Quick Skills', hint: 'Displays quick & configurable skill roll access in summary tab.', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "import { CFG } from '@root/config.mjs';\nimport { QuickSkillsModel } from './quick-skills-model.mjs';\n\nexport const getActorQuickSkillsConfig = (actor) => {\n\tconst config = actor.getFlag(CFG.id, 'quickSkills');\n\tif (config) return new QuickSkillsModel(config);\n\treturn null;\n};\n\nexport function getActorSkills(actor, options) {\n\tconst skills = [];\n\n\tconst addSkill = (sklId) => {\n\t\tconst ski = actor.getSkillInfo(sklId) ?? {};\n\t\tif (ski.mod > options.maxMod) options.maxMod = ski.mod;\n\t\tconst [parentId, subId] = ski.id.split('.');\n\t\tski.parentId = parentId;\n\t\tski.subId = subId;\n\t\tskills.push({\n\t\t\t...ski,\n\t\t});\n\t};\n\n\tconst bannedIds = game.settings.get('pf1', 'allowBackgroundSkills') ? new Set() : new Set(pf1.config.backgroundOnlySkills);\n\n\tfor (const skillId of actor.allSkills ?? []) {\n\t\tif (bannedIds.has(skillId)) continue;\n\t\ttry {\n\t\t\taddSkill(skillId);\n\t\t}\n\t\tcatch { /* nop */ }\n\t}\n\n\tskills.sort((a, b) => a.fullName.localeCompare(b.fullName, undefined, { sensitivity: 'base' }));\n\n\tconst rv = {};\n\tfor (const s of skills) rv[s.id] = s;\n\n\treturn rv;\n}\n\n/**\n * @returns {string[]}\n */\nexport const getDefaultQuickSkills = () => [...QuickSkillsModel.DEFAULT_SKILLS];\n\n/**\n * @returns {string[]}\n */\nexport const getGetUserDefaultQuickSkills = () => game.settings.get(CFG.id, 'quickSkills')?.split(',').filter(id => !!id) ?? [];\n",
    "import { getGetUserDefaultQuickSkills } from './quick-skills-common.mjs';\n\nexport class QuickSkillsModel extends foundry.abstract.DataModel {\n\tstatic defineSchema() {\n\t\tconst fields = foundry.data.fields;\n\t\treturn {\n\t\t\tskills: new fields.SetField(new fields.StringField(), { initial: () => getGetUserDefaultQuickSkills() }),\n\t\t\tthreshold: new fields.NumberField({ initial: 0.4 }),\n\t\t\tminRank: new fields.NumberField({ initial: 1 }),\n\t\t\tuseMod: new fields.BooleanField({ initial: true }),\n\t\t\tsortMod: new fields.BooleanField({ initial: false }),\n\t\t\tdefaults: new fields.BooleanField({ initial: true }),\n\t\t};\n\t}\n\n\tstatic migrateData(source) {\n\t\tif (typeof source.skills === 'string') source.skills = source.skills.split(',').map(sk => sk.trim()).filter(sk => !!sk);\n\t}\n\n\tstatic DEFAULT_SKILLS = new Set(['per', 'dip', 'hea']);\n}\n",
    "import { CFG } from '@root/config.mjs';\nimport { i18n } from '@utility/i18n.mjs';\n\nimport { FAIcons } from '@root/core/icons.mjs';\nimport { signNum } from '@root/common.mjs';\n\nimport { getActorSkills, getActorQuickSkillsConfig, getDefaultQuickSkills } from './quick-skills-common.mjs';\nimport { QuickSkillsModel } from './quick-skills-model.mjs';\n\nexport class SkillEditor extends foundry.applications.api.HandlebarsApplicationMixin(foundry.applications.api.ApplicationV2) {\n\tskillsConfig;\n\n\tconstructor(options = {}) {\n\t\toptions.isUser = !!options.document;\n\t\toptions.document ??= new Actor.implementation({ type: 'character', name: 'Quick Skills Temp' });\n\n\t\tsuper(options);\n\n\t\tthis.skillsConfig = getActorQuickSkillsConfig(options.document) ?? new QuickSkillsModel();\n\t\t;\n\t}\n\n\tget actor() {\n\t\treturn this.options.document;\n\t}\n\n\tget title() {\n\t\tconst actor = this.actor;\n\t\tif (actor.id) return i18n.get('LittleHelper.QuickSkills.ActorTitle', { name: actor.name, id: actor.id });\n\t\telse return i18n.get('LittleHelper.QuickSkills.DefaultTitle');\n\t}\n\n\tstatic DEFAULT_OPTIONS = {\n\t\ttag: 'form',\n\t\tclasses: ['lil-quick-skills-editor'],\n\t\twindow: {\n\t\t\ticon: 'fa-solid fa-hands',\n\t\t\tresizable: true,\n\t\t},\n\t\tposition: {\n\t\t\t// height: ,\n\t\t\twidth: 460,\n\t\t},\n\t\tform: {\n\t\t\thandler: this._onSubmit,\n\t\t\tsubmitOnChange: false,\n\t\t\tcloseOnSubmit: true,\n\t\t\tsubmitOnClose: false,\n\t\t},\n\t};\n\n\tstatic PARTS = {\n\t\tform: {\n\t\t\ttemplate: `modules/${CFG.id}/templates/quick-skills-editor.hbs`,\n\t\t},\n\t\tfooter: {\n\t\t\ttemplate: 'templates/generic/form-footer.hbs',\n\t\t},\n\t};\n\n\t_initializeApplicationOptions(options) {\n\t\toptions = super._initializeApplicationOptions(options);\n\n\t\tconst actor = options.document;\n\t\tif (actor.id)\n\t\t\toptions.uniqueId = `quick-skills-editor-${actor.uuid.replaceAll('.', '-')}`;\n\t\telse\n\t\t\toptions.uniqueId = 'quick-skills-editor-defaults';\n\n\t\treturn options;\n\t}\n\n\tasync _prepareContext(options) {\n\t\tconst actor = this.actor,\n\t\t\tactorData = actor?.system;\n\n\t\tconst skills = getActorSkills(actor, { maxMod: Number.NEGATIVE_INFINITY });\n\n\t\tconst qs = this.skillsConfig ?? new QuickSkillsModel();\n\t\tfor (const skId of qs.skills) {\n\t\t\tconst sklData = skills[skId];\n\t\t\tif (sklData) {\n\t\t\t\tsklData.selected = true;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconsole.warn('Invalid skill ID:', skId);\n\t\t\t}\n\t\t}\n\n\t\tfor (const sk of getDefaultQuickSkills()) {\n\t\t\tif (qs.skills.size === 0) skills[sk].selected = true;\n\t\t\tskills[sk].default = true;\n\t\t}\n\n\t\tconst context = {\n\t\t\tactor,\n\t\t\tuser: this.options.isUser,\n\t\t\tskills,\n\t\t\ticons: FAIcons,\n\t\t\tlabels: {},\n\t\t};\n\n\t\tif (actor) {\n\t\t\tconst hd = actorData.attributes.hd.total,\n\t\t\t\tmaxRank = hd,\n\t\t\t\tminRank = qs.minRank ?? 1;\n\n\t\t\tcontext.threshold = qs.threshold;\n\t\t\tcontext.thresholdPct = Math.floor(qs.threshold * 100);\n\t\t\tcontext.useMod = qs.useMod;\n\t\t\tcontext.maxMod = options.maxMod;\n\t\t\tcontext.maxRank = maxRank;\n\t\t\tcontext.minRank = minRank;\n\n\t\t\tcontext.labels.maxMod = `<span class='maxmod-value'>${signNum(context.maxMod)}</span>`;\n\t\t\tcontext.labels.maxRank = `<span class='maxrank-value'>${context.maxRank}</span>`;\n\t\t}\n\n\t\treturn context;\n\t}\n\n\t/**\n\t * @param {Actor} actor\n\t */\n\tasync resetSkills() {\n\t\tconst actor = this.actor;\n\n\t\tif (actor.id) {\n\t\t\tconst rv = await foundry.applications.api.DialogV2.confirm({\n\t\t\t\twindow: { title: i18n.get('LittleHelper.QuickSkills.Reset.Title') },\n\t\t\t\tcontent: '<p>' + i18n.get('LittleHelper.QuickSkills.Reset.Info'),\n\t\t\t});\n\n\t\t\tif (rv) {\n\t\t\t\tactor.unsetFlag(CFG.id, 'quickSkills');\n\t\t\t\tthis.close();\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tthis.skillsConfig.updateSource({ skills: QuickSkillsModel.DEFAULT_SKILLS });\n\t\t\tthis.render();\n\t\t\tui.notifications.warn(i18n.get('LittleHelper.QuickSkills.Reset.Soft'));\n\t\t}\n\t}\n\n\t/**\n\t * @param {object} context\n\t * @param {object} options\n\t */\n\t_onRender(context, options) {\n\t\tsuper._onRender(context, options);\n\n\t\tconst html = this.element.querySelector('.window-content');\n\n\t\tconst actor = this.actor;\n\n\t\thtml.querySelector('button[data-action=\"reset\"]').addEventListener('click', ev => {\n\t\t\tev.preventDefault();\n\t\t\tev.stopPropagation();\n\t\t\tthis.resetSkills().then(_ => this.render());\n\t\t});\n\n\t\tif (!actor.id) return;\n\n\t\tconst t = html.querySelector('.threshold'),\n\t\t\tr = t?.querySelector('[name=\"threshold\"]'),\n\t\t\tmr = t?.querySelector('[name=\"minRank\"]'),\n\t\t\tum = t?.querySelector('[name=\"useMod\"]'),\n\t\t\tp = t?.querySelector('.percentage'),\n\t\t\thus = html.querySelector('input.hide-unselected'),\n\t\t\tsl = html.querySelector('.skill-list');\n\n\t\tconst actorData = actor.system,\n\t\t\thd = actorData.attributes.hd.total,\n\t\t\tmaxRank = hd;\n\n\t\tlet maxMod = Number.NEGATIVE_INFINITY;\n\n\t\tconst qs = getActorQuickSkillsConfig(actor) ?? new QuickSkillsModel();\n\t\tlet threshold = qs.threshold ?? 0,\n\t\t\tminRank = qs.minRank ?? 1,\n\t\t\thideUnselected = false;\n\n\t\tconst skills = html.querySelectorAll('[data-skill]');\n\n\t\tlet useMod = qs.useMod;\n\n\t\tfunction highlightSkills(percent, minRank = 1) {\n\t\t\tfor (const el of skills) {\n\t\t\t\tconst rank = parseInt(el.dataset.rank) || 0,\n\t\t\t\t\tmod = parseInt(el.dataset.mod) || 0,\n\t\t\t\t\tval = useMod ? mod : rank;\n\t\t\t\tif (mod > maxMod) maxMod = mod;\n\t\t\t\tconst tt = useMod ? maxMod : maxRank;\n\t\t\t\tconst pcte = percent > 0 ? val >= Math.floor(tt * percent) : false,\n\t\t\t\t\tmre = minRank > 0 ? rank >= minRank : false,\n\t\t\t\t\tboth = percent == 0 && minRank == 0 ? false : (percent > 0 ? pcte : true) && (minRank > 0 ? mre : true);\n\n\t\t\t\tel.classList.toggle('auto-select', both);\n\n\t\t\t\tconst checkbox = el.querySelector('input');\n\t\t\t\tif (!checkbox.checked) checkbox.indeterminate = both;\n\t\t\t}\n\n\t\t\tconst thval = Math.floor((useMod ? maxMod : maxRank) * threshold);\n\t\t\tp.textContent = `${Math.floor(percent * 100)}% [${thval}]`;\n\t\t}\n\n\t\thighlightSkills(qs.threshold);\n\t\thus.addEventListener('change', ev0 => {\n\t\t\thideUnselected = Boolean(ev0.target.checked);\n\t\t\tsl.classList.toggle('hide-unselected', hideUnselected);\n\t\t\thighlightSkills(threshold, minRank);\n\t\t}, { passive: true });\n\n\t\tum.addEventListener('change', ev0 => {\n\t\t\tuseMod = Boolean(ev0.target.checked);\n\t\t\thighlightSkills(threshold, minRank);\n\t\t}, { passive: true });\n\n\t\tr.addEventListener('input', ev0 => highlightSkills(threshold = parseFloat(ev0.target.value), minRank), { passive: true });\n\t\tr.addEventListener('change', ev0 => highlightSkills(threshold = parseFloat(ev0.target.value), minRank), { passive: true });\n\t\tmr.addEventListener('input', ev0 => highlightSkills(threshold, minRank = parseFloat(ev0.target.value)), { passive: true });\n\t\tmr.addEventListener('change', ev0 => highlightSkills(threshold, minRank = parseFloat(ev0.target.value)), { passive: true });\n\t}\n\n\t/**\n\t * @param {SubmitEvent} event\n\t * @param {HTMLFormElement} form\n\t * @param {FormDataExtended} formData\n\t */\n\tstatic _onSubmit(event, form, formData) {\n\t\tconst actor = this.actor;\n\n\t\tformData = formData.object;\n\n\t\tconst qs = [];\n\t\tfor (const [skId, enabled] of Object.entries(formData)) {\n\t\t\tif (skId.startsWith('skill.') && enabled) qs.push(skId.replace(/^skill\\./, ''));\n\t\t}\n\n\t\tconst C = CFG.console.colors;\n\n\t\tif (actor.id) {\n\t\t\tconst setup = new QuickSkillsModel({ ...formData, skills: qs });\n\t\t\tconsole.log('%cLittle Helper%c ðŸ¦Ž | Quick Skills | Saving actor config:',\n\t\t\t\tC.main, C.unset,\n\t\t\t\tsetup);\n\t\t\tactor.setFlag(CFG.id, 'quickSkills', setup.toObject());\n\t\t}\n\t\telse {\n\t\t\tconsole.log('%cLittle Helper%c ðŸ¦Ž | Quick Skills | Saving defaults:',\n\t\t\t\tC.main, C.unset,\n\t\t\t\tqs);\n\t\t\tgame.settings.set(CFG.id, 'quickSkills', qs.join(','));\n\t\t}\n\t}\n}\n",
    "/**\n * Clarify actor linking status.\n */\n\nimport { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { createNode, addCoreTooltip } from '@root/common.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nconst variants = {\n\tlinked: {\n\t\tlabel: 'LittleHelper.LinkState.Linked.TitleTag',\n\t\tsub: 'LittleHelper.LinkState.Linked.Token',\n\t\tproto: 'LittleHelper.LinkState.Linked.Prototype',\n\t\tsproto: 'LittleHelper.LinkState.Linked.PrototypeShort',\n\t\tcss: ['lil-token-linked', 'linked'],\n\t\ticon: ['fa-solid', 'fa-link', 'fa-fw'],\n\t},\n\tunlinked: {\n\t\tlabel: 'LittleHelper.LinkState.Unlinked.TitleTag',\n\t\tsub: 'LittleHelper.LinkState.Unlinked.Token',\n\t\tproto: 'LittleHelper.LinkState.Unlinked.Prototype',\n\t\tsproto: 'LittleHelper.LinkState.Unlinked.PrototypeShort',\n\t\tcss: ['lil-token-unlinked', 'unlinked'],\n\t\ticon: ['fa-solid', 'fa-unlink', 'fa-fw'],\n\t},\n};\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} _opts\n * @param {SharedData} shared\n * @returns\n */\nfunction actorLinkStatus(sheet, html, _opts, shared) {\n\tconst actor = sheet.actor,\n\t\ttoken = sheet.token ?? actor.token,\n\t\tisToken = !!token,\n\t\tisLinked = isToken ? token.isLinked : actor.prototypeToken.actorLink;\n\n\tif (actor.pack) return; // Inside compendium, ignore\n\n\t/** @type {HTMLElement} */\n\tconst tab = shared.tabs.summary?.tab;\n\tif (!tab) return;\n\n\tconst baseActor = actor.token?.baseActor ?? actor;\n\tconst isProtoLinked = baseActor.prototypeToken.actorLink;\n\n\tconst vd = variants[isLinked ? 'linked' : 'unlinked'];\n\n\tif (game.user.isGM || !isLinked) {\n\t\tconst tsheet = html.closest('.app.sheet.actor');\n\t\tconst title = tsheet?.querySelector('.window-title');\n\t\tif (!title) return;\n\t\tconst fc = title.firstChild; // Text node\n\t\tif (fc) {\n\t\t\tlet extraLabel;\n\t\t\tif (isLinked) {\n\t\t\t\tif (isProtoLinked) extraLabel = 'full-link';\n\t\t\t\telse extraLabel = 'bad-link';\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (isProtoLinked) extraLabel = 'broken';\n\t\t\t\telse extraLabel = 'full-unlink';\n\t\t\t}\n\n\t\t\t// Delete already existing status\n\t\t\tfc.parentElement?.querySelector('.lil-link-status')?.remove();\n\n\t\t\tconst linkLabel = createNode('i', null, ['lil-link-status', ...vd.icon, ...vd.css, extraLabel]);\n\t\t\taddCoreTooltip(linkLabel, isToken ? vd.sub : vd.proto, 'DOWN');\n\t\t\tfc.after(linkLabel);\n\t\t}\n\t}\n}\n\nfunction enable() {\n\tAncillary.register('actor', actorLinkStatus);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', actorLinkStatus);\n}\n\nnew Feature({ setting: 'actor-unmistaken-linking', label: 'Display Linking Status', hint: 'Display if an actor is linked or not.', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "import { i18n } from '@root/utility/i18n.mjs';\n\nexport const healthLabels = {\n\t0: 'LittleHelper.HealthLevel.Healthy',\n\t1: 'LittleHelper.HealthLevel.Grazed',\n\t2: 'LittleHelper.HealthLevel.Wounded',\n\t3: 'LittleHelper.HealthLevel.Critical',\n\tdying: 'LittleHelper.HealthLevel.Dying',\n\tdead: 'LittleHelper.HealthLevel.Dead',\n};\n\n/**\n * Evaluates the numeric point at which character dies.\n *\n * @param {Actor} actor\n * @returns {number}\n */\nexport const evaluateDeathPoint = (actor) => {\n\tconst ad = actor.system,\n\t\tisUnliving = ad.abilities.con.value === null,\n\t\tdeathPoint = isUnliving ? 0 : -(ad.abilities[ad.attributes.hpAbility]?.total ?? 0);\n\treturn deathPoint;\n};\n\nHooks.once('i18nInit', () => {\n\tfor (const [key, value] of Object.entries(healthLabels)) healthLabels[key] = i18n.get(value);\n});\n",
    "import { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { evaluateDeathPoint } from '@root/helpers/wounds.mjs';\nimport { clampNum } from '@root/common.mjs';\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param _opts\n * @param shared\n */\nfunction considerDeath(sheet, html, _opts, shared) {\n\tconst tab = shared.tabs.summary?.tab;\n\n\t// As per 0.78.15 sheet design\n\tconst hpEl = tab?.querySelector('[name=\"system.attributes.hp.value\"]')?.parentElement;\n\tif (!hpEl) return;\n\n\tconst actor = shared.actor,\n\t\tactorData = shared.systemData,\n\t\thp = actorData.attributes.hp,\n\t\teHP = hp.value + hp.temp;\n\n\t// https://aonprd.com/Rules.aspx?Name=Dying%20(Negative%20Hit%20Points)&Category=Injury%20and%20Death\n\t// > If your hit point total is negative, but not equal to or greater than your Constitution score, youâ€™re dying.\n\n\tconst cls = [];\n\n\tconst hpPercentage = eHP / hp.max,\n\t\twoundThreshold = clampNum(4 - Math.ceil(hpPercentage * 4), 0, 3);\n\tswitch (woundThreshold) {\n\t\tcase 0: cls.push('healthy'); break;\n\t\tcase 1: cls.push('grazed'); break;\n\t\tcase 2: cls.push('wounded'); break;\n\t\tcase 3: cls.push('critical'); break;\n\t}\n\n\tif (eHP <= evaluateDeathPoint(actor))\n\t\tcls.push('lil-dead'); // Dead, unaffected by NL\n\telse if (eHP >= 0) {\n\t\tcls.push('lil-alive'); // in relatively good health\n\t\tconst eHPNL = eHP - hp.nonlethal;\n\t\tif (eHPNL >= 0) cls.push('lil-awake');\n\t\tif (eHPNL <= 0) {\n\t\t\tif (eHPNL == 0) cls.push('lil-staggered');\n\t\t\tif (eHPNL < 0) cls.push('lil-unconscious');\n\t\t\tif (hp.nonlethal > 0) {\n\t\t\t\ttab.querySelector('[name=\"system.attributes.hp.nonlethal\"]')\n\t\t\t\t\t?.parentElement?.classList.add('lil-staggered');\n\t\t\t}\n\t\t}\n\t}\n\telse\n\t\tcls.push('lil-dying', 'lil-unconscious'); // Dying, unaffected by NL\n\n\thpEl.classList.add(...cls);\n}\n\nfunction enable() {\n\tAncillary.register('actor', considerDeath);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', considerDeath);\n}\n\nnew Feature({ setting: 'death-proximity', label: 'Death Proximity', hint: 'Color and iconize actor sheet health depending on health status.', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "import { Ancillary } from '@root/ancillary.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { SharedData } from '@core/shared-data.mjs';\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction addRaceName(sheet, html, options, shared) {\n\tif (!shared.coreSheet) return;\n\n\tconst actor = shared.actor,\n\t\trace = actor.race;\n\n\tif (!race) return;\n\n\tconst tab = shared.tabs?.summary?.tab;\n\n\tconst header = tab?.querySelector('.summary-header');\n\n\tconst raceInfo = header?.querySelector(`[data-item-id=\"${race.id}\"] .race-info`);\n\n\traceInfo?.prepend(createNode('div', null, ['lil-race-name'],\n\t\t{\n\t\t\tchildren: [\n\t\t\t\tcreateNode('span', race.name, ['name']),\n\t\t\t],\n\t\t}));\n}\n\nfunction enable() {\n\tAncillary.register('actor', addRaceName);\n}\n\nenable();\n",
    "/**\n * Display ability scores on summary tab.\n */\nimport { createNode, signNum, maxPrecision } from '@root/common.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nconst ablKeys = ['str', 'dex', 'con', 'int', 'wis', 'cha'];\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction summaryAbilityScores(sheet, html, options, shared) {\n\tconst actor = sheet.actor,\n\t\tactorData = shared.systemData;\n\n\tconst summary = shared.tabs.summary;\n\tconst attr = summary?.attributes;\n\tif (!attr) return;\n\n\tconst abls = foundry.utils.deepClone(actorData.abilities);\n\n\tconst ablsSorted = [];\n\tfor (const [key, abl] of Object.entries(abls)) {\n\t\tconst data = abl;\n\t\tdata.key = key;\n\t\tablsSorted.push(data);\n\t}\n\tablsSorted.sort((a, b) => b.total - a.total);\n\n\tablsSorted[0].grade = 5;\n\tconst best = ablsSorted[0],\n\t\tworst = ablsSorted[5];\n\n\tfor (const abl of ablsSorted) {\n\t\tabl.percentile = maxPrecision((abl.total - worst.total) / (best.total - worst.total), 2);\n\t\tabl.grade = Math.round(abl.percentile * 5);\n\t}\n\n\tconst ablDiv = createNode('div', undefined, ['lil-ability-scores']);\n\tconst abilities = {};\n\tfor (const ablKey of ablKeys) {\n\t\tconst abl = abls[ablKey],\n\t\t\taligner = createNode('div', undefined, ['ability-score-holder']),\n\t\t\tablD = createNode('h3', undefined, ['ability-score']),\n\t\t\tl = createNode('label', i18n.get(`PF1.AbilityShort${ablKey.capitalize()}`)),\n\t\t\tt = createNode('span', abl.total, ['total']),\n\t\t\tm = createNode('span', `(${signNum(abl.mod)})`, ['modifier']);\n\n\t\tconst isNull = abl.total === null;\n\t\tif (isNull) {\n\t\t\tt.textContent = 'â€“';\n\t\t\tm.textContent = '';\n\t\t\taligner.classList.add('null');\n\t\t}\n\n\t\tabilities[ablKey] = { d: ablD, l, t, m };\n\t\tablD.append(l, t, m);\n\t\taligner.append(ablD);\n\t\tablDiv.append(aligner);\n\n\t\tablD.dataset.ability = ablKey;\n\t\tablD.dataset.grade = abl.grade;\n\n\t\tif (abl.grade == 5) {\n\t\t\tconst icon = createNode('i', undefined, ['far', 'fa-star', 'lil-icon']);\n\t\t\tablD.prepend(icon);\n\t\t}\n\n\t\tif (!isNull) ablD.addEventListener('click', function rollAbilityCheck(ev) {\n\t\t\tev.preventDefault();\n\t\t\tev.stopPropagation();\n\t\t\tactor.rollAbilityTest(ablKey);\n\t\t});\n\t}\n\n\tattr.before(ablDiv);\n\n\t// Add a fix for weird layout\n\tattr.querySelector('.maneuverability-details')\n\t\t?.classList.add('lil-abl-score-layout-fix');\n}\n\nfunction enable() {\n\tAncillary.register('actor', summaryAbilityScores);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', summaryAbilityScores);\n}\n\nnew Feature({ setting: 'summary-ability-scores', label: 'Ability Scores in Summary Tab', hint: 'Displays ability scores on the summary tab just above health.', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "// Token image mismatch\n/**\n * Displays little marker if itoken image does not match portrait image.\n *\n * Useful in case you like to keep the two synced but don't always remember to update the token image.\n */\n\nimport { CFG } from '@root/config.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { addCoreTooltip } from '@root/common.mjs';\n\n/* global FormApplication */\nclass TokenSyncDialog extends FormApplication {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\t}\n\n\tget document() {\n\t\treturn this.object;\n\t}\n\n\tget title() {\n\t\treturn `Image Sync: ${this.document.token?.name ?? this.document.name}`;\n\t}\n\n\tget template() {\n\t\treturn `modules/${CFG.id}/templates/dialog/token-image-sync-dialog.hbs`;\n\t}\n\n\tstatic get defaultOptions() {\n\t\tconst _default = super.defaultOptions;\n\t\treturn {\n\t\t\t..._default,\n\t\t\tclasses: [..._default.classes, 'lil-token-image-sync-dialog'],\n\t\t\tid: 'lil-token-image-sync-dialog',\n\t\t\theight: 'auto',\n\t\t\twidth: 'auto',\n\t\t};\n\t}\n\n\tgetData() {\n\t\tconst context = super.getData();\n\n\t\tcontext.actor = this.document;\n\t\tcontext.token = this.document.token ?? this.document.prototypeToken;\n\n\t\treturn context;\n\t}\n\n\t/**\n\t * @param {Event} ev\n\t * @param {{source: string}} options\n\t */\n\tasync _syncImage(ev, { source } = {}) {\n\t\tev.preventDefault();\n\t\tev.stopPropagation();\n\n\t\tconst actor = this.document,\n\t\t\ttoken = actor.token ?? actor.prototypeToken;\n\n\t\tswitch (source) {\n\t\t\tcase 'actor':\n\t\t\t\tif (actor.token)\n\t\t\t\t\ttoken.update({ 'texture.src': actor.img });\n\t\t\t\telse\n\t\t\t\t\tactor.update({ 'prototypeToken.texture.src': actor.img });\n\t\t\t\tbreak;\n\t\t\tcase 'token':\n\t\t\t\tactor.update({ img: token.texture.src });\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis.close();\n\t}\n\n\t/**\n\t * @param {HTMLElement} jq\n\t */\n\tactivateListeners(jq) {\n\t\tconst html = jq;\n\n\t\tconst actorImg = html.querySelector('.actor-image');\n\t\tconst tokenImg = html.querySelector('.token-image');\n\n\t\tactorImg.addEventListener('click', ev => this._syncImage(ev, { source: 'actor' }));\n\t\ttokenImg.addEventListener('click', ev => this._syncImage(ev, { source: 'token' }));\n\t}\n}\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction tokenImageMismatch(sheet, html, options, shared) {\n\tconst actor = sheet.actor;\n\n\tconst summary = shared.tabs.summary?.tab;\n\tconst img = summary?.querySelector('section > .tab.summary img.profile[data-edit=\"img\"]');\n\n\tif (!img) return;\n\n\tconst pImg = actor.img,\n\t\ttImg = actor.token?.texture.src ?? actor.prototypeToken.texture.src;\n\n\tconst mismatch = pImg !== tImg;\n\tif (!mismatch) return;\n\t// TODO: Add marker when it matches, in case there's people who want the portrait and token to always be different.\n\n\tconst slant = document.createElement('span');\n\tslant.classList.add('lil-token-mismatch-marker');\n\taddCoreTooltip(slant, 'Token image does not match profile.<br>Click to show sync options.');\n\n\tslant.addEventListener('click', ev => {\n\t\tev.preventDefault();\n\t\tev.stopPropagation();\n\n\t\tnew TokenSyncDialog(actor).render(true, { focus: true, left: ev.clientX + 20, top: ev.clientY + 20 });\n\t});\n\n\timg.before(slant);\n}\n\nfunction enable() {\n\tAncillary.register('actor', tokenImageMismatch);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', tokenImageMismatch);\n}\n\nnew Feature({ setting: 'actor-token-mismatch', category: 'actor-sheet', enable, disable, enabledByDefault: false, stage: 'ready' });\n",
    "// Display token name with actor name\n\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { hookCoreTooltip } from '@core/tooltip.mjs';\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction displayTokenName(sheet, html, options, shared) {\n\t/** @type {HTMLElement} */\n\tconst tab = shared.tabs.summary?.tab;\n\n\tconst actor = sheet.actor;\n\t// sheet token > actor token > prototype token\n\tconst token = sheet.token ?? actor.token ?? actor.prototypeToken;\n\tconst tokenName = token.name;\n\tif (actor.name == tokenName) return;\n\n\tconst nameEl = tab?.querySelector('input[name=name]');\n\tif (!nameEl) return;\n\n\tconst tokenNameEl = createNode('span', tokenName, ['token-name']);\n\ttokenNameEl.dataset.tooltip = 'Token Name';\n\n\tnameEl.after(tokenNameEl);\n}\n\nfunction enable() {\n\tAncillary.register('actor', displayTokenName);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', displayTokenName);\n}\n\nnew Feature({ setting: 'actor-token-name', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "import { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { createNode, signNum } from '@root/common.mjs';\nimport { setStaticToolTipListener } from '@core/tooltip.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nfunction rangeLabel(value, units) {\n\tlet label = pf1.utils.convertDistance(0)[1];\n\tlabel = label === 'ft' ? pf1.config.measureUnitsShort.ft : pf1.config.measureUnitsShort.m;\n\tlabel = `${value} ${label}`;\n\n\tswitch (units) {\n\t\tcase 'personal':\n\t\t\treturn pf1.config.distanceUnits.personal;\n\t\tcase 'melee':\n\t\t\treturn pf1.config.distanceUnits.melee + ` (${label})`;\n\t\tcase 'touch':\n\t\t\treturn pf1.config.distanceUnits.touch + ` (${label})`;\n\t\tcase 'reach':\n\t\t\treturn pf1.config.distanceUnits.reach + ` (${label})`;\n\t\tdefault:\n\t\t\treturn label;\n\t}\n}\n\n/**\n *\n * @param {ItemAction} act\n * @param {ItemPF} item\n * @param {HTMLElement} ul\n * @param {SharedData} shared\n */\nasync function fillActionDetails(act, item, ul, shared) {\n\tconst actor = item.actor;\n\n\t// Damage\n\tconst damage = Handlebars.helpers.actionDamage(act, shared.rollData, { hash: { combine: true } });\n\tif (damage) {\n\t\tconst damagel = createNode('div', null, ['damage', 'value', 'nowrap']);\n\t\tdamagel.append(damage);\n\t\tconst label = act.isHealing ? 'PF1.Healing' : 'PF1.Damage';\n\t\tul.append(createNode('li', null, ['damage'], { children: [createNode('label', i18n.get(label)), damagel] }));\n\t}\n\n\t// Attacks\n\tif (act.hasAttack) {\n\t\tconst attacks = act.getAttacks({ full: true, resolve: true, bonuses: true, conditionals: true });\n\t\tif (attacks?.length) {\n\t\t\tconst attacksl = createNode('div', null, ['attacks', 'value', 'nowrap']);\n\t\t\tattacksl.append(attacks.map(a => signNum(a.bonus)).join('/'));\n\t\t\tul.append(createNode('li', null, ['attacks'], { children: [createNode('label', 'Attacks'), attacksl] }));\n\t\t}\n\t}\n\n\t// CHARGES\n\tif (act.isCharged) {\n\t\tconst charges = createNode('div', null, ['charges', 'value']);\n\t\tconst chargeCost = await act.getChargeCost({ maximize: true, interactive: false });\n\t\tcharges.append(createNode('span', `${Math.floor(item.charges / chargeCost)}`, ['remaining']));\n\t\tconst m = item.chargeMax;\n\t\tif (m > 0) charges.append(' / ', createNode('span', Math.floor(m / chargeCost), ['max']));\n\t\tul.append(createNode('li', null, ['charges'], { children: [createNode('label', 'Charges'), charges] }));\n\t}\n\n\tif (act.usesAmmo) {\n\t\tconst ammoId = item.getFlag('pf1', 'defaultAmmo');\n\t\tconst ammo = actor.items.get(ammoId);\n\n\t\tif (ammo) {\n\t\t\tconst ammoLeft = ammo.system.quantity ?? 0;\n\t\t\tul.append(\n\t\t\t\tcreateNode('li', null, ['ammo'], {\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tcreateNode('label', 'Ammo'),\n\t\t\t\t\t\tcreateNode('span', ammo.name, ['value']),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\tcreateNode('li', null, ['ammo'], {\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tcreateNode('label', ' â€“ Quantity'),\n\t\t\t\t\t\tcreateNode('span', ammoLeft, ['value']),\n\t\t\t\t\t],\n\t\t\t\t}));\n\t\t}\n\t\telse {\n\t\t\tul.append(createNode('li', null, ['ammo'], { children: [createNode('label', 'No Default Ammo', ['warning', 'span-2'])] }));\n\t\t}\n\t}\n\n\tconst rUnits = act.range?.units;\n\tif (act.hasRange && !!rUnits) {\n\t\tconst r = act.getRange();\n\t\tconst rl = rangeLabel(r, rUnits);\n\n\t\tul.append(createNode('li', null, ['range'], {\n\t\t\tchildren: [\n\t\t\t\tcreateNode('label', 'Range'),\n\t\t\t\tcreateNode('span', rl, ['value']),\n\t\t\t],\n\t\t}));\n\n\t\tconst minRange = act.minRange;\n\t\tif (minRange > 0) {\n\t\t\tconst mrlabel = rangeLabel(minRange, rUnits);\n\t\t\tul.append(createNode('li', null, ['range', 'min'], {\n\t\t\t\tchildren: [\n\t\t\t\t\tcreateNode('label', 'â€“ Min'),\n\t\t\t\t\tcreateNode('span', mrlabel, ['value']),\n\t\t\t\t],\n\t\t\t}));\n\t\t}\n\n\t\tconst mi = act.range.maxIncrements ?? 1;\n\t\tif (mi > 1 && rUnits === 'ft') {\n\t\t\tconst maxRange = act.maxRange;\n\t\t\tconst mrlabel = rangeLabel(maxRange, rUnits);\n\n\t\t\tul.append(createNode('li', null, ['range', 'max'], {\n\t\t\t\tchildren: [\n\t\t\t\t\tcreateNode('label', 'â€“ Max'),\n\t\t\t\t\tcreateNode('span', mrlabel, ['value']),\n\t\t\t\t],\n\t\t\t}));\n\t\t}\n\t}\n};\n\n/**\n * @param {HTMLElement} el\n * @param {ItemPF} item\n * @param shared\n */\nasync function generateActionTooltip(el, item, shared) {\n\tconst template = document.createElement('template');\n\n\tconst ul = createNode('ul', null, ['details']);\n\n\tconst act = item.defaultAction;\n\tif (act) {\n\t\tawait fillActionDetails(act, item, ul, shared);\n\t}\n\telse {\n\t\tul.append(createNode('li', 'No Actions', ['warning', 'span-2']));\n\t}\n\n\ttemplate.content.append(\n\t\tcreateNode('h3', item.name, ['name']),\n\t\tdocument.createElement('hr'),\n\t\tul,\n\t);\n\n\tconst tooltip = {\n\t\thtml: template.content,\n\t\tdirection: game.tooltip.constructor.TOOLTIP_DIRECTIONS.UP,\n\t\tcssClass: 'lil-quick-action-tooltip',\n\t};\n\n\tgame.tooltip.activate(el, tooltip);\n};\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction addQuickActionTooltips(sheet, html, options, shared) {\n\t/** @type {HTMLElement} */\n\tconst tab = shared.tabs.summary?.tab;\n\n\t/** @type {ActorPF} */\n\tconst actor = shared.actor;\n\n\tconst acts = tab?.querySelector('.quick-actions');\n\tif (!acts) return;\n\n\tfor (const el of acts.querySelectorAll('[data-item-id]')) {\n\t\t/** @type {ItemPF} */\n\t\tconst item = actor.items.get(el.dataset.itemId);\n\t\tif (!item) continue;\n\n\t\tdelete el.dataset.tooltip; // Remove normal tooltip\n\n\t\tel.addEventListener('pointerenter', _ => generateActionTooltip(el, item, shared), { passive: true });\n\t}\n\tacts.addEventListener('pointerleave', () => game.tooltip.deactivate());\n}\n\nfunction enable() {\n\tAncillary.register('actor', addQuickActionTooltips);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', addQuickActionTooltips);\n}\n\nnew Feature({ setting: 'actor-quick-action-tooltips', label: 'Quick Action Tooltips', hint: 'Display tooltips for quick actions.', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "/*\n * Make finding common easier.\n */\n\nimport { CFG } from '@root/config.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nCFG.API.language = {\n\tgroups: {\n\t\tsecret: {\n\t\t\tcss: ['secret'],\n\t\t\ticon: ['fa-mask'],\n\t\t\tvalues: new Set(['druidic', 'drowsign']),\n\t\t},\n\t\t// Languages other languages base themselves on\n\t\t// proto: {\n\t\t//\tvalues: new Set(['draconic', 'cyclops', 'azlanti']),\n\t\t// },\n\t\tracial: {\n\t\t\tcss: ['racial'],\n\t\t\ticon: ['fa-fish'],\n\t\t\tvalues: new Set(['elven', 'dwarven', 'gnome', 'orc', 'goblin', 'grippli', 'halfling', 'gnoll', 'tengu', 'strix', 'samsaran', 'kasatha', 'kuru', 'munavri', 'nagaji', 'caligni', 'dark', 'triaxian', 'yaddithian', 'androffan', 'catfolk', 'ib', 'lashunta', 'reptoid', 'rougarou', 'syrinx', 'vishkanya', 'vanaran']),\n\t\t},\n\t\t// Non-specific monstrous/NPC race languages.\n\t\tmonster: {\n\t\t\tcss: ['monster', 'npc'],\n\t\t\ticon: ['fa-pastafarianism'],\n\t\t\tvalues: new Set(['sphinx', 'sasquatch', 'aboleth', 'aklo', 'cyclops', 'necril', 'giant', 'dziriak', 'arboreal', 'treant', 'vegepygmy', 'boggard', 'migo', 'yithian', 'elderthing', 'shae', 'grioth']),\n\t\t},\n\t\t// // Regional & Cultural\n\t\tregional: {\n\t\t\tcss: ['regional'],\n\t\t\ticon: ['fa-map'],\n\t\t\tvalues: new Set(['varisian', 'skald', 'taldane', 'shoanti', 'vudrani', 'varki', 'shadowtongue', 'orvian', 'osiriani', 'kelish', 'minatan', 'hallit', 'polyglot', 'mwangi']),\n\t\t},\n\t\tmagic: {\n\t\t\tcss: ['draconic'],\n\t\t\ticon: ['fa-dragon'],\n\t\t\tvalues: new Set(['draconic']),\n\t\t},\n\t\tfae: {\n\t\t\tcss: ['sylvan'],\n\t\t\ticon: ['fa-cannabis'],\n\t\t\tvalues: new Set(['sylvan']),\n\t\t},\n\t\telemental: {\n\t\t\tcss: ['elemental'],\n\t\t\ticon: ['fa-fire'],\n\t\t\tvalues: new Set(['terran', 'ignan', 'aquan', 'auran']),\n\t\t},\n\t\tplanar: {\n\t\t\tcss: ['planar'],\n\t\t\ticon: ['fa-solar-panel'],\n\t\t\tvalues: new Set(['celestial', 'infernal', 'abyssal', 'protean']),\n\t\t},\n\t\tdead: {\n\t\t\tcss: ['rare'],\n\t\t\ticon: ['fa-monument'],\n\t\t\tvalues: new Set(['azlanti', 'thassilonian', 'ancientosiriani', 'tekritanin', 'shory', 'jistka']),\n\t\t},\n\t\tcommon: {\n\t\t\tcss: ['lil-highlight', 'common'],\n\t\t\ticon: ['fa-globe'],\n\t\t\tvalues: new Set(['common', 'taldane', 'tien', 'undercommon']),\n\t\t},\n\t},\n};\n\nconst animalIcons = ['fa-cat', 'fa-dog', 'fa-otter', 'fa-hippo', 'fa-crow', 'fa-dove', 'fa-dragon', 'fa-frog', 'fa-horse', 'fa-fish'];\n\nlet langMap;\n\n/**\n * @param {ItemSheet} app\n * @param {HTMLElement} html\n */\nfunction manipulateTraitSelector(app, html) {\n\tif (html instanceof jQuery) html = html[0];\n\n\tconst isLang = app.options.subject === 'languages';\n\tif (!isLang) return;\n\n\tconst langGroups = CFG.API.language.groups;\n\tif (!langGroups) return;\n\n\t// TODO: Support overlap\n\tif (!langMap) {\n\t\tlangMap = new Map();\n\t\tfor (const [groupId, lang] of Object.entries(langGroups)) {\n\t\t\tconst i18nKey = `LittleHelper.Languages.${groupId}`;\n\t\t\tlang.label = i18n.has(i18nKey) ? i18n.get(i18nKey) : 'Â ';\n\t\t\tfor (const id of lang.values) langMap.set(id, lang);\n\t\t}\n\n\t\tconst canonical = new Set(Object.keys(pf1.config.languages));\n\t\tconst missing = new Set();\n\t\tfor (const id of canonical) {\n\t\t\tif (!langMap.has(id)) missing.add(id);\n\t\t}\n\t\tif (missing.size > 0) console.warn('LH | Following languages were not recognized:\\n', missing);\n\t}\n\n\thtml.classList.add('lil-enhanced-language-selector');\n\n\tfor (const node of html.querySelectorAll('li input[type=\"checkbox\"]')) {\n\t\tif (node.type !== 'checkbox') return;\n\t\tconst el = node.closest('li');\n\t\tconst lang = el.dataset.choice;\n\t\tlet icon, css;\n\t\tconst label = createNode('span', null, ['lil-lang-type']);\n\n\t\tconst langData = langMap.get(lang);\n\t\tif (langData) {\n\t\t\tcss = langData.css;\n\t\t\ticon = langData.icon;\n\t\t\tlabel.textContent = langData.label;\n\t\t}\n\t\telse {\n\t\t\tcss = ['unknown'];\n\t\t\ticon = ['fa-question-circle'];\n\t\t\tlabel.textContent = 'Unidentified';\n\t\t}\n\n\t\tif (css) el.classList.add(...css);\n\t\tif (icon) {\n\t\t\tnode.parentElement.append(\n\t\t\t\tcreateNode('i', null, ['fa-solid', ...icon, 'lil-icon', 'lil-faded']),\n\t\t\t\tlabel,\n\t\t\t);\n\t\t}\n\t}\n}\n\nfunction enable() {\n\tHooks.on('renderActorTraitSelector', manipulateTraitSelector);\n}\n\nfunction disable() {\n\tHooks.off('renderActorTraitSelector', manipulateTraitSelector);\n}\n\nnew Feature({ setting: 'enhanced-language-selection', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "import { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction discourageSourceless(sheet, html, options, shared) {\n\tif (html instanceof jQuery) html = html[0];\n\n\tif (!shared.coreSheet) return;\n\n\tconst actorData = shared.systemData;\n\n\t// Combat Tab\n\tconst combatTab = shared.tabs.combat?.tab;\n\tif (combatTab) {\n\t\tconst notes = combatTab.querySelector('.defense-notes');\n\n\t\tlet hasValues = false;\n\t\tconst inputs = notes?.querySelectorAll('textarea');\n\t\tif (inputs) {\n\t\t\tfor (const input of inputs) {\n\t\t\t\tif (input.textContent.length > 0) {\n\t\t\t\t\thasValues = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!hasValues) {\n\t\t\tnotes?.remove();\n\t\t\tconst header = combatTab.querySelector('table')?.parentElement;\n\t\t\tif (header) header.style.flex = '0';\n\t\t\tconst footer = combatTab.querySelector('.combat-defenses');\n\t\t\tif (footer) footer.style.flex = '0';\n\t\t}\n\t}\n\n\t// Skills Tab\n\tconst skillsTab = shared.tabs.skills?.tab;\n\tif (skillsTab) {\n\t\tconst bonusSkills = skillsTab.querySelector('.skill-rank-formula');\n\t\tif (actorData.details.bonusSkillRankFormula.length === 0) {\n\t\t\tbonusSkills?.remove();\n\n\t\t\t// Shuffle lock button to better position\n\t\t\tconst lockbutton = skillsTab.querySelector('.skill-lock-button');\n\t\t\tconst holder = lockbutton.parentElement;\n\n\t\t\tconst backgroundSkills = game.settings.get('pf1', 'allowBackgroundSkills');\n\t\t\tif (backgroundSkills) {\n\t\t\t\t// Background skills layout\n\t\t\t\tconst nav = skillsTab.querySelector('nav.tabs');\n\t\t\t\tconst wrapper = document.createElement('div');\n\t\t\t\twrapper.classList.add('lil-helper-skill-nav-wrapper');\n\t\t\t\tnav.before(wrapper);\n\t\t\t\twrapper.append(nav, lockbutton);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconst superholder = holder?.parentElement;\n\t\t\t\tsuperholder.append(lockbutton);\n\t\t\t\tsuperholder.style.setProperty('flex-direction', 'row');\n\t\t\t\tlockbutton.style.padding = '0.3em';\n\t\t\t\tconst prev = lockbutton.previousElementSibling;\n\t\t\t\tif (prev) prev.style.flex = '1';\n\t\t\t}\n\t\t\tlockbutton.classList.add('lil-moved-skill-lock');\n\n\t\t\t// Remove undesired elements\n\t\t\tholder.remove();\n\t\t}\n\t}\n\n\t// Spells Tab\n\tconst tab = shared.tabs.spellbook?.tab;\n\tfor (const el of tab?.querySelectorAll('.spellcasting-notes') ?? []) {\n\t\tlet emptyNotes = true;\n\t\tfor (const nel of el.querySelectorAll('textarea') ?? []) {\n\t\t\tif (nel.textContent.length > 0) emptyNotes = false;\n\t\t}\n\t\tif (emptyNotes) el.remove();\n\t}\n}\n\nfunction enable() {\n\tAncillary.register('actor', discourageSourceless);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', discourageSourceless);\n}\n\nnew Feature({ setting: 'discourage-sourceless', label: 'Discourage Sourceless', hint: 'Removes input elements for sourceless notes or bonuses that can be added in their actual sources, and adjusts layout to compensate.', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "/* eslint-disable unicorn/prefer-dom-node-text-content */\n/*\n * Warn about various bits not being there.\n */\n\nimport { CFG } from '@root/config.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { addWarning, constructWarning, unifyProficiency, createNode } from '@root/common.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} _data\n * @param {import('@root/core/shared-data.mjs').SharedData} shared\n */\nfunction missingBitsWarnings(sheet, html, _data, shared) {\n\tif (html instanceof jQuery) html = html[0];\n\n\tif (!sheet.isEditable) return;\n\tif (!shared.coreSheet) return;\n\n\tif (sheet.actor.getFlag(CFG.id, 'overrides')?.complete) return;\n\n\tconst actor = sheet.actor,\n\t\tactorData = shared.systemData;\n\n\t// FEATS\n\t/** @type {HTMLElement} */\n\tconst featTab = shared.tabs.feats?.tab;\n\n\tconst feats = actor.getFeatCount();\n\tconst active = feats.active;\n\tif (feats.max !== active) {\n\t\tconst diff = active - feats.max;\n\t\tconst featsUsed = featTab?.querySelector('.tab-footer table td');\n\t\tif (featsUsed) {\n\t\t\taddWarning(featsUsed, i18n.get('LittleHelper.Warning.FeatMismatch'));\n\t\t\tfeatsUsed.append(createNode('span', ` (${Math.abs(diff)} ${diff < 0 ? ' missing' : ' excess'})`, ['lil-diff']));\n\t\t}\n\t}\n\n\t// SKILLS\n\t// Made unnecessary with PF1v10\n\t/** @type {HTMLElement} */\n\tconst skillTab = shared.tabs.skills?.tab;\n\tif (skillTab) {\n\t\tconst srInfo = skillTab.querySelector('.skill-rank-info');\n\t\tif (srInfo) {\n\t\t\tconst skillRanksMax = srInfo.querySelector('.ranks-max'),\n\t\t\t\tskillRanksUsed = srInfo.querySelector('.ranks-used');\n\n\t\t\tconst available = parseInt(skillRanksMax.innerText, 10), used = parseInt(skillRanksUsed.innerText, 10),\n\t\t\t\tdiff = used - available;\n\t\t\tif (diff !== 0) {\n\t\t\t\taddWarning(skillRanksUsed, i18n.get('LittleHelper.Warning.SkillMismatch'));\n\t\t\t\tskillRanksUsed.append(createNode('span', ` (${Math.abs(diff)} ${diff < 0 ? ' missing' : ' excess'})`, ['lil-diff']));\n\t\t\t}\n\n\t\t\tconst bgRanksMax = srInfo.querySelector('.ranks-max-bg'),\n\t\t\t\tbgRanksUsed = bgRanksMax ? srInfo.querySelector('.ranks-used-bg') : undefined;\n\n\t\t\t// Background skills\n\t\t\tif (bgRanksUsed) {\n\t\t\t\tconst available = parseInt(bgRanksMax.innerText, 10), used = parseInt(bgRanksUsed.innerText, 10),\n\t\t\t\t\tdiff = used - available;\n\t\t\t\tif (diff !== 0) {\n\t\t\t\t\taddWarning(bgRanksUsed, i18n.get('LittleHelper.Warning.SkillMismatch'));\n\t\t\t\t\tbgRanksUsed.append(createNode('span', ` (${Math.abs(diff)} ${diff < 0 ? ' missing' : ' excess'})`, ['lil-diff']));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Unnamed skills\n\t\t\tfor (const el of skillTab?.querySelectorAll('[data-skill] .skill-name input[type=\"text\"]') ?? []) {\n\t\t\t\tif (el.value.trim().length === 0)\n\t\t\t\t\tel.closest('[data-skill]')?.classList.add('lil-missing-skill-name');\n\t\t\t}\n\t\t}\n\t}\n\n\t// UNUSED SPELLS\n\t/** @type {HTMLElement} */\n\tconst spellTab = shared.tabs.spellbook?.tab;\n\tfor (const el of spellTab?.querySelectorAll('.spell-uses .spell-slots') ?? []) {\n\t\tconst left = parseInt(el.querySelector('[data-dtype=\"Number\"]')?.textContent.trim(), 10);\n\t\tif (left < 0 || !el.classList.contains('spontaneous') && left > 0)\n\t\t\tel.classList.add('lil-warning');\n\t}\n\n\t// FCB\n\t/** @type {HTMLElement} */\n\tconst clss = shared.tabs.summary?.tab;\n\tif (clss) {\n\t\tlet fcb = 0;\n\t\tfor (const cls of shared.items.byType.class?.all ?? []) {\n\t\t\tconst { alt, hp, skill } = cls.system.fc;\n\t\t\tfcb += alt.value + hp.value + skill.value;\n\t\t};\n\n\t\tif (fcb === 0) {\n\t\t\tclss.querySelector('.classes-body .item-list-header .item-name')\n\t\t\t\t.append(\n\t\t\t\t\tcreateNode('label', 'No FCB on any class.', ['lil-warning', 'lil-box', 'lil-fcb-notification']),\n\t\t\t\t);\n\t\t}\n\t}\n\n\t// LANGUAGES\n\tconst languages = unifyProficiency(actorData.traits.languages);\n\tif (languages && !shared.isMindless) {\n\t\t// 1 (base) + 1 per Int Mod + 1 per linguistics rank\n\t\tconst minLang = actorData.abilities.int.mod + (actorData.skills.lin.rank ?? 0) + 1;\n\n\t\tif (languages.length < minLang) {\n\t\t\tconst list = shared.tabs.attributes?.tab\n\t\t\t\t?.querySelector('[data-options=\"languages\"]')\n\t\t\t\t?.closest('.form-group')\n\t\t\t\t?.querySelector('.traits-list');\n\n\t\t\tif (list) {\n\t\t\t\tlist.append(constructWarning(i18n.get('LittleHelper.Warning.TooFewLanguages', { granted: minLang, missing: minLang - languages.length })));\n\t\t\t\tlist.classList.add('lil-warning');\n\t\t\t\tlist.closest('.traits .form-group')?.classList.add('lil-warning');\n\t\t\t}\n\t\t}\n\t}\n\n\t// PROFICIENCIES\n\tconst armorProficiencies = unifyProficiency(actorData.traits.armorProf);\n\tif (armorProficiencies.length === 0) {\n\t\tconst aEl = shared.tabs.attributes?.tab\n\t\t\t?.querySelector('[for=\"system.traits.armorProf\"]')\n\t\t\t?.closest('form-group')\n\t\t\t?.querySelector('.traits-list');\n\n\t\tif (aEl) {\n\t\t\taEl.append(constructWarning(i18n.get('LittleHelper.Warning.NoArmorProf')));\n\t\t\taEl.classList.add('lil-warning');\n\t\t\taEl.closest('.traits .form-group')?.classList.add('lil-warning');\n\t\t}\n\t}\n\tconst weaponProficiencies = unifyProficiency(actorData.traits.weaponProf);\n\tif (weaponProficiencies.length === 0) {\n\t\tconst wEl = shared.tabs.attributes?.tab\n\t\t\t?.querySelector('[for=\"system.traits.weaponProf\"]')\n\t\t\t?.closest('form-group')\n\t\t\t?.querySelector('.traits-list');\n\n\t\tif (wEl) {\n\t\t\twEl.append(constructWarning(i18n.get('LittleHelper.Warning.NoWeaponProf')));\n\t\t\twEl.classList.add('lil-warning');\n\t\t\twEl.closest('.traits .form-group')?.classList.add('lil-warning');\n\t\t}\n\t}\n}\n\nfunction enable() {\n\tAncillary.register('actor', missingBitsWarnings);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', missingBitsWarnings);\n}\n\nnew Feature({ setting: 'missing-bits', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "/**\n * Warn about missing ability score links.\n */\n\nimport { CFG } from '@root/config.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { addCoreTooltip } from '@root/common.mjs';\n\nconst checkForEmpty = [\n\t'attributes.hpAbility',\n\t'attributes.init.ability',\n\t'attributes.cmbAbility',\n\t'attributes.attack.meleeAbility', // non-critical\n\t'attributes.attack.rangedAbility', // non-critical\n\t'attributes.ac.normal.ability',\n\t'attributes.ac.touch.ability',\n\t'attributes.cmd.strAbility',\n\t'attributes.cmd.dexAbility',\n\t'attributes.savingThrows.fort.ability',\n\t'attributes.savingThrows.ref.ability',\n\t'attributes.savingThrows.will.ability',\n];\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction warnMissingSettings(sheet, html, options, shared) {\n\tconst actor = sheet.actor,\n\t\tdata = shared.systemData;\n\tconst settings = html.querySelector('.sheet-navigation.tabs [data-tab=\"settings\"]');\n\t/** @type {HTMLElement} */\n\tconst tab = shared.tabs?.settings?.tab;\n\tif (!tab) return;\n\tlet badAbls = false;\n\n\tconst colors = CFG.console.colors;\n\n\tfor (const attr of checkForEmpty) {\n\t\tconst v = foundry.utils.getProperty(data, attr);\n\t\tif (!(v in data.abilities)) {\n\t\t\t// Not found\n\t\t\tconsole.log(`[%cERROR%c] %c${attr}`, colors.error, colors.unset, colors.label, { ability: v }, 'not found');\n\t\t\tconst attrEl = tab.querySelector(`[name=\"system.${attr}\"],[data-name=\"system.${attr}\"]`);\n\t\t\tattrEl.classList.add('lil-select-value');\n\t\t\tbadAbls = true;\n\t\t}\n\t}\n\n\tif (badAbls && !!settings) {\n\t\tsettings.classList.add('lil-angry-warning-glow');\n\t}\n}\n\nfunction enable() {\n\tAncillary.register('actor', warnMissingSettings);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', warnMissingSettings);\n}\n\nnew Feature({ setting: 'missing-ability-links', label: 'Unlinked Ability Scores', hint: 'Add warnings about missing ability score links.', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "// Right click popout of bio and notes tabs\n\nimport { CFG } from '@root/config.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { addCoreTooltip } from '@root/common.mjs';\n\n/* global FormApplication */\nclass BioNotesApp extends FormApplication {\n\tconstructor(actor, options) {\n\t\tsuper(actor, options);\n\n\t\tconst bio = this.options.type === 'bio';\n\t\tthis.options.id = actor.uuid + '-' + (bio ? 'bio-popout' : 'notes-popout');\n\t\tthis.options.title = actor.name + ': ' + (bio ? 'Biography' : 'Notes');\n\n\t\tactor.apps[this.appId] = this;\n\t}\n\n\tget template() {\n\t\treturn `modules/${CFG.id}/templates/bionotes-popout.hbs`;\n\t}\n\n\tstatic get defaultOptions() {\n\t\tconst options = super.defaultOptions;\n\t\treturn {\n\t\t\t...options,\n\t\t\tclasses: [...options.classes, 'koboldworks', 'bionotes', 'pf1'],\n\t\t\tresizable: true,\n\t\t\twidth: 520,\n\t\t\theight: 580,\n\t\t\tcloseOnSubmit: false,\n\t\t\tsubmitOnClose: true,\n\t\t\tsubmitOnChange: true,\n\t\t};\n\t}\n\n\tget actor() {\n\t\treturn this.object;\n\t}\n\n\tget document() {\n\t\treturn this.object;\n\t}\n\n\t/** @override */\n\tget isEditable() {\n\t\tconst actor = this.actor;\n\n\t\tlet editable = this.options.editable && actor.isOwner;\n\t\tif (actor.pack) {\n\t\t\tconst pack = game.packs.get(actor.pack);\n\t\t\tif (pack.locked) editable = false;\n\t\t}\n\t\treturn editable;\n\t}\n\n\tasync getData() {\n\t\tconst context = super.getData(),\n\t\t\tactor = this.actor,\n\t\t\tactorData = actor.system;\n\n\t\tcontext.data = actorData;\n\t\tconst bio = this.options.type === 'bio';\n\n\t\tconst rollData = actor.getRollData();\n\n\t\tcontext.raw = bio ? actorData.details.biography.value : actorData.details.notes.value;\n\t\tcontext.target = bio ? 'system.details.biography.value' : 'system.details.notes.value';\n\n\t\tcontext.enriched = await pf1.utils.enrichHTMLUnrolled(context.raw, { rollData, secrets: actor.isOwner });\n\n\t\t// field: new foundry.data.fields.HTMLField(),\n\n\t\tcontext.editable = this.isEditable;\n\n\t\treturn context;\n\t}\n\n\t_updateObject(event, formData) {\n\t\tif (!foundry.utils.isEmpty(formData))\n\t\t\tthis.actor.update(formData);\n\t}\n\n\tstatic open(actor, options) {\n\t\tconst old = Object.values(actor.apps).find(a => a instanceof BioNotesApp && a.options.type === options.type);\n\t\tif (old) old.render(true, { focus: true });\n\t\telse new BioNotesApp(actor, options).render(true, { focus: true });\n\t}\n\n\tclose(...args) {\n\t\tdelete this.actor.apps[this.appId];\n\t\tsuper.close(...args);\n\t}\n}\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n */\nfunction enableTabPopout(sheet, html) {\n\tconst actor = sheet.actor;\n\n\tconst tabs = html.querySelector('form nav.tabs[data-group=\"primary\"]');\n\n\tconst hint = 'LittleHelper.UI.PopTabHint';\n\n\tconst bio = tabs?.querySelector('[data-tab=\"biography\"');\n\tif (bio) {\n\t\taddCoreTooltip(bio, hint);\n\n\t\tbio.addEventListener('contextmenu', (event) => {\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t\tBioNotesApp.open(actor, { type: 'bio' });\n\t\t});\n\t}\n\n\tconst notes = tabs?.querySelector('[data-tab=\"notes\"]');\n\tif (notes) {\n\t\taddCoreTooltip(notes, hint);\n\n\t\tnotes.addEventListener('contextmenu', (event) => {\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t\tBioNotesApp.open(actor, { type: 'notes' });\n\t\t});\n\t}\n}\n\nfunction enable() {\n\tAncillary.register('actor', enableTabPopout);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', enableTabPopout);\n}\n\nnew Feature({ setting: 'bionotes-popout', label: 'Bio & Notes Popout', hint: 'Allow popping out bio and notes with right click on tab header.', category: 'actor-sheet', enable, disable, stage: 'ready' });\n",
    "import { CFG } from '@root/config.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\n/* global libWrapper */\n\nconst doKeen = (cr) => 21 - (21 - cr) * 2;\n\n/**\n * @param {ItemSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nconst sheetKeen = (sheet, html, options, shared) => {\n\tconst item = shared.item;\n\tconst action = shared.action;\n\n\tconst keen = item?.flags?.lilhelper?.item?.keen ?? false;\n\n\tif (!keen) return;\n\tconst crEl = html.querySelector('[name=\"ability.critRange\"],[name=\"system.ability.critRange\"]');\n\tif (crEl) {\n\t\tif (item.system.broken) {\n\t\t\tcrEl.after(createNode('span', `${i18n.get('PF1.Broken')}: 20`, ['lil-critrange-display', 'broken']));\n\t\t\treturn;\n\t\t}\n\t\tconst cr = action.ability?.critRange ?? 20;\n\t\tcrEl.after(createNode('span', `Keen: ${doKeen(cr)} â€“ 20`, ['lil-critrange-display', 'keen']));\n\t}\n};\n\nfunction keenCritRange(wrapped) {\n\tconst cr = wrapped.call(this),\n\t\titem = this.item ?? this.action?.item,\n\t\tisBroken = item.system.broken ?? false,\n\t\tkeen = item?.flags?.lilhelper?.item?.keen ?? false;\n\n\treturn !isBroken && keen ? doKeen(cr) : cr;\n}\n\nfunction enable() {\n\t// how to tell the dialog was skipped so power attack isn't enforced?\n\tconst C = CFG.console.colors;\n\tconsole.log('%cLittle Helper%c ðŸ¦Ž | Overriding ChatAttack.critRange', C.main, C.unset);\n\tlibWrapper.register(CFG.id, 'pf1.components.ItemAction.prototype.critRange', keenCritRange, libWrapper.WRAPPER);\n\n\tAncillary.register('action', sheetKeen);\n}\n\nfunction disable() {\n\tlibWrapper.unregister(CFG.id, 'pf1.components.ItemAction.prototype.critRange');\n}\n\nHooks.once('setup', enable);\n",
    "import { CFG } from '@root/config.mjs';\n\nconst POWER_ATTACK_FLAG = 'autoPowerAttack';\n\n/**\n * @param {pf1.actionUse.ActionUse} actionUse\n */\nfunction preCreateActionUse(actionUse) {\n\tconst { shared, item } = actionUse;\n\n\tconst apa = item.flags?.lilhelper?.item?.[POWER_ATTACK_FLAG] ?? false;\n\tif (apa) {\n\t\tconst C = CFG.console.colors;\n\t\tconsole.log('%cLittle Helper%c ðŸ¦Ž | Auto enabling Power Attack', C.main, C.unset);\n\t\tshared.useOptions.powerAttack ??= true;\n\t}\n}\n\nconst enable = () => {\n\tHooks.on('pf1CreateActionUse', preCreateActionUse);\n};\n\nfunction disable() {\n\tHooks.off('pf1CreateActionUse', preCreateActionUse);\n}\n\nHooks.once('setup', () => enable());\n",
    "// Configuration is set up in item config.\n\nconst forceRoll = (item, options) => {\n\tif (!options.dice) {\n\t\tconst roll = item.flags?.lilhelper?.item?.rollOverride ?? null;\n\t\tif (roll) options.dice = roll;\n\t}\n};\n\nHooks.on('little-helper.useAttackWrapper', forceRoll);\n",
    "// Configuration is set up in item config.\n\nimport { CFG } from '@root/config.mjs';\n\nconst fetchForceModeSetting = (item) => {\n\tconst rawRollMode = item.flags?.lilhelper?.item?.rollmodeOverride;\n\tif (rawRollMode) {\n\t\tlet rollMode = Object.keys(CFG.ROLLMODES).includes(rawRollMode) ? rawRollMode : null;\n\t\tif (rollMode === 'roll') rollMode = 'publicroll';\n\t\treturn rollMode ?? null;\n\t}\n\treturn null;\n};\n\nconst forceRollMode = (item, options) => {\n\tif (!options.rollMode) {\n\t\tconst mode = fetchForceModeSetting(item);\n\t\tif (mode && options.rollMode !== mode) {\n\t\t\toptions.rollMode = mode;\n\t\t}\n\t}\n};\n\nHooks.on('little-helper.useAttackWrapper', forceRollMode);\n",
    "/**\n * Hide attacks from items with `hideAttacks` boolean item flag set.\n */\n\nimport { Ancillary } from '@root/ancillary.mjs';\n\n/**\n * @param {ChatMessage} cm\n * @param {HTMLElement} html\n */\nconst hideAttacks = (cm, html) => {\n\tconst item = cm.itemSource;\n\tif (!item?.hasAttack) return; // Only the item has the required info\n\n\tconst ha = item.flags?.lilhelper?.item?.hideAttacks ?? false;\n\tif (!ha) return;\n\n\tfor (const el of html.querySelectorAll('.chat-attack td[colspan] .inline-roll.inline-result')) {\n\t\tel.closest('tr')?.remove();\n\t}\n};\n\nAncillary.register('chat', hideAttacks);\n",
    "import { Ancillary } from '@root/ancillary.mjs';\n\n/**\n * @param {ItemSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction sharedItemData(sheet, html, options, shared) {\n\t// NOP\n}\n\nAncillary.register('item', sharedItemData, { priority: 1000 });\n",
    "// Wrapper around useAttack to allow multiple functions to hook into it.\n\nimport { CFG } from '@root/config.mjs';\n\nfunction useAttackWrapper(wrapped, options = {}) {\n\tHooks.call('little-helper.useAttackWrapper', this, options);\n\treturn wrapped.call(this, options);\n}\n\nHooks.once('setup', () => {\n\tconst C = CFG.console.colors;\n\tconsole.log('%cLittle Helper%c ðŸ¦Ž | Overriding Item#use', C.main, C.unset);\n\t/* global libWrapper */\n\tlibWrapper.register(CFG.id, 'pf1.documents.item.ItemPF.prototype.use', useAttackWrapper, libWrapper.WRAPPER);\n});\n",
    "// Adds little display of what action an item uses and if it counts as action within the system\n\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\n/**\n * @param {ItemSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n */\nfunction injectActionDisplay(sheet, html, options) {\n\tconst item = sheet.item;\n\tif (!item) return;\n\n\tconst h = html.querySelector('.header-details .summary');\n\tif (!h) return; // shouldn't happen\n\n\tconst list = createNode('ul', undefined, ['lil-entry-info', 'summary']);\n\n\tHooks.callAll('little-helper.item.header.properties', sheet, list);\n\n\tif (list.childNodes.length > 0) {\n\t\th.after(list);\n\t}\n}\n\nfunction enable() {\n\tAncillary.register('item', injectActionDisplay);\n}\n\nfunction disable() {\n\tAncillary.unregister('item', injectActionDisplay);\n}\n\nnew Feature({ setting: 'item-header-enrichment', label: 'Header Enrichment', hint: 'Display more info in the item sheet header, such as used action and identified status.', category: 'items', enable, disable, stage: 'ready' });\n",
    "// Improve visibility of an item being disabled\n\nimport { createNode } from '@root/common.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\n\n/**\n * @param {ItemSheet} sheet\n * @param {HTMLElement} html\n * @param {object} opts\n * @param {SharedData} shared\n */\nfunction clarifyDisabledFeature(sheet, html, opts, shared) {\n\tconst item = sheet.document;\n\n\tif (item.isActive) return;\n\n\tconst disabled = html.querySelector('[name=\"system.disabled\"]');\n\tconst warning = createNode('i', null, ['fa-solid', 'fa-exclamation-triangle', 'warning-symbol']);\n\tconst p = disabled?.parentElement;\n\tif (!p) return;\n\tp.append(warning);\n\tp.classList.add('lil-warning-glow');\n}\n\nAncillary.register('item', clarifyDisabledFeature);\n\n// TODO: FEATURE\n",
    "import { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\n\nconst nameToIconMap = {\n\t// Enhancement\n\t'system.enh': ['ra', 'ra-fairy-wand', 'lil-icon-enhancement'],\n\t'system.armor.enh': ['ra', 'ra-fairy-wand', 'lil-icon-enhancement'],\n\t// Armor\n\t'system.armor.value': ['ra', 'ra-shield', 'lil-icon-armor'],\n\t'system.armor.acp': ['fa-solid', 'fa-mitten', 'lil-icon-acp'],\n\t// Targeting\n\t'system.target.value': ['fa-solid', 'fa-bullseye', 'lil-icon-target'],\n\t'system.range.units': ['fa-solid', 'fa-ruler', 'lil-icon-distance'],\n\t'system.area': ['fa-solid', 'fa-ruler-combined', 'lil-icon-area'],\n\t// Duration\n\t'system.duration.units': ['fa-solid', 'fa-hourglass-start', 'lil-icon-time'],\n\t'system.spellDuration': ['fa-solid', 'fa-hourglass-start', 'lil-icon-time'],\n\t// Uses\n\t'system.uses.per': ['fa-solid', 'fa-battery-half', 'lil-icon-armor'],\n\t// Attacks\n\t'system.attackBonus': ['ra', 'ra-axe-swing', 'lil-icon-attack'],\n\t'system.ability.critRange': ['ra', 'ra-decapitation', 'lil-icon-critical'],\n};\n\nfunction compatiblePathName(path) {\n\treturn /^system\\./.test(path) ? path : `system.${path}`;\n}\n\n/**\n * @param {ItemSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {object} shared\n */\nfunction extraIcons(sheet, html, options, shared) {\n\t// const item = shared.document;\n\n\tconst inputs = html.querySelectorAll('input[name],select[name]');\n\tfor (const input of inputs) {\n\t\tconst iconCss = nameToIconMap[compatiblePathName(input.name)];\n\t\tif (!iconCss) continue;\n\t\tconst label = input.closest('.form-group')?.querySelector('label');\n\t\tif (!label) continue;\n\n\t\tconst icon = document.createElement('i');\n\t\ticon.classList.add(...iconCss, 'lil-extra-icon');\n\n\t\tlabel.append(icon);\n\t}\n}\n\nfunction enable() {\n\tAncillary.register('item', extraIcons);\n\tAncillary.register('action', extraIcons);\n}\n\nfunction disable() {\n\tAncillary.unregister('item', extraIcons);\n\tAncillary.unregister('action', extraIcons);\n}\n\nnew Feature({ setting: 'extra-icons', label: 'Extra Icons', hint: 'Add extra icons to help find relevant info faster.', category: 'items', enable, disable, stage: 'ready' });\n",
    "import { createNode } from '@root/common.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { i18n } from '@utility/i18n.mjs';\n\n/**\n * @param {ItemSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction hitPointRetrainCapacity(sheet, html, options, shared) {\n\tconst item = sheet.document,\n\t\tactor = item.actor;\n\tif (!actor || item.type !== 'class') return;\n\n\tconst hd = item.hitDice,\n\t\titemData = item.system,\n\t\thp = itemData.hp,\n\t\thdSize = itemData.hd,\n\t\tmaxHp = hdSize * hd,\n\t\tmissing = maxHp - hp;\n\n\tif (missing <= 0) return;\n\n\tconst hpEl = html.querySelector('input[name=\"system.hp\"]');\n\tif (!hpEl) return;\n\n\thpEl.after(createNode('label', i18n.get('LittleHelper.Info.RetrainPotential', { missing, max: maxHp }), ['lil-retrain-capacity', 'hit-points']));\n}\n\nfunction enable() {\n\tAncillary.register('item', hitPointRetrainCapacity);\n}\n\nfunction disable() {\n\tAncillary.unregister('item', hitPointRetrainCapacity);\n}\n\nnew Feature({ setting: 'class-hitpoint-retrain-capacity', label: 'Hit Point Retrain Potential', hint: 'Display how much hit points could be retrained.', category: 'items', enable, disable, stage: 'ready' });\n",
    "import { Feature } from '@core/feature.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { getHumanTime, humanTimeUnit } from '@root/common.time.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nconst line = (selectors) => createNode('li', null, ['item-detail', ...selectors]);\n\n/**\n * @param {ItemSheet} sheet\n * @param {HTMLElement} props\n */\nasync function addBuffDuration(sheet, props) {\n\tconst item = sheet.item;\n\n\tif (!item.isActive) return;\n\tif (item.type !== 'buff') return;\n\n\tconst durLine = line(['lil-property', 'duration']);\n\n\tconst ae = item.effect;\n\tif (!ae) return;\n\n\tconst s = ae.duration?.seconds ?? 0;\n\n\tconst ht = getHumanTime(s);\n\tconst tt = s > 0 ? ht.n : 'Infinite';\n\tconst tu = s > 0 ? humanTimeUnit[ht.u]?.long : '';\n\tdurLine.append(i18n.get('PF1.EnrichedText.Condition.Duration', { period: tt, unit: tu }));\n\n\tprops.append(durLine);\n\n\tif (s <= 0) return;\n\n\tconst { n, u } = getHumanTime(ae.duration.remaining);\n\tconst remLine = line(['lil-property', 'remaining']);\n\tremLine.append(i18n.get('Koboldworks.Missing.PF1.DurationLeft', { time: n, unit: humanTimeUnit[u].long }));\n\tprops.append(remLine);\n\t// TODO: Some kind of autoupdate?\n}\n\nfunction enable() {\n\tHooks.on('little-helper.item.header.properties', addBuffDuration);\n}\n\nfunction disable() {\n\tHooks.off('little-helper.item.header.properties', addBuffDuration);\n}\n\nnew Feature({ setting: 'buff-item-duration-display', label: 'Buff Duration Display', hint: 'Displays remaining duration in buff item sheet. This is NOT updated except on sheet re-open. Requires header enrichment to be enabled.', category: 'items', enable, disable, stage: 'ready' });\n",
    "import { CFG } from '@root/config.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { hookCoreTooltip } from '@core/tooltip.mjs';\n\nfunction addWarning(el, text) {\n\tconst n = createNode('i', undefined, ['fa-solid', 'fa-exclamation-triangle', 'lil-warning-icon']);\n\tif (text) hookCoreTooltip(n, { fn: () => text });\n\tel.before(n);\n}\n\nfunction missingActionBits(doc, html, shared) {\n\tconst data = shared.systemData;\n\n\t// Ammo type missing with uses ammuniton selected\n\tif (data.usesAmmo && !data.ammoType) {\n\t\tconst type = html.querySelector('select[name=\"ammoType\"],select[name=\"system.ammoType\"]');\n\t\tif (type) {\n\t\t\taddWarning(type, 'Missing selection with ammo usage enabled.');\n\t\t\ttype.classList.add('lil-missing-input');\n\t\t}\n\t}\n\n\tif (!data.range?.units) {\n\t\tconst rng = html.querySelector('select[name=\"range.units\"],select[name=\"system.range.units\"]');\n\t\tif (rng) {\n\t\t\taddWarning(rng, 'No range defined.');\n\t\t\trng.classList.add('lil-missing-input');\n\t\t}\n\t}\n\n\tif (data.actionType === 'save' && data.save.dc == 0) {\n\t\tconst dc = html.querySelector('input[name=\"save.dc\"],input[name=\"system.save.dc\"]');\n\t\tif (dc) {\n\t\t\taddWarning(dc, 'Missing saving throw DC.');\n\t\t\tdc.classList.add('lil-missing-input');\n\t\t}\n\t}\n\n\tconst sdc = data.save?.dc;\n\tif (['save', 'spellsave'].includes(data.actionType) || sdc !== undefined && sdc != 0) {\n\t\tconst type = data.save?.type;\n\t\tif (type !== undefined && type == 0) {\n\t\t\tconst st = html.querySelector('select[name=\"save.type\"],select[name=\"system.save.type\"]');\n\t\t\tif (st) {\n\t\t\t\taddWarning(st, 'No save type selected.');\n\t\t\t\tst.classList.add('lil-missing-input');\n\t\t\t}\n\t\t}\n\t\tconst desc = data.save?.description;\n\t\tif (desc !== undefined && desc == 0) {\n\t\t\tconst sd = html.querySelector('input[name=\"save.description\"],input[name=\"system.save.description\"]');\n\t\t\tif (sd) {\n\t\t\t\taddWarning(sd, 'No save effect defined.');\n\t\t\t\tsd.classList.add('lil-missing-input');\n\t\t\t}\n\t\t}\n\t}\n\n\t// Measure Templates\n\tif (data.measureTemplate !== undefined && data.measureTemplate.type != 0) {\n\t\tif (data.measureTemplate.size === 0) {\n\t\t\tconst mts = html.querySelector('input[name=\"measureTemplate.size\"],input[name=\"system.measureTemplate.size\"]');\n\t\t\tif (mts) {\n\t\t\t\taddWarning(mts, 'No template size defined.');\n\t\t\t\tmts.classList.add('lil-missing-input');\n\t\t\t}\n\t\t}\n\n\t\tif (data.measureTemplate.customColor == 0) {\n\t\t\tconst mcc = html.querySelector('input[name=\"measureTemplate.customColor\"],input[name=\"system.measureTemplate.customColor\"]');\n\t\t\tif (mcc) {\n\t\t\t\taddWarning(mcc, 'No override color defined.');\n\t\t\t\tmcc.classList.add('lil-missing-input');\n\t\t\t}\n\t\t}\n\n\t\tif (data.measureTemplate.customTexture == 0) {\n\t\t\tconst mct = html.querySelector('input[name=\"measureTemplate.customTexture\"],input[name=\"system.measureTemplate.customTexture\"]');\n\t\t\tif (mct) {\n\t\t\t\taddWarning(mct, 'No override texture defined.');\n\t\t\t\tmct.classList.add('lil-missing-input');\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * @param {ItemSheet|ActionSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction missingItemBits(sheet, html, options, shared) {\n\tconst data = shared.systemData,\n\t\tdoc = shared.document;\n\n\tconst isRealAction = doc instanceof pf1.components.ItemAction;\n\tconst isAction = doc instanceof pf1.components.ItemAction;\n\tif (isAction) missingActionBits(doc, html, shared);\n\n\tif (!isRealAction) {\n\t\t// Unidentified item stuff\n\t\tconst docData = shared.systemData;\n\n\t\t/** @type {HTMLElement} */\n\t\tconst tab = shared.tabs.description?.tab;\n\t\tif (!tab) return;\n\n\t\tif (docData.identified === false && game.user.isGM) {\n\t\t\tconst unIdentDesc = docData.description?.unidentified || '';\n\n\t\t\tif (unIdentDesc.length === 0) {\n\t\t\t\tconst uin = tab.querySelector('.sheet-navigation.subtabs [data-tab=\"unidentified\"]');\n\t\t\t\tuin?.append('Â ', createNode('span', '(n/a)', ['lil-not-described', 'lil-unidentified-warning']));\n\t\t\t}\n\n\t\t\tconst unIdentPrice = docData.unidentified?.price || 0;\n\t\t\tif (unIdentPrice == 0) {\n\t\t\t\tconst uip = tab.querySelector('[data-attr-name=\"system.unidentified.price\"]')?.firstElementChild;\n\t\t\t\tuip?.classList.add('lil-not-priced', 'lil-unidentified-warning');\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction enable() {\n\tAncillary.register('item', missingItemBits);\n\tAncillary.register('action', missingItemBits);\n}\n\nfunction disable() {\n\tAncillary.unregister('item', missingItemBits);\n\tAncillary.unregister('action', missingItemBits);\n}\n\nnew Feature({ setting: 'missing-item-bits', label: 'Missing Bits', hint: 'Add warnings about missing bits.', category: 'items', enable, disable, stage: 'ready' });\n",
    "import { Ancillary } from '@root/ancillary.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { createNode, signNum } from '@root/common.mjs';\nimport { SharedData } from '@core/shared-data.mjs';\n\nfunction createValue(value) {\n\tconst c = createNode('label', null, ['lil-resolved-value']);\n\tc.append('=', createNode('span', value, ['value']));\n\treturn c;\n}\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction resolveActorValues(sheet, html, options, shared) {\n\tconst actor = sheet.actor;\n\tif (!['character', 'npc'].includes(actor.type)) return;\n\tif (!shared.coreSheet && !shared.altSheetZenvy) return; // Ignore most alt sheets\n\tconst rollData = shared.rollData;\n\n\t/** @type {HTMLElement} */\n\tconst bookTab = shared.tabs.spellbook?.tab;\n\tif (bookTab) {\n\t\tfor (const el of bookTab.querySelectorAll('.spellcasting-ability select[name]')) {\n\t\t\tconst abl = el.value;\n\t\t\tconst mod = rollData.abilities[abl]?.mod;\n\t\t\tif (Number.isFinite(mod)) {\n\t\t\t\tconst value = createValue(`${signNum(mod)}`);\n\t\t\t\tel.after(value);\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * @param {ItemSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction resolveItemValues(sheet, html, options, shared) {\n\tif (!shared.systemDocument) return;\n\tconst data = shared.systemData;\n\tconst actor = shared.actor;\n\tif (!actor) return;\n\tconst rollData = shared.rollData;\n\n\t// ATTACK ABILITY\n\tif (data.ability?.attack) {\n\t\tconst ablAtk = html.querySelector('[name=\"ability.attack\"],[name=\"system.ability.attack\"]');\n\t\tconst mod = rollData.abilities[data.ability?.attack].mod;\n\t\tconst value = createValue(signNum(mod));\n\t\tablAtk?.after(value);\n\t}\n\n\t// ABILITY DAMAGE\n\tif (data.ability?.damage) {\n\t\tconst ablMult = html.querySelector('[name=\"ability.damageMult\"],[name=\"system.ability.damageMult\"]');\n\t\tconst abl = data.ability?.damage,\n\t\t\tmult = data.ability?.damageMult,\n\t\t\tmod = rollData.abilities[abl].mod;\n\t\tconst value = createValue(signNum(Math.floor(mod * mult)));\n\t\tablMult?.after(value);\n\t}\n\n\t// RANGE\n\tconst rngUnits = rollData.action?.range?.units ?? rollData.item.range?.units;\n\tif (['melee', 'reach'].includes(rngUnits)) {\n\t\tconst rng = html.querySelector('[name=\"range.units\"],[name=\"system.range.units\"]');\n\t\trng?.after(createValue(rollData.range[rngUnits]));\n\t}\n\n\tconst rngMinUnits = rollData.action?.range?.minUnits ?? rollData.item.range?.minUnits;\n\tif (['melee', 'reach'].includes(rngMinUnits)) {\n\t\tconst rng = html.querySelector('[name=\"range.minUnits\"],[name=\"system.range.minUnits\"]');\n\t\trng?.after(createValue(rollData.range[rngMinUnits]));\n\t}\n\n\t// const pwAtk = html.querySelector('[name=\"powerAttack.multiplier\"]');\n}\n\nfunction enable() {\n\tAncillary.register('action', resolveItemValues);\n\tAncillary.register('item', resolveItemValues);\n\tAncillary.register('actor', resolveActorValues);\n}\n\nfunction disable() {\n\tAncillary.unregister('action', resolveItemValues);\n\tAncillary.unregister('item', resolveItemValues);\n\tAncillary.unregister('actor', resolveActorValues);\n}\n\nnew Feature({ setting: 'resolve-values', label: 'Resolve Values', hint: 'Resolves some indirect values to their actual numbers.', category: 'common', enable, disable, stage: 'ready' });\n",
    "import { CFG } from '@root/config.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { createNode } from '@root/common.mjs';\n\n/**\n * @param {ItemSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction addNoActionWarning(sheet, html, options, shared) {\n\tconst item = shared.document,\n\t\titemData = shared.systemData;\n\n\tif (itemData.actions === undefined) return;\n\tif (itemData.actions.length > 0) return;\n\n\tconst actions = html.querySelector('.actions .action-parts');\n\tactions?.append(createNode('div', 'No Actions', ['warning', 'no-actions']));\n}\n\nfunction enable() {\n\tAncillary.register('item', addNoActionWarning);\n}\n\nenable();\n",
    "import { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\n\n/**\n * @param {ItemSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction disableUnusuableDetails(sheet, html, options, shared) {\n\tconst item = sheet.document;\n\n\tconst inner = html.querySelector('section');\n\n\tconst disable = [];\n\tif (item.spellbook) {\n\t\tconst spellPoints = item.spellbook.spellPoints?.useSystem ?? false;\n\t\tconst isPrepared = item.spellbook.spellPreparationMode !== 'spontaneous';\n\t\tdisable.push({\n\t\t\tenabled: spellPoints,\n\t\t\tselectors: [\n\t\t\t\t'[name=\"system.preparation.preparedAmount\"]',\n\t\t\t\t'[name=\"system.preparation.maxAmount\"]',\n\t\t\t\t'[name=\"system.slotCost\"]',\n\t\t\t],\n\t\t}, {\n\t\t\tenabled: !spellPoints && isPrepared,\n\t\t\tselectors: ['[name=\"system.spellPoints.cost\"]'],\n\t\t});\n\t}\n\n\tdisable.push({\n\t\tenabled: !!item.links.charges,\n\t\tselectors: [\n\t\t\t'[name=\"system.uses.maxFormula\"]',\n\t\t\t'[name=\"system.uses.per\"]',\n\t\t\t'[name=\"system.uses.value\"]',\n\t\t],\n\t});\n\n\tfor (const r of disable) {\n\t\tif (!r.enabled) continue;\n\t\tfor (const s of r.selectors) {\n\t\t\tconst sel = inner.querySelector(s);\n\t\t\tif (sel) {\n\t\t\t\tsel.disabled = true;\n\t\t\t\tsel.readOnly = true;\n\t\t\t\tconst p = sel.parentElement;\n\t\t\t\tp.classList.add('lil-disabled');\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction enable() {\n\tAncillary.register('item', disableUnusuableDetails);\n}\n\nfunction disable() {\n\tAncillary.unregister('item', disableUnusuableDetails);\n}\n\nnew Feature({ setting: 'item-disable-unusable-details', label: 'Disable unusable details', hint: 'Disables/removes details from item sheet that are not usable with their current configuration.', category: 'items', enable, disable, stage: 'ready' });\n",
    "function skipDialogOnUse(item, options) {\n\tconst skip = item.flags?.lilhelper?.item?.skipDialog ?? 0; // 0 = default, 1 = show, -1 = hide\n\tif (skip < 0) options.skipDialog = true;\n\telse if (skip > 0) options.skipDialog = false;\n}\n\nHooks.on('little-helper.useAttackWrapper', skipDialogOnUse);\n",
    "import { CFG } from '@root/config.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { FAIcons } from '@core/icons.mjs';\nimport { addCoreTooltip } from '@root/common.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\n/**\n * @param {ItemSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction renderItemSheet(sheet, html, options, shared) {\n\t// const pv = sheet.__littleHelper?.unidentifiedView ?? false;\n\tconst app = html.closest('.app[data-appid]');\n\tconst button = app?.querySelector('header > .little-helper-unidentified-view');\n\tif (button) addCoreTooltip(button, 'Unidentified View');\n}\n\n/**\n * @param {ItemSheet} sheet\n * @param {object[]} buttons\n */\nfunction addViewToggle(sheet, buttons) {\n\tif (sheet.item.system.identified) return;\n\tif (sheet.item.system.identified === undefined) return;\n\n\tconst C = CFG.console.colors;\n\n\tbuttons.unshift({\n\t\tclass: 'little-helper-unidentified-view',\n\t\ticon: FAIcons.eyeSlash,\n\t\t// label: i18n.get('LittleHelper.UI.RefreshButton'),\n\t\tonclick: () => {\n\t\t\tconst pv = sheet.__littleHelper?.unidentifiedView ?? false;\n\t\t\tif (pv) {\n\t\t\t\tconsole.log('%cLittle Helper%c ðŸ¦Ž | Returning to Normal View', C.main, C.unset);\n\t\t\t\tdelete sheet.__littleHelper.unidentifiedView;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconsole.log('%cLittle Helper%c ðŸ¦Ž | Swapping to unidentified View', C.main, C.unset);\n\t\t\t\tsheet.__littleHelper ??= {};\n\t\t\t\tsheet.__littleHelper.unidentifiedView = true;\n\t\t\t}\n\t\t\tsheet.render(false, { __lilUnidentifiedView: !pv });\n\t\t},\n\t});\n}\n\nasync function getDataWrapper(wrapped, ...args) {\n\tconst rv = await wrapped.call(this, ...args);\n\tconst pv = this.__littleHelper?.unidentifiedView ?? false;\n\n\tif (pv) {\n\t\trv.isGM = false;\n\n\t\tconst isIdentified = rv.system.identified;\n\n\t\trv.showUnidentifiedData = true;\n\t\trv.showIdentifyDescription = false;\n\n\t\t// Mess with the data since it is not reliant on the above toggles always\n\t\trv.itemName = rv.system.unidentified.name;\n\t\trv.descriptionAttributes = rv.descriptionAttributes.filter(d => {\n\t\t\tswitch (d.name) {\n\t\t\t\tcase 'system.unidentified.price':\n\t\t\t\t\td.label = i18n.get('PF1.Price');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'system.price':\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\t}\n\n\treturn rv;\n}\n\nfunction renderWrapper(wrapped, force, options = {}) {\n\tif (game.user.isGM) {\n\t\tthis.__littleHelper ??= {};\n\t\tthis.__littleHelper.unidentifiedView = options.__lilUnidentifiedView ?? false;\n\t}\n\treturn wrapped.call(this, force, options);\n}\n\n/* global libWrapper */\n\nfunction enable() {\n\tif (!game.user.isGM) return;\n\tAncillary.register('item', renderItemSheet);\n\n\tHooks.on('getItemSheetHeaderButtons', addViewToggle);\n\n\tlibWrapper.register(CFG.id, 'pf1.applications.item.ItemSheetPF.prototype.render', renderWrapper, libWrapper.WRAPPER);\n\tlibWrapper.register(CFG.id, 'pf1.applications.item.ItemSheetPF.prototype.getData', getDataWrapper, libWrapper.WRAPPER);\n}\n\nfunction disable() {\n\tif (!game.user.isGM) return;\n\tAncillary.unregister('item', renderItemSheet);\n\n\tHooks.off('getItemSheetHeaderButtons', addViewToggle);\n\n\tlibWrapper.unregister(CFG.id, 'pf1.applications.item.ItemSheetPF.prototype.render', renderWrapper);\n\tlibWrapper.unregister(CFG.id, 'pf1.applications.item.ItemSheetPF.prototype.getData', getDataWrapper);\n}\n\nnew Feature({ setting: 'item-unidentified-view', label: 'Simulated Unidentified View', hint: 'Adds header button to items to toggle partially simulated unidentified view of the item, as player would see it.', category: 'items', enable, disable, stage: 'ready', gm: true });\n",
    "import { Feature } from '@core/feature.mjs';\nimport { createNode, maxPrecision, clampNum } from '@root/common.mjs';\nimport { hookCoreTooltip } from '@core/tooltip.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\n// eslint-disable-next-line unicorn/no-static-only-class\nclass Pricing {\n\tstatic forWand(sl, cl, mcost = 0, uses = 50) {\n\t\treturn 750 * clampNum(sl, 0.5, 9) * clampNum(cl, 1, 100) + (mcost * uses);\n\t}\n\n\tstatic forWandFormula() {\n\t\treturn '750 * @sl * @cl + (@materials * @uses)';\n\t}\n\n\tstatic forPotion(sl, cl, mcost = 0) {\n\t\treturn 50 * clampNum(sl, 0.5, 9) * clampNum(cl, 1, 100) + mcost;\n\t}\n\n\tstatic forPotionFormula() {\n\t\treturn '50 * @sl * @cl + @materials';\n\t}\n\n\tstatic forScroll(sl, cl, mcost = 0) {\n\t\treturn 25 * clampNum(sl, 0.5, 9) * clampNum(cl, 1, 100) + mcost;\n\t}\n\n\tstatic forScrollFormula() {\n\t\treturn '25 * @sl * @cl + @materials';\n\t}\n\n\tstatic forScribing(sl, _cl) {\n\t\treturn Math.max(5, Math.pow(sl, 2) * 10);\n\t}\n\n\tstatic forScribingFormula() {\n\t\treturn '@sl ^ 2 * 10';\n\t}\n}\n\n/**\n * @param {Dialog} app\n */\nfunction enrichCreateConsumable(app) {\n\tif (!app.options.classes.includes('create-consumable')) return;\n\n\tconst html = app.element.querySelector('form');\n\n\tconst allowScribing = !!app.options.buttons.spell;\n\n\tconst content = html.querySelector('.dialog-content'),\n\t\tbuttons = html.querySelector('footer');\n\n\tconst d = createNode('div', null, ['flexrow', 'lil-consumable-cost']);\n\tconst scribeCost = createNode('span', '0', ['value']),\n\t\tpotionCost = createNode('span', '0', ['value']),\n\t\tscrollCost = createNode('span', '0', ['value']),\n\t\twandCost = createNode('span', '0', ['value']);\n\n\tconst bPot = buttons.querySelector('button[data-action=\"potion\"]'),\n\t\tbScrl = buttons.querySelector('button[data-action=\"scroll\"]'),\n\t\tbWand = buttons.querySelector('button[data-action=\"wand\"]'),\n\t\tbSpl = buttons.querySelector('button[data-action=\"spell\"]');\n\n\tconst inSL = content?.querySelector('input[name=\"sl\"]'),\n\t\tinCL = content?.querySelector('input[name=\"cl\"]');\n\n\tconst itemData = app.options?.itemData ?? {};\n\n\t// Material cost\n\tconst mcost = Number(itemData.system?.materials?.gpValue || 0);\n\n\tlet cl = 0, sl = 0;\n\tfunction updateValues() {\n\t\tcl = parseInt(inCL.value) || 1;\n\t\tsl = parseInt(inSL.value);\n\t\tif (!Number.isFinite(sl)) sl = 1;\n\n\t\tpotionCost.textContent = `${Pricing.forPotion(sl, cl, mcost)}`;\n\t\tscrollCost.textContent = `${Pricing.forScroll(sl, cl, mcost)}`;\n\t\tconst wcost = Pricing.forWand(sl, cl, mcost);\n\t\twandCost.textContent = `${wcost}`;\n\t\tscribeCost.textContent = `${Pricing.forScribing(sl, cl)}`;\n\n\t\tconst notPot = sl > 3;\n\t\tbPot.classList.toggle('impossible', notPot);\n\t}\n\n\tconst scribeCostL = createNode('h4', ' gp', ['scroll', 'cost', 'type']),\n\t\tpotionCostL = createNode('h4', ' gp', ['potion', 'cost', 'type']),\n\t\twandCostL = createNode('h4', ' gp', ['wand', 'cost', 'type']),\n\t\tscrollCostL = createNode('h4', ' gp', ['scribe', 'cost', 'type']);\n\n\thookCoreTooltip(potionCostL, { fn: () => Pricing.forPotionFormula() });\n\tif (allowScribing) hookCoreTooltip(scribeCostL, { fn: () => i18n.get('LittleHelper.Scribing') + '<br>' + Pricing.forScribingFormula() });\n\tconst wcostChL = i18n.get('PF1.PricePerCharge');\n\thookCoreTooltip(wandCostL, {\n\t\tfn: () => {\n\t\t\tconst wcost = Pricing.forWand(sl, cl, mcost);\n\t\t\treturn Pricing.forWandFormula() + `<br>${wcostChL}: ${maxPrecision(wcost / 50, 2)}`;\n\t\t},\n\t});\n\n\thookCoreTooltip(scrollCostL, { fn: () => Pricing.forScrollFormula() });\n\tscrollCostL.prepend(scrollCost);\n\n\tif (allowScribing) scribeCostL.prepend(scribeCost);\n\tpotionCostL.prepend(potionCost);\n\twandCostL.prepend(wandCost);\n\n\tif (mcost > 0) {\n\t\tconst mcostEl = createNode('div', null, ['lil-material-cost']);\n\t\tmcostEl.classList.add('form-group');\n\t\tmcostEl.append(\n\t\t\tcreateNode('label', 'Material Cost'),\n\t\t\tcreateNode('span', `${mcost} gp`, ['value']),\n\t\t);\n\t\tcontent.append(mcostEl);\n\t}\n\n\td.append(potionCostL, scrollCostL, wandCostL);\n\tif (allowScribing) d.append(scribeCostL);\n\tcontent.append(d);\n\n\tfor (const el of [inSL, inCL]) el.addEventListener('change', updateValues, { passive: true });\n\n\tupdateValues();\n\n\t// Resize to fit modifications\n\tsetTimeout(() => app.setPosition({ height: 'auto' }), 100);\n}\n\nfunction enable() {\n\tHooks.on('renderDialogV2', enrichCreateConsumable);\n}\n\nfunction disable() {\n\tHooks.off('renderDialogV2', enrichCreateConsumable);\n}\n\nnew Feature({ setting: 'enrich-create-consumable', label: 'Enrich Create Consumable', hint: 'Displays expected item cost in the consumable creation dialog.', category: 'dialog', enable, disable, stage: 'ready' });\n",
    "import { Feature } from '@core/feature.mjs';\nimport { createNode, signNum } from '@root/common.mjs';\n\nfunction getSources(actor, abl) {\n\treturn pf1.documents.actor.changes\n\t\t.getHighestChanges(actor.changes.filter(c => c.target === abl), { ignoreTarget: true })\n\t\t.sort((a, b) => a.priority - b.priority);\n}\n\nfunction updateTotal(d) {\n\tlet bonus = 0;\n\tfor (const c of d.sources) {\n\t\tif (c.operator !== 'add') continue;\n\t\tbonus += c.value;\n\t}\n\n\td.bonus.textContent = signNum(bonus);\n\n\tconst total = d.base + bonus;\n\td.total.textContent = `${total}`;\n\n\tconst mod = pf1.utils.getAbilityModifier(total);\n\td.mod.textContent = signNum(mod);\n}\n\n/**\n * @param {Application} app\n * @param {HTMLElement} html\n * @param {object} options\n */\nfunction enrichPointBuy(app, html, options) {\n\tconst abilities = {};\n\n\tconst actor = app.document;\n\n\thtml = html.querySelector('.window-content');\n\n\tapp.element.classList.add('lil-enriched-pointbuy');\n\n\tfor (const el of html.querySelectorAll('li[data-ability]')) {\n\t\tconst abl = el.dataset.ability;\n\t\tconst d = abilities[abl] = {\n\t\t\tkey: abl,\n\t\t\tdata: actor.system.abilities[abl],\n\t\t\tget base() {\n\t\t\t\treturn app.abilities.find(i => i.key === abl).value;\n\t\t\t},\n\t\t\tli: el,\n\t\t\tbonus: createNode('span', '0', ['lil-ability-bonus'], { tooltip: 'Bonuses' }),\n\t\t\ttotal: createNode('span', '00', ['lil-ability-total'], { tooltip: 'Total' }),\n\t\t\tmod: createNode('span', '0', ['lil-ability-mod'], { tooltip: 'Modifier' }),\n\t\t\tt: undefined,\n\t\t\tget sources() {\n\t\t\t\treturn getSources(actor, abl);\n\t\t\t},\n\t\t};\n\n\t\tconst abs = createNode('div', undefined, ['ability-setup']);\n\t\tconst v = el.querySelector('.value');\n\n\t\tv.previousElementSibling.before(abs);\n\t\tabs.append(\n\t\t\tv.previousElementSibling,\n\t\t\tv,\n\t\t\tv.nextElementSibling,\n\t\t);\n\n\t\tif (pf1.config.abilityCost[d.base] === undefined) {\n\t\t\tv.classList.add('lil-out-of-range');\n\t\t}\n\n\t\tconst final = createNode('div', undefined, ['lil-ability-total-holder']);\n\t\tfinal.append(d.total, d.mod);\n\t\tel.append(d.bonus, final);\n\n\t\tupdateTotal(abilities[abl]);\n\t}\n}\n\nfunction enable() {\n\tHooks.on('renderPointBuyCalculator', enrichPointBuy);\n}\n\nfunction disable() {\n\tHooks.off('renderPointBuyCalculator', enrichPointBuy);\n}\n\nnew Feature({ setting: 'pointbuy-enricher', label: 'Point Buy Enricher', hint: 'Enriches point buy calculator with currently active bonuses and displays final ability score and its bonus.', category: 'dialog', enable, disable, stage: 'ready' });\n",
    "import { CFG } from '@root/config.mjs';\nimport { Feature } from '@root/core/feature.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\nimport { formatNum } from '@root/common.mjs';\n\n/* global Application */\nclass XPChartDialog extends Application {\n\tconstructor(app, options) {\n\t\tsuper(options);\n\n\t\tthis.configDialog = app;\n\n\t\tthis._onRender = this.render.bind(this);\n\t\tHooks.on('renderExperienceConfig', this._onRender);\n\t}\n\n\tclose(...args) {\n\t\tHooks.off('renderExperienceConfig', this._onRender);\n\t\tsuper.close(...args);\n\t}\n\n\tget template() {\n\t\treturn `modules/${CFG.id}/templates/dialog/xp-chart.hbs`;\n\t}\n\n\tstatic get defaultOptions() {\n\t\tconst options = super.defaultOptions;\n\t\treturn {\n\t\t\t...options,\n\t\t\ttitle: i18n.get('LittleHelper.XPTable.Short'),\n\t\t\tid: 'lil-xp-chart',\n\t\t\tclasses: [...options.classes, 'pf1', 'lil-xp-chart'],\n\t\t\theight: 'auto',\n\t\t\twidth: 'auto',\n\t\t};\n\t}\n\n\tgetData() {\n\t\tlet html = this.configDialog.element;\n\t\tif (html instanceof jQuery) html = html[0];\n\n\t\tconst track = html.querySelector('select[name=\"track\"]').value;\n\t\tconst custom = html.querySelector('input[name=\"custom.formula\"]')?.value || '';\n\n\t\tlet trackXp = pf1.config.CHARACTER_EXP_LEVELS[track]?.map(i => ({ total: i }));\n\n\t\tif (trackXp) {\n\t\t\t// Calculate XP increment\n\t\t\tfor (let i = 19; i >= 0; i--) {\n\t\t\t\tconst entry = trackXp[i];\n\t\t\t\tconst prev = trackXp[i - 1] ?? { total: 0, value: 0 };\n\t\t\t\tentry.value = entry.total - prev.total;\n\t\t\t}\n\t\t}\n\t\t// custom\n\t\telse {\n\t\t\ttrackXp = Array.fromRange(20).map(idx => ({ value: RollPF.safeRollSync(custom || '0', { level: idx + 1 }).total }));\n\t\t\ttrackXp[0].value = 0; // Level 1 does not require XP\n\t\t\t// Calculate cumulative XP\n\t\t\tfor (let i = 0; i < 20; i++) {\n\t\t\t\tconst prev = trackXp[i - 1] ?? { total: 0 };\n\t\t\t\tconst cur = trackXp[i];\n\t\t\t\tcur.total = prev.total + cur.value;\n\t\t\t}\n\t\t}\n\n\t\t// Calculate percentage\n\t\tfor (let i = 1; i < 20; i++) {\n\t\t\tconst t = trackXp[i];\n\t\t\tt.level = i + 1;\n\t\t\tconst p = trackXp[i - 1] ?? { value: 0 };\n\t\t\tt.pct = pf1.utils.limitPrecision((t.value / p.value) * 100 - 100, 1);\n\t\t\tif (!Number.isFinite(t.pct)) t.pct = null;\n\t\t}\n\n\t\ttrackXp.splice(0, 1); // Remove level which has no interesting data\n\n\t\t// Pretty format numbers\n\t\tfor (const t of trackXp) {\n\t\t\tt.total = formatNum(t.total);\n\t\t\tt.value = formatNum(t.value);\n\t\t}\n\n\t\treturn {\n\t\t\ttrack: trackXp,\n\t\t};\n\t}\n}\n\nfunction injectXPChart(app, html) {\n\tif (html instanceof jQuery) html = html[0];\n\n\tconst track = html.querySelector('select[name=\"track\"]');\n\n\tconst i = document.createElement('i');\n\ti.classList.add('fa-solid', 'fa-table', 'fa-fw', 'lil-xp-chart');\n\ti.dataset.action = 'open-xp-chart';\n\ti.dataset.tooltip = 'LittleHelper.XPTable.Title';\n\ttrack.before(i);\n\n\ti.addEventListener('click', (ev) => {\n\t\tev.preventDefault();\n\n\t\tconst xpcapp = new XPChartDialog(app);\n\t\txpcapp.render(true);\n\t});\n}\n\nfunction enable() {\n\tHooks.on('renderExperienceConfig', injectXPChart);\n}\n\nfunction disable() {\n\tHooks.off('renderExperienceConfig', injectXPChart);\n}\n\nnew Feature({ setting: 'xp-chart', category: 'dialog', enable, disable, stage: 'ready' });\n",
    "import { CFG } from '@root/config.mjs';\nimport { Feature } from '@root/core/feature.mjs';\nimport { FAIcons } from '@root/core/icons.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nconst STATUS = {\n\terror: -1,\n\tinprogress: 1,\n\tunlocking: 11,\n\tlocking: 12,\n\tfinished: 2,\n\tdefault: 0,\n};\n\nconst MSG = {\n\t[STATUS.error]: 'LittleHelper.Action.Migration.Status.Error',\n\t[STATUS.inprogress]: 'LittleHelper.Action.Migration.Status.InProgress',\n\t[STATUS.locking]: 'LittleHelper.Action.Migration.Status.Locking',\n\t[STATUS.unlocking]: 'LittleHelper.Action.Migration.Status.Unlocking',\n\t[STATUS.finished]: 'LittleHelper.Action.Migration.Status.Finished',\n};\n\nconst ICON = {\n\t[STATUS.error]: 'âœ˜',\n\t[STATUS.inprogress]: 'â²',\n\t[STATUS.locking]: 'ðŸ”’',\n\t[STATUS.unlocking]: 'ðŸ”“',\n\t[STATUS.finished]: 'âœ”',\n};\n\nconst { ApplicationV2, HandlebarsApplicationMixin } = foundry.applications.api;\n\nclass MigrationDialog extends HandlebarsApplicationMixin(ApplicationV2) {\n\t/** @type {Compendium} */\n\tget pack() { return this.options.pack; }\n\n\tstatic DEFAULT_OPTIONS = {\n\t\tid: 'lil-compendium-migration-{id}',\n\t\tclasses: ['lil-compendium-migration'],\n\t\twindow: {\n\t\t\ticon: 'fa-solid fa-soap',\n\t\t},\n\t};\n\n\t_initializeApplicationOptions(options) {\n\t\toptions = super._initializeApplicationOptions(options);\n\n\t\toptions.uniqueId = options.pack.metadata.id;\n\n\t\treturn options;\n\t}\n\n\tget title() {\n\t\treturn `Migrating Compendium: ${i18n.get(this.pack.title)}`;\n\t}\n\n\tstatic PARTS = {\n\t\tmain: {\n\t\t\ttemplate: `modules/${CFG.id}/templates/compendium-migration.hbs`,\n\t\t},\n\t};\n\n\t#inProgress = false;\n\tstatus = 'Initializing...';\n\tstate = '';\n\n\t_prepareContext(options) {\n\t\tconst status = this.status;\n\n\t\tconst type = this.pack.metadata.packageType;\n\t\tlet packageName;\n\t\tswitch (type) {\n\t\t\tcase 'system':\n\t\t\t\tpackageName = game.system.title;\n\t\t\t\tbreak;\n\t\t\tcase 'module':\n\t\t\t\tpackageName = game.modules.get(this.pack.metadata.packageName)?.title;\n\t\t\t\tbreak;\n\t\t\tcase 'world':\n\t\t\t\tpackageName = 'World';\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn {\n\t\t\tpack: this.pack,\n\t\t\tpackageName,\n\t\t\tstate: {\n\t\t\t\tid: foundry.utils.invertObject(STATUS)[status],\n\t\t\t\tlabel: MSG[status],\n\t\t\t\ticon: ICON[status],\n\t\t\t},\n\t\t\tindexSize: Math.floor(JSON.stringify(this.pack.index).length / 100) / 10,\n\t\t\tdocTotal: this.docTotal ?? 'n/a',\n\t\t\tdocAvg: this.docAvg ?? 'n/a',\n\t\t};\n\t}\n\n\t_statusUpdate(state) {\n\t\tlet html = this.element;\n\t\tif (html instanceof jQuery) html = html[0];\n\n\t\tif (!html) return; // Dialog was closed\n\t\tconst status = html.querySelector('.value[name=\"status\"]');\n\n\t\tthis.status = state;\n\t\tstatus.textContent = ICON[state] + 'Â ' + i18n.get(MSG[state]);\n\n\t\tswitch (state) {\n\t\t\tcase STATUS.error: status?.classList.add('error'); this.state = 'error'; break;\n\t\t\tcase STATUS.locking:\n\t\t\tcase STATUS.unlocking:\n\t\t\tcase STATUS.inprogress: status?.classList.add('inprogress'); this.state = 'inprogress'; break;\n\t\t\tcase STATUS.finished: status?.classList.add('finished'); this.state = 'finished'; break;\n\t\t\tdefault: break;\n\t\t}\n\t}\n\n\t/**\n\t * @param {HTMLElement} html\n\t */\n\tasync _doMigration() {\n\t\tthis.#migrationState = 1;\n\t\tif (this.#inProgress) return;\n\t\tthis.#inProgress = true;\n\n\t\tlet html = this.element;\n\t\tif (html instanceof jQuery) html = html[0];\n\n\t\tconst pack = this.pack;\n\t\tconst wasLocked = pack.locked;\n\t\tif (wasLocked) {\n\t\t\tthis._statusUpdate(STATUS.unlocking);\n\t\t\tawait pack.configure({ locked: false });\n\t\t}\n\n\t\tthis._statusUpdate(STATUS.inprogress);\n\n\t\t// This is called by migrateCompendium\n\t\tif (['Actor', 'Item', 'Scene'].includes(this.pack.metadata.type)) {\n\t\t\tawait pf1.migrations.migrateCompendium(this.pack)\n\t\t\t\t.catch(_ => this._statusUpdate(STATUS.error))\n\t\t\t\t.then(_ => this._statusUpdate(STATUS.finished));\n\t\t}\n\t\telse {\n\t\t\tawait this.pack.migrate()\n\t\t\t\t.catch(_ => this._statusUpdate(STATUS.error))\n\t\t\t\t.then(_ => this._statusUpdate(STATUS.finished));\n\t\t}\n\n\t\tconst docs = await pack.getDocuments();\n\t\tconst totalDocData = docs\n\t\t\t.map(d => JSON.stringify(d.toObject()).length)\n\t\t\t.reduce((t, o) => t + o, 0);\n\t\tconst doMB = totalDocData >= 700_000;\n\t\tconst divisor = doMB ? 100_000 : 100;\n\t\tthis.docTotal = Math.floor(totalDocData / divisor) / 10 + (' ' + (doMB ? 'MB' : 'kB'));\n\t\tthis.docAvg = docs.length > 0 ? Math.floor(totalDocData / docs.length / 100) / 10 + ' kB' : 0;\n\t\tconst dt = html.querySelector('.value[name=\"doc-total\"]');\n\t\tconst da = html.querySelector('.value[name=\"doc-avg\"]');\n\t\tdt.textContent = this.docTotal;\n\t\tda.textContent = this.docAvg;\n\n\t\tif (wasLocked) {\n\t\t\tthis._statusUpdate(STATUS.locking);\n\t\t\tawait pack.configure({ locked: true });\n\t\t\tthis._statusUpdate(STATUS.finished);\n\t\t}\n\n\t\tthis.#inProgress = false;\n\t\tthis.#migrationState = 2;\n\t}\n\n\t#migrationState = 0;\n\n\t/** @override */\n\t_onRender(options) {\n\t\tsuper._onRender(options);\n\n\t\tif (this.#migrationState === 0) {\n\t\t\tthis._doMigration();\n\t\t}\n\t}\n\n\t/** @override */\n\tclose(...args) {\n\t\tdelete this.pack.__lilMD;\n\t\tsuper.close(...args);\n\t}\n}\n\n/**\n * @param {HTMLElement} html\n */\nasync function migrateCompendium(html) {\n\tif (pf1.migrations.isMigrating) {\n\t\tui.notifications.warn('Cancelled due to ongoing migration.');\n\t\treturn;\n\t}\n\n\tconst packId = html.dataset.pack;\n\tconst pack = game.packs.get(packId);\n\n\tlet app = foundry.applications?.instances.get(`lil-compendium-migration-${packId}`);\n\tapp ??= new MigrationDialog({ pack });\n\tapp.render(true);\n}\n\n/**\n * @param {foundry.applications.sidebar.tabs.CompendiumDirectory} apphtml - TODO: this is app in v12\n * @param {object[]} entries\n */\nfunction addCompendiumMigrationContextOption(apphtml, entries) {\n\tconst exportEntry = {\n\t\tname: 'LittleHelper.Action.Migrate',\n\t\ticon: `<i class='${FAIcons.fileExport}'></i>`,\n\t\tcallback: migrateCompendium,\n\t};\n\tentries.push(exportEntry);\n}\n\nfunction enable() {\n\tHooks.on('getCompendiumContextOptions', addCompendiumMigrationContextOption);\n}\n\nfunction disable() {\n\tHooks.off('getCompendiumContextOptions', addCompendiumMigrationContextOption);\n\treturn false;\n}\n\nnew Feature({ setting: 'compendium-migration', label: 'Compendium Migration', hint: 'Allows easy migration of specific compendiums.', category: 'foundry-ui', enable, disable, stage: 'init', gm: true });\n",
    "import { Feature } from '@root/core/feature.mjs';\n\nconst nullText = 'n/a';\n\n/**\n * @param {TokenHUD} hud\n * @param {HTMLElement} html\n */\nfunction renderTokenHUD(hud, html) {\n\tif (html instanceof jQuery) html = html[0];\n\n\t// const sefx = Object.values(data.statusEffects);\n\n\tconst sEl = html.querySelector('div.status-effects');\n\tif (!sEl) return;\n\n\tsEl.classList.add('lil-enhanced');\n\n\tconst d = document.createElement('div');\n\td.classList.add('status-effects-label');\n\td.textContent = nullText;\n\n\tconst cs = getComputedStyle(sEl);\n\t// sEl.style.setProperty('--lil-width', cs.width);\n\td.style.cssText += `--lil-width:${cs.width};width:calc(var(--lil-width) + 6px + 2px);`; // 6 for padding, 2 for border\n\n\tsEl.before(d);\n\n\tconst mouseOver = (ev) => {\n\t\tconst el = ev.target, hovering = el.matches('img.effect-control');\n\t\td.textContent = hovering ? el.dataset.tooltip : nullText;\n\t\td.classList.toggle('none', !hovering);\n\t};\n\n\tsEl.addEventListener('pointerover', mouseOver, { passive: true });\n}\n\nfunction enable() {\n\tHooks.on('renderTokenHUD', renderTokenHUD);\n}\n\nfunction disable() {\n\tHooks.off('renderTokenHUD', renderTokenHUD);\n}\n\nnew Feature({ setting: 'tokenhud-effects', label: 'Effects Menu Enhancements', hint: 'Display labels for token HUD status options, improve layout, and make active effects more obvious.', category: 'token-hud', enable, disable, stage: 'ready' });\n",
    "import { createNode } from '@root/common.mjs';\nimport { Feature } from '@root/core/feature.mjs';\nimport { hookCoreTooltip } from '@root/core/tooltip.mjs';\n\n/**\n * @param {MacroConfig} app\n * @param {HTMLElement} html\n */\nfunction displayMacroOwners(app, html) {\n\tif (html instanceof jQuery) html = html[0];\n\n\tif (!game.user.isGM) return;\n\n\tconst doc = app.document;\n\tconst header = html.querySelector('.sheet-header');\n\tif (!header) return;\n\n\tconst users = game.users?.players.filter(u => doc.testUserPermission(u, 'OBSERVER'));\n\n\tif (users.length > 0) {\n\t\tconst uls = createNode('ul', null, ['lil-user-access']);\n\t\tfor (const u of users) {\n\t\t\tconst owner = doc.isOwner;\n\t\t\tconst uel = createNode('li', u.name, [owner ? 'owner' : 'observer']);\n\t\t\thookCoreTooltip(uel, {\n\t\t\t\tfn: () => {\n\t\t\t\t\tconst template = document.createDocumentFragment();\n\t\t\t\t\ttemplate.append(\n\t\t\t\t\t\t`ID: ${u.id}`,\n\t\t\t\t\t\tdocument.createElement('br'),\n\t\t\t\t\t\t`Permission: ${owner ? 'Owner' : 'Observer'}`,\n\t\t\t\t\t);\n\t\t\t\t\treturn template;\n\t\t\t\t},\n\t\t\t\tcss: 'lil-user-access',\n\t\t\t});\n\t\t\tuls.append(uel);\n\t\t}\n\t\theader.after(uls);\n\t}\n\n\t// NOT VISIBLE TO PLAYERS\n\tif ((doc.ownership.default ?? 0) < CONST.DOCUMENT_OWNERSHIP_LEVELS.OBSERVER) {\n\t\tconst noPlayers = createNode('h3', 'No players see this macro by default.', ['lil-user-warning']);\n\t\tnoPlayers.prepend(createNode('i', 'Â ', ['fa-solid', 'fa-exclamation-triangle']));\n\t\theader.after(noPlayers);\n\t}\n}\n\nfunction enable() {\n\tHooks.on('renderMacroConfig', displayMacroOwners);\n}\n\nfunction disable() {\n\tHooks.off('renderMacroConfig', displayMacroOwners);\n}\n\nnew Feature({ setting: 'macro-access', label: 'User Access', hint: 'Display user access to macros in their sheet.', category: 'macro', enable, disable, stage: 'ready', gm: true });\n",
    "import { Feature } from '@root/core/feature.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nconst makeTag = () => createNode('span', undefined, ['lil-tag']);\n\n/**\n * @param {MacroDirectory} app\n * @param {HTMLElement} html\n */\nfunction macroDirectory(app, html) {\n\tconst list = html.querySelector('.directory-list');\n\tif (!list) return;\n\tlist.classList.add('lil-enhanced-macro-directory');\n\n\tconst isGM = game.user.isGM,\n\t\tuserId = game.user.id;\n\n\tconst permlabels = {\n\t\t0: i18n.get('LittleHelper.Macro.None'),\n\t\t1: i18n.get('LittleHelper.Macro.Visible'),\n\t\t2: i18n.get('LittleHelper.Macro.Executable'),\n\t\t3: i18n.get('LittleHelper.Macro.Editable'),\n\t};\n\n\tfor (const el of list.querySelectorAll('.entry[data-entry-id]')) {\n\t\tconst docId = el.dataset.entryId;\n\t\tconst macro = game.macros.get(docId);\n\t\tif (!macro) continue;\n\n\t\tconst author = macro.author,\n\t\t\tname = author ? author.name : `[${macro._source.author}]`;\n\n\t\t// Find relevant element\n\t\tconst nel = el.querySelector('.entry-name');\n\t\tnel.classList.add('macro-name');\n\n\t\tconst md = createNode('div', undefined, ['lil-entry-info']);\n\n\t\t// Author\n\t\tconst aTag = makeTag();\n\t\taTag.append(createNode('label', i18n.get('LittleHelper.Macro.Author')), createNode('span', name, ['author-name']));\n\n\t\t// Access\n\t\tconst defaultPerm = macro.ownership?.default ?? 0;\n\t\tconst perm = isGM ? 3 : (macro.ownership[userId] ?? defaultPerm);\n\t\tconst pTag = makeTag();\n\t\tpTag.append(createNode('span', permlabels[perm], ['permission']));\n\n\t\tmd.append(aTag, pTag);\n\n\t\tel.classList.add('lil-enriched-entry');\n\n\t\tnel.append(md);\n\t}\n}\n\nfunction enable() {\n\tHooks.on('renderMacroDirectory', macroDirectory);\n}\n\nfunction disable() {\n\tHooks.off('renderMacroDirectory', macroDirectory);\n}\n\nnew Feature({ setting: 'macro-directory', label: 'Directory Enrichment', hint: 'Enhance information available in macro directory.', category: 'macro', enable, disable, stage: 'init' });\n",
    "import { Feature } from '@root/core/feature.mjs';\n\nfunction defaultMacroType(macro, data, options, userId) {\n\tif (data.command == undefined)\n\t\tmacro.updateSource({ type: 'script' });\n}\n\nfunction enable() {\n\tHooks.on('preCreateMacro', defaultMacroType);\n}\n\nfunction disable() {\n\tHooks.off('preCreateMacro', defaultMacroType);\n}\n\nnew Feature({ setting: 'macro-default-script', label: 'Default Script Type', hint: 'Forces macros to script type by default.', category: 'macro', enable, disable, stage: 'ready' });\n",
    "/**\n * Adds little ID button to sheets for copying the underlying ID to clipboard.\n */\n\nimport { Feature } from '@root/core/feature.mjs';\n\n// Mimic Foundry ID button\nfunction injectIDButtonToTitle(app, html, _, context) {\n\tif (!context.isFirstRender) return;\n\n\tlet type;\n\tif (app instanceof foundry.applications.sidebar.apps.Compendium) type = 'pack';\n\n\tconst title = html.querySelector('.window-title');\n\tif (!title) return;\n\n\tif (title.querySelector('.document-id-link')) return;\n\n\tconst idLink = document.createElement('a');\n\tidLink.classList.add('document-id-link', 'lil-helper');\n\n\tlet id, label;\n\tswitch (type) {\n\t\tcase 'pack': {\n\t\t\tconst pack = app.collection;\n\t\t\tid = pack.metadata.id;\n\t\t\tlabel = 'Compendium';\n\t\t\tidLink.dataset.tooltip = `Copy Compendium ID: ${id}`;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (!id) return;\n\n\tidLink.dataset.tooltipDirection = 'UP';\n\tidLink.innerHTML = '<i class=\"fa-solid fa-passport\"></i>';\n\tidLink.addEventListener('click', event => {\n\t\tevent.preventDefault();\n\t\tgame.clipboard.copyPlainText(id);\n\t\tui.notifications.info(game.i18n.format('DOCUMENT.IdCopiedClipboard', { label, type: 'id', id }));\n\t});\n\ttitle.before(idLink);\n}\n\nconst renderEvents = [\n\t'renderCompendium',\n];\n\nfunction enable() {\n\tfor (const ev of renderEvents)\n\t\tHooks.on(ev, injectIDButtonToTitle);\n}\n\nfunction disable() {\n\tfor (const ev of renderEvents)\n\t\tHooks.off(ev, injectIDButtonToTitle);\n}\n\nnew Feature({ setting: 'sheet-id', label: 'Sheet ID', hint: 'Display button on action sheet and compendium header to copy relevant ID to clipboard.', category: 'dev', enable, disable, stage: 'ready' });\n",
    "import { CFG } from '@root/config.mjs';\nimport { Feature } from '@root/core/feature.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nconst iconEye = (title) => createNode('i', undefined, ['far', 'fa-eye', 'lil-icon', 'lil-vision-hint'], { title });\nconst iconLamp = (title) => createNode('i', undefined, ['far', 'fa-lightbulb', 'lil-icon', 'lil-vision-hint'], { title });\n\n/**\n * @param {HTMLElement} el\n */\nconst prev = (el) => {\n\tconst prevEl = el.previousElementSibling;\n\tprevEl?.classList.add('lil-vision-hint-label');\n\treturn prevEl;\n};\n\n/**\n * @param {*} tokenConfig\n * @param {HTMLElement} html\n * @param {object} options\n */\nfunction clarifyTokenSettings(tokenConfig, html, options) {\n\tconst inputs = [];\n\tfor (const tab of html.querySelectorAll('[data-tab=\"vision\"],[data-tab=\"light\"]')) {\n\t\tfor (const lvin of tab.querySelectorAll('input')) {\n\t\t\tinputs.push(lvin);\n\t\t};\n\t}\n\n\tfor (const node of inputs) {\n\t\tlet icon;\n\t\tswitch (node.name) {\n\t\t\tcase 'light.dim':\n\t\t\t\ticon = iconLamp(i18n.get('LittleHelper.Foundry.Light.Dim.Hint'));\n\t\t\t\tbreak;\n\n\t\t\tcase 'light.bright':\n\t\t\t\ticon = iconLamp(i18n.get('LittleHelper.Foundry.Light.Bright.Hint'));\n\t\t\t\tbreak;\n\t\t}\n\t\tif (icon) prev(node)?.after(icon);\n\t}\n}\n\nfunction enable() {\n\tHooks.on('renderTokenConfig', clarifyTokenSettings);\n}\n\nfunction disable() {\n\tHooks.off('renderTokenConfig', clarifyTokenSettings);\n}\n\nnew Feature({ setting: 'token-vision-hints', label: 'Vision Hints', hint: 'Add extra clarity to token vision settings. With PF1 0.80.22 and newer disables brightvision editing in token settings.', category: 'token', enable, disable, stage: 'ready' });\n",
    "/**\n * Display world name.\n */\n\nimport { Feature } from '@root/core/feature.mjs';\nimport { createNode } from '@root/common.mjs';\n\n/**\n * @param {*} settings\n * @param {HTMLElement} html\n * @param {*} opts\n */\nfunction renderSettingsEvent(settings, html) {\n\tif (html instanceof jQuery) html = html[0];\n\n\tconst gd = html.querySelector('section.info .modules');\n\tconst world = createNode('div', undefined, ['world']);\n\tworld.append(\n\t\tcreateNode('span', 'World', ['label']),\n\t\tcreateNode('span', game.world.title, ['value']),\n\t);\n\tgd.after(world);\n}\n\nfunction enable() {\n\tHooks.on('renderSettings', renderSettingsEvent);\n}\n\nfunction disable() {\n\tHooks.off('renderSettings', renderSettingsEvent);\n\treturn false;\n}\n\nnew Feature({ setting: 'world-identity', label: 'World Identity', hint: 'Display world name in settings tab.', category: 'foundry-ui', enable, disable, stage: 'setup' });\n",
    "import { CFG } from '@root/config.mjs';\nimport { Feature } from '@root/core/feature.mjs';\nimport { FAIcons } from '@root/core/icons.mjs';\n\nconst autoExpand = 'autoExpandFolders';\n\nHooks.once('init', () => {\n\t// Storage for expanded folders\n\tgame.settings.register(CFG.id, autoExpand, {\n\t\tconfig: false,\n\t\tdefault: {},\n\t\ttype: Object,\n\t\tscope: 'client',\n\t});\n});\n\nfunction expandFolders(folders) {\n\tconst C = CFG.console.colors;\n\tconsole.group('%cLittle Helper%c ðŸ¦Ž', C.main, C.unset, '| Auto-Expand Folders');\n\ttry {\n\t\tconst foldersByType = {};\n\t\tfor (const f of Object.entries(folders)\n\t\t\t.filter(([_, open]) => open)\n\t\t\t.map(([fid, _]) => game.folders?.get(fid))) {\n\t\t\tfoldersByType[f.type] ??= [];\n\t\t\tfoldersByType[f.type].push(f);\n\t\t}\n\n\t\tconst types = Object.keys(foldersByType);\n\n\t\tif (types.length === 0)\n\t\t\treturn void console.log('No folders configured');\n\n\t\tfor (const type of types) {\n\t\t\tconsole.group(type);\n\t\t\ttry {\n\t\t\t\tfor (const folder of foldersByType[type])\n\t\t\t\t\tconsole.log(folder.name, `[${folder.id}]`);\n\t\t\t}\n\t\t\tfinally {\n\t\t\t\tconsole.groupEnd();\n\t\t\t}\n\t\t}\n\t}\n\tfinally {\n\t\tconsole.groupEnd();\n\t}\n}\n\nHooks.once('ready', () => {\n\t// Cleanup missing folders\n\tconst folders = game.settings.get(CFG.id, autoExpand);\n\tlet update = false;\n\n\tfor (const [uid, _] of Object.entries(folders)) {\n\t\tif (!game.folders.get(uid)) {\n\t\t\tdelete folders[uid];\n\t\t\tupdate = true;\n\t\t}\n\t}\n\n\tif (update) game.settings.set(CFG.id, autoExpand, folders);\n\n\texpandFolders(folders);\n});\n\n/**\n * @param {HTMLElement} html\n * @param {boolean} expand\n */\nfunction toggleFolder(html, expand) {\n\tif (html instanceof jQuery) html = html[0];\n\n\t// TODO: Swap to data-uuid usage for v11\n\tconst folderId = html.closest('[data-folder-id]')?.dataset.folderId;\n\tif (!folderId) return;\n\n\tconst cfg = game.settings.get(CFG.id, autoExpand);\n\n\tif (expand) cfg[folderId] = true;\n\telse delete cfg[folderId];\n\n\treturn game.settings.set(CFG.id, autoExpand, foundry.utils.deepClone(cfg));\n}\n\n/**\n * @param {HTMLElement} html\n */\nfunction getToggleState(html) {\n\tif (html instanceof jQuery) html = html[0];\n\n\t// TODO: Swap to data-uuid usage for v11\n\tconst folderId = html.closest('[data-folder-id]')?.dataset.folderId;\n\tif (!folderId) return;\n\tconst cfg = game.settings.get(CFG.id, autoExpand);\n\treturn cfg[folderId] ?? false;\n}\n\n/**\n * @param _jq\n * @param {object[]} contextmenu\n */\nfunction folderContext(_jq, contextmenu) {\n\tcontextmenu.unshift({\n\t\tcallback: (html) => toggleFolder(html, false),\n\t\tcondition: (html) => getToggleState(html),\n\t\ticon: `<i class='${FAIcons.folder}'></i>`,\n\t\tname: 'Undo auto-expand',\n\t},\n\t{\n\t\tcallback: (html) => toggleFolder(html, true),\n\t\tcondition: (html) => !getToggleState(html),\n\t\ticon: `<i class='${FAIcons.folderOpen}'></i>`,\n\t\tname: 'Auto-expand folder',\n\t});\n}\n\n/**\n * @param {Sidebar} app\n * @param {HTMLElement} html\n * @param {object} options\n */\nfunction onRenderSidebar(app, html, options) {\n\tif (html instanceof jQuery) html = html[0];\n\n\tconst cfg = game.settings.get(CFG.id, autoExpand);\n\n\t// TODO: Swap to data-uuid usage for v11\n\tfor (const el of html.querySelectorAll('li[data-folder-id]')) {\n\t\tconst folderId = el.dataset.folderId;\n\t\tconst open = cfg[folderId] ?? false;\n\t\tif (open && el.classList.contains('collapsed')) el.querySelector('header')?.click();\n\t}\n}\n\nfunction enable() {\n\tHooks.on('getDocumentDirectoryFolderContext', folderContext);\n\tHooks.on('renderDocumentDirectory', onRenderSidebar);\n\n\treturn true;\n}\n\nfunction disable() {\n\tHooks.off('getDocumentDirectoryFolderContext', folderContext);\n\tHooks.off('renderDocumentDirectory', onRenderSidebar);\n\n\treturn true;\n}\n\nnew Feature({ setting: 'auto-expand-sidebar-folders', label: 'Auto-expand Sidebar Folders', hint: 'Allows automatically expanding sidebar folders. Toggle the expansion with right click context menu.', category: 'foundry-ui', enable, disable, stage: 'init' });\n",
    "import { Feature } from '@root/core/feature.mjs';\n\nfunction widenSidebar() {\n\tdocument.body.style.setProperty('--sidebar-width', '360px');\n}\n\nfunction enable() {\n\twidenSidebar();\n}\n\nfunction disable() {\n\treturn false;\n}\n\nnew Feature({ setting: 'widen-sidebar', label: 'Widen Sidebar', hint: 'Increase sidebar width.', category: 'foundry-ui', enable, disable, stage: 'setup', enabledByDefault: false });\n",
    "import { Feature } from '@root/core/feature.mjs';\nimport { createNode, addCoreTooltip } from '@root/common.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nfunction getActorType(actor) {\n\tswitch (actor.type) {\n\t\tcase 'character':\n\t\t\treturn 'PC';\n\t\tcase 'npc':\n\t\t\treturn 'NPC';\n\t\tcase 'basic':\n\t\t\treturn 'Basic';\n\t\tdefault:\n\t\t\treturn i18n.get(CONFIG.Actor.typeLabels[actor.type]);\n\t}\n}\n\nfunction CRtoString(value) {\n\tswitch (value) {\n\t\tcase 0.125: return '1/8';\n\t\tcase 0.1625: return '1/6';\n\t\tcase 0.25: return '1/4';\n\t\tcase 0.3375: return '1/3';\n\t\tcase 0.5: return '1/2';\n\t\tdefault: return `${value}`;\n\t}\n}\n\nfunction generateContent(actor) {\n\tconst t = document.createDocumentFragment();\n\n\tconst sysData = actor.system;\n\n\t// Display actor type\n\tconst actorType = createNode('span', getActorType(actor), ['lil-tag', 'type', actor.type]);\n\taddCoreTooltip(actorType, i18n.get('LittleHelper.Sidebar.ActorType', { type: actor.type }));\n\tt.append(actorType);\n\n\t// Display Link status\n\tconst isPC = actor.hasPlayerOwner,\n\t\tisLinked = actor.prototypeToken.actorLink;\n\tif ((isPC && !isLinked) || (!isPC && isLinked)) {\n\t\tconst linkState = createNode('span', isLinked ? i18n.get('LittleHelper.Linked') : i18n.get('LittleHelper.Unlinked'), ['lil-tag', 'link-state', isPC ? 'pc' : 'npc', isLinked ? 'linked' : 'unlinked']);\n\t\tconst playerOwned = i18n.get(isPC ? 'Yes' : 'No');\n\t\tconst tokenLinked = i18n.get(isLinked ? 'Yes' : 'No');\n\t\taddCoreTooltip(linkState, i18n.get('LittleHelper.Sidebar.ActorType', { type: actor.type }) + `<br>Player Owned: ${playerOwned}<br>Linked Token: ${tokenLinked}`);\n\t\tt.append(linkState);\n\t}\n\n\t// Display player owner(s) for GM\n\tif (isPC && game.user.isGM) {\n\t\tconst owners = game.users.players.filter(u => actor.testUserPermission(u, 'OWNER'));\n\n\t\tif (owners.length === 1)\n\t\t\tt.append(createNode('span', `Owner: ${owners[0].name}`, ['lil-tag', 'owner', 'singular']));\n\t\telse if (owners.length > 1 || actor.ownership.default >= CONST.DOCUMENT_OWNERSHIP_LEVELS.OWNER)\n\t\t\tt.append(createNode('span', 'Multiple Owners', ['lil-tag', 'owner', 'multiple'], { tooltip: owners.map(u =>u.name).join(', ') }));\n\t}\n\n\t// Display actual ownership level for player\n\tif (!game.user.isGM) {\n\t\tconst perm = actor.permission;\n\t\tconst permStr = foundry.utils.invertObject(CONST.DOCUMENT_OWNERSHIP_LEVELS)[perm];\n\t\tconst label = i18n.get(`OWNERSHIP.${permStr}`);\n\t\tt.append(createNode('span', label, ['lil-tag', 'permission', permStr.toLowerCase()]));\n\t}\n\n\t// Display level/CR\n\t// presence of getCR function says the actor type cares about CR, so we don't display CR for others even if it's present.\n\tif (typeof actor.getCR === 'function') {\n\t\tconst cr = actor.getCR();\n\t\tt.append(createNode('span', `CR ${pf1.utils.CR.fromNumber(cr)}`, ['lil-tag', 'cr']));\n\t}\n\n\treturn t;\n}\n\n/**\n * @param {ActorDirectory} app\n * @param {HTMLElement} html\n * @param {object} options\n */\nfunction onRenderActorDirectory(app, html, options) {\n\tfor (const el of html.querySelectorAll('li.document.actor')) {\n\t\tconst actorId = el.dataset.entryId;\n\t\tconst actor = game.actors.get(actorId);\n\n\t\tif (actor.permission < CONST.DOCUMENT_OWNERSHIP_LEVELS.OBSERVER) continue;\n\n\t\tconst name = el.querySelector('.entry-name');\n\t\tif (!name) continue;\n\n\t\tconst holder = createNode('div', undefined, ['lil-entry-info']);\n\t\tconst content = generateContent(actor);\n\t\tif (content) holder.replaceChildren(content);\n\n\t\tel.classList.add('lil-enriched-entry');\n\n\t\tname.append(holder);\n\t}\n}\n\n/**\n * updateActor event handler.\n *\n * @param {ActorPF} actor\n * @param {object} update\n */\nfunction updateActorEvent(actor, update) {\n\t// TODO: Check if anything actually of interest was updated\n\t// ^ May be impossible with item Changes or similar modifying the derived values.\n\n\tif (actor.pack) return;\n\tif (actor.collectionName !== 'actors') return;\n\n\tconst updateElements = [];\n\n\tconst sidetab = document.getElementById('actors');\n\tif (sidetab) updateElements.push(sidetab);\n\tconst popout = document.getElementById('actors-popout');\n\tif (popout) updateElements.push(popout);\n\n\tif (updateElements.length === 0) return;\n\n\tconst content = generateContent(actor);\n\tfor (const [index, el] of updateElements.entries()) {\n\t\tconst ii = el.querySelector(`li.document.actor[data-entry-id=\"${actor.id}\"] .lil-entry-info`);\n\t\tif (!ii) return;\n\t\tconst sc = index + 1 === updateElements.length ? content : content.cloneNode(true);\n\t\tii.replaceChildren(sc);\n\t}\n}\n\nfunction enable() {\n\tHooks.on('renderActorDirectory', onRenderActorDirectory);\n\tHooks.on('updateActor', updateActorEvent);\n}\n\nfunction disable() {\n\tHooks.off('renderActorDirectory', onRenderActorDirectory);\n\tHooks.off('updateActor', updateActorEvent);\n\treturn false;\n}\n\nnew Feature({ setting: 'enrich-actors-directory', label: 'Enrich Actors Directory', hint: 'Add additional information to actors directory.', category: 'foundry-ui', enable, disable, stage: 'setup' });\n",
    "import { i18n } from '@root/utility/i18n.mjs';\nimport { Feature, SubSetting } from '@core/feature.mjs';\nimport { createNode, clampNum } from '@root/common.mjs';\nimport { healthLabels } from '@root/helpers/wounds.mjs';\nimport { CFG } from '@root/config.mjs';\n\n/**\n * Plans:\n * - Experience\n */\n\n// TODO: Sort types first, level second.\nconst classLevelSorter = (a, b) => b.system.level - a.system.level;\n\nlet ownership;\n\nconst havePerm = (c) => c.testUserPermission(game.user, 'OBSERVER');\n\n/**\n * @param {HTMLElement} parent\n * @param {Actor} actor\n */\nasync function generateActorTooltip(parent, actor) {\n\tlet ignoreActors = game.settings.get(CFG.id, 'ignoreActors');\n\tif (Array.isArray(ignoreActors)) ignoreActors = new Set(ignoreActors); // v12 does not init the set correctly\n\tconst ignoreProblems = ignoreActors.has(actor.type);\n\tconst warnUnfinished = feature.subsettings.unfinished.value ?? true;\n\n\tconst fragment = document.createDocumentFragment();\n\n\tconst isNormal = ['character', 'npc'].includes(actor.type),\n\t\thasPlayerOwner = actor.hasPlayerOwner;\n\n\t// const isOwner = actor.isOwner;\n\tconst isObserver = actor.testUserPermission(game.user, 'OBSERVER');\n\tconst isLimited = actor.testUserPermission(game.user, 'LIMITED', { exact: true });\n\n\tif (!isLimited && !isObserver) return;\n\n\t// Name\n\tconst nameLabel = createNode('h3', actor.name, ['name', 'span-4']);\n\tfragment.append(nameLabel);\n\n\tconst hpCfg = game.settings.get('pf1', 'healthConfig');\n\tconst variantHpRules = hpCfg.getActorConfig(actor).rules;\n\n\tconst actorData = actor.system,\n\t\tattributes = actorData.attributes;\n\n\t// Token Name\n\tconst protoToken = actor.prototypeToken;\n\tif (actor.name !== protoToken.name && isObserver) {\n\t\tconst tEl = createNode('div', undefined, ['token']);\n\t\ttEl.append(\n\t\t\tcreateNode('label', 'Alias', ['label']),\n\t\t\tcreateNode('span', protoToken.name, ['simple-value', 'value', 'text', 'span-3']),\n\t\t);\n\t\tfragment.append(tEl);\n\t}\n\n\tlet unfinished = false;\n\n\tif (isNormal) {\n\t\tconst woundsAndVigor = variantHpRules.useWoundsAndVigor === true;\n\n\t\tconst health = woundsAndVigor ? attributes.vigor : attributes.hp;\n\t\tif (!ignoreProblems && warnUnfinished && (!(health.max > 0) || actor.itemTypes.class.length === 0)) {\n\t\t\tunfinished = true;\n\t\t\tconst unfinishedEl = createNode('div', undefined, ['unfinished']);\n\t\t\tunfinishedEl.append(createNode('span', 'UNFINISHED', ['value', 'span-4', 'error']));\n\t\t\tfragment.append(unfinishedEl);\n\t\t}\n\n\t\t// HD\n\t\tconst hd = attributes?.hd?.total;\n\t\tif (hd > 0) {\n\t\t\tconst hdEl = createNode('div', undefined, ['hd']);\n\t\t\thdEl.append(\n\t\t\t\tcreateNode('label', i18n.get('PF1.HitDieShort'), ['label']),\n\t\t\t\tcreateNode('span', `${hd}`, ['value', 'span-3']),\n\t\t\t);\n\t\t\tfragment.append(hdEl);\n\t\t}\n\n\t\t// CR\n\t\tif (actorData.details?.cr > 0) {\n\t\t\t// CR\n\t\t}\n\n\t\t// Core Health Rules\n\t\tif (woundsAndVigor) {\n\t\t\tconst { wounds, vigor } = attributes;\n\t\t\tconst evig = vigor.value + (vigor.temp || 0),\n\t\t\t\tvigPct = evig / vigor.max,\n\t\t\t\twndPCt = wounds.value / wounds.max;\n\n\t\t\tconst hpEl = createNode('div', undefined, ['health']);\n\n\t\t\t// Wounds\n\t\t\tconst wndValueEl = createNode('span', undefined, ['health-data', 'simple-value']);\n\t\t\twndValueEl.append(\n\t\t\t\tcreateNode('span', `${wounds.value}`, ['wounds', 'effective', 'value']),\n\t\t\t\t' / ',\n\t\t\t\tcreateNode('span', `${wounds.max}`, ['wounds', 'max', 'value']),\n\t\t\t\t' (',\n\t\t\t\tcreateNode('span', `${pf1.utils.limitPrecision(wndPCt * 100, 1)}`, ['wounds', 'percentage', 'value']),\n\t\t\t\t'%)',\n\t\t\t);\n\t\t\thpEl.append(createNode('label', i18n.get('PF1.Wounds'), ['label']), wndValueEl);\n\n\t\t\t// Vigor\n\t\t\tconst vigValueEl = createNode('span', undefined, ['health-data', 'simple-value']);\n\t\t\tvigValueEl.append(\n\t\t\t\tcreateNode('span', `${evig}`, ['vigor', 'effective', 'value']),\n\t\t\t\t' / ',\n\t\t\t\tcreateNode('span', `${vigor.max}`, ['vigor', 'max', 'value']),\n\t\t\t\t' (',\n\t\t\t\tcreateNode('span', `${pf1.utils.limitPrecision(vigPct * 100, 1)}`, ['vigor', 'percentage', 'value']),\n\t\t\t\t'%)',\n\t\t\t);\n\t\t\thpEl.append(createNode('label', i18n.get('PF1.Vigor'), ['label']), vigValueEl);\n\n\t\t\tfragment.append(hpEl);\n\t\t}\n\t\t// Wounds & Vigor\n\t\telse {\n\t\t\tconst health = attributes.hp,\n\t\t\t\tehp = health.value + health.temp,\n\t\t\t\thpPercentage = ehp / health.max,\n\t\t\t\twoundThreshold = clampNum(4 - Math.ceil(hpPercentage * 4), 0, 3);\n\n\t\t\tconst hpEl = createNode('div', undefined, ['health']);\n\t\t\t// Health\n\t\t\tconst hpValueEl = createNode('span', undefined, ['health-data', 'simple-value']);\n\t\t\thpValueEl.append(\n\t\t\t\tcreateNode('span', `${ehp}`, ['health', 'effective', 'value']),\n\t\t\t\t' / ',\n\t\t\t\tcreateNode('span', `${health.max}`, ['health', 'max', 'value']),\n\t\t\t\t' (',\n\t\t\t\tcreateNode('span', `${pf1.utils.limitPrecision(hpPercentage * 100, 1)}`, ['health', 'percentage', 'value']),\n\t\t\t\t'%)',\n\t\t\t);\n\t\t\thpEl.append(createNode('label', 'HP', ['label']), hpValueEl);\n\t\t\tfragment.append(hpEl);\n\n\t\t\t// Wound threshold\n\t\t\tif (health.max > 0) {\n\t\t\t\tconst hpLabel = createNode('div', undefined, ['health']);\n\t\t\t\thpLabel.append(\n\t\t\t\t\tcreateNode('label', 'Status', ['label']),\n\t\t\t\t\tcreateNode('span', `${healthLabels[woundThreshold]}`, ['simple-value', 'value', 'text', 'span-3']),\n\t\t\t\t);\n\t\t\t\tfragment.append(hpLabel);\n\t\t\t}\n\t\t}\n\n\t\t// Race\n\t\tconst race = actor.race;\n\t\tif (race) {\n\t\t\tconst rEl = createNode('div', undefined, ['race']);\n\t\t\trEl.append(\n\t\t\t\tcreateNode('label', i18n.get(CONFIG.Item.typeLabels.race), ['label']),\n\t\t\t\tcreateNode('span', race.name, ['simple-value', 'text', 'value']),\n\t\t\t);\n\t\t\tfragment.append(rEl);\n\t\t}\n\n\t\t// Classes\n\t\tconst classes = actor.itemTypes.class\n\t\t\t.filter(i => i.system.level > 0)\n\t\t\t.sort(classLevelSorter);\n\t\tconst clsEl = createNode('div', undefined, ['classes']);\n\t\tif (classes.length > 0) {\n\t\t\tconst clsList = createNode('ul', undefined, ['class-list', 'span-4']);\n\t\t\tfor (const cls of classes) {\n\t\t\t\tconst clsLiEl = createNode('li', undefined, ['class']);\n\t\t\t\tclsLiEl.append(\n\t\t\t\t\tcreateNode('span', cls.name, ['text', 'value']),\n\t\t\t\t\tcreateNode('span', cls.system.level, ['number', 'value']),\n\t\t\t\t);\n\t\t\t\tclsList.append(clsLiEl);\n\t\t\t}\n\t\t\tclsEl.append(createNode('label', 'Classes', ['label', 'span-4']), clsList);\n\t\t}\n\t\telse {\n\t\t\tif (!ignoreProblems && warnUnfinished)\n\t\t\t\tclsEl.append(createNode('span', 'NO CLASSES', ['value', 'span-4', 'error']));\n\t\t}\n\t\tfragment.append(clsEl);\n\t}\n\n\townership ??= {\n\t\tdefault: i18n.get('OWNERSHIP.DEFAULT'),\n\t\t1: i18n.get('OWNERSHIP.LIMITED'),\n\t\t2: i18n.get('OWNERSHIP.OBSERVER'),\n\t\t3: i18n.get('OWNERSHIP.OWNER'),\n\t};\n\n\t// Users with permissions\n\tconst owners = game.users.players.filter(u => actor.testUserPermission(u, 'LIMITED'));\n\n\tconst defaultOwnership = actor.ownership.default;\n\n\tif (defaultOwnership > 0 || owners.length > 0) {\n\t\tconst ownerList = createNode('ul', undefined, ['owner-list', 'span-4']);\n\t\tconst addOwner = (name, level) => {\n\t\t\tconst ownerLiEl = createNode('li', undefined, ['owner']);\n\t\t\tlevel ??= 'default';\n\t\t\townerLiEl.append(\n\t\t\t\tcreateNode('span', name, ['text', 'value']),\n\t\t\t\tcreateNode('span', ownership[level], ['value', 'text']),\n\t\t\t);\n\t\t\townerList.append(ownerLiEl);\n\t\t};\n\n\t\tif (defaultOwnership > 0) addOwner(ownership.default, defaultOwnership);\n\t\tfor (const user of owners) addOwner(user.name, actor.ownership[user.id]);\n\t\tconst ownerEl = createNode('div', undefined, ['ownership']);\n\t\townerEl.append(createNode('label', 'Permissions', ['label', 'span-4']), ownerList);\n\t\tfragment.append(ownerEl);\n\t}\n\n\t// Type\n\tconst typeEl = createNode('div', undefined, ['type']);\n\ttypeEl.append(\n\t\tcreateNode('label', i18n.get('PF1.Type'), ['label']),\n\t\tcreateNode('span', i18n.get(CONFIG.Actor.typeLabels[actor.type]), ['value', 'text', 'span-3']),\n\t);\n\tfragment.append(typeEl);\n\n\t// Link Status\n\tconst linkStatus = protoToken.actorLink,\n\t\tlinkStatusExpected = linkStatus ? !!hasPlayerOwner : !hasPlayerOwner;\n\tconst linkEl = createNode('div', undefined, ['link-status']);\n\tconst linkStateLabel = linkStatus ? i18n.get('LittleHelper.LinkState.Linked.Label') : i18n.get('LittleHelper.LinkState.Unlinked.Label');\n\tlinkEl.append(\n\t\tcreateNode('label', 'Link State'),\n\t\tcreateNode('span', linkStateLabel, ['value', 'boolean', 'link-state', linkStatusExpected ? 'expected' : 'unexpected', linkStatus ? 'true' : 'false', 'span-3']),\n\t);\n\n\tfragment.append(linkEl);\n\n\t/** @type {TooltipManager} */\n\tconst tt = CONFIG.ux.TooltipManager;\n\n\tconst ttData = {\n\t\thtml: fragment,\n\t\tcssClass: 'lil-directory-tooltip',\n\t\tdirection: tt.TOOLTIP_DIRECTIONS.LEFT, // TODO: Reactive side\n\t};\n\n\tgame.tooltip.activate(parent, ttData);\n}\n\n/**\n * @param {HTMLElement} dom\n * @param {Actor} actor\n */\nfunction hookActorTooltip(dom, actor) {\n\tif (actor.type.includes('.')) return; // Ignore module actors\n\n\tif (!havePerm(actor)) return;\n\n\tdom.addEventListener('pointerenter', () => generateActorTooltip(dom, actor), { passive: true });\n}\n\n/**\n * @param {ActorDirectory} app\n * @param {HTMLElement} html\n */\nfunction hookActorDirectoryTooltips(app, html) {\n\tif (html instanceof jQuery) html = html[0];\n\n\tconst listing = html.querySelector('ol.directory-list');\n\tif (!listing) return;\n\n\t// document-id is no longer used with v13\n\tfor (const el of listing.querySelectorAll('.entry[data-entry-id]')) {\n\t\thookActorTooltip(el, game.actors.get(el.dataset.entryId));\n\t}\n}\n\nfunction enable() {\n\tHooks.on('renderActorDirectory', hookActorDirectoryTooltips);\n}\n\nfunction disable() {\n\tHooks.off('renderActorDirectory', hookActorDirectoryTooltips);\n\treturn false;\n}\n\nconst feature = new Feature({\n\tsetting: 'actor-list-tooltip',\n\tlabel: 'Actors Directory Tooltips',\n\thint: 'Actor tooltips for the sidebar directory, providing basic info.',\n\tcategory: 'foundry-ui',\n\tsubsettings: {\n\t\tunfinished: new SubSetting({\n\t\t\tlabel: 'Unfinished',\n\t\t\thint: 'Display warnings if the actor appears to lack necessary information.',\n\t\t\ttype: Boolean,\n\t\t\tfallback: true,\n\t\t}),\n\t},\n\tenable,\n\tdisable,\n\tstage: 'init',\n});\n",
    "import { Feature } from '@root/core/feature.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { getFullItemTypeLabel } from '@root/helpers/item.mjs';\n\n/**\n * @param {Item} item\n */\nfunction getItemTags(item) {\n\tconst tags = {};\n\tconst type = item.type;\n\tconst itemData = item.system;\n\tconst subType = itemData.subType;\n\n\ttags.type = getFullItemTypeLabel(item, type, subType);\n\n\tswitch (item.type) {\n\t\tcase 'weapon': {\n\t\t\tconst actionType = item.defaultAction?.actionType;\n\t\t\tswitch (actionType) {\n\t\t\t\tcase 'mwak':\n\t\t\t\tcase 'msak':\n\t\t\t\tcase 'mcman':\n\t\t\t\t\ttags.range = 'Melee';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'rwak':\n\t\t\t\tcase 'rsak':\n\t\t\t\tcase 'rcman':\n\t\t\t\t\ttags.range = 'Ranged';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn tags;\n}\n\n/**\n * @param {HTMLElement} el\n * @param {Item} item\n */\nfunction addDetails(el, item) {\n\tconst tags = getItemTags(item);\n\n\tconst t = document.createDocumentFragment();\n\tif (tags.type) t.append(createNode('span', tags.type, ['lil-tag', 'type']));\n\tif (tags.range) t.append(createNode('span', tags.range, ['lil-tag', 'range']));\n\n\tel.replaceChildren(t);\n}\n\n/**\n * @param {foundry.applications.sidebar.tabs.ItemDirectory} app\n * @param {HTMLElement} html\n * @param {object} options\n */\nfunction onRenderItemDirectory(app, html, options) {\n\tfor (const el of html.querySelectorAll('li.document.item[data-entry-id]')) {\n\t\tconst itemId = el.dataset.entryId;\n\t\tconst item = game.items.get(itemId);\n\n\t\tconst holder = createNode('div', undefined, ['lil-entry-info']);\n\n\t\taddDetails(holder, item);\n\n\t\tconst name = el.querySelector('.entry-name');\n\t\tel.classList.add('lil-enriched-entry');\n\n\t\tname.append(holder);\n\t}\n}\n\nasync function onUpdateItem(item) {\n\tif (item.actor) return;\n\tif (item.pack) return;\n\n\tconst inItemsDir = item.collectionName === 'items';\n\n\tfor (const app of item.collection?.apps ?? []) {\n\t\tif (inItemsDir && app instanceof foundry.applications.sidebar.tabs.ItemDirectory) {\n\t\t\tlet html = app.element;\n\t\t\tif (html instanceof jQuery) html = html[0];\n\t\t\tconst el = html.querySelector(`.item[data-document-id=\"${item.id}\"] .lil-entry-info`);\n\t\t\tif (el) addDetails(el, item);\n\t\t}\n\t}\n}\n\nfunction enable() {\n\tHooks.on('updateItem', onUpdateItem);\n\tHooks.on('renderItemDirectory', onRenderItemDirectory);\n}\n\nfunction disable() {\n\tHooks.off('updateItem', onUpdateItem);\n\tHooks.off('renderItemDirectory', onRenderItemDirectory);\n\treturn false;\n}\n\nnew Feature({ setting: 'enrich-items-directory', label: 'Enrich Items Directory', hint: 'Add additional information to items directory.', category: 'foundry-ui', enable, disable, stage: 'setup' });\n",
    "import { i18n } from '@root/utility/i18n.mjs';\n\n/**\n * @param {string} type\n */\nexport function getItemMainTypeLabel(type) {\n\treturn i18n.get(CONFIG.Item.typeLabels[type]);\n}\n\n/**\n * @param {Item} item\n * @param {string} type\n * @param {string} subType\n * @returns {string}\n */\nexport function getFullItemTypeLabel(item, type, subType) {\n\tconst showIdentified = !item.showUnidentifiedData;\n\n\tconst itemData = item.system;\n\tswitch (type) {\n\t\tcase 'equipment':\n\t\t\tif (['armor', 'shield'].includes(subType)) {\n\t\t\t\tlet subType2 = itemData.equipmentSubtype;\n\t\t\t\tif (!subType2) {\n\t\t\t\t\tif (subType === 'armor') subType2 ||= 'lightArmor';\n\t\t\t\t\telse if (subType === 'shield') subType2 ||= 'lightShield';\n\t\t\t\t}\n\t\t\t\treturn pf1.config.equipmentTypes[subType]?.[subType2];\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (!showIdentified && subType !== 'clothing') return i18n.get(CONFIG.Item.typeLabels.equipment);\n\n\t\t\t\tconst label = pf1.config.equipmentTypes[subType]?._label;\n\t\t\t\tconst slot = item.system.slot || 'slotless';\n\t\t\t\tif (['wondrous', 'other'].includes(subType)) {\n\t\t\t\t\tconst slabel = pf1.config.equipmentSlots[subType][slot];\n\t\t\t\t\tif (slabel) return `${label} (${slabel})`;\n\t\t\t\t}\n\t\t\t\treturn label;\n\t\t\t}\n\n\t\tcase 'loot': {\n\t\t\tif (!showIdentified) return i18n.get(CONFIG.Item.typeLabels.loot);\n\t\t\tconst label = pf1.config.lootTypes[subType];\n\t\t\tif (subType === 'ammo') {\n\t\t\t\tconst subLabel = pf1.config.ammoTypes[itemData.extraType];\n\t\t\t\treturn subLabel ? `${label} [${subLabel}]` : label;\n\t\t\t}\n\t\t\treturn label;\n\t\t}\n\t\tcase 'feat': {\n\t\t\tconst ablType = pf1.config.abilityTypes[itemData.abilityType]?.short; // Ex, Su, Sp\n\t\t\tconst label = pf1.config.featTypes[subType];\n\t\t\tif (ablType) return `${label} (${ablType})`;\n\t\t\tif (subType === 'misc') return `${i18n.get('PF1.Feature')} [${label}]`;\n\t\t\treturn label;\n\t\t}\n\t\tcase 'consumable':\n\t\t\tif (showIdentified)\n\t\t\t\treturn `${i18n.get(CONFIG.Item.typeLabels.consumable)} [${pf1.config.consumableTypes[subType]}]`;\n\t\t\telse return i18n.get(CONFIG.Item.typeLabels.consumable);\n\t\tcase 'class':\n\t\t\treturn pf1.config.classTypes[subType];\n\t\tcase 'race':\n\t\t\treturn i18n.get(CONFIG.Item.typeLabels.race);\n\t\tcase 'container':\n\t\t\treturn i18n.get(CONFIG.Item.typeLabels.container);\n\t\t/*\n\t\tcase 'weapon':\n\t\tcase 'attack':\n\t\tcase 'buff':\n\t\tcase 'spell':\n\t\t*/\n\t\tdefault:\n\t\t\treturn i18n.get(CONFIG.Item.typeLabels[type]);\n\t}\n}\n\n/**\n * @param {Item} item\n * @param {string} type\n * @param {string} subType\n * @returns {string}\n */\nexport function getItemSubTypeLabel(item, type, subType) {\n\tconst itemData = item.system;\n\tswitch (type) {\n\t\tcase 'equipment': {\n\t\t\tconst subType2 = itemData.equipmentSubtype;\n\t\t\treturn pf1.config.equipmentTypes[subType][subType2];\n\t\t}\n\t\tcase 'loot': {\n\t\t\tconst label = pf1.config.lootTypes[subType];\n\t\t\tif (subType === 'ammo') {\n\t\t\t\tconst subLabel = pf1.config.ammoTypes[itemData.extraType];\n\t\t\t\treturn subLabel ? `${label} [${subLabel}]` : label;\n\t\t\t}\n\t\t\treturn label;\n\t\t}\n\t\tcase 'feat':\n\t\t\treturn pf1.config.featTypes[subType];\n\t\tcase 'consumable':\n\t\t\treturn pf1.config.consumableTypes[subType];\n\t\tcase 'class':\n\t\t\treturn pf1.config.classTypes[subType];\n\t\tcase 'buff':\n\t\t\treturn i18n.get(pf1.config.buffTypes[subType]);\n\t\tcase 'attack':\n\t\t\treturn pf1.config.attackTypes[subType];\n\t\t/*\n\t\tcase 'race':\n\t\tcase 'container':\n\t\tcase 'weapon':\n\t\tcase 'spell':\n\t\t\treturn;\n\t\t*/\n\t}\n}\n",
    "import { Feature } from '@root/core/feature.mjs';\nimport { createNode, formatNum } from '@root/common.mjs';\nimport { getItemSubTypeLabel, getItemMainTypeLabel } from '@root/helpers/item.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nlet ownership;\n\n/**\n * @param {Item} item\n * @param {HTMLElement} d\n */\nfunction addRaceInfo(item, d) {\n\tconst itemData = item.system;\n\tconst type = itemData.creatureType;\n\tif (type) {\n\t\tconst typeEl = createNode('div', undefined, ['creature-type']);\n\t\ttypeEl.append(\n\t\t\tcreateNode('label', i18n.get('PF1.CreatureType'), ['label']),\n\t\t\tcreateNode('span', `${pf1.config.creatureTypes[type]}`, ['value', 'text', 'span-3']),\n\t\t);\n\t\td.append(typeEl);\n\t}\n\n\tconst size = itemData.size;\n\tif (itemData.size > 0) {\n\t\tconst typeEl = createNode('div', undefined, ['size']);\n\t\ttypeEl.append(\n\t\t\tcreateNode('label', i18n.get('PF1.Size'), ['label']),\n\t\t\tcreateNode('span', `${pf1.config.actorSizes[size]}`, ['value', 'text', 'span-3']),\n\t\t);\n\t\td.append(typeEl);\n\t}\n\n\tif (itemData.subTypes?.length) {\n\t\tconst subtypeList = createNode('ul', undefined, ['subtypes-list', 'span-4']);\n\t\tfor (const type of itemData.subTypes) {\n\t\t\tconst subtypeLiEl = createNode('li', undefined, ['owner']);\n\t\t\tsubtypeLiEl.append(\n\t\t\t\tcreateNode('span', type, ['value', 'text']),\n\t\t\t);\n\t\t\tsubtypeList.append(subtypeLiEl);\n\t\t}\n\t\tconst subtypesEl = createNode('div', undefined, ['subtypes']);\n\t\tsubtypesEl.append(\n\t\t\tcreateNode('label', i18n.get('PF1.RaceSubtypePlural'), ['label', 'span-4']),\n\t\t\tsubtypeList,\n\t\t);\n\t\td.append(subtypesEl);\n\t}\n}\n\n/**\n * @param {HTMLElement} parent\n * @param {Item} item\n */\nasync function generateItemTooltip(parent, item) {\n\tconst fragment = document.createDocumentFragment();\n\n\tconst permLevel = item.permission;\n\n\tconst isGM = game.user.isGM;\n\n\tconst itemData = item.system;\n\n\tconst isIdentified = game.user.isGM || (itemData.identified ?? true);\n\n\tconst nameLabel = createNode('h3', item.name, ['name', 'span-4']);\n\tfragment.append(nameLabel);\n\n\tconst typeLabel = getItemMainTypeLabel(item.type);\n\tconst typeEl = createNode('div', undefined, ['type']);\n\ttypeEl.append(\n\t\tcreateNode('label', i18n.get('PF1.Type'), ['label']),\n\t\tcreateNode('span', i18n.get(typeLabel), ['value', 'text', 'span-3']),\n\t);\n\tfragment.append(typeEl);\n\n\t// Display subtype for everything else except consumables unless they're identified\n\tif (!(!isIdentified && item.type === 'consumable')) {\n\t\tconst subtype = item.subType;\n\t\tconst sublabel = getItemSubTypeLabel(item, item.type, subtype);\n\t\tif (sublabel) {\n\t\t\tconst subtypeEl = createNode('div', undefined, ['subtype']);\n\n\t\t\tsubtypeEl.append(\n\t\t\t\tcreateNode('label', i18n.get('PF1.Subtype'), ['label']),\n\t\t\t\tcreateNode('span', sublabel, ['value', 'text', 'span-3']),\n\t\t\t);\n\t\t\tfragment.append(subtypeEl);\n\t\t}\n\t}\n\n\tif (item.type === 'race')\n\t\taddRaceInfo(item, fragment);\n\n\tif (Number.isFinite(itemData.quantity) && itemData.quantity !== 1) {\n\t\tconst gpEl = createNode('div', undefined, ['quantity']);\n\t\tgpEl.append(\n\t\t\tcreateNode('label', i18n.get('PF1.Quantity'), ['label']),\n\t\t\tcreateNode('span', `${itemData.quantity}`, ['value', 'number', 'span-3']),\n\t\t);\n\t\tfragment.append(gpEl);\n\t}\n\n\tconst value = item.isPhysical ? item.getValue({ inLowestDenomination: true, sellValue: 1, single: true }) : Number.NaN;\n\tif (!Number.isNaN(value)) {\n\t\tconst gpEl = createNode('div', undefined, ['gold-value']);\n\t\tconst gpValueEl = createNode('span', undefined, ['simple-value']);\n\t\tgpValueEl.append(createNode('span', `${formatNum(value / 100)}`, ['value', 'number']), 'Â ðŸœš');\n\t\tgpEl.append(createNode('label', i18n.get('PF1.Value'), ['label']), gpValueEl);\n\t\tfragment.append(gpEl);\n\t}\n\n\tconst weight = itemData.weight;\n\tif (Number.isFinite(weight?.total)) {\n\t\tconst weightEl = createNode('div', undefined, ['weight-value']);\n\t\tconst weightValueEl = createNode('span', undefined, ['simple-value']);\n\t\tconst ws = pf1.utils.getWeightSystem();\n\t\tconst units = ws === 'metric' ? 'PF1.Kgs' : 'PF1.Lbs';\n\n\t\tweightValueEl.append(createNode('span', `${pf1.utils.limitPrecision(weight.converted.total, 2)}`, ['value', 'number']), `Â ${i18n.get(units)}`);\n\t\tweightEl.append(createNode('label', i18n.get('PF1.Weight'), ['label']), weightValueEl);\n\t\tfragment.append(weightEl);\n\t}\n\n\t// Spell info\n\tif (item.type === 'spell') {\n\t\tconst school = createNode('div', undefined, ['school']);\n\t\tconst label = pf1.config.spellSchools[itemData.school] || i18n.get('PF1.Undefined');\n\t\tschool.append(\n\t\t\tcreateNode('label', i18n.get('PF1.School'), ['label']),\n\t\t\tcreateNode('span', label, ['value', 'string', 'span-3']),\n\t\t);\n\t\tfragment.append(school);\n\t}\n\n\t/*\n\tif (Number.isFinite(itemData.hardness)) {\n\t\tconst hardnessEl = createNode('div', null, ['gold-value']);\n\t\thardnessEl.append(\n\t\t\tcreateNode('label', 'Hardness', ['label']),\n\t\t\tcreateNode('span', `${itemData.hardness}`, ['value', 'number', 'span-3']),\n\t\t);\n\t\td.append(hardnessEl);\n\t}\n\t*/\n\n\townership ??= {\n\t\tdefault: i18n.get('OWNERSHIP.DEFAULT'),\n\t\t1: i18n.get('OWNERSHIP.LIMITED'),\n\t\t2: i18n.get('OWNERSHIP.OBSERVER'),\n\t\t3: i18n.get('OWNERSHIP.OWNER'),\n\t};\n\n\t// Owners\n\tconst owners = game.users.players\n\t\t.filter(u => item.testUserPermission(u, 'LIMITED'))\n\t\t.map(u => [u, item.ownership[u.id]]);\n\n\tconst defaultOwnership = item.ownership.default;\n\n\tif (defaultOwnership > 0 || owners.length > 0) {\n\t\tconst ownerList = createNode('ul', undefined, ['owner-list', 'span-4']);\n\t\tconst addOwner = (name, level) => {\n\t\t\tconst ownerLiEl = createNode('li', undefined, ['owner']);\n\t\t\tlevel ??= 'default';\n\t\t\townerLiEl.append(\n\t\t\t\tcreateNode('span', name, ['text', 'value']),\n\t\t\t\tcreateNode('span', ownership[level], ['value', 'text']),\n\t\t\t);\n\t\t\townerList.append(ownerLiEl);\n\t\t};\n\n\t\tif (defaultOwnership > 0) addOwner(ownership.default, defaultOwnership);\n\t\tfor (const user of owners) addOwner(user.name, item.ownership[user.id]);\n\n\t\tconst ownerEl = createNode('div', undefined, ['ownership']);\n\t\townerEl.append(\n\t\t\tcreateNode('label', i18n.get('Permissions'), ['label', 'span-4']),\n\t\t\townerList,\n\t\t);\n\t\tfragment.append(ownerEl);\n\t}\n\n\t// Aura is not visible with limited permission items\n\tif (permLevel > CONST.DOCUMENT_OWNERSHIP_LEVELS.LIMITED && isIdentified && itemData.cl > 0) {\n\t\tconst school = itemData.aura.school,\n\t\t\tschoolLabel = itemData.aura.custom ? school : pf1.config.spellSchools[school],\n\t\t\tauraStrength = pf1.config.auraStrengths[item.auraStrength],\n\t\t\tauraLabel = i18n.get('LittleHelper.Aura', { school: schoolLabel, strength: auraStrength }),\n\t\t\tauraEl = createNode('div', undefined, ['aura-value']);\n\t\tauraEl.append(\n\t\t\tcreateNode('label', 'Aura', ['label']),\n\t\t\tcreateNode('span', auraLabel, ['value', 'text', 'span-3']),\n\t\t);\n\t\tfragment.append(auraEl);\n\t}\n\n\tif (isGM) {\n\t\tconst ident = itemData.identified;\n\t\tif (ident !== undefined) {\n\t\t\tconst identEl = createNode('div', undefined, ['identified']),\n\t\t\t\tidentLabel = i18n.get(ident ? 'Yes' : 'No');\n\t\t\tidentEl.append(\n\t\t\t\tcreateNode('label', i18n.get('PF1.Identified'), ['label']),\n\t\t\t\tcreateNode('span', identLabel, ['value', 'boolean', 'identified-state', ident ? 'identified' : 'unidentified', ident ? 'true' : 'false', 'span-3']),\n\t\t\t);\n\t\t\tfragment.append(identEl);\n\t\t}\n\t}\n\n\t/** @type {TooltipManager} */\n\tconst tt = CONFIG.ux.TooltipManager;\n\n\tconst ttData = {\n\t\thtml: fragment,\n\t\tcssClass: 'lil-directory-tooltip',\n\t\tdirection: tt.TOOLTIP_DIRECTIONS.LEFT, // TODO: Reactive side\n\t};\n\n\tgame.tooltip.activate(parent, ttData);\n};\n\n/**\n * @param {Item} item\n * @param {HTMLElement} dom\n */\nfunction hookItemTooltip(dom, item) {\n\tif (!item.testUserPermission(game.user, 'LIMITED')) return;\n\n\tdom.addEventListener('pointerenter', () => generateItemTooltip(dom, item), { passive: true });\n}\n\n/**\n * @param {ItemDirectory} app\n * @param {HTMLElement} html\n */\nfunction hookItemDirectoryTooltips(app, html) {\n\tif (html instanceof jQuery) html = html[0];\n\n\tconst listing = html.querySelector('ol.directory-list');\n\tif (!listing) return;\n\n\tfor (const el of listing.querySelectorAll('.entry[data-entry-id]')) {\n\t\thookItemTooltip(el, game.items.get(el.dataset.entryId));\n\t}\n}\n\nfunction enable() {\n\tHooks.on('renderItemDirectory', hookItemDirectoryTooltips);\n}\n\nfunction disable() {\n\tHooks.off('renderItemDirectory', hookItemDirectoryTooltips);\n\treturn false;\n}\n\nnew Feature({ setting: 'item-list-tooltip', label: 'Items Directory Tooltips', hint: 'Item tooltips for the sidebar directory, providing basic info.', category: 'foundry-ui', enable, disable, stage: 'init' });\n",
    "import { Feature } from '@root/core/feature.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nlet ownership;\n\n/**\n * @param parent\n * @param {RollTable} table\n * @param {HTMLElement} tt\n */\nconst generateRollTableTooltip = async (parent, table) => {\n\tconst fragment = document.createDocumentFragment();\n\n\tconst nameLabel = createNode('h3', table.name, ['name', 'span-4']);\n\tfragment.append(nameLabel);\n\n\townership ??= {\n\t\tdefault: i18n.get('OWNERSHIP.DEFAULT'),\n\t\t0: i18n.get('OWNERSHIP.NONE'),\n\t\t1: i18n.get('OWNERSHIP.LIMITED'),\n\t\t2: i18n.get('OWNERSHIP.OBSERVER'),\n\t\t3: i18n.get('OWNERSHIP.OWNER'),\n\t};\n\n\tconst rollFormula = createNode('div', null, ['formula']);\n\trollFormula.append(\n\t\tcreateNode('label', 'Formula'),\n\t\tcreateNode('span', table.formula, ['value', 'string', 'formula', 'span-3']),\n\t);\n\tconst results = createNode('div', null, ['results']);\n\tresults.append(\n\t\tcreateNode('label', 'Results'),\n\t\tcreateNode('span', `${table.results.size}`, ['value', 'number', 'result-count', 'span-3']),\n\t);\n\tfragment.append(rollFormula, results);\n\n\t// Owners\n\tconst owners = game.users?.players.filter(u => table.testUserPermission(u, 'LIMITED'));\n\n\tconst defaultOwnership = table.ownership.default;\n\n\tconst ownerList = createNode('ul', null, ['owner-list', 'span-4']);\n\tconst addOwner = (name, level) => {\n\t\tconst ownerLiEl = createNode('li', null, ['owner']);\n\t\tlevel ??= 'default';\n\t\townerLiEl.append(\n\t\t\tcreateNode('span', name, ['text', 'value']),\n\t\t\tcreateNode('span', ownership[level], ['value', 'text', 'ownership', `level-${level}`]),\n\t\t);\n\t\townerList.append(ownerLiEl);\n\t};\n\n\tif (defaultOwnership > 0)\taddOwner(ownership.default, defaultOwnership);\n\tfor (const user of owners) addOwner(user.name, table.ownership[user.id]);\n\n\tif (owners.length === 0) ownerList.append(createNode('li', 'No user access', ['error']));\n\n\tconst ownerEl = createNode('div', null, ['ownership']);\n\townerEl.append(\n\t\tcreateNode('label', i18n.get('Permissions'), ['label', 'span-4']),\n\t\townerList,\n\t);\n\tfragment.append(ownerEl);\n\n\t/** @type {TooltipManager} */\n\tconst tt = CONFIG.ux.TooltipManager;\n\n\tconst ttData = {\n\t\thtml: fragment,\n\t\tcssClass: 'lil-directory-tooltip',\n\t\tdirection: tt.TOOLTIP_DIRECTIONS.LEFT, // TODO: Reactive side\n\t};\n\n\tgame.tooltip.activate(parent, ttData);\n};\n\n/**\n * @param {HTMLElement} dom\n * @param {RollTable} table\n */\nfunction hookRollTableTooltip(dom, table) {\n\t// Pointless\n\t// if (!table.testUserPermission(game.user, CONST.DOCUMENT_OWNERSHIP_LEVELS.LIMITED)) return;\n\n\tdom.addEventListener('pointerenter', () => generateRollTableTooltip(dom, table), { passive: true });\n}\n\n/**\n * @param {SceneDirectory} app\n * @param {HTMLElement} html\n */\nconst hookRollTableDirectoryTooltips = (app, html) => {\n\tif (html instanceof jQuery) html = html[0];\n\n\tconst listing = html.querySelector('ol.directory-list');\n\tif (!listing) return;\n\n\tfor (const el of listing.querySelectorAll('.document[data-document-id],.entry[data-entry-id]')) {\n\t\thookRollTableTooltip(el, game.tables.get(el.dataset.entryId || el.dataset.documentId));\n\t}\n};\n\nconst enable = () => {\n\tHooks.on('renderRollTableDirectory', hookRollTableDirectoryTooltips);\n};\n\nconst disable = () => {\n\tHooks.off('renderRollTableDirectory', hookRollTableDirectoryTooltips);\n\treturn false;\n};\n\nnew Feature({ setting: 'rolltable-list-tooltip', label: 'RollTable List Tooltips', hint: 'RollTable tooltips for the sidebar directory, providing basic info.', category: 'foundry-ui', enable, disable, stage: 'init' });\n",
    "import { Feature } from '@root/core/feature.mjs';\n\n/**\n * @param {SceneDirectory} app\n * @param {HTMLElement} html\n * @param {object} options\n */\nfunction compressSceneDirectory(app, html, options) {\n\thtml.style.setProperty('--sidebar-scene-height', '60px');\n}\n\nfunction enable() {\n\tHooks.on('renderSceneDirectory', compressSceneDirectory);\n}\n\nfunction disable() {\n\treturn false;\n}\n\nnew Feature({ setting: 'compress-scene-directory', label: 'Compress Scene Directory', hint: 'Reduces the space each scene takes.', category: 'foundry-ui', enable, disable, stage: 'init', enabledByDefault: false });\n",
    "import { Feature } from '@root/core/feature.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nlet ownership;\n\n/**\n * @param {HTMLElement} parent\n * @param {Scene} scene\n */\nasync function generateSceneTooltip(parent, scene) {\n\tconst fragment = document.createDocumentFragment();\n\n\tconst nameLabel = createNode('h3', scene.name, ['name', 'span-4']);\n\tfragment.append(nameLabel);\n\n\tconst displayName = scene.navName;\n\tif (displayName) {\n\t\tconst nameEl = createNode('div', null, ['navigation-name']);\n\t\tnameEl.append(\n\t\t\tcreateNode('h3', displayName, ['value', 'text', 'span-4']),\n\t\t);\n\t\tfragment.append(nameEl);\n\t}\n\n\tconst navEl = createNode('div', null, ['navigation']),\n\t\tnavLabel = i18n.get(scene.navigation ? 'Yes' : 'No');\n\tnavEl.append(\n\t\tcreateNode('label', i18n.get('Navigation'), ['label']),\n\t\tcreateNode('span', navLabel, ['value', 'boolean', 'navigation-state', scene.navigation ? 'navigatable' : 'unnavigatable', scene.navigation ? 'true' : 'false', 'span-3']),\n\t);\n\tfragment.append(navEl);\n\n\tconst visionEl = createNode('div', null, ['fog']),\n\t\tvision = scene.tokenVision,\n\t\tvisionLabel = i18n.get(vision ? 'Yes' : 'No');\n\tvisionEl.append(\n\t\tcreateNode('label', i18n.get('Vision'), ['label']),\n\t\tcreateNode('span', visionLabel, ['value', 'boolean', 'vision-state', vision ? 'token' : 'universal', vision ? 'true' : 'false', 'span-3']),\n\t);\n\tfragment.append(visionEl);\n\n\tconst fogEl = createNode('div', null, ['fog']),\n\t\tfog = scene.fog?.exploration ?? scene.fogExploration, // TODO: remove fogExploration when v11 support is removed\n\t\tfogLabel = i18n.get(fog ? 'Yes' : 'No');\n\tfogEl.append(\n\t\tcreateNode('label', i18n.get('Fog'), ['label']),\n\t\tcreateNode('span', fogLabel, ['value', 'boolean', 'fog-state', fog ? 'fogged' : 'fogless', fog ? 'true' : 'false', 'span-3']),\n\t);\n\tfragment.append(fogEl);\n\n\t/** @type {TooltipManager} */\n\tconst tt = CONFIG.ux.TooltipManager;\n\n\tconst ttData = {\n\t\thtml: fragment,\n\t\tcssClass: 'lil-directory-tooltip',\n\t\tdirection: tt.TOOLTIP_DIRECTIONS.LEFT,\n\t};\n\n\tgame.tooltip.activate(parent, ttData);\n};\n\n/**\n * @param {Scene} scene\n * @param {HTMLElement} dom\n */\nfunction hookSceneTooltip(scene, dom) {\n\t// if (!scene.testUserPermission(game.user, CONST.DOCUMENT_OWNERSHIP_LEVELS.LIMITED)) return;\n\n\tdom.addEventListener('pointerenter', () => generateSceneTooltip(dom, scene), { passive: true });\n}\n\n/**\n * @param {SceneDirectory} app\n * @param {HTMLElement} html\n */\nfunction hookSceneDirectoryTooltips(app, html) {\n\tif (html instanceof jQuery) html = html[0];\n\n\tconst listing = html.querySelector('ol.directory-list');\n\tif (!listing) return;\n\n\tfor (const el of listing.querySelectorAll('.document[data-document-id]')) {\n\t\thookSceneTooltip(game.scenes.get(el.dataset.documentId), el);\n\t}\n}\n\nfunction enable() {\n\tHooks.on('renderSceneDirectory', hookSceneDirectoryTooltips);\n}\n\nfunction disable() {\n\tHooks.off('renderSceneDirectory', hookSceneDirectoryTooltips);\n\treturn false;\n}\n\nnew Feature({ setting: 'scene-list-tooltip', label: 'Scene List Tooltips', hint: 'Scene tooltips for the sidebar directory, providing basic info.', category: 'foundry-ui', enable, disable, stage: 'init' });\n",
    "import { Feature } from '@root/core/feature.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nlet ownership;\n\n/**\n * @param {HTMLElement} parent\n * @param {JournalEntry} journal\n */\nasync function generateJournalTooltip(parent, journal) {\n\tconst fragment = document.createDocumentFragment();\n\n\tconst nameLabel = createNode('h3', journal.name, ['name', 'span-4']);\n\tfragment.append(nameLabel);\n\n\townership ??= {\n\t\tdefault: i18n.get('OWNERSHIP.DEFAULT'),\n\t\t0: i18n.get('OWNERSHIP.NONE'),\n\t\t1: i18n.get('OWNERSHIP.LIMITED'),\n\t\t2: i18n.get('OWNERSHIP.OBSERVER'),\n\t\t3: i18n.get('OWNERSHIP.OWNER'),\n\t};\n\n\t// Pages\n\tconst pages = journal.pages.size ?? 0;\n\tconst pgEl = createNode('div', null, ['page-count']);\n\tconst pgValueEl = createNode('span', null, ['simple-value']);\n\tpgValueEl.append(createNode('span', `${pages}`, ['value', 'number', 'pages', pages > 0 ? 'finite' : 'empty']), 'Â ðŸ—');\n\tpgEl.append(\n\t\tcreateNode('label', i18n.get('Pages'), ['label']),\n\t\tpgValueEl,\n\t);\n\tfragment.append(pgEl);\n\n\t// Owners\n\tconst owners = game.users.players\n\t\t.filter(u => journal.testUserPermission(u, 'LIMITED'));\n\n\tconst ownerList = createNode('ul', null, ['owner-list', 'span-4']);\n\tconst addOwner = (name, level) => {\n\t\tconst ownerLiEl = createNode('li', null, ['owner']);\n\t\tlevel ??= 'default';\n\t\townerLiEl.append(\n\t\t\tcreateNode('span', name, ['text', 'value']),\n\t\t\tcreateNode('span', ownership[level], ['value', 'text', 'ownership', `level-${level}`]),\n\t\t);\n\t\townerList.append(ownerLiEl);\n\t};\n\n\tconst defaultOwnership = journal.ownership.default;\n\tif (defaultOwnership > 0) addOwner(ownership.default, defaultOwnership);\n\tfor (const user of owners) addOwner(user.name, journal.ownership[user.id]);\n\tif (owners.length === 0) ownerList.append(createNode('li', 'No user access', ['error']));\n\n\tconst ownerEl = createNode('div', null, ['ownership']);\n\townerEl.append(\n\t\tcreateNode('label', i18n.get('Permissions'), ['label', 'span-4']),\n\t\townerList,\n\t);\n\tfragment.append(ownerEl);\n\n\t/** @type {TooltipManager} */\n\tconst tt = CONFIG.ux.TooltipManager;\n\n\tconst ttData = {\n\t\thtml: fragment,\n\t\tcssClass: 'lil-directory-tooltip',\n\t\tdirection: tt.TOOLTIP_DIRECTIONS.LEFT, // TODO: Reactive side\n\t};\n\n\tgame.tooltip.activate(parent, ttData);\n};\n\n/**\n * @param {HTMLElement} dom\n * @param {RollTable} table\n */\nfunction hookJournalTooltip(dom, table) {\n\t// if (!table.testUserPermission(game.user, CONST.DOCUMENT_OWNERSHIP_LEVELS.LIMITED)) return;\n\n\tdom.addEventListener('pointerenter', () => generateJournalTooltip(dom, table), { passive: true });\n}\n\n/**\n * @param {SceneDirectory} app\n * @param {HTMLElement} html\n */\nfunction hookJournalDirectoryTooltips(app, html) {\n\tif (html instanceof jQuery) html = html[0];\n\n\tconst listing = html.querySelector('ol.directory-list');\n\tif (!listing) return;\n\n\tfor (const el of listing.querySelectorAll('.entry[data-entry-id],.document[data-document-id]')) {\n\t\thookJournalTooltip(el, game.journal.get(el.dataset.entryId || el.dataset.documentId));\n\t}\n};\n\nconst enable = () => {\n\tHooks.on('renderJournalDirectory', hookJournalDirectoryTooltips);\n};\n\nconst disable = () => {\n\tHooks.off('renderJournalDirectory', hookJournalDirectoryTooltips);\n\treturn false;\n};\n\nnew Feature({ setting: 'journal-list-tooltip', label: 'Journal List Tooltips', hint: 'Journal tooltips for the sidebar directory, providing basic info.', category: 'foundry-ui', enable, disable, stage: 'init' });\n",
    "import { Feature } from '@root/core/feature.mjs';\nimport { FAIcons } from '@root/core/icons.mjs';\n\n/**\n * @param _\n * @param {object[]} entries\n */\nfunction insertOpenActionSheetContextOption(_, entries) {\n\tentries.unshift({\n\t\tname: 'LittleHelper.UI.OpenActionSheet',\n\t\ticon: `<i class=\"${FAIcons.fileAlt}\"></i>`,\n\t\tcondition: (html) => {\n\t\t\tif (html instanceof jQuery) html = html[0];\n\n\t\t\t/** @type {ChatMessagePF} */\n\t\t\tconst cm = game.messages.get(html.dataset.messageId);\n\n\t\t\treturn cm.actionSource && (cm.itemSource?.testUserPermission(game.user, 'OBSERVER') ?? false);\n\t\t},\n\t\tcallback: (html) => {\n\t\t\tif (html instanceof jQuery) html = html[0];\n\n\t\t\t/** @type {ChatMessagePF} */\n\t\t\tconst cm = game.messages.get(html.dataset.messageId);\n\t\t\tcm.actionSource?.sheet.render(true, { focus: true });\n\t\t},\n\t});\n}\n\nfunction enable() {\n\tHooks.on('getChatLogEntryContext', insertOpenActionSheetContextOption);\n}\n\nfunction disable() {\n\tHooks.off('getChatLogEntryContext', insertOpenActionSheetContextOption);\n}\n\nnew Feature({ setting: 'chatlog-open-action', label: 'Context Menu Action Sheet', hint: 'Adds context menu option to open the relevant action sheet directly.', category: 'chat-card', enable, disable, stage: 'init' });\n",
    "import { Feature } from '@root/core/feature.mjs';\nimport { FAIcons } from '@root/core/icons.mjs';\n\n/**\n * @param {JQuery|Application} _app\n * @param {object[]} entries\n */\nfunction insertOpenItemSheetContextOption(_app, entries) {\n\tentries.unshift({\n\t\tname: 'LittleHelper.UI.OpenItemSheet',\n\t\ticon: `<i class=\"${FAIcons.fileAlt}\"></i>`,\n\t\tcondition: function (html) {\n\t\t\tif (html instanceof jQuery) html = html[0];\n\n\t\t\tconst cm = game.messages.get(html.dataset.messageId);\n\t\t\treturn cm.itemSource?.testUserPermission(game.user, 'OBSERVER') ?? false;\n\t\t},\n\t\tcallback: function (html) {\n\t\t\tif (html instanceof jQuery) html = html[0];\n\n\t\t\tconst cm = game.messages.get(html.dataset.messageId);\n\t\t\tcm.itemSource?.sheet.render(true, { focus: true });\n\t\t},\n\t});\n}\n\nfunction enable() {\n\tHooks.on('getChatLogEntryContext', insertOpenItemSheetContextOption);\n}\n\nfunction disable() {\n\tHooks.off('getChatLogEntryContext', insertOpenItemSheetContextOption);\n}\n\nnew Feature({ setting: 'chatlog-open-item', label: 'Context Menu Item Sheet', hint: 'Adds context menu option to open the relevant item sheet directly.', category: 'chat-card', enable, disable, stage: 'init' });\n",
    "import { Feature } from '@root/core/feature.mjs';\nimport { FAIcons } from '@root/core/icons.mjs';\n\n/**\n * @param _\n * @param {object[]} entries\n */\nfunction insertOpenActorSheetContextOption(_, entries) {\n\tentries.unshift({\n\t\tname: 'LittleHelper.UI.OpenActorSheet',\n\t\ticon: `<i class=\"${FAIcons.fileAlt}\"></i>`,\n\t\tcondition: (html) => {\n\t\t\tif (html instanceof jQuery) html = html[0];\n\n\t\t\tconst cm = game.messages.get(html.dataset.messageId);\n\t\t\tconst actor = ChatMessage.getSpeakerActor(cm?.speaker);\n\t\t\treturn actor?.testUserPermission(game.user, 'OBSERVER') ?? false;\n\t\t},\n\t\tcallback: (html) => {\n\t\t\tif (html instanceof jQuery) html = html[0];\n\n\t\t\tconst cm = game.messages.get(html.dataset.messageId);\n\t\t\tconst actor = ChatMessage.getSpeakerActor(cm?.speaker);\n\t\t\tactor?.sheet?.render(true, { focus: true, token: actor.token });\n\t\t},\n\t});\n}\n\nfunction enable() {\n\tHooks.on('getChatLogEntryContext', insertOpenActorSheetContextOption);\n}\n\nfunction disable() {\n\tHooks.off('getChatLogEntryContext', insertOpenActorSheetContextOption);\n}\n\nnew Feature({ setting: 'chatlog-open-actor', label: 'Context Menu Actor Sheet', hint: 'Adds context menu option to open the relevant actor sheet directly.', category: 'chat-card', enable, disable, stage: 'init' });\n",
    "/**\n * Adds little refresh button to sheets to force re-render.\n */\n\nimport { Feature } from '@root/core/feature.mjs';\nimport { FAIcons } from '@root/core/icons.mjs';\n\nfunction injectIDButton(sheet, buttons) {\n\tbuttons.unshift({\n\t\tclass: 'little-helper-sheet-refresh',\n\t\ticon: FAIcons.syncAlt,\n\t\t// label: i18n.get('LittleHelper.UI.RefreshButton'),\n\t\tonclick: _ => sheet.render(),\n\t});\n}\n\nconst events = [\n\t'getDocumentSheetHeaderButtons',\n\t'getActorSheetHeaderButtons', // weirdly not documentSheet\n\t'getItemSheetHeaderButtons', // weirdly not documentSheet\n\t// 'getJournalSheetHeaderButtons', // documentSheet\n\t// 'getRollTableConfigHeaderButtons', // documentSheet\n\t'getCompendiumHeaderButtons',\n\t// 'getSceneConfigHeaderButtons', // documentSheet\n\t// 'getCombatantConfigHeaderButtons', // documentSheet\n\t'getTokenConfigHeaderButtons',\n\t// 'getWallConfigHeaderButtons' // documentSheet\n];\n\nfunction enable() {\n\tsetTimeout(() => {\n\t\tfor (const ev of events)\n\t\t\tHooks.on(ev, injectIDButton);\n\t}, this.ready ? 0 : 2_000);\n\tthis.ready = true;\n}\n\nfunction disable() {\n\tfor (const ev of events)\n\t\tHooks.off(ev, injectIDButton);\n}\n\nnew Feature({ setting: 'sheet-refresh', label: 'Sheet Refresh', hint: 'Display button on sheet header to force refresh.', category: 'dev', enable, disable, stage: 'ready', enabledByDefault: false });\n",
    "// Automatically pop out combat tracker if there is active combat.\n\n// TODO: Add option to change default position?\n\nimport { Feature, SubSetting } from '@root/core/feature.mjs';\n\nfunction popOutCombatTracker() {\n\tif (game.combat?.started) {\n\t\tui.combat?.createPopout()?.render(true);\n\t}\n}\n\n/**\n * @param {Combat} combat\n * @param _update\n * @param {object} context\n */\nfunction preUpdateCombatEvent(combat, _update, context) {\n\tcontext.__littleHelper ??= {};\n\tcontext.__littleHelper.started = combat.started;\n}\n\n/**\n * @param {Combat} combat\n * @param update\n * @param {object} context\n */\nfunction updateCombatEvent(combat, update, context) {\n\tif (update.round === 1 || !context.__littleHelper?.started && combat.started)\n\t\tpopOutCombatTracker();\n}\n\nfunction enable() {\n\tHooks.on('preUpdateCombat', preUpdateCombatEvent);\n\tHooks.on('updateCombat', updateCombatEvent);\n\tHooks.once('ready', () => setTimeout(popOutCombatTracker, 200));\n}\n\nfunction disable() {\n\tHooks.off('preUpdateCombat', preUpdateCombatEvent);\n\tHooks.off('updateCombat', updateCombatEvent);\n}\n\nnew Feature({\n\tsetting: 'combat-auto-popout',\n\tlabel: 'Combat Auto-Popout',\n\thint: 'Automatically pops out the combat tracker when combat starts and on login if combat has already started.',\n\tcategory: 'foundry-ui',\n\tenable,\n\tdisable,\n\tstage: 'init',\n\tenabledByDefault: false,\n\t/*\n\tsubsettings: {\n\t\tposition: new SubSetting({\n\t\t\tlabel: 'Set Position',\n\t\t\thint: 'Move combat tracker to specific position.',\n\t\t\ttype: Object,\n\t\t\tfallback: null,\n\t\t\tdisplay: (v) => {\n\t\t\t\tif (v) return `x(${v.x}), y(${v.y})`;\n\t\t\t\telse return 'undefined';\n\t\t\t},\n\t\t\tcallback: {\n\t\t\t\tlabel: 'Set Position',\n\t\t\t\tfn: (_ev, _f, _ss) => {\n\t\t\t\t\tconst ct = Object.values(ui.windows).find(win => win instanceof CombatTracker);\n\t\t\t\t\tif (ct) return { x: ct.position.left, y: ct.position.top };\n\t\t\t\t\telse return null;\n\t\t\t\t}\n\t\t\t}\n\t\t}),\n\t}\n\t*/\n});\n",
    "import { CFG } from '@root/config.mjs';\nimport { Feature } from '@root/core/feature.mjs';\nimport { createNode, clampNum } from '@root/common.mjs';\nimport { healthLabels, evaluateDeathPoint } from '@root/helpers/wounds.mjs';\n\nconst tooltipTemplateSource = /** @type {const} */ (`modules/${CFG.id}/templates/tooltip/combat-tracker.hbs`);\n\nconst havePerm = (c) => c.testUserPermission(game.user, CONST.DOCUMENT_OWNERSHIP_LEVELS.OBSERVER);\n\n/**\n * @param {Combatant} combatant\n */\nfunction collectCombatantData(combatant) {\n\tconst actor = combatant.actor;\n\tif (!actor) return;\n\n\tconst actorData = actor.system,\n\t\tattributes = actorData.attributes,\n\t\thp = attributes.hp,\n\t\tac = attributes.ac,\n\t\tcmd = attributes.cmd;\n\n\tconst context = {\n\t\tactor,\n\t\tcombatant,\n\t\thealth: {\n\t\t\tvalue: hp.value,\n\t\t\tmax: hp.max,\n\t\t\ttemp: hp.temp,\n\t\t\tget effective() { return this.value + this.temp; },\n\t\t\tget percentage() { return this.effective / this.max; },\n\t\t\tget threshold() { return clampNum(4 - Math.ceil(this.percentage * 4), 0, 3); },\n\t\t\tget label() {\n\t\t\t\tconst ehp = this.effective;\n\t\t\t\tif (ehp < 0) return ehp <= evaluateDeathPoint(actor) ? healthLabels.dead : healthLabels.dying;\n\t\t\t\treturn healthLabels[this.threshold];\n\t\t\t},\n\t\t},\n\t\tdefenses: {\n\t\t\tac: {\n\t\t\t\tvalue: ac.normal.total,\n\t\t\t\tff: ac.flatFooted?.total,\n\t\t\t},\n\t\t\ttouch: {\n\t\t\t\tvalue: ac.touch.total,\n\t\t\t\tff: ac.touch.total - (ac?.normal.total - ac?.flatFooted.total),\n\t\t\t},\n\t\t\tcmd: {\n\t\t\t\tvalue: cmd.total,\n\t\t\t\tff: cmd.flatFootedTotal,\n\t\t\t},\n\t\t},\n\t\teffects: actor.appliedEffects.filter(ae => ae.img) // visible effects\n\t\t\t.map(ae => ({ name: ae.name, id: ae.id, img: ae.img })),\n\t};\n\n\treturn context;\n}\n\n/**\n * @param {HTMLElement} parent\n * @param {Combatant} combatant\n */\nfunction generateCombatantTooltip(parent, combatant) {\n\tconst templateData = collectCombatantData(combatant);\n\tif (!templateData) return false;\n\n\tconst tooltipTemplate = Handlebars.partials[tooltipTemplateSource];\n\n\tconst template = document.createElement('template');\n\ttemplate.innerHTML = tooltipTemplate(templateData, { allowProtoMethodsByDefault: true, allowProtoPropertiesByDefault: true });\n\n\t/** @type {TooltipManager} */\n\tconst tt = CONFIG.ux.TooltipManager;\n\n\tconst ttData = {\n\t\thtml: template.content,\n\t\tcssClass: 'lil-directory-tooltip',\n\t\tdirection: tt.TOOLTIP_DIRECTIONS.LEFT, // TODO: Reactive side\n\t};\n\n\tgame.tooltip.activate(parent, ttData);\n}\n\n/**\n * TooltipManager based tooltip handling.\n * BLOCK: Align to top option missing.\n *\n * @param {Combatant} combatant\n * @param {HTMLElement} dom\n */\nfunction generateCombatantTooltipCore(combatant, dom) {\n\tif (!dom) return;\n\tif (!combatant?.actor || !havePerm(combatant)) return;\n\n\tconst tm = CONFIG.ux.TooltipManager;\n\n\tdom.addEventListener('pointerover', async event => {\n\t\tconst templateData = collectCombatantData(combatant);\n\t\tif (!templateData) return;\n\n\t\tconst tooltipTemplate = Handlebars.partials[tooltipTemplateSource];\n\n\t\tconst content = tooltipTemplate(templateData, { allowProtoMethodsByDefault: true, allowProtoPropertiesByDefault: true });\n\n\t\tgame.tooltip.activate(dom, { text: content, direction: tm.TOOLTIP_DIRECTIONS.LEFT, cssClass: 'lil-combatant-tooltip' });\n\t}, { passive: true });\n\n\tdom.addEventListener('pointerleave', () => game.tooltip.deactivate(), { passive: true });\n}\n\n/**\n * @param {Combatant} combatant\n * @param {HTMLElement} dom\n */\nfunction hookCombatantTooltip(dom, combatant) {\n\tif (!dom) return;\n\tif (!combatant?.actor || !havePerm(combatant)) return;\n\n\tif (!['character', 'npc'].includes(combatant.actor?.type)) return;\n\n\tdom.addEventListener('pointerenter', () => generateCombatantTooltip(dom, combatant), { passive: true });\n}\n\n/**\n * @param {CombatTracker} app\n * @param {HTMLElement} html\n */\nfunction hookCombatTrackerTooltips(app, html) {\n\tif (html instanceof jQuery) html = html[0];\n\n\tconst combat = game.combats.viewed;\n\tif (!combat) return;\n\n\t// .directory-list is v12 and prior\n\tconst listing = html.querySelector('ol.combat-tracker,ol.directory-list');\n\tif (!listing) return;\n\n\tfor (const el of listing.querySelectorAll('.combatant[data-combatant-id]')) {\n\t\tconst combatant = combat.combatants.get(el.dataset.combatantId);\n\t\thookCombatantTooltip(el, combatant);\n\t}\n}\n\nfunction enable() {\n\tHooks.on('renderCombatTracker', hookCombatTrackerTooltips);\n\tfoundry.applications.handlebars.loadTemplates([`modules/${CFG.id}/templates/tooltip/combat-tracker.hbs`]);\n}\n\nfunction disable() {\n\tHooks.off('renderCombatTracker', hookCombatTrackerTooltips);\n\treturn false;\n}\n\nnew Feature({ setting: 'combat-tracker-tooltip', label: 'Combat Tracker Tooltip', hint: 'Basic info tooltip for combat tracker.', category: 'foundry-ui', enable, disable, stage: 'init' });\n",
    "import { CFG } from '@root/config.mjs';\nimport { Feature } from '@root/core/feature.mjs';\nimport { createNode } from '@root/common.mjs';\n\n/**\n * @param {CombatTracker} app\n * @param {HTMLElement} html\n * @param {object} options\n */\nfunction renderCombat(app, html, options) {\n\tif (html instanceof jQuery) html = html[0];\n\n\tfor (const el of html.querySelectorAll('.token-initiative .initiative')) {\n\t\tconst [main, tiebreaker] = el.textContent.split('.', 2);\n\t\tif (tiebreaker === undefined) continue;\n\t\tconst tbEl = createNode('span', ` ${tiebreaker}`, ['lil-tiebreaker']);\n\t\tel.replaceChildren(main, tbEl);\n\t\tel.classList.add('lil-tiebreaker-restyle');\n\t}\n}\n\nfunction enable() {\n\tHooks.on('renderCombatTracker', renderCombat);\n}\n\nfunction disable() {\n\tHooks.off('renderCombatTracker', renderCombat);\n\treturn false;\n}\n\nnew Feature({ setting: 'combat-tracker-init-tiebreaker', label: 'Combat Tracker Initiative Tiebreaker', hint: 'Alters display of initiative tiebreaker.', category: 'foundry-ui', enable, disable, stage: 'init' });\n",
    "import { Feature } from '@root/core/feature.mjs';\n\n// Everything this does is done in CSS for now\n\nfunction enable() {\n\tdocument.body.classList.add('lil-boost');\n}\n\nfunction disable() {\n\tdocument.body.classList.remove('lil-boost');\n}\n\nnew Feature({ setting: 'boost', label: 'Performance Boost', hint: 'Add content hints for browser.', category: 'experiment', enable, disable, stage: 'ready', enabledByDefault: false });\n",
    "// Chat card restyle\n\nimport { Feature } from '@core/feature.mjs';\n\nfunction enable() {\n\tdocument.body.classList.add('lil-chatcard-restyle');\n}\n\nfunction disable() {\n\tdocument.body.classList.remove('lil-chatcard-restyle');\n}\n\nnew Feature({ setting: 'chat-restyle', label: 'Restyle', hint: 'Adds minor restyling to chat cards.', category: 'chat-card', enable, disable, stage: 'init', stream: true });\n",
    "// Resolve formulas\n\nimport { CFG } from '@root/config.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { createNode } from '@root/common.mjs';\nimport { unflair, getVariables } from '@core/formula.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nconst hideIdenticalResolution = true;\n\n// Ignore for resolution\nconst ignorePaths = [\n\t// Has built-in total\n\t/^formulaicAttacks\\.count\\.formula$/,\n];\n\n// Resolve even if no formula is present\nconst alwaysResolve = [\n\t/^save\\.dc$/,\n];\n\n/**\n * Paths that have limited roll data available.\n */\nconst limitedRollData = {\n\tclass: {\n\t\titem: [\n\t\t\t'system.customHD',\n\t\t\t'system.babFormula',\n\t\t\t'system.savingThrows.fort.custom',\n\t\t\t'system.savingThrows.ref.custom',\n\t\t\t'system.savingThrows.will.custom',\n\t\t],\n\t},\n};\n\nfunction getSpecialItemRollData(path, item) {\n\tswitch (path) {\n\t\tcase 'system.customHD':\n\t\t\treturn { item: { level: item.system.level } };\n\t\tcase 'system.babFormula':\n\t\tcase 'system.savingThrows.fort.custom':\n\t\tcase 'system.savingThrows.ref.custom':\n\t\tcase 'system.savingThrows.will.custom':\n\t\t\treturn { level: item.system.level, hitDice: item.hitDice };\n\t}\n\n\treturn null;\n}\n\nfunction addSpecialRollData(rollData, path, actor, item, temp) {\n\tconst bookId = /\\.spellbooks\\.(?<bookId>\\w+)\\./.exec(path)?.groups.bookId;\n\n\tif (actor && !!bookId) {\n\t\tconst bookData = rollData.spells?.[bookId];\n\t\tif (bookData) {\n\t\t\tif (rollData.sl === undefined) {\n\t\t\t\trollData.sl = item?.system.level ?? 0; // Filler\n\t\t\t\ttemp.add('sl');\n\t\t\t}\n\t\t\tif (rollData.cl === undefined) {\n\t\t\t\trollData.cl = bookData.cl.total;\n\t\t\t\ttemp.add('cl');\n\t\t\t}\n\t\t\tif (rollData.ablMod === undefined) {\n\t\t\t\trollData.ablMod = rollData.abilities[bookData.ability]?.mod;\n\t\t\t\ttemp.add('ablMod');\n\t\t\t}\n\t\t}\n\t}\n};\n\nfunction cleanSpecialRollData(rollData, path, temp) {\n\tfor (const p of temp) {\n\t\tfoundry.utils.setProperty(rollData, p, undefined);\n\t\ttemp.delete(p);\n\t}\n};\n\nconst rules = {\n\tmatchCount: {\n\t\tparenthesis: { open: '(', close: ')', warning: 'LittleHelper.Warning.MismatchedQuantity' },\n\t\tsquareBrackets: { open: '[', close: ']', warning: 'LittleHelper.Warning.MismatchedQuantity' },\n\t\tcurlyBrackets: { open: '{', close: '}', warning: 'LittleHelper.Warning.MismatchedQuantity' },\n\t},\n\tgeneral: {\n\t\tbadVariable: { match: /@[^_\\w]/i, warning: 'LittleHelper.Warning.BadVariable' }, // @ followed by bad characters\n\t\tsquareBrackets: { match: /[^)\\w\\d]\\[/, warning: 'LittleHelper.Warning.OrphanBrackets' }, // brackets without connected value\n\t\t// nonFunction: { match: /[^@[][\\w_.]+[^(]/, warning: 'LittleHelper.Warning.FreeLetters' }, // freefloating letters\n\t\trunIn: { match: /\\w[*+\\-/]/, warning: 'LittleHelper.Warning.RunInOperator' },\n\t\tdieParens: { match: /\\)d/, warning: 'LittleHelper.Warning.DieFunctionPair', error: true },\n\t\texcessSpace: { match: /\\w\\s+[([]/, warning: 'LittleHelper.Warning.ExcessSpacing' },\n\t},\n};\n\n/**\n * @param {string} formula Formula to inspect.\n * @param {RollTerm[]} [terms] Roll terms to inspect.\n * @param {object[]} [issues] Issues array to append to\n * @param {object[]} [errors] Errors array to append to\n * @returns {{issues: object[], errors: object[]}} Issues array\n */\nfunction validateFormula(formula = '', issues = [], errors = []) {\n\tlet error;\n\tlet terms = [];\n\tif (formula) {\n\t\ttry {\n\t\t\tterms = RollPF.parse(formula);\n\t\t}\n\t\tcatch (err) {\n\t\t\terror = true;\n\t\t\terrors.push({\n\t\t\t\trule: 'parse',\n\t\t\t\tmessage: err.message,\n\t\t\t\terror: err,\n\t\t\t});\n\t\t}\n\t}\n\telse {\n\t\terrors.push({\n\t\t\trule: 'empty',\n\t\t\tmessage: i18n.get('LittleHelper.Warning.EmptyFormula'),\n\t\t});\n\t}\n\n\tfor (const [subrule, rule] of Object.entries(rules.matchCount)) {\n\t\tlet open = 0, close = 0;\n\t\tfor (const l of formula) {\n\t\t\tif (l === rule.open) open++;\n\t\t\telse if (l === rule.close) close++;\n\t\t}\n\n\t\tif (open !== close) // mismatch\n\t\t\tissues.push(\n\t\t\t\t{\n\t\t\t\t\trule: 'matchCount',\n\t\t\t\t\tsubrule: subrule,\n\t\t\t\t\tmessage: i18n.get(rule.warning, { details: `\"${rule.open}\" Ã—${open}, \"${rule.close}\" Ã—${close}` }),\n\t\t\t\t},\n\t\t\t);\n\t}\n\n\tfor (const [subrule, rule] of Object.entries(rules.general)) {\n\t\tconst re = rule.match.exec(formula);\n\t\tif (re) {\n\t\t\tif (rule.error && !error) continue;\n\t\t\tissues.push({\n\t\t\t\trule: 'general',\n\t\t\t\tsubrule: subrule,\n\t\t\t\toffset: re.index,\n\t\t\t\tmessage: i18n.get(rule.warning),\n\t\t\t});\n\t\t}\n\t}\n\n\t// Missing rounding\n\tfor (const term of terms ?? []) {\n\t\tconst re = /(\\d\\.\\d|\\/)/.exec(term.expression);\n\t\tif (!!re && !/(?:ceil|floor|round)\\(/.test(term.expression)) {\n\t\t\tissues.push({\n\t\t\t\trule: 'terms',\n\t\t\t\tsubrule: 'rounding',\n\t\t\t\toffset: re.index,\n\t\t\t\tmessage: i18n.get('LittleHelper.Warning.MissingRounding'),\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * TODO:\n\t * - Formula has only string term: e.g. \"blep\"\n\t * - Misplaced stringterm\n\t */\n\n\treturn { issues, errors };\n};\n\n// Ensure line-breaks\nconst spaceFormula = (iformula) => iformula\n\t.replaceAll(/([)\\d\\w])\\s*([+*\\-/])\\s*/g, (_, m1, m2) => `${m1} ${m2} <wbr>`);\n\n/**\n * @param {HTMLElement} el\n * @param {string} formula\n * @param path\n * @param {ItemPF} item\n * @param {ActorPF} actor\n * @param {pf1.components.ItemAction} action\n * @param rollData\n */\nasync function generateTooltip(el, formula, path, actor, item, action, rollData) {\n\tconst content = document.createElement('div');\n\n\tcontent.append(\n\t\tcreateNode('h2', i18n.get('LittleHelper.Formula.Base')),\n\t\tcreateNode('p', spaceFormula(formula), ['base-formula'], { isHTML: true }),\n\t);\n\n\tconst temporary = new Set();\n\trollData = getRollData(item, action, path, rollData);\n\taddSpecialRollData(rollData, path, actor, item, temporary);\n\n\t/** Formula with variables replaced */\n\tconst numformula = Roll.replaceFormulaData(formula, rollData, { missing: 0 });\n\n\tconst varNames = getVariables(formula);\n\tconst vars = [...varNames].map(kpath => {\n\t\tconst value = foundry.utils.getProperty(rollData, kpath);\n\t\tconst idents = [];\n\n\t\tif (value === undefined) idents.push('undefined', 'nullish');\n\t\telse if (value === null) idents.push('null', 'nullish');\n\t\telse if (typeof value === 'object') idents.push('object');\n\n\t\treturn {\n\t\t\tpath: kpath,\n\t\t\tvalue,\n\t\t\tidents,\n\t\t};\n\t});\n\n\t// Check for basic validation errors\n\tconst issues = [], errors = [];\n\n\tconst checkVar = (v) => {\n\t\tif (v.path.startsWith('dFlags')) {\n\t\t\tconst [_, tag] = v.path.split('.', 2);\n\t\t\tconst pi = actor.items.find(i => i.system.tag === tag);\n\t\t\tif (!pi?.isActive) {\n\t\t\t\tissues.push({\n\t\t\t\t\trule: 'itemDisabled',\n\t\t\t\t\tmessage: `Item \"${tag}\" disabled, @dFlags.${tag}.* set to 0`,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (v.path.startsWith('item.dFlags') && !item.isActive) {\n\t\t\tissues.push({\n\t\t\t\trule: 'itemDisabled',\n\t\t\t\tmessage: 'Item disabled, @item.dFlags.* set to 0',\n\t\t\t});\n\t\t}\n\t};\n\n\tif (vars.length) {\n\t\tcontent.append(\n\t\t\tcreateNode('h2', i18n.get('LittleHelper.Formula.Resolved')),\n\t\t\tcreateNode('p', spaceFormula(numformula), ['numeric-formula'], { isHTML: true }),\n\t\t);\n\n\t\tconst ul = createNode('ul', null, ['formula-parts']);\n\t\tul.append(\n\t\t\t...vars.map(vdata => {\n\t\t\t\tconst { path, value, idents: extraIdents } = vdata;\n\t\t\t\tconst li = createNode('li', null, ['formula-variable']);\n\n\t\t\t\tli.append(\n\t\t\t\t\tcreateNode('span', `@${path}`, ['data-path']),\n\t\t\t\t\t' = ',\n\t\t\t\t\tcreateNode('span', `${value}`, ['data-value', ...extraIdents]),\n\t\t\t\t);\n\t\t\t\treturn li;\n\t\t\t}),\n\t\t);\n\n\t\tcontent.append(createNode('h2', i18n.get('LittleHelper.Formula.Variables')), ul);\n\n\t\tif (actor) {\n\t\t\tfor (const v of vars)\n\t\t\t\tcheckVar(v);\n\t\t}\n\t}\n\n\tvalidateFormula(formula, issues, errors);\n\n\tcleanSpecialRollData(rollData, path, temporary);\n\n\tif (issues.length > 0)\n\t\tcontent.append(createNode('h2', `âš ï¸ ${i18n.get('LittleHelper.Warnings')}`), ...issues.map(issue => createNode('p', issue.message)));\n\n\tif (errors.length > 0)\n\t\tcontent.append(createNode('h2', `âš ï¸ ${i18n.get('LittleHelper.Errors')}`), ...errors.map(issue => createNode('p', issue.message)));\n\n\tgame.tooltip.activate(el, { html: content, direction: 'UP', cssClass: 'lil-resolved-formula' });\n};\n\n/**\n * @param {DocumentSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction resolveDocumentFormulas(sheet, html, options, shared) {\n\tif (!shared.coreSheet && !shared.altSheetZenvy) return; // Ignore most alt sheets\n\n\tconst action = shared.action,\n\t\titem = shared.item,\n\t\tactor = shared.actor;\n\n\tresolveFormulas(html, { actor, item, action });\n}\n\nfunction safeResolveInputFormula(el, path, actor, item, action, rollData) {\n\tconst temporary = new Set();\n\n\taddSpecialRollData(rollData, path, actor, item, temporary);\n\n\ttry {\n\t\tresolveInputFormula(el, path, actor, item, action, rollData);\n\t}\n\tfinally {\n\t\tcleanSpecialRollData(rollData, path, temporary);\n\t}\n}\n\nfunction getRollData(item, action, path, rollData) {\n\tif (item) {\n\t\tlet specialData = limitedRollData[item.type];\n\t\tlet isSpecial = false;\n\t\tif (specialData) {\n\t\t\tspecialData = action ? specialData.action : specialData.item;\n\t\t\tisSpecial = specialData?.includes(path) ?? false;\n\t\t}\n\n\t\tif (isSpecial)\n\t\t\trollData = getSpecialItemRollData(path, item);\n\t}\n\n\treturn rollData;\n}\n\nfunction resolveInputFormula(el, path, actor, item, action, rollData) {\n\tif (path && ignorePaths.some(ign => ign.test(path))) return;\n\tlet formula = el.value?.trim();\n\n\tconst doc = action ?? item ?? actor;\n\n\trollData = getRollData(item, action, path, rollData);\n\n\t// Save DC, needs special handling with spells, but do so only if actor is present\n\tif (/^save\\.dc$/.test(path) && item?.type === 'spell' && actor) {\n\t\tconst bookData = rollData.spells[item?.system.spellbook];\n\t\tformula = [bookData.baseDCFormula, formula].filter(i => i.length).join(' + ');\n\t}\n\telse if (formula.length === 0) return;\n\n\tlet rf, broken = false;\n\ttry {\n\t\trf = pf1.utils.formula.compress(pf1.utils.formula.simplify(formula, rollData, { errors: false }));\n\t}\n\tcatch (err) {\n\t\tconsole.error('Bad formula:', formula, '\\n\\nDocument:', doc.name, doc, '\\n\\nData path:', path, '\\n\\nError:', err);\n\t\trf = 'NaN';\n\t\tbroken = true;\n\t}\n\n\tconst issues = [], errors = [];\n\tvalidateFormula(formula, issues, errors);\n\tif (errors.length > 0) broken = true;\n\n\tif (hideIdenticalResolution && rf === pf1.utils.formula.compress(unflair(formula)) && !broken) return; // Or maybe show Î”F=0\n\n\tconst rv = createNode('label', null, ['lil-resolved-formula']);\n\tconst nr = RollPF.safeRollSync(formula, rollData, undefined, undefined, { minimize: true });\n\tif (nr?.err) broken = true;\n\tconst terms = nr?.terms ?? [];\n\n\trv.append('= ', createNode('span', `${rf}`, ['lil-resolved-value']));\n\tif (terms.length === 0)\n\t\trv.classList.add('lil-broken-formula', 'NaN');\n\telse if (terms.some(t => t.constructor.name === 'StringTerm')) // TODO: v12 needs foundry.dice.terms.StringTerm\n\t\trv.classList.add('lil-broken-formula');\n\n\tif (broken) rv.classList.add('broken');\n\n\tconst numformula = Roll.replaceFormulaData(formula, rollData, { missing: 0 });\n\tif (!broken && numformula == formula) {\n\t\t// Too unspectacular formula\n\t}\n\telse {\n\t\trv.addEventListener('pointerenter', _ => generateTooltip(rv, formula, path, actor, item, action, rollData), { passive: true });\n\t\trv.addEventListener('pointerleave', () => game.tooltip.deactivate());\n\t}\n\n\tif (el.classList.contains('conditional-formula'))\n\t\tel.closest('li[data-conditional]')?.classList.add('lil-conditional-style-correction');\n\n\tif (broken) rv.append(createNode('i', null, ['fa-solid', 'fa-exclamation-triangle', 'lil-formula-warning']));\n\n\tel.after(rv);\n};\n\nasync function resolveFormulas(html, { actor, item, action } = {}) {\n\tconst doc = action ?? item ?? actor;\n\tconst rollData = doc.getRollData();\n\n\t// Fill in some basic data not present without actor\n\tif (!actor) rollData.size = 4;\n\n\tfor (const el of html.querySelectorAll('input.formula')) {\n\t\tsafeResolveInputFormula(el, el.name, actor, item, action, rollData);\n\t}\n}\n\n/**\n * Change editor\n *\n * @param {foundry.applications.api.ApplicationV2} app\n * @param {HTMLElement} html\n */\nfunction resolveChangeFormulas(app) {\n\tconst html = app.element.querySelector('.window-content');\n\n\tconst doc = app.document;\n\tconst action = doc instanceof pf1.components.ItemAction ? doc : null;\n\tconst item = doc instanceof Item ? doc : doc.item;\n\tconst actor = item.actor;\n\n\tresolveFormulas(html, { actor, item, action });\n}\n\nfunction enable() {\n\tAncillary.register('item', resolveDocumentFormulas);\n\tAncillary.register('actor', resolveDocumentFormulas);\n\tAncillary.register('action', resolveDocumentFormulas);\n\n\tHooks.on('renderChangeEditor', resolveChangeFormulas);\n}\n\nfunction disable() {\n\tAncillary.unregister('item', resolveDocumentFormulas);\n\tAncillary.unregister('actor', resolveDocumentFormulas);\n\tAncillary.unregister('action', resolveDocumentFormulas);\n\n\tHooks.off('renderChangeEditor', resolveChangeFormulas);\n}\n\nnew Feature({\n\tsetting: 'resolve-formulas',\n\tlabel: 'Resolve Formulas',\n\thint: 'Resolves and performs basic validation on formulas and displays partially resolved value (no rolls) with tooltip on details about it on actor and item sheets.',\n\tcategory: 'common',\n\tenable,\n\tdisable,\n\tstage: 'ready',\n});\n\nCFG.API.formula.validate = validateFormula;\n",
    "// Formula Helpers\n\nimport { CFG } from '../config.mjs';\n\n/**\n * Remove flairs, remove excessive spacing, simplify math\n *\n * @param {string} formula\n */\nexport const unflair = (formula) => formula\n\t.replaceAll(/\\[.*?]/g, '')\n\t.replaceAll(/\\s\\s+/g, ' ')\n\t.replaceAll('+ -', '-')\n\t.replaceAll(/\\s*\\+\\s*/g, '+')\n\t.trim();\n\n/**\n * @param {string} formula\n * @returns {Set<string>}\n */\nexport function getVariables(formula) {\n\tconst vars = formula.match(/@(\\w[\\w.]*)\\b/g);\n\tconst rv = new Set();\n\tif (vars) for (const v of vars) rv.add(v.slice(1));\n\treturn rv;\n};\n\nCFG.API.formula = {\n\t...CFG.API.formula,\n\tgetVariables,\n};\n",
    "import { createNode } from '@root/common.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nasync function exportDocument(doc) {\n\treturn doc.exportToJSON();\n}\n\n/**\n * @param {HTMLElement} el\n * @param {Item|Actor} doc\n */\nfunction appendExportButton(el, doc) {\n\tconst button = createNode('button', null, ['lil-export']);\n\tbutton.append(createNode('i', null, ['fa-solid', 'fa-save']), ' ', i18n.get('LittleHelper.Action.ExportJSON'));\n\tbutton.style.whiteSpace = 'nowrap';\n\tbutton.type = 'button';\n\n\tbutton.addEventListener('click', function (event) {\n\t\tevent.preventDefault();\n\t\tbutton.disable = true;\n\t\texportDocument(doc)\n\t\t\t.then(_ => button.disable = false);\n\t});\n\n\tel.append(button);\n}\n\n/**\n * @param {ActorSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction injectExportActorSheet(sheet, html, options, shared) {\n\tconst tab = shared.tabs.settings?.tab;\n\tif (!tab) return;\n\n\tconst actor = sheet.document;\n\n\tconst div = createNode('div', null, ['form-group']);\n\tdiv.style.flexDirection = 'column';\n\tconst h2 = createNode('h2');\n\th2.style.width = '100%';\n\th2.append(createNode('i', null, ['fa-solid', 'fa-puzzle-piece']), ' ', i18n.get('LittleHelper.Action.Actions'));\n\n\tdiv.append(h2);\n\tappendExportButton(div, actor);\n\n\ttab.append(div);\n}\n\n/**\n * @param {ItemSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction injectExportItemSheet(sheet, html, options, shared) {\n\tconst adv = html.querySelector('.tab[data-tab=\"advanced\"] .lil-advanced-options');\n\tif (!adv) return;\n\n\tappendExportButton(adv, sheet.document);\n}\n\nfunction enable() {\n\tAncillary.register('actor', injectExportActorSheet);\n\tAncillary.register('item', injectExportItemSheet);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', injectExportActorSheet);\n\tAncillary.unregister('item', injectExportItemSheet);\n}\n\nnew Feature({ setting: 'easy-export', label: 'Easy Export', hint: 'Actor and Item sheets have easy export button in settings or advanced tab.', category: 'dev', enable, disable, stage: 'ready', enabledByDefault: false });\n",
    "// Data lists for various inputs\n\nimport { CFG } from '@root/config.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { Ancillary } from '@root/ancillary.mjs';\n\nconst addDatalistSource = (el, listId) => {\n\tif (!el.getAttribute('list'))\n\t\tel.setAttribute('list', listId);\n};\n\n/**\n * @param {Element[]} el\n * @param f_input\n * @param item\n */\nfunction handleInput(el, item) {\n\tif (el.matches('[name=\"powerAttack.multiplier\"]'))\n\t\taddDatalistSource(el, 'lil-power-attack-mult');\n}\n\n/**\n * @param {Element[]} el\n * @param item\n */\nfunction handleFormulaInputs(el, item) {\n\tif (el.matches('[name=\"system.formulaicAttacks.count.formula\"],[name=\"formulaicAttacks.count.formula\"]'))\n\t\taddDatalistSource(el, 'lil-premade-fac-list');\n\telse if (el.matches('[name=\"system.formulaicAttacks.bonus.formula\"],[name=\"formulaicAttacks.bonus.formula\"]'))\n\t\taddDatalistSource(el, 'lil-premade-fab-list');\n\telse if (el.matches('[name=\"system.attackBonus\"],[name=\"attackBonus\"]'))\n\t\taddDatalistSource(el, 'lil-premade-ab-list');\n\telse if (el.matches('[name=\"system.critConfirmBonus\"],[name=\"critConfirmBonus\"]'))\n\t\taddDatalistSource(el, 'lil-premade-cf-list');\n\telse if (el.matches('.damage-formula'))\n\t\taddDatalistSource(el, 'lil-premade-damage-formula-list');\n\telse if (el.matches('[name=\"system.save.dc\"],[name=\"save.dc\"]'))\n\t\taddDatalistSource(el, item.type === 'spell' ? 'lil-premade-spell-dc-list' : 'lil-premade-dc-list');\n\telse if (el.matches('[name=\"system.customHD\"]'))\n\t\taddDatalistSource(el, 'lil-class-hd');\n}\n\n/**\n * @param {ItemSheetPF} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction inputQuickAccessInjection(sheet, html, options, shared) {\n\tconst item = shared.document;\n\t/** @type {HTMLInputElement[]} */\n\tconst inputs = html.querySelectorAll('input');\n\tfor (const f_input of inputs) {\n\t\tif (f_input.classList.contains('formula'))\n\t\t\thandleFormulaInputs(f_input, item);\n\t\telse\n\t\t\thandleInput(f_input, item);\n\t}\n}\n\n/**\n * @param {Dialog} dialog\n * @param {HTMLElement} html\n * @param {object} options\n */\nfunction inputDialogQuickAccessInjection(dialog, html) {\n\tif (html instanceof jQuery) html = html[0];\n\n\tconst subject = dialog.options.subject;\n\tif (!subject && !(dialog instanceof pf1.applications.AttackDialog))\n\t\treturn;\n\n\tif (!dialog.options.classes.includes('pf1') && !dialog.options.classes.includes('pf1-v2')) return;\n\n\tconst inputs = html.querySelectorAll('input[name]');\n\n\tfor (const el of inputs) {\n\t\tswitch (el.name) {\n\t\t\tcase 'd20': addDatalistSource(el, 'lil-premade-roll-list'); break;\n\t\t\tcase 'attack-bonus': addDatalistSource(el, 'lil-premade-attack-bonus-list'); break;\n\t\t\tcase 'bonus': addDatalistSource(el, 'lil-premade-roll-bonus-list'); break;\n\t\t}\n\t}\n}\n\nconst dataSourceTemplate = `modules/${CFG.id}/templates/data-sources.hbs`;\n\nasync function injectDataSources() {\n\tconst data = {\n\t\tconfig: pf1.config,\n\t\tregistry: {\n\t\t\tdamageTypes: pf1.registry.damageTypes.getLabels(),\n\t\t},\n\t\textra: {\n\t\t\tdamageTypes: ['Healing', 'Bleed'],\n\t\t},\n\t};\n\n\tconst fragment = document.createElement('template');\n\n\tconst rt = foundry.applications.handlebars.renderTemplate;\n\n\tfragment.innerHTML = await rt(dataSourceTemplate, data);\n\tdocument.body.append(fragment.content);\n}\n\nHooks.once('ready', () => injectDataSources());\n\nfunction enable() {\n\tAncillary.register('item', inputQuickAccessInjection);\n\tAncillary.register('action', inputQuickAccessInjection);\n\n\tHooks.on('renderAttackDialog', inputDialogQuickAccessInjection);\n\tHooks.on('renderDialogV2', inputDialogQuickAccessInjection); // Matches all dialogs. May as such match unwanted dialogs.\n\tHooks.on('renderDialog', inputDialogQuickAccessInjection); // Matches all dialogs. May as such match unwanted dialogs.\n}\n\nfunction disable() {\n\tAncillary.unregister('item', inputQuickAccessInjection);\n\tAncillary.unregister('action', inputQuickAccessInjection);\n\n\tHooks.off('renderAttackDialog', inputDialogQuickAccessInjection);\n\tHooks.off('renderDialogV2', inputDialogQuickAccessInjection);\n\tHooks.off('renderDialog', inputDialogQuickAccessInjection);\n}\n\nnew Feature({ setting: 'quick-input', label: 'Quick Input', hint: 'Adds quick access to various common values and formulas to various actor, item and dialog inputs.', category: 'common', enable, disable, stage: 'ready' });\n",
    "import { Feature } from '@core/feature.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\n/**\n * @param {HTMLElement} el\n */\nasync function updateNote(el) {\n\t// Re-find the element due to refresh remaking it\n\tconst txEl = el.closest('form').querySelector('.lil-take-x');\n\n\tif (el.value.trim().length === 0) {\n\t\ttxEl.textContent = '';\n\t\treturn;\n\t}\n\n\tlet roll;\n\ttry {\n\t\troll = new Roll(el.value);\n\t\tdelete txEl.dataset.tooltip;\n\t}\n\tcatch (err) {\n\t\ttxEl.textContent = 'ERROR!';\n\t\ttxEl.dataset.tooltip = err.message;\n\t\treturn;\n\t}\n\n\tlet text = '';\n\tif (roll.isDeterministic) {\n\t\ttry {\n\t\t\tawait roll.evaluate();\n\t\t\ttext = i18n.get('PF1.TakeX', { number: roll.total });\n\t\t}\n\t\tcatch (err) {\n\t\t\ttext = 'ERROR!';\n\t\t\ttxEl.dataset.tooltip = err.message;\n\t\t}\n\t}\n\ttxEl.textContent = text;\n}\n\n/**\n * @param {Application} app\n * @param {JQuery<HTMLElement>} html\n * @param {object} options\n */\nfunction injectTakeXHint(app, html, options) {\n\tif (html instanceof jQuery) html = html[0];\n\n\tconst subject = app.options.subject;\n\tif (!subject && !(app instanceof pf1.applications.AttackDialog))\n\t\treturn;\n\n\tconst classes = new Set(app.options.classes ?? []);\n\tif (!classes.has('pf1') && !classes.has('pf1-v2')) return;\n\n\tconst d20 = html.querySelector('input[name=\"d20\"]');\n\tif (!d20) return;\n\n\tconst txEl = document.createElement('span');\n\ttxEl.classList.add('lil-take-x');\n\td20.after(txEl);\n\n\tupdateNote(d20);\n\n\td20.addEventListener('change', (ev) => updateNote(ev.target), { passive: true });\n\td20.addEventListener('input', (ev) => updateNote(ev.target), { passive: true });\n}\n\nfunction enable() {\n\tHooks.on('renderAttackDialog', injectTakeXHint);\n\tHooks.on('renderDialogV2', injectTakeXHint); // Matches all dialogs. May as such match unwanted dialogs.\n}\n\nfunction disable() {\n\tHooks.off('renderAttackDialog', injectTakeXHint);\n\tHooks.off('renderDialogV2', injectTakeXHint);\n}\n\nnew Feature({ setting: 'roll-dialog-take-x', label: 'Roll Dialog Take X', hint: 'Simple reminder that you\\'re doing Take X roll in some circumstances.', category: 'common', enable, disable, stage: 'ready' });\n",
    "// Display buffs near chatlog\n\nimport { CFG } from '@root/config.mjs';\nimport { createNode, stopEventPropagation, getRelevantAE } from '@root/common.mjs';\nimport { getHumanTime, humanTimeUnit, getAEDuration } from '@root/common.time.mjs';\nimport { Feature, SubSetting } from '@core/feature.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\n// TODO: Add quick access to enabling buffs and conditions, too.\n\nconst missingDescription = 'n/a';\n\nlet\n\t/** @type {HTMLElement} */\n\tconditionList,\n\t/** @type {HTMLElement} */\n\tbuffList,\n\t/** @type {HTMLElement} */\n\tpermList;\n\nconst { ApplicationV2, HandlebarsApplicationMixin } = foundry.applications.api;\n\n/**\n * App for listening on actor updates.\n */\nclass ActiveBuffsDisplay extends HandlebarsApplicationMixin(ApplicationV2) {\n\t/** @type {Actor} */\n\t#actor;\n\t/** @type {TokenDocument} */\n\t#token;\n\n\tstatic instance;\n\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.constructor.instance = this;\n\t}\n\n\tsetToken(token) {\n\t\tthis.#token = token;\n\t\tthis.#actor = token.actor;\n\n\t\tthis.render(true);\n\t}\n\n\tget token() { return this.#token; }\n\n\tget actor() { return this.#actor; }\n\n\tstatic DEFAULT_OPTIONS = {\n\t\tid: 'little-helper-active-buffs',\n\t\twindow: {\n\t\t\tframe: false,\n\t\t\tpositioned: false,\n\t\t},\n\t\tactions: {\n\t\t\ttoggle: { handler: this._onToggle, buttons: [0, 2] },\n\t\t},\n\t};\n\n\tstatic PARTS = {\n\t\troot: {\n\t\t\troot: true,\n\t\t\ttemplate: 'modules/koboldworks-pf1-little-helper/templates/active-buffs/root.hbs',\n\t\t},\n\t\ttemp: {\n\t\t\ttemplate: 'modules/koboldworks-pf1-little-helper/templates/active-buffs/entries.hbs',\n\t\t},\n\t\tperm: {\n\t\t\ttemplate: 'modules/koboldworks-pf1-little-helper/templates/active-buffs/entries.hbs',\n\t\t},\n\t\tcond: {\n\t\t\ttemplate: 'modules/koboldworks-pf1-little-helper/templates/active-buffs/entries.hbs',\n\t\t},\n\t};\n\n\t_prepareContext(options) {\n\t\treturn {\n\t\t\tactor: this.actor,\n\t\t\ttoken: this.token,\n\t\t\tuuid: this.actor.uuid,\n\t\t};\n\t}\n\n\t_preparePartContext(partId, context, options) {\n\t\tcontext.partId = partId;\n\n\t\tswitch (partId) {\n\t\t\tcase 'cond':\n\t\t\t\tthis._prepareConditions(context);\n\t\t\t\tbreak;\n\t\t\tcase 'perm':\n\t\t\t\tthis._prepareBuffs(context, true);\n\t\t\t\tbreak;\n\t\t\tcase 'temp':\n\t\t\t\tthis._prepareBuffs(context, false);\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn context;\n\t}\n\n\t_prepareConditions(context) {\n\t\tconst token = this.token;\n\t\tconst actor = this.actor;\n\n\t\tconst entries = [];\n\n\t\tfor (const conditionId of token.actor.statuses) {\n\t\t\tconst condition = pf1.registry.conditions.get(conditionId);\n\t\t\tconst image = condition?.texture;\n\t\t\tconst label = condition?.name || conditionId;\n\n\t\t\tentries.push({\n\t\t\t\timg: image,\n\t\t\t\tlabel,\n\t\t\t\tcondition,\n\t\t\t\tconditionId,\n\t\t\t\tcss: 'condition',\n\t\t\t});\n\t\t}\n\n\t\tcontext.css = 'conditions';\n\t\tcontext.empty = entries.length === 0;\n\t\tcontext.entries = entries;\n\t}\n\n\t_prepareBuffs(context, perm) {\n\t\tconst showHidden = feature.subsettings.showHidden.value;\n\n\t\tconst actor = this.actor;\n\n\t\tconst allBuffs = actor.itemTypes.buff ?? [];\n\t\tconst buffs = allBuffs.filter(i => i.isActive && (perm ? i.subType === 'perm' : i.subType !== 'perm'))\n\t\t\t.sort((a, b) => b.sort - a.sort);\n\n\t\tconst entries = [];\n\n\t\tfor (const item of buffs) {\n\t\t\tif (!showHidden && item.system.hideFromToken) continue;\n\n\t\t\tentries.push({\n\t\t\t\timg: item.img,\n\t\t\t\tlabel: item.name,\n\t\t\t\tpermanent: perm,\n\t\t\t\tinvalid: false,\n\t\t\t\tcss: ['buff', perm ? 'permanent' : 'temporary'].join(' '),\n\t\t\t\titem,\n\t\t\t});\n\t\t}\n\n\t\tcontext.css = ['buffs', perm ? 'permanent' : 'temporary'].join(' ');\n\t\tcontext.entries = entries;\n\t\tcontext.empty = entries.length === 0;\n\t}\n\n\t_syncPartState(partId, newEl, oldEl, state) {\n\t\tsuper._syncPartState(partId, newEl, oldEl, state);\n\n\t\tswitch (partId) {\n\t\t\tcase 'temp':\n\t\t\t\tbreak;\n\t\t\tcase 'perm':\n\t\t\t\tbreak;\n\t\t\tcase 'cond':\n\t\t\t\tnewEl\n\t\t\t\t\t.break;\n\t\t}\n\t}\n\n\tclear() {\n\t\tif (!this.element) return;\n\n\t\tthis.#token = null;\n\t\tthis.#actor = null;\n\n\t\tthis.element.classList.remove('active');\n\n\t\tbuffList?.replaceChildren();\n\t\tpermList?.replaceChildren();\n\t\tconditionList?.replaceChildren();\n\t}\n\n\t/** @override */\n\t_canRender(options) {\n\t\tif (!this.actor) return false;\n\t}\n\n\t/** @override */\n\t_insertElement(element) {\n\t\tdocument.getElementById('ui-right-column-1').prepend(element);\n\n\t\tbuffList = element.querySelector('.buff-list.temporary');\n\t\tpermList = element.querySelector('.buff-list.permanent');\n\t\tconditionList = element.querySelector('.buff-list.conditions');\n\t}\n\n\t_onRender(...args) {\n\t\tsuper._onRender(...args);\n\n\t\tthis.element.classList.add('active');\n\n\t\tfor (const el of this.element.querySelectorAll('li.buff')) {\n\t\t\tel.addEventListener('pointerenter', this._onHoverStart.bind(this), { passive: true });\n\t\t\tel.addEventListener('pointerleave', this._onHoverEnd.bind(this), { passive: true });\n\t\t}\n\t}\n\n\tasync _onHoverStart(event) {\n\t\tconst el = event.target;\n\n\t\tconst actor = this.actor;\n\n\t\tconst itemId = el.dataset.itemId;\n\t\tconst conditionId = el.dataset.conditionId;\n\t\tlet label, item, condition;\n\t\tif (itemId) {\n\t\t\titem = actor.items.get(itemId);\n\t\t\tlabel = item?.name || itemId;\n\t\t}\n\t\telse if (conditionId) {\n\t\t\tcondition = pf1.registry.conditions.get(conditionId);\n\t\t\tlabel = condition?.name || conditionId;\n\t\t}\n\t\telse return void console.error('What happen?\\n', el);\n\n\t\tgame.tooltip.activate(el, {\n\t\t\thtml: await generateTooltip(el, { actor, label, item, condition }),\n\t\t\tcssClass: 'lil-active-buff-tooltip',\n\t\t\tdirection: foundry.helpers.interaction.TooltipManager.implementation.TOOLTIP_DIRECTIONS.LEFT,\n\t\t});\n\t}\n\n\t_onHoverEnd(event) {\n\t\tgame.tooltip.deactivate();\n\t}\n\n\t/**\n\t * @this {ActiveBuffsDisplay}\n\t * @param {Event} event\n\t * @param {HTMLElement} button\n\t */\n\tstatic _onToggle(event, button) {\n\t\tif (!this.actor) throw new Error('Someone broke a leg');\n\n\t\tconst rightClick = feature.subsettings.rightClick.value ?? false;\n\n\t\tconst conditionId = button.dataset.conditionId,\n\t\t\titemId = button.dataset.itemId;\n\n\t\tconst isLeftClick = event.button === 0;\n\n\t\tif (event.shiftKey && isLeftClick)\n\t\t\tthis._onPrintDescription(itemId);\n\t\telse if (rightClick !== isLeftClick) {\n\t\t\tif (conditionId) {\n\t\t\t\tthis._onDisableCondition(conditionId);\n\t\t\t}\n\t\t\telse if (itemId) {\n\t\t\t\tthis._onDisableItem(itemId);\n\t\t\t}\n\t\t}\n\t}\n\n\t_onPrintDescription(itemId) {\n\t\treturn this.actor.items.get(itemId).displayCard();\n\t}\n\n\t_onDisableCondition(conditionId) {\n\t\treturn this.actor.setCondition(conditionId, false);\n\t}\n\n\t_onDisableItem(itemId) {\n\t\tconst buff = this.actor.items.get(itemId);\n\t\tif (buff.isActive && buff.type === 'buff') {\n\t\t\tif (buff.subType === 'perm') return ui.notifications.warn('Will not disable permanent buff.');\n\t\t\treturn buff.setActive(false);\n\t\t}\n\t\tthrow new Error('Invalid buff selection');\n\t}\n\n\t_onClose() {\n\t\tthis.#token = null;\n\t\tthis.#actor = null;\n\t}\n\n\t_onTokenControl(_tokens, _controlled) {\n\t\tconst tokens = canvas.tokens?.controlled ?? [];\n\t\tconst token = tokens[0];\n\t\tif (tokens.length === 1 && token.actor && this.token !== token) {\n\t\t\tthis.setToken(token);\n\t\t}\n\t\telse\n\t\t\tthis.clear();\n\t}\n\n\t_onUpdateTime(time) {\n\t\tif (!this.actor) return;\n\n\t\tthis.render();\n\t}\n\n\t_onAECreate(ae, data, context) {\n\t\tif (ae.actor !== this.actor) return;\n\t\tif (!this.actor) return;\n\n\t\tthis.render();\n\t}\n\n\t_onAEUpdate(ae, data, context) {\n\t\tif (ae.actor !== this.actor) return;\n\t\tif (!this.actor) return;\n\n\t\tthis.render();\n\t}\n\n\t_onAEDelete(ae, context) {\n\t\tif (ae.actor !== this.actor) return;\n\t\tif (!this.actor) return;\n\n\t\tthis.render();\n\t}\n\n\t_onItemCreate(item) {\n\t\tif (item.actor !== this.actor) return;\n\t\tif (item.type !== 'buff') return;\n\n\t\tthis.render();\n\t}\n\n\t_onItemUpdate(item) {\n\t\tif (item.actor !== this.actor) return;\n\t\tif (item.type !== 'buff') return;\n\n\t\tif (item?.isActive) this.render();\n\t\telse this._removeItem(item);\n\t}\n\n\t_onItemDelete(item) {\n\t\tif (item.actor !== this.actor) return;\n\t\tif (item.type !== 'buff') return;\n\n\t\tif (item.isActive) this._removeItem(item);\n\t}\n\n\t_onActorUpdate(actor) {\n\t\tif (actor !== this.actor) return;\n\n\t\tthis.render();\n\t}\n\n\t_removeItem(item) {\n\t\tthis.element.querySelector(`[data-item-id=\"${item.id}\"]`)?.remove();\n\t}\n\n\t_displayExtraInfo(enabled) {\n\t\tconst root = this.element;\n\t\tif (!root) return;\n\n\t\tfor (const el of root.querySelectorAll('.fast-label')) {\n\t\t\tel.style.setProperty('--width', el.clientWidth);\n\t\t}\n\n\t\troot.classList.toggle('extraInfo', enabled);\n\t}\n\n\t#events = {\n\t\tcontrolToken: this._onTokenControl.bind(this),\n\t\tupdateWorldTime: this._onUpdateTime.bind(this),\n\n\t\tcreateActiveEffect: this._onAECreate.bind(this),\n\t\tupdateActiveEffect: this._onAEUpdate.bind(this),\n\t\tdeleteActiveEffect: this._onAEDelete.bind(this),\n\n\t\tcreateItem: this._onItemCreate.bind(this),\n\t\tupdateItem: this._onItemUpdate.bind(this),\n\t\tdeleteItem: this._onItemDelete.bind(this),\n\n\t\tupdateActor: this._onActorUpdate.bind(this),\n\n\t\t'little-helper.extraInfo': this._displayExtraInfo.bind(this),\n\t};\n\n\tregister() {\n\t\tfor (const [hookId, handler] of Object.entries(this.#events)) {\n\t\t\tHooks.on(hookId, handler);\n\t\t}\n\t\tthis._onTokenControl();\n\t}\n\n\tunregister() {\n\t\tfor (const [hookId, handler] of Object.entries(this.#events)) {\n\t\t\tHooks.off(hookId, handler);\n\t\t}\n\t}\n}\n\n/**\n *\n * @param {HTMLElement} el\n * @param {object} options\n * @param options.tooltip\n * @param {ActorPF} options.actor\n * @param {ItemPF} options.item\n * @param {pf1.registry.conditions.model} options.condition\n */\nfunction addTooltipTimeInfo(el, { tooltip, actor, item, condition } = {}) {\n\tconst ae = getRelevantAE(actor, { item, condition });\n\tel.dataset.effectUuid = ae?.getRelativeUUID(actor);\n\n\tconst dur = ae ? getAEDuration(ae) : {};\n\n\tconst longFormat = feature.subsettings.longTimeFormat.value;\n\n\tif (Number.isFinite(dur.start) && dur.passed >= 0) {\n\t\tel.dataset.start = dur.start;\n\n\t\tconst time = createNode('div', null, ['time']);\n\t\ttime.dataset.start = `${dur.start}`;\n\n\t\tconst activeTime = dur.passed;\n\t\ttime.dataset.active = `${activeTime}`;\n\n\t\tconst hActive = getHumanTime(activeTime);\n\t\tconst activeTimeBlock = createNode('div', null, ['active-time', 'time-block'], {\n\t\t\tchildren: [\n\t\t\t\t'Active: ',\n\t\t\t\tcreateNode('span', `${hActive.n ?? 0}`, ['active', 'number']),\n\t\t\t\t' ',\n\t\t\t\tcreateNode('span', humanTimeUnit[hActive.u][longFormat ? 'long' : 'short'], ['remaining', 'unit']),\n\t\t\t],\n\t\t});\n\t\ttime.append(activeTimeBlock);\n\n\t\tif (dur.duration > 0) {\n\t\t\ttime.dataset.duration = `${dur.duration}`;\n\n\t\t\tconst hRemaining = getHumanTime(dur.remaining),\n\t\t\t\thDuration = getHumanTime(dur.duration);\n\n\t\t\tconst remainingTimeBlock = createNode('div', null, ['remaining-time', 'time-block'], {\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\t'Remaining: ',\n\t\t\t\t\t\tcreateNode('span', hRemaining.n, ['remaining', 'number', hRemaining.n <= 0 ? 'expired' : 'ongoing']),\n\t\t\t\t\t\t' ',\n\t\t\t\t\t\tcreateNode('span', humanTimeUnit[hRemaining.u][longFormat ? 'long' : 'short'], ['remaining', 'unit']),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\tmaxTimeBlock = createNode('div', null, ['max-time', 'time-block'], {\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\t'Max duration: ',\n\t\t\t\t\t\tcreateNode('span', hDuration.n, ['duration', 'number']),\n\t\t\t\t\t\t' ',\n\t\t\t\t\t\tcreateNode('span', humanTimeUnit[hDuration.u][longFormat ? 'long' : 'short'], ['duration', 'unit']),\n\t\t\t\t\t],\n\t\t\t\t});\n\n\t\t\ttime.append(remainingTimeBlock, maxTimeBlock);\n\t\t}\n\n\t\ttooltip.append(time);\n\t}\n}\n\n/**\n * @param {object} options\n * @param {ItemPF} options.item\n * @param {pf1.registry.conditions.model} options.condition\n * @returns {string}\n */\nasync function fillTooltipDescription({ item, condition } = {}) {\n\tlet desc;\n\tif (item) {\n\t\tconst rollData = item?.getRollData() ?? {};\n\t\tdesc = await item?.getDescription();\n\t\tconst secrets = feature.subsettings.secrets.value;\n\t\tdesc = await foundry.applications.ux.TextEditor.implementation.enrichHTML(desc, { rollData, documents: true, rolls: true, secrets, async: true });\n\t}\n\telse if (condition) {\n\t\tconst descs = CFG.i18n.conditions;\n\t\tdesc = '<p>' + descs[condition.id] || i18n.get('LittleHelper.Conditions._missing');\n\t}\n\telse {\n\t\tdesc = '<p>' + i18n.get('LittleHelper.Conditions._invalid');\n\t}\n\n\treturn desc;\n}\n\n/**\n *\n * @param {HTMLElement} el\n * @param {object} options\n * @param {ActorPF} options.actor\n * @param {string} options.label\n * @param {ItemPF} options.item\n * @param {pf1.registry.conditions.model} options.condition\n * @returns\n */\nasync function generateTooltip(el, { actor, label, item, condition } = {}) {\n\tconst tooltip = createNode('section', null, [], { children: [createNode('h4', label, ['name'])] });\n\n\tconst level = item?.system.level;\n\tif (level != 0 && Number.isFinite(level)) {\n\t\tconst levelEl = createNode('div', null, ['level']);\n\t\tconst ll = createNode('label', i18n.get('PF1.Level'));\n\t\tconst lv = createNode('span', level, ['value']);\n\t\tlevelEl.append(ll, ' ', lv);\n\t\ttooltip.append(levelEl);\n\t}\n\n\taddTooltipTimeInfo(el, { tooltip, label, actor, item, condition, event });\n\n\tconst descEl = createNode('div', null, ['description']);\n\ttooltip.append(descEl);\n\n\tdescEl.innerHTML = await fillTooltipDescription({ item, condition });\n\n\t// Control help\n\ttooltip.append(createNode('hr'));\n\tif (item && item.system.buffType === 'perm')\n\t\ttooltip.append(createNode('p', i18n.get('PF1.Permanent'), ['buff-type']));\n\telse {\n\t\tconst rightClick = feature.subsettings.rightClick.value;\n\t\tconst clickLabel = rightClick ? i18n.get('LittleHelper.UI.ClickToEndEffectAlt') : i18n.get('LittleHelper.UI.ClickToEndEffect');\n\t\ttooltip.append(createNode('p', clickLabel, ['buff-action', 'help']));\n\t}\n\n\tHooks.callAll('little-helper.hud.tooltip.active', tooltip, { actor, item, condition, event });\n\n\treturn tooltip;\n}\n\nfunction enable() {\n\tconst app = new ActiveBuffsDisplay();\n\tapp.register();\n}\n\nfunction disable() {\n\tActiveBuffsDisplay.instance.unregister();\n\tActiveBuffsDisplay.instance.close();\n\tActiveBuffsDisplay.instance = null;\n}\n\n// TODO: Allow displaying the bar for configured character when no token is selected.\n// TODO: Hold alt to display names of all buffs.\n\nconst feature = new Feature({\n\tsetting: 'active-buffs',\n\tlabel: 'Active Buffs',\n\thint: 'Display active buffs and conditions on the side of the chat log, providing quick access to some information and allowing disabling them with a click.',\n\tcategory: 'hud',\n\tenable,\n\tdisable,\n\tstage: 'ready',\n\tsubsettings: {\n\t\tshowHidden: new SubSetting({ label: 'Show Hidden', hint: 'Show buffs with Hide from Token enabled.', type: Boolean, fallback: true }),\n\t\tlongTimeFormat: new SubSetting({ label: 'Long Time Format', hint: 'Show time units in long format (hours(s) instead of h(s)).', type: Boolean, fallback: true }),\n\t\tsecrets: new SubSetting({ label: 'Secrets', hint: 'Display contents of secret sections.', type: Boolean, fallback: true }),\n\t\trightClick: new SubSetting({ label: 'Right Click to End', hint: 'End buffs with right click instead of left click.', type: Boolean, fallback: false }),\n\t},\n});\n",
    "import { CFG } from '@root/config.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\n// Warns about scene lacking tokens with vision\n// TODO: Warn about specific player owned tokens lacking vision.\n// TODO: Warn about specific player lacking tokens.\n\nfunction canvasReadyEvent(canvas) {\n\tif (!canvas.scene.tokenVision) return;\n\n\t// No tokens what-so-ever, hope it isn't decorative scene\n\tif (canvas.tokens.placeables.length === 0) return;\n\n\t// Player owned tokens that aren't NPC type\n\tconst allPlayerTokens = canvas.tokens.placeables\n\t\t.filter(t => t.actor?.hasPlayerOwner && t.actor.type === 'character');\n\tconst ownedTokens = allPlayerTokens.filter(t => t.isOwner);\n\tconst unsightedTokens = ownedTokens.filter(t => !t.hasSight);\n\n\tif (unsightedTokens.length > 0) {\n\t\tif (game.user.isGM)\n\t\t\tui.notifications.warn(i18n.get('LittleHelper.Scene.LackingVisionGM', { count: unsightedTokens.length }));\n\t\telse {\n\t\t\tif (unsightedTokens.length == 1)\n\t\t\t\tui.notifications.warn(i18n.get('LittleHelper.Scene.NoVisionOnToken', { name: unsightedTokens[0].name }));\n\t\t\telse\n\t\t\t\tui.notifications.warn(i18n.get('LittleHelper.Scene.LackingVision', { count: unsightedTokens.length }));\n\t\t}\n\n\t\tconst C = CFG.console.colors;\n\t\tconsole.log('%cLittle Helper%c ðŸ¦Ž', C.main, C.unset, '| Unsighted Tokens:', unsightedTokens.map(t => t.name));\n\t}\n}\n\n/**\n * Scene update\n *\n * @param {Scene} scene\n * @param {object} update\n */\nfunction sceneUpdateEvent(scene, update) {\n\t// Not viewed?\n\tif (scene.id !== canvas.scene?.id) return;\n\n\t// Ignore flag changes for notifications\n\tconst scrubbedUpdate = foundry.utils.deepClone(update);\n\tdelete scrubbedUpdate._id;\n\tdelete scrubbedUpdate.flags; // e.g. Stairways module uses scene flags to store the teleporter points\n\tif (foundry.utils.isEmpty(scrubbedUpdate)) return;\n\n\tcanvasReadyEvent(canvas);\n}\n\n/**\n * Warn about newly placed player owned token lacking vision.\n *\n * @param {TokenDocument} token\n * @param {object} options\n * @param {string} userId\n */\nfunction newTokenOnScene(token, options, userId) {\n\tif (!canvas.scene.tokenVision) return;\n\tif (token.sight.enabled) return;\n\tconst actor = token.actor;\n\tif (!actor?.hasPlayerOwner) return;\n\tif (actor.type !== 'character') return; // No NPC tokens, or basic actors\n\tif (!actor.isOwner) return;\n\n\tui.notifications.warn(i18n.get('LittleHelper.Scene.NoVisionOnToken', { name: token.name }));\n}\n\nHooks.on('createToken', newTokenOnScene);\nHooks.on('canvasReady', canvasReadyEvent);\nHooks.on('updateScene', sceneUpdateEvent);\n",
    "// NO DEFAULT VIEW ON SCENE\n\nlet lastSceneWarning;\n\nfunction canvasReadyEvent(canvas) {\n\tif (!game.user.isGM) {\n\t\tHooks.off('canvasReady', canvasReadyEvent);\n\t\treturn;\n\t}\n\n\tif (canvas.scene.initial === null) {\n\t\tif (lastSceneWarning === canvas.scene.id) return;\n\t\tlastSceneWarning = canvas.scene.id;\n\t\tui.notifications.warn(`This scene \"${canvas.scene.name}\" lacks initial view. Please consider setting it at bottom of scene settings.`);\n\t}\n}\n\nHooks.on('canvasReady', canvasReadyEvent);\n",
    "/**\n * @param {*} app\n * @param {HTMLElement} html\n */\nfunction sceneConfigEvent(app, html) {\n\tconst scene = app.object ?? app.document;\n\n\t/** Another warning for no initial view */\n\tif (!scene.initial || scene.initial?.x === null || scene.initial?.y === null)\n\t\thtml.querySelector('[name=\"initial.x\"]')\n\t\t\t?.closest('.form-group')\n\t\t\t?.classList.add('lil-warning');\n}\n\nHooks.on('renderSceneConfig', sceneConfigEvent);\n",
    "// Check if scene scale is ft in metric or m in imperial and report the mismatch\n\nimport { i18n } from '@root/utility/i18n.mjs';\n\nconst sceneScaleMismatch = (canvas) => {\n\tconst grid = canvas.scene?.grid;\n\tif (!grid) return;\n\n\tconst sunits = pf1.utils.getDistanceSystem();\n\n\tconst { units, distance } = grid;\n\tconst badUnits = sunits === 'metric' ? ['ft', 'mi'] : ['m', 'km'];\n\tconst badUnitsi18n = badUnits.map(u => pf1.config.measureUnits[u]);\n\tif (badUnits.includes(units) || badUnitsi18n.some(ul => ul.toLowerCase() == units.toLowerCase()))\n\t\tui.notifications.warn(i18n.get('LittleHelper.Warning.GM.SceneScaleMismatch', { units, scale: distance }));\n};\n\nHooks.on('canvasReady', sceneScaleMismatch);\n",
    "/**\n * Support https://gitlab.com/mkahvi/fvtt-micro-modules/-/tree/master/pf1-feature-sources\n * BUG: This is incredibly cumbersome.\n */\n\nimport { Feature } from '../core/feature.mjs';\nimport { Ancillary } from '../ancillary.mjs';\n\nimport { delSheetMarker, setSheetMarker } from '../common.mjs';\n\nconst marker = 'featureSources';\nlet markerId = 0;\n\nconst levelConflicting = {\n\tfeat: ['level', 'class'],\n\tclassFeat: ['feat'],\n};\n\n/**\n * @param {ActorSheetPF} sheet\n * @param {HTMLElement} html\n * @param _opts\n * @param {SharedData} shared\n */\nasync function featureSourceConflicts(sheet, html, _opts, shared) {\n\tlet cancel = false;\n\tconst _markerId = markerId++;\n\tsetSheetMarker(sheet, marker, _markerId, () => cancel = true);\n\n\tconst actor = sheet.document;\n\tconst feats = {};\n\n\t// Filter by subtype\n\tif (actor.itemTypes.feat) {\n\t\tfor (const i of actor.itemTypes.feat) {\n\t\t\tconst subType = i.system.featType;\n\t\t\tif (feats[subType] === undefined) feats[subType] = { items: [], conflicts: [] };\n\t\t\tfeats[subType].items.push(i);\n\t\t}\n\t}\n\n\t// Build lists by type\n\tfor (const e of Object.entries(levelConflicting)) {\n\t\tconst [subType, conflicts] = e;\n\t\tconst items = feats[subType]?.items;\n\t\tif (!(items?.length > 1)) continue;\n\n\t\tconst levels = {};\n\t\tfor (const i of items) {\n\t\t\tconst type = i.flags?.world?.['source_type'];\n\t\t\tif (!conflicts.includes(type)) continue;\n\t\t\tif (levels[type] === undefined) levels[type] = {};\n\t\t\tconst level = i.flags?.world?.['source_level'];\n\t\t\tif (level === undefined) continue;\n\t\t\tif (levels[type][level] === undefined) levels[type][level] = [];\n\t\t\tlevels[type][level].push({ item: i, type, level });\n\t\t}\n\t\tfeats[subType].levels = levels;\n\t}\n\n\tconst majorconflicts = [];\n\tfor (const e of Object.entries(levelConflicting)) {\n\t\tconst [subType, conflicts] = e;\n\t\tif (!feats[subType]?.levels) continue;\n\n\t\tfor (const vs of Object.values(feats[subType].levels)) {\n\t\t\tfor (const vsis of Object.values(vs)) {\n\t\t\t\tif (vsis.length > 1) majorconflicts.push(vsis);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (cancel || majorconflicts.length === 0) {\n\t\tdelSheetMarker(sheet, marker, _markerId);\n\t\treturn;\n\t}\n\n\tconst conflictingItems = majorconflicts.flat().map(i => i.item);\n\tconst tab = shared.tabs.feats?.tab;\n\tif (tab) {\n\t\tfor (const el of tab.querySelectorAll('.item[data-item-id]')) {\n\t\t\tif (cancel) continue;\n\t\t\tconst id = el.dataset.itemId;\n\t\t\tconst item = conflictingItems.find(i => i.id === id);\n\t\t\tif (!item) continue;\n\t\t\tel.classList.add('lil-feature-source-conflict');\n\t\t}\n\t}\n\n\tdelSheetMarker(sheet, marker, _markerId);\n}\n\nfunction enable() {\n\tif (!game.modules.get('mkah-pf1-feature-sources')?.active) return;\n\n\tAncillary.register('actor', featureSourceConflicts);\n}\n\nfunction disable() {\n\tAncillary.unregister('actor', featureSourceConflicts);\n}\n\nnew Feature({ setting: 'module-feature-sources', label: 'Feature Sources', hint: 'Attempts to display source conflicts on actor sheet. This is slow procedure and may impact sheet performance.', category: 'module', enable, disable, stage: 'ready', requirements: { module: 'mkah-pf1-feature-sources' } });\n",
    "import { CFG } from '@root/config.mjs';\nimport { maxPrecision, signNum } from '@root/common.mjs';\nimport { unflair, getVariables } from '@core/formula.mjs';\nimport { i18n } from '@root/utility/i18n.mjs';\n\nconst METATYPES = {\n\tnormal: 'normal',\n\tnonCritical: 'nonCrit',\n\tcriticalOnly: 'crit',\n};\n\nconst baseDamageData = () => {\n\treturn {\n\t\tenabled: true,\n\t\tformula: '',\n\t\tstatic: true,\n\t\tavg: 0,\n\t\test: 0,\n\t};\n};\n\nclass DamageInstance {\n\tlabel;\n\tformula;\n\troll;\n\ttype;\n\tmetatype;\n\tenabled = true;\n\tconditional = false;\n\tverbose = true;\n\n\tdamage = {};\n\n\tconstructor(label, formula, roll, type = 'inherit', metatype = METATYPES.normal) {\n\t\tthis.label = label;\n\t\tthis.formula = formula;\n\t\tthis.roll = roll;\n\t\tthis.type = type;\n\t\tthis.metatype = metatype;\n\t}\n}\n\nexport class TheoryDialog extends foundry.applications.api.HandlebarsApplicationMixin(foundry.applications.api.DocumentSheetV2) {\n\t_config = {\n\t\tsize: undefined,\n\t\tdamage: {\n\t\t\tcustom: { formula: '', enabled: true },\n\t\t},\n\t\tattacks: [],\n\t\tclOffset: 0,\n\t\thaste: false,\n\t\tmanyshot: false,\n\t\tfull: false,\n\t\taction: undefined,\n\t};\n\n\trollData;\n\n\tconstructor({ action, ...options } = {}) {\n\t\tsuper(options);\n\n\t\tthis.action = action;\n\t}\n\n\t/** @override */\n\t_initializeApplicationOptions(options) {\n\t\toptions = super._initializeApplicationOptions(options);\n\t\toptions.uniqueId += '-theory-dialog';\n\t\treturn options;\n\t}\n\n\tget title() {\n\t\treturn `Theory on ${this.document.name}`;\n\t}\n\n\tget item() {\n\t\treturn this.document;\n\t}\n\n\tstatic DEFAULT_OPTIONS = {\n\t\tclasses: ['koboldworks', 'theory'],\n\t\twindow: {\n\t\t\ticon: 'fa-solid fa-chart-line',\n\t\t\tresizable: true,\n\t\t},\n\t\tform: {\n\t\t\tcloseOnSubmit: false,\n\t\t\tsubmitOnChange: true,\n\t\t},\n\t\tsheetConfig: false,\n\t};\n\n\tstatic PARTS = {\n\t\tform: {\n\t\t\ttemplate: `modules/${CFG.id}/templates/item-theory.hbs`,\n\t\t},\n\t};\n\n\tgetBaseData() {\n\t\tconst item = this.item;\n\t\tconst action = this.action;\n\t\tconst atkData = action ?? item.system;\n\n\t\tconst held = action.held || item.system.held || '1h';\n\n\t\tconst sizes = {};\n\t\tfor (const [index, v] of Object.values(pf1.config.actorSizes)) {\n\t\t\tsizes[index] = v;\n\t\t}\n\n\t\tconst context = {\n\t\t\tisSpell: item.type === 'spell',\n\t\t\tisTwoHanded: held === '2h',\n\t\t\tisRanged: ['rwak', 'rsak', 'rcman'].includes(atkData.actionType),\n\t\t\tisOffhand: held === 'oh' || (!action.primaryAttack && item.system.attackType === 'natural'),\n\n\t\t\toptions: {\n\t\t\t\tsize: sizes,\n\t\t\t},\n\n\t\t\tsize: 4,\n\n\t\t\thasAttacks: true,\n\n\t\t\trollData: action.getRollData(),\n\t\t};\n\n\t\t// Size\n\t\tcontext.size = this._config.size ?? context.rollData.size ?? 4;\n\t\tcontext.rollData.size = context.size;\n\t\tthis._config.size = context.size;\n\n\t\t// Apply CL offset\n\t\tconst clOffset = this._config.clOffset ?? 0;\n\t\tcontext.rollData.cl += clOffset;\n\n\t\t// Add attacks\n\t\tcontext.attacks = this.action.getAttacks({ full: true, resolve: true, bonuses: true })\n\t\t\t.map(atk => new DamageInstance(`BAB [${signNum(atk.bonus)}]`, `${atk.bonus}`));\n\n\t\tcontext.full = this._config.full;\n\n\t\t// Haste extra attack\n\t\tconst hasteAttack = {\n\t\t\tlabel: 'Haste',\n\t\t\tmod: Number.parseInt(context.attacks[0].formula),\n\t\t\tenabled: this._config.haste,\n\t\t\tdamage: {},\n\t\t};\n\t\tcontext.attacks.splice(1, 0, hasteAttack);\n\n\t\treturn context;\n\t}\n\n\tasync baseDamageParts(item, action, rollData) {\n\t\tconst atkDta = action ?? item.system;\n\t\tconst dmg = atkDta.damage;\n\n\t\tconst allDamage = [];\n\n\t\tconst doPart = async (d, metatype) => {\n\t\t\tconst roll = await RollPF.safeRoll(d.formula, rollData);\n\t\t\treturn [d, roll, metatype];\n\t\t};\n\n\t\t// TODO: Batch await\n\t\tconst dmgParts = dmg.parts?.map(d => doPart(d, METATYPES.normal)) ?? [];\n\t\tconst nonCritParts = dmg.nonCritParts?.map(d => doPart(d, METATYPES.nonCritical)) ?? [];\n\n\t\tconst parts = await Promise.all([...dmgParts, ...nonCritParts]);\n\n\t\tfor (const [d, roll, metatype] of parts) {\n\t\t\tconst { formula, types } = d;\n\t\t\tallDamage.push({ formula, roll, types, metatype, enabled: true });\n\t\t}\n\n\t\t/*\n\t\tdmg.critParts.forEach(d => {\n\t\t\tconst [formula, type] = d;\n\t\t\tconst roll = RollPF.safeRoll(formula, rollData);\n\t\t\tallDamage.push({ formula, type,  metatype: METATYPES.nonCritical, enabled: true });\n\t\t});\n\t\t*/\n\n\t\treturn allDamage;\n\t}\n\n\t/**\n\t * @param {object} context  - Context data\n\t * @param {object} rollData\n\t * @returns\n\t */\n\tasync getDamage(context, rollData) {\n\t\tconst item = this.item,\n\t\t\taction = this.action,\n\t\t\titemData = item.system;\n\n\t\tconst baseDamage = await this.baseDamageParts(item, action, rollData);\n\t\tconst enhOverride = action.enh?.value ?? undefined;\n\t\tconst enhBonus = enhOverride ?? itemData.enh ?? 0;\n\n\t\t// Ability to damage\n\t\tconst actorData = item.actor?.system;\n\t\tif (actorData) {\n\t\t\tconst abl = action.ability.damage;\n\t\t\tconst mult = action.ability.damageMult;\n\t\t\tif (abl?.length && Number.isFinite(mult)) {\n\t\t\t\tconst formula = `floor(@abilities.${abl}.mod * @action.ability.damageMult)`;\n\t\t\t\tconst roll = RollPF.safeRollSync(formula, rollData);\n\t\t\t\tbaseDamage.push(new DamageInstance(i18n.get(`PF1.Ability${abl.capitalize()}`), formula, roll, 'inherit', METATYPES.normal));\n\t\t\t}\n\t\t}\n\n\t\tif (enhBonus > 0) baseDamage.push(new DamageInstance('Enhancement', `${enhBonus}`, RollPF.safeRollSync(`${enhBonus}`), 'inherit', METATYPES.normal));\n\n\t\tconst allDmg = [];\n\t\tconst condDmg = {};\n\t\tfor (const cd of action.conditionals) {\n\t\t\tfor (const mod of cd.modifiers) {\n\t\t\t\tif (mod.target !== 'damage') return;\n\n\t\t\t\tlet store;\n\t\t\t\tif (mod.subTarget === 'allDamage') {\n\t\t\t\t\tstore = allDmg;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tconst re = /attack\\.(?<attack>\\d+)/.exec(mod.subTarget);\n\t\t\t\t\tif (!re) return;\n\t\t\t\t\tconst attack = Number.parseInt(re.groups.attack);\n\t\t\t\t\tif (!condDmg[attack]) condDmg[attack] = [];\n\t\t\t\t\tstore = condDmg[attack];\n\t\t\t\t}\n\t\t\t\tconst di = new DamageInstance(cd.name, mod.formula, undefined, mod.type, mod.critical);\n\t\t\t\tdi.enabled = cd.default;\n\t\t\t\tstore.push(di);\n\t\t\t}\n\t\t}\n\n\t\tconst extendedDamage = [];\n\t\tfor (const d of allDmg) {\n\t\t\tconst roll = await RollPF.safeRoll(d.formula, rollData);\n\t\t\tconst di = new DamageInstance(d.label, d.formula, roll, d.type, d.metatype);\n\t\t\tdi.conditional = true;\n\t\t\tdi.enabled = d.enabled;\n\t\t\textendedDamage.push(di);\n\t\t}\n\n\t\tconst optionalDamage = [];\n\t\t// Power Attack, Deadly Aim, Piranha Strike\n\t\t// Off-hand = 1, Ranged = 2, Two-handed = 3, anything else is 2\n\t\t// TODO: Primary/secondary natural\n\t\tlet powerAttackDamage = 2;\n\t\tif (context.isOffhand) powerAttackDamage = 1;\n\t\telse if (context.isRanged) powerAttackDamage = 2;\n\t\telse if (context.isTwoHanded) powerAttackDamage = 3;\n\n\t\tconst bab = rollData.attributes?.bab.total;\n\t\tif (bab !== undefined) {\n\t\t\tconst powerAttackSteps = (bab + 4) / 4;\n\t\t\tconst formula = `${powerAttackDamage} * floor((@attributes.bab.total + 4) / 4)`;\n\t\t\tconst roll = RollPF.safeRollSync(formula, rollData);\n\t\t\trollData.powerAttackDamage = roll.total;\n\t\t\trollData.powerAttackPenalty = -powerAttackSteps;\n\t\t\tconst di = new DamageInstance('Power Attack/Deadly Aim/Piranha Strike', formula, roll, METATYPES.normal);\n\t\t\tdi.enabled = false;\n\t\t\tdi.custom = false;\n\t\t\tdi.verbose = true;\n\t\t\tdi.powerAttack = true;\n\t\t\tdi.id = 'powerAttack';\n\t\t\toptionalDamage.push(di);\n\t\t}\n\n\t\treturn { baseDamage, optionalDamage, extendedDamage, allDmg, condDmg };\n\t}\n\n\tfillAttackData(atk, rollData, stats) {\n\t\tatk.error = atk.roll?.err ?? false;\n\t\tif (atk.error) atk.verbose = true;\n\t\tatk.originalFormula = atk.formula;\n\t\tconst formula = atk.roll.formula || atk.formula;\n\t\tatk.strippedFormula = unflair(pf1.utils.formula.simplify(formula, rollData));\n\t\tatk.max = atk.roll.clone().evaluateSync({ maximize: true });\n\t\tatk.min = atk.roll.clone().evaluateSync({ minimize: true });\n\t\tconst l_est = (atk.max.total - atk.min.total) / 2 + atk.min.total;\n\t\tconst l_avg = (atk.max.total + atk.min.total) / 2;\n\t\tatk.avg = maxPrecision(l_avg, 2);\n\t\tatk.est = maxPrecision(l_est, 2);\n\t\tatk.static = atk.max.total === atk.min.total && atk.roll.isDeterministic;\n\t\tif (atk.base) atk.enabled = true;\n\t\tif (atk.enabled) {\n\t\t\tstats.avg += l_avg;\n\t\t\tstats.est += l_est;\n\t\t\tstats.min += atk.min.total;\n\t\t\tstats.max += atk.max.total;\n\t\t}\n\n\t\tatk.finalFormula = atk.roll.formula;\n\n\t\tatk.staticFormula = atk.originalFormula == atk.finalFormula;\n\n\t\tatk.variables = getVariables(atk.formula);\n\t\tif (atk.variables.length > 0) {\n\t\t\tatk.variablesFormatted = atk.variables.map(v => `${v} = ${foundry.utils.getProperty(rollData, v)}`).join('\\n');\n\t\t\tatk.verbose = true; // force verbosity\n\t\t}\n\t}\n\n\t// Custom formula\n\tasync getCustom(rollData, stats) {\n\t\tconst custom = this._config.damage.custom ?? { formula: '', enabled: true };\n\t\tcustom.custom = true;\n\n\t\tcustom.roll = await RollPF.safeRoll(custom.formula || '0', rollData);\n\t\tif (custom.formula.length > 0)\n\t\t\tcustom.verbose = !!custom.variables;\n\t\telse {\n\t\t\tcustom.static = true;\n\t\t\tcustom.verbose = false;\n\t\t}\n\n\t\treturn custom;\n\t}\n\n\tasync _prepareContext(options) {\n\t\tconst item = this.item,\n\t\t\taction = this.action;\n\n\t\tconst context = this.getBaseData();\n\t\tcontext.item = item;\n\t\tcontext.action = action;\n\n\t\tcontext.actions = {};\n\t\tfor (const act of item.actions) {\n\t\t\tif (act.hasDamage) context.actions[act.id] = act.name;\n\t\t}\n\t\tcontext.selectedAction = action.id;\n\n\t\tconst isTwoHanded = context.isTwoHanded,\n\t\t\tisRanged = context.isRanged,\n\t\t\tisOffhand = context.isOffhand;\n\n\t\t// TODO: Buffs\n\n\t\tif (this._config.manyshot) {\n\t\t\t//\n\t\t}\n\n\t\tconst isCritical = false;\n\n\t\tconst damage = await this.getDamage(context, context.rollData);\n\n\t\tconst stats = { avg: 0, est: 0, min: 0, max: 0 };\n\n\t\tconst custom = await this.getCustom(context.rollData, stats);\n\n\t\tconst all = [...damage.baseDamage, ...damage.extendedDamage, ...damage.optionalDamage, custom];\n\n\t\t// Toggle values\n\t\tfor (const [idx, dmg] of Object.entries(this._config.damage)) {\n\t\t\tif (dmg.enabled !== undefined) {\n\t\t\t\tconst _dmg = all[Number(idx)];\n\t\t\t\tif (!_dmg) continue;\n\t\t\t\t_dmg.enabled = dmg.enabled;\n\t\t\t}\n\t\t}\n\n\t\tconst attacks = this._config.attacks;\n\n\t\t// Fill data for all damage instances\n\t\tfor (const [index, atk] of all.entries()) {\n\t\t\tatk.enabled = attacks[0]?.damage?.grouped?.[index]?.enabled ?? atk.enabled ?? false;\n\t\t\tatk.index = index;\n\n\t\t\tthis.fillAttackData(atk, context.rollData, stats);\n\t\t}\n\n\t\tconst total = { avg: maxPrecision(stats.avg, 2), est: maxPrecision(stats.est, 2), min: stats.min, max: stats.max, static: stats.min === stats.max };\n\n\t\t// Construct final data structure\n\t\tconst derived = {\n\t\t\tdamage: {\n\t\t\t\tbase: damage.baseDamage,\n\t\t\t\textended: damage.extendedDamage,\n\t\t\t\toptional: damage.optionalDamage,\n\t\t\t\tall,\n\t\t\t\tgrouped: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: undefined,\n\t\t\t\t\t\tbase: true,\n\t\t\t\t\t\tconditional: false,\n\t\t\t\t\t\tcustom: false,\n\t\t\t\t\t\titems: damage.baseDamage,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Conditional',\n\t\t\t\t\t\tbase: false,\n\t\t\t\t\t\tconditional: true,\n\t\t\t\t\t\tcustom: false,\n\t\t\t\t\t\titems: damage.extendedDamage,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Optional',\n\t\t\t\t\t\tbase: false,\n\t\t\t\t\t\tconditional: false,\n\t\t\t\t\t\tcustom: false,\n\t\t\t\t\t\titems: damage.optionalDamage,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Custom',\n\t\t\t\t\t\tbase: false,\n\t\t\t\t\t\tconditional: false,\n\t\t\t\t\t\tcustom: true,\n\t\t\t\t\t\titems: [custom],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\thasPerAttack: !foundry.utils.isEmpty(damage.condDmg),\n\t\t\t\tperAttack: damage.condDmg,\n\t\t\t\tcustom,\n\t\t\t\ttotal,\n\t\t\t\tstats,\n\t\t\t},\n\t\t\tattacks: this._config.attacks,\n\t\t\tconfig: this._config,\n\t\t};\n\n\t\tfor (const atk of context.attacks) {\n\t\t\tatk.damage = {\n\t\t\t\tgroups: derived.damage.grouped,\n\t\t\t\ttotal: derived.damage.total,\n\t\t\t};\n\t\t}\n\n\t\tcontext.attack = context.attacks[0];\n\n\t\tconst attackCount = context.attacks.length + (this._config.haste ? 1 : 0);\n\n\t\tcontext.fullAttack = {\n\t\t\test: maxPrecision(attackCount * context.attack.damage.total.est, 2),\n\t\t\tstatic: false,\n\t\t\tattackCount,\n\t\t\tmin: maxPrecision(attackCount * context.attack.damage.total.min, 2),\n\t\t\tmax: maxPrecision(attackCount * context.attack.damage.total.max, 2),\n\t\t};\n\n\t\tcontext.d = derived;\n\n\t\tcontext.uuid = `${item.uuid}-theory`;\n\n\t\t/*\n\t\t// Check for unawaited promises\n\t\tfor (const [path, value] of Object.entries(foundry.utils.flattenObject(context))) {\n\t\t\tif (value instanceof Promise) console.error(path, value);\n\t\t}\n\t\t*/\n\n\t\treturn context;\n\t}\n\n\t/**\n\t * @param {object} config\n\t * @param {Event} event\n\t */\n\t_onChangeForm(config, event) {\n\t\tconst data = foundry.utils.expandObject(new foundry.applications.ux.FormDataExtended(this.element).object);\n\n\t\t// Objects to arrays\n\t\tdata.attacks = Object.values(data.attacks);\n\t\tdata.damage.custom.enabled = data.attacks[0].damage.custom.enabled;\n\n\t\tfor (const [ai, atk] of this._config.attacks.entries()) {\n\t\t\tif (atk.damage?.grouped) {\n\t\t\t\tfor (const [di, dmg] of atk.damage.grouped.entries()) {\n\t\t\t\t\tconst enabled = data.attacks?.[ai]?.damage?.grouped?.[di]?.enabled;\n\t\t\t\t\tif (enabled !== undefined)\n\t\t\t\t\t\tdmg.enabled = enabled;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Extract first attack damage toggles\n\t\tfor (const [idx, dmg] of Object.entries(data.attacks[0]?.damage)) {\n\t\t\tif (dmg.enabled !== undefined) {\n\t\t\t\tthis._config.damage[idx] ??= {};\n\t\t\t\tthis._config.damage[idx].enabled = dmg.enabled;\n\t\t\t}\n\t\t}\n\n\t\tdelete data.attacks;\n\t\tfoundry.utils.mergeObject(this._config, data);\n\n\t\tif (data.action)\n\t\t\tthis.action = this.item.actions.get(data.action);\n\n\t\tthis.render();\n\t}\n\n\t/**\n\t * @param context\n\t * @param options\n\t */\n\t_onRender(context, options) {\n\t\tsuper._onRender(context, options);\n\n\t\t/** @type {HTMLElement} */\n\t\tconst html = this.element.querySelector('.window-content');\n\n\t\tconst sliders = html.querySelectorAll('input[type=\"range\"]');\n\t\tfor (const slider of sliders) {\n\t\t\tconst label = slider.nextElementSibling;\n\t\t\tslider.addEventListener('input', () => label.textContent = `${slider.value}%`, { passive: true });\n\t\t}\n\n\t\tconst actor = this.action.actor;\n\t\tif (!actor) return;\n\n\t\t// Highlight actor size\n\t\tconst size = actor.system.traits?.size?.value ?? 4;\n\t\tconst sizeEl = html.querySelector('select[name=\"size\"]');\n\t\tsizeEl?.querySelector(`option[value=\"${size}\"]`)?.classList.add('current-size');\n\n\t\t// Highlight default action\n\t\tconst actionEl = html.querySelector('select[name=\"action\"]');\n\t\tconst defaultActionId = this.action.item?.defaultAction?.id;\n\t\tactionEl?.querySelector(`option[value=\"${defaultActionId}\"]`)?.classList.add('default-action');\n\t}\n}\n",
    "import { Ancillary } from '@root/ancillary.mjs';\nimport { Feature } from '@core/feature.mjs';\nimport { TheoryDialog } from './theory-dialog.mjs';\nimport { FAIcons } from '@core/icons.mjs';\nimport { addCoreTooltip } from '@root/common.mjs';\n\n/**\n * @param {ItemSheet} sheet\n * @param {HTMLElement} html\n * @param {object} options\n * @param {SharedData} shared\n */\nfunction injectTooltip(sheet, html, options, shared) {\n\t// const pv = sheet.__littleHelper?.unidentifiedView ?? false;\n\tconst app = html.closest('.app[data-appid]');\n\tconst button = app?.querySelector('header > .little-helper-theory-button');\n\tif (button) addCoreTooltip(button, 'Damage Theory');\n}\n\n/**\n * @param {ItemSheet} sheet\n * @param {Array<object>} buttons\n */\nfunction theoryHeaderButton(sheet, buttons) {\n\tconst doc = sheet.document ?? sheet.action;\n\n\tconst item = doc.item ?? doc,\n\t\taction = doc instanceof Item ? doc.defaultAction : doc;\n\n\tif (!doc.hasDamage) return;\n\n\tconst button = {\n\t\tlabel: '',\n\t\ticon: FAIcons.search,\n\t\tclass: 'little-helper-theory-button',\n\t\tonclick: _ => new TheoryDialog({ document: item, action }).render({ force: true }),\n\t};\n\n\tbuttons.unshift(button);\n\t// buttons.splice(buttons.length - 1, 0, button);\n}\n\nfunction enable() {\n\tHooks.on('getItemSheetHeaderButtons', theoryHeaderButton);\n\tHooks.on('getItemActionSheetHeaderButtons', theoryHeaderButton);\n\tAncillary.register('item', injectTooltip);\n\tAncillary.register('action', injectTooltip);\n}\n\nfunction disable() {\n\tHooks.off('getItemSheetHeaderButtons', theoryHeaderButton);\n\tHooks.off('getItemActionSheetHeaderButtons', theoryHeaderButton);\n\tAncillary.unregister('item', injectTooltip);\n\tAncillary.unregister('action', injectTooltip);\n}\n\nnew Feature({ setting: 'item-theory', label: 'Theory', hint: 'Adds a dialog button to item sheet header with theoretical data about them.', category: 'items', enable, disable, stage: 'ready' });\n",
    "import { CFG } from '../config.mjs';\nimport { Ancillary } from '../ancillary.mjs';\nimport { stopEventPropagation } from '../common.mjs';\nimport { FAIcons } from '@core/icons.mjs';\n\nconst FLAGS = {\n\tkeenFlag: 'keen',\n\thideAttacksFlag: 'hideAttacks',\n\tautoPowerAttack: 'autoPowerAttack',\n\tskipDialogFlag: 'skipDialog',\n\trollModeOverrideFlag: 'rollmodeOverride',\n\trollOverrideFlag: 'rollOverride',\n};\n\nexport const migrateItemFlags = async (item) => {\n\tif (item.flags?.lilhelper?.item) return;\n\n\tconst flags = {\n\t\t[FLAGS.rollOverrideFlag]: item.getItemDictionaryFlag(FLAGS.rollOverrideFlag),\n\t\t[FLAGS.rollModeOverrideFlag]: item.getItemDictionaryFlag(FLAGS.rollModeOverrideFlag),\n\t\t[FLAGS.keenFlag]: item.hasItemBooleanFlag(FLAGS.keenFlag),\n\t\t[FLAGS.hideAttacksFlag]: item.hasItemBooleanFlag(FLAGS.hideAttacksFlag),\n\t\t[FLAGS.autoPowerAttack]: item.hasItemBooleanFlag(FLAGS.autoPowerAttack),\n\t\t[FLAGS.skipDialogFlag]: item.getItemDictionaryFlag(FLAGS.skipDialogFlag),\n\t};\n\n\tfor (const [key, value] of Object.entries(flags)) {\n\t\tif (value === undefined || value === '' || value === false || value === 0) delete flags[key];\n\t}\n\n\tif (Object.keys(flags).length === 0) return;\n\n\tconst updateData = {\n\t\tflags: {\n\t\t\tlilhelper: {\n\t\t\t\titem: flags,\n\t\t\t},\n\t\t},\n\t\tsystem: {\n\t\t\tflags: {\n\t\t\t\tboolean: {\n\t\t\t\t\t'-=keen': null,\n\t\t\t\t\t'-=autoPowerAttack': null,\n\t\t\t\t\t'-=hideAttacks': null,\n\t\t\t\t},\n\t\t\t\tdictionary: {\n\t\t\t\t\t'-=rollOverride': null,\n\t\t\t\t\t'-=rollmodeOverride': null,\n\t\t\t\t\t'-=skipDialog': null,\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t};\n\n\tconst C = CFG.console.colors;\n\tconsole.log('%cLittle Helper%c ðŸ¦Ž | Migrating Item Flags |', C.main, C.unset, item);\n\treturn item.update(updateData);\n};\n\nconst sheetTemplateSource = /** @type {const} */ (`modules/${CFG.id}/templates/item-config.hbs`);\nHooks.once('setup', () => foundry.applications.handlebars.loadTemplates([sheetTemplateSource]));\n\n/**\n * @param {ItemSheet} sheet\n * @param {HTMLElement} html\n */\nfunction itemSheetConfig(sheet, html) {\n\tconst tab = html.querySelector('.tab[data-tab=\"advanced\"]');\n\tif (!tab) return;\n\tconst item = sheet.item;\n\n\tmigrateItemFlags(item);\n\n\t// Guard against weird modes\n\tconst rollModeGuard = (mode) => {\n\t\tif (mode == undefined) return '';\n\t\tif (Object.keys(CFG.ROLLMODES).includes(mode)) return mode;\n\t\tif (mode == 'roll') return 'publicroll';\n\t\treturn 'garbage';\n\t};\n\n\tconst flags = sheet.item.flags?.lilhelper?.item ?? {};\n\n\tconst rollModeOverride = rollModeGuard(flags[FLAGS.rollModeOverrideFlag]);\n\tconst rollModes = foundry.utils.deepClone(CFG.ROLLMODES);\n\tif (rollModeOverride == 'garbage') rollModes.garbage = 'BAD VALUE';\n\n\tconst hasAction = !['class', 'race', 'container'].includes(item.type);\n\n\tconst templateData = {\n\t\t...flags,\n\t\tuid: `lil-${item.id}`,\n\t\ttype: item.type,\n\t\thasAction,\n\t\tchoices: {\n\t\t\trollmodes: rollModes,\n\t\t\tskipDialog: {\n\t\t\t\t0: 'LittleHelper.Options.NoOverride',\n\t\t\t\t1: 'LittleHelper.Options.ForceDisplay',\n\t\t\t\t'-1': 'LittleHelper.Options.ForceSkip',\n\t\t\t},\n\t\t},\n\t\tlibwrapper: game.modules.get('lib-wrapper')?.active ?? false,\n\t\ticons: FAIcons,\n\t};\n\n\tconst sheetTemplate = Handlebars.partials[sheetTemplateSource];\n\n\tconst fragment = document.createDocumentFragment();\n\t// fragments have no innerHTML\n\tconst div = document.createElement('div');\n\tdiv.innerHTML = sheetTemplate(templateData, { allowProtoMethodsByDefault: true, allowProtoPropertiesByDefault: true });\n\tfragment.append(...div.childNodes);\n\n\tfor (const el of fragment.querySelectorAll('[data-name]')) {\n\t\tel.addEventListener('change', ev => {\n\t\t\tconst path = ev.target.dataset.name;\n\t\t\tconst value = ev.target.value;\n\t\t\titem.update({ [path]: value });\n\t\t});\n\t}\n\n\tif (!sheet.isEditable) {\n\t\tfor (const el of fragment.querySelectorAll('input,select')) {\n\t\t\tel.readOnly = true;\n\t\t\tel.disabled = true;\n\t\t}\n\t}\n\n\ttab.append(fragment);\n}\n\nAncillary.register('item', itemSheetConfig, { priority: 500 });\n",
    "import { CFG } from '../config.mjs';\n\nHooks.once('setup', () => {\n\tgame.keybindings.register(CFG.id, 'extraInfo', {\n\t\tname: 'LittleHelper.Keybindings.ExtraInfo.Hold',\n\t\teditable: [{ key: 'AltRight' }, { key: 'AltLeft' }],\n\t\tonDown: () => {\n\t\t\tCFG.state.alt = true;\n\t\t\tHooks.callAll('little-helper.extraInfo', true);\n\t\t},\n\t\tonUp: () => {\n\t\t\tCFG.state.alt = false;\n\t\t\tHooks.callAll('little-helper.extraInfo', false);\n\t\t},\n\t});\n});\n",
    "import { CFG } from '@root/config.mjs';\nimport { migrateItemFlags } from '@root/config/item-config.mjs';\n\nfunction limitPrecision(number, decimals = 2) {\n\tconst mult = Math.pow(10, decimals);\n\treturn Math.floor(number * mult) / mult;\n}\n\n// pf1PostReady is fired after system migration is done\nHooks.once('pf1PostReady', async () => {\n\tconst activeGM = game.users.activeGM;\n\tif (!activeGM?.isSelf) return;\n\n\tconst migration = game.settings.get(CFG.id, 'migration');\n\tconst mod = game.modules.get(CFG.id);\n\n\tconst C = CFG.console.colors;\n\tif (migration === mod.version || foundry.utils.isNewerVersion(migration, mod.version)) return void console.debug('%cLittle Helper%c ðŸ¦Ž | Migration | Not needed', C.main, C.unset);\n\n\tconsole.log(`%cLittle Helper%c ðŸ¦Ž | Migration | ${migration} -> ${mod.version}`, C.main, C.unset);\n\n\tconst actors = game.actors.filter(a => a.isOwner);\n\tlet pct10 = Math.max(25, Math.floor(actors.length / 10));\n\tif (actors.length < 50) pct10 = 100;\n\tlet i = 0, migrated = 0;\n\tfor (const actor of actors) {\n\t\ti += 1;\n\t\tif (i % pct10 === 0) console.log('%cLittle Helper%c ðŸ¦Ž | Migration |', C.main, C.unset, limitPrecision((i / actors.length) * 100, 1), '% |', i, 'out of', actors.length);\n\t\tfor (const item of actor.items) {\n\t\t\tconst rv = await migrateItemFlags(item);\n\t\t\tif (rv) migrated += 1;\n\t\t}\n\t}\n\n\tconsole.log('%cLittle Helper%c ðŸ¦Ž | Migration | Complete', C.main, C.unset, '|', migrated, 'Items Adjusted');\n\tif (game.users.activeGM?.isSelf) game.settings.set(CFG.id, 'migration', mod.version);\n});\n"
  ],
  "mappings": "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",
  "debugId": "DEDD208AE3B7D2EB64756E2164756E21",
  "names": []
}