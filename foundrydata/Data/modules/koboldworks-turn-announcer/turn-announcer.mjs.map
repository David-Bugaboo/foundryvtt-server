{
  "version": 3,
  "sources": ["../src/helpers/math.mjs", "../src/modules/quench.mjs", "../src/turn-announcer.mjs"],
  "sourcesContent": [
    "/**\n * @param {Number} num\n * @param {Number} min\n * @param {Number} max\n * @returns {Number} Number wrapped within the provided range\n */\nexport function wrapNumber(num, min, max) {\n\tconst range = max - min + 1, value = num - min + 1; // normalize to 1 to range+1\n\tconst t = value % range - 1;\n\treturn (t < 0 ? range + t : t) + min;\n}\n",
    "import { wrapNumber } from '../helpers/math.mjs';\n/* global quench */\nquench.registerBatch(\n\t'koboldworks-turn-announcer.helpers',\n\tasync function testHelpers({ describe, it, expect, before, after } = {}) {\n\t\tdescribe('wrapNumber', function testWrapNumber() {\n\t\t\tit('wrap 5 [0 – 4] = 0', function () {\n\t\t\t\texpect(wrapNumber(5, 0, 4)).to.equal(0);\n\t\t\t});\n\t\t\tit('wrap 6 [2 – 4] = 3', function () {\n\t\t\t\texpect(wrapNumber(6, 2, 4)).to.equal(3);\n\t\t\t});\n\t\t\tit('wrap -1 [0 – 4] = 4', function () {\n\t\t\t\texpect(wrapNumber(-1, 0, 4)).to.equal(4);\n\t\t\t});\n\t\t\tit('wrap -2 [0 – 4] = 3', function () {\n\t\t\t\texpect(wrapNumber(-2, 0, 4)).to.equal(3);\n\t\t\t});\n\t\t\tit('wrap -2 [2 – 4] = 4', function () {\n\t\t\t\texpect(wrapNumber(-2, 2, 4)).to.equal(4);\n\t\t\t});\n\t\t\tit('wrap -102 [0 – 10] = 8', function () {\n\t\t\t\texpect(wrapNumber(-102, 0, 10)).to.equal(8);\n\t\t\t});\n\t\t\tit('wrap 103 [0 – 10] = 4', function () {\n\t\t\t\texpect(wrapNumber(103, 0, 10)).to.equal(4);\n\t\t\t});\n\t\t});\n\t},\n\t{ displayName: game.i18n.localize('Koboldworks.TurnAnnouncer.Tests.Helpers') }\n)\n",
    "const CFG = /** @type {const} */ ({\n\tid: 'koboldworks-turn-announcer',\n\tSETTING: {\n\t\tmissedKey: 'missedTurn',\n\t\thidePortrait: 'hidePortrait',\n\t\tobfuscateNPCs: 'obfuscateNPCs',\n\t\troundCycling: 'roundCycling',\n\t\tcompact: 'compact',\n\t\tturnLabel: 'turnLabel',\n\t\troundLabel: 'roundLabel',\n\t},\n});\n\nconst getPlayerOwners = (thing, perm) => thing ? game.users.players.filter(u => thing.testUserPermission(u, perm)) : [];\n\nconst escapeHTML = (unsafe) => unsafe.replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;').replaceAll('\"', '&quot;').replaceAll('\\'', '&apos;');\n\nimport { wrapNumber } from './helpers/math.mjs';\n\nconst turn_template_file = `modules/${CFG.id}/template/turn-announcer.hbs`,\n\tround_template_file = `modules/${CFG.id}/template/round-cycling.hbs`;\n\nlet turnTemplate, roundTemplate;\nHooks.once('init', () => {\n\tgetTemplate(turn_template_file).then(t => turnTemplate = t);\n\tgetTemplate(round_template_file).then(t => roundTemplate = t);\n});\n\nconst lastCombatant = {\n\tcombatant: null,\n\tget tokenId() { return this.combatant?.token?.id; },\n\tspoke: false,\n};\n\n/**\n * @param {HTMLElement} content\n */\nfunction hideContent(content) {\n\tif (content) {\n\t\tcontent.replaceChildren();\n\t\tcontent.style.display = 'none';\n\t}\n}\n\n/**\n * @param {ChatMessage} cm\n * @param {Element} html\n * @param {Element} main\n */\nfunction compressTurnAnnounceMessage(cm, html, main) {\n\tconst compact = game.settings.get(CFG.id, CFG.SETTING.compact);\n\tif (compact) main.classList.add('compact');\n}\n\n/**\n * @param {ChatMessage} cm\n * @param {Element} html\n * @param {Element} main\n */\nfunction compressRoundCyclingMessage(cm, html, main) {\n\tif (!main) return;\n\tmain.classList.add('koboldworks', 'round-cycling');\n\n\tconst header = html.querySelector('.message-header');\n\tif (!header) return;\n\t// Remove sender\n\theader.querySelector('.message-sender')?.remove();\n\n\tconst content = html.querySelector('.message-content');\n\tif (!content) return;\n\tconst msg = content.querySelector('.round-message');\n\n\theader.prepend(msg);\n\tconst icon = document.createElement('i');\n\ticon.classList.add('fa-solid', 'fa-hourglass-start', 'round-icon');\n\tmsg?.prepend(icon, ' ');\n\n\t// Migrate data attributes\n\tconst data = content.querySelector('.round-cycling');\n\tif (data?.dataset) {\n\t\tmain.dataset.combatId = data.dataset.combatId;\n\t\tmain.dataset.round = data.dataset.round;\n\t}\n\n\t// Remove old content\n\thideContent(content);\n}\n\n/**\n * @param {ChatMessage} cm\n * @param {Element} html\n * @param {Element} main\n */\nfunction compressMissedTurnMessage(cm, html, main) {\n\tmain.classList.add('koboldworks', 'missed-turn-announcer');\n\n\tconst content = html.querySelector('.message-content > .turn-announcer');\n\n\t// Remove things to enforce formatting\n\tconst header = main.querySelector('.message-header');\n\tif (!header) return;\n\theader.classList.remove('message-header');\n\tconst wh = header.querySelector('.whisper-to');\n\tif (wh) {\n\t\tmain.title = wh.textContent;\n\t\twh.remove();\n\t}\n\tconst timestamp = header.querySelectorAll('.message-sender,.message-timestamp');\n\ttimestamp?.forEach(el => el.style.display = 'none');\n\n\tconst msgb = document.createElement('div');\n\tmsgb.classList.add('missed-token');\n\tconst missedIcon = content.querySelector('.missed-turn-icon'),\n\t\tmissedText = content.querySelector('.missed-turn-text'),\n\t\tmissedCombatant = content.querySelector('.missed-combatant'),\n\t\tmissedName = document.createElement('span');\n\tmissedName.classList.add('missed-turn-name');\n\tmissedName.textContent = missedCombatant?.textContent?.trim() ?? '...';\n\tmsgb.append(missedIcon, ' ', missedName, ' ', missedText);\n\theader.prepend(msgb);\n\n\tif (content) hideContent(content);\n}\n\nfunction updateLastCombatantFromMsg(cm, flags) {\n\tlastCombatant.spoke = false;\n\tlastCombatant.combatant = game.combat?.getCombatantByToken(flags.token) ?? null;\n}\n\n/**\n * @param {ChatMessage} cm\n * @param {JQuery} html\n * @param {object} _options\n */\nfunction chatMessageEvent(cm, [html], _options) {\n\tconst isGM = game.user.isGM;\n\tconst flags = cm.flags?.[CFG.id];\n\n\tif (!flags) {\n\t\tif (isGM && cm.speaker?.token === lastCombatant.tokenId)\n\t\t\tlastCombatant.spoke = true;\n\t\treturn;\n\t}\n\n\tconst main = html.closest('[data-message-id]');\n\thtml?.classList.add('turn-announcer', 'koboldworks');\n\n\tif (flags.missedTurn)\n\t\tcompressMissedTurnMessage(cm, html, main);\n\telse if (flags.turnAnnounce || flags.token) {\n\t\tupdateLastCombatantFromMsg(cm, flags);\n\t\tcompressTurnAnnounceMessage(cm, html, main);\n\t}\n\telse if (flags.roundCycling) {\n\t\tcompressRoundCyclingMessage(cm, html, main);\n\t}\n\n\tmain?.querySelector('.whisper-to')?.remove();\n\n\t// De-obfuscate name for GM\n\tif (cm.getFlag(CFG.id, 'obfuscated')) {\n\t\thtml.classList.add('obfuscated');\n\n\t\tconst combat = game.combats.get(cm.getFlag(CFG.id, 'combat')),\n\t\t\tcombatant = combat?.combatants.get(cm.getFlag(CFG.id, 'combatant'));\n\n\t\tif (!combatant?.actor?.testUserPermission(game.user, 'OBSERVER')) return;\n\n\t\tif (combatant?.token) {\n\t\t\tconst name = html.querySelector('.actor .name-box .name');\n\t\t\tif (name) name.textContent = combatant.token.name;\n\t\t}\n\t}\n}\n\nlet lastReported = {};\n\nfunction missedTurn(data, context) {\n\tif (data.last?.spoke || data.last == null) return; // They spoke, nothing more to do.\n\n\tconst preUpdate = context._turnAnnouncer;\n\tif (preUpdate?.combat === game.combats.active.id) {\n\t\t// Rolling back\n\t\tif (preUpdate.roundShift < 0 || preUpdate.turnShift < 0 && preUpdate.roundShift <= 0)\n\t\t\treturn;\n\t}\n\n\tconst { last, combat, combatant } = data;\n\tif (lastReported.combat !== undefined && combat.id !== lastReported.combat) return;\n\tif (last.token?.id === combatant?.token?.id) return; // Same character's turn?\n\tif (lastReported.id === last.token?.id) return;\n\n\tlastReported = { id: last.token?.id, combat: combat.id };\n\n\tconst mt = game.i18n.localize('Koboldworks.TurnAnnouncer.MissedTurn');\n\n\tconst scene = combat.scene,\n\t\tactor = last.actor?.id,\n\t\ttoken = last.token?.id,\n\t\talias = last.name;\n\n\tif (actor === undefined || token === undefined) return;\n\n\tconst cmName = escapeHTML(data.last.combatant.name);\n\n\tconst msgData = {\n\t\tcontent: `<div class=\"koboldworks turn-announcer\"><span class='missed-turn-icon'><i class=\"fas fa-exclamation-triangle\"></i></span><span class='missed-combatant'>${cmName}</span> <span class='missed-turn-text'>${mt}</span></div>`,\n\t\tspeaker: { scene, actor, token, alias },\n\t\tflags: {\n\t\t\t[CFG.id]: { missedTurn: true, token, actor, combatant: last.combatant.id },\n\t\t},\n\t\t// type: CONST.CHAT_MESSAGE_TYPES.OOC\n\t};\n\n\tChatMessage.implementation.applyRollMode(msgData, CONST.DICE_ROLL_MODES.PRIVATE);\n\n\treturn msgData;\n}\n\n/**\n * @param {*} info\n * @param {*} context\n * @returns {object[]}\n */\nfunction generateCards(info, context) {\n\tconst msgs = [];\n\tif (game.settings.get(CFG.id, CFG.SETTING.missedKey)) {\n\t\tconst msg = missedTurn(info, context);\n\t\tif (msg) msgs.push(msg);\n\t}\n\n\tif (info.combatant.defeated) return msgs; // undesired\n\tif (info.last?.combatant != null && info.last.combatant.id === info.combatant.id) return msgs; // don't report the same thing multiple times\n\n\tconst speaker = info.obfuscated ? { user: game.user.id } : ChatMessage.getSpeaker({ token: info.token?.document, actor: info.actor });\n\n\tconst minPerm = CONST.DOCUMENT_OWNERSHIP_LEVELS.OBSERVER;\n\tconst defaultVisible = info.hidden ? false : info.actor?.ownership?.default >= minPerm;\n\n\tconst cardData = {\n\t\tcontent: turnTemplate(info, { allowProtoMethodsByDefault: true, allowProtoPropertiesByDefault: true }),\n\t\tspeaker,\n\t\trollMode: defaultVisible ? 'publicroll' : 'gmroll',\n\t\twhisper: defaultVisible ? [] : getPlayerOwners(info.actor, minPerm).map(u => u.id),\n\t\tflags: {\n\t\t\t[CFG.id]: {\n\t\t\t\tturnAnnounce: true,\n\t\t\t\ttoken: info.token?.id,\n\t\t\t\tround: info.round,\n\t\t\t\tturn: info.turn,\n\t\t\t\tcombat: info.combat.id,\n\t\t\t\tcombatant: info.combatant.id,\n\t\t\t\tobfuscated: info.obfuscated,\n\t\t\t},\n\t\t},\n\t};\n\n\tChatMessage.applyRollMode(cardData, !info.hidden ? 'publicroll' : 'gmroll');\n\tif (cardData.rollMode === 'publicroll') delete cardData.whisper;\n\n\tmsgs.push(cardData);\n\n\treturn msgs;\n}\n\nfunction generateRoundCyclingCard(combat) {\n\tconst speaker = ChatMessage.getSpeaker('GM');\n\tconst override = game.settings.get(CFG.id, CFG.SETTING.roundLabel);\n\tconst data = { combat };\n\tif (override) data.message = override.replace('{round}', combat.round);\n\telse data.message = game.i18n.format('Koboldworks.TurnAnnouncer.RoundCycling', { round: combat.round });\n\tconst msgData = {\n\t\tcontent: roundTemplate(data, { allowProtoMethodsByDefault: true, allowProtoPropertiesByDefault: true }),\n\t\tspeaker,\n\t\trollMode: 'publicroll',\n\t\tflags: {\n\t\t\t[CFG.id]: { roundCycling: true, round: combat.round, combat: combat.id },\n\t\t},\n\t};\n\n\t// Spoof GM as message owner\n\tif (!game.user.isGM) {\n\t\t// msgData.author = game.users.activeGM?.id ?? game.users.filter(u => u.isGM)[0].id;\n\t}\n\n\treturn msgData;\n}\n\n/**\n * @param {Combat} combat\n * @param context\n */\nfunction announceRoundCycling(combat, context) {\n\t// Skip in case turns were rolled back.\n\tif (combat.__turnAnnouncerLastRoundCycle >= combat.round) return;\n\tif (context._turnAnnouncer.roundShift <= 0) return;\n\tcombat.__turnAnnouncerLastRoundCycle = combat.round;\n\treturn generateRoundCyclingCard(combat);\n}\n\n/**\n * @param {Combat} combat\n * @param {string} userId\n * @param context\n */\nfunction announceTurn(combat, context) {\n\t// Only continue with first GM in the list\n\t// if (!game.user.isGM || game.users.filter(o => o.isGM && o.active).sort((a, b) => b.role - a.role)[0].id !== game.user.id) return;\n\n\tconst combatant = combat.combatant;\n\tconst defeated = combatant?.defeated ?? false;\n\tconst tokenDoc = combatant?.token;\n\tif (!tokenDoc) return; // Combatant with no token, unusual, but possible\n\n\tconst previous = {\n\t\tcombatant: lastCombatant.combatant, // cache\n\t\tget defeated() { return this.combatant?.defeated; },\n\t\tget token() { return this.combatant?.token; },\n\t\tget actor() { return this.combatant?.actor; },\n\t\tspoke: lastCombatant.combatant?.defeated ? false : (lastCombatant?.spoke ?? false), // dead don't speak\n\t};\n\n\t// Update for next cycle\n\tif (!defeated) {\n\t\tlastCombatant.combatant = combatant;\n\t\tlastCombatant.spoke = false;\n\t}\n\n\tif (!combat.started) return;\n\n\tconst info = {\n\t\tactor: combatant.actor,\n\t\tcombatant,\n\t\tcombat,\n\t\tlast: previous,\n\t\t/** @type {Token|null} */\n\t\ttoken: tokenDoc.object,\n\t\ttokenDoc,\n\t\tget round() { return this.combat?.round; },\n\t\tget turn() { return this.combat?.turn; },\n\t\tuser: combatant.players[0] ?? game.users.activeGM ?? game.users.find(u => u.isGM),\n\t\tget player() { return this.user?.name; },\n\t\tname: null,\n\t\tlabel: null,\n\t\tget hidden() { return this.combatant?.hidden ?? false; },\n\t\tget visible() { return this.combatant?.visible ?? false; },\n\t\tobfuscated: false,\n\t};\n\n\tinfo.name = info.token?.name ?? combatant.name;\n\tinfo.portrait = tokenDoc?.texture.src ?? info.actor.prototypeToken?.texture.src;\n\n\tconst obfuscateType = game.settings.get(CFG.id, CFG.SETTING.obfuscateNPCs);\n\tconst hasVisibleName = () => info.token ? [30, 50].includes(tokenDoc.displayName) : true; // 30=hovered by anyone or 50=always for everyone\n\tconst obfuscate = {\n\t\tget all() { return false; },\n\t\tget owned() { return !info.actor.hasPlayerOwner; },\n\t\tget token() { return !hasVisibleName(); },\n\t\tget any() { return !(info.actor?.hasPlayerOwner || hasVisibleName()); },\n\t};\n\tinfo.obfuscated = obfuscate[obfuscateType] ?? false;\n\tif (info.obfuscated) info.name = game.i18n.localize('Koboldworks.TurnAnnouncer.UnidentifiedTurn');\n\n\tconst label = `<span class='name'>${escapeHTML(info.name)}</span>`;\n\tconst override = game.settings.get(CFG.id, CFG.SETTING.turnLabel);\n\tif (override) info.label = override.replace('{name}', label);\n\telse info.label = game.i18n.format('Koboldworks.TurnAnnouncer.Turn', { name: label });\n\n\tif (!info.portrait || game.settings.get(CFG.id, CFG.SETTING.hidePortrait))\n\t\tinfo.hidePortrait = true;\n\n\tconst msgs = generateCards(info, context);\n\n\treturn msgs;\n}\n\n/**\n * @param {Combat} combat\n * @param {object} changed\n * @param {object} context\n * @param {string} userId\n */\nfunction processTurn(combat, changed, context, userId) {\n\tif (game.user.id !== userId) return; // Trust the one provoking combat update has sufficient permissions\n\t// if (!game.user.activeGM?.isSelf) return;\n\n\tconst msgs = [];\n\n\t// Round cycling message\n\tif (game.settings.get(CFG.id, CFG.SETTING.roundCycling)) {\n\t\tconst roundMsg = announceRoundCycling(combat, context);\n\t\tif (roundMsg) msgs.push(roundMsg);\n\t}\n\n\t// Turn announcement\n\tconst turnMsgs = announceTurn(combat, context);\n\tif (turnMsgs?.length) msgs.push(...turnMsgs);\n\n\tif (msgs.length) ChatMessage.create(msgs);\n}\n\n/* REGISTER SETTINGS */\n\nHooks.once('init', () => {\n\tgame.settings.register(CFG.id, CFG.SETTING.turnLabel, {\n\t\tname: 'Koboldworks.TurnAnnouncer.TurnCardLabel',\n\t\thint: 'Koboldworks.TurnAnnouncer.TurnCardHint',\n\t\ttype: String,\n\t\tconfig: true,\n\t\tscope: 'world',\n\t\tdefault: '',\n\t});\n\n\tgame.settings.register(CFG.id, CFG.SETTING.roundLabel, {\n\t\tname: 'Koboldworks.TurnAnnouncer.RoundCardLabel',\n\t\thint: 'Koboldworks.TurnAnnouncer.RoundCardHint',\n\t\ttype: String,\n\t\tconfig: true,\n\t\tscope: 'world',\n\t\tdefault: '',\n\t});\n\n\tgame.settings.register(CFG.id, CFG.SETTING.obfuscateNPCs, {\n\t\tname: 'Koboldworks.TurnAnnouncer.ObfuscateNPCsLabel',\n\t\thint: 'Koboldworks.TurnAnnouncer.ObfuscateNPCsHint',\n\t\ttype: String,\n\t\tconfig: true,\n\t\tscope: 'world',\n\t\tchoices: {\n\t\t\tall: 'Koboldworks.TurnAnnouncer.ObfuscateNPCsVisibility.All',\n\t\t\towned: 'Koboldworks.TurnAnnouncer.ObfuscateNPCsVisibility.Owned',\n\t\t\ttoken: 'Koboldworks.TurnAnnouncer.ObfuscateNPCsVisibility.Token',\n\t\t\t// visible: 'Koboldworks.TurnAnnouncer.ObfuscateNPCsVisibility.Visible',\n\t\t\tany: 'Koboldworks.TurnAnnouncer.ObfuscateNPCsVisibility.Any',\n\t\t},\n\t\tdefault: 'all',\n\t});\n\n\tgame.settings.register(CFG.id, CFG.SETTING.roundCycling, {\n\t\tname: 'Koboldworks.TurnAnnouncer.RoundCyclingLabel',\n\t\thint: 'Koboldworks.TurnAnnouncer.RoundCyclingHint',\n\t\ttype: Boolean,\n\t\tconfig: true,\n\t\tscope: 'world',\n\t\tdefault: true,\n\t});\n\n\tgame.settings.register(CFG.id, CFG.SETTING.missedKey, {\n\t\tname: 'Koboldworks.TurnAnnouncer.MissedTurnLabel',\n\t\thint: 'Koboldworks.TurnAnnouncer.MissedTurnHint',\n\t\ttype: Boolean,\n\t\tconfig: true,\n\t\tscope: 'world',\n\t\tdefault: false,\n\t\tonChange: (value) => value ? Hooks.on('renderChatMessage', chatMessageEvent) : Hooks.off('renderChatMessage', chatMessageEvent),\n\t});\n\n\tgame.settings.register(CFG.id, CFG.SETTING.hidePortrait, {\n\t\tname: 'Koboldworks.TurnAnnouncer.HidePortraitLabel',\n\t\thint: 'Koboldworks.TurnAnnouncer.HidePortraitHint',\n\t\ttype: Boolean,\n\t\tconfig: true,\n\t\tscope: 'world',\n\t\tdefault: false,\n\t});\n\n\tgame.settings.register(CFG.id, CFG.SETTING.compact, {\n\t\tname: 'Koboldworks.TurnAnnouncer.CompactLabel',\n\t\thint: 'Koboldworks.TurnAnnouncer.CompactHint',\n\t\ttype: Boolean,\n\t\tconfig: true,\n\t\tscope: 'world',\n\t\tdefault: true,\n\t});\n});\n\n/* HOOKS */\n\n/**\n * Detect what was changed and how and pass it along to the real update.\n */\nHooks.on('preUpdateCombat', function preUpdateCombat(combat, updateData, context) {\n\tconst roundDelta = updateData.round !== undefined ? updateData.round - combat.round : 0,\n\t\tturnCount = combat.turns.length,\n\t\troundAdjust = roundDelta * turnCount,\n\t\tforward = roundDelta >= 0,\n\t\tturnDelta = updateData.turn !== undefined ? updateData.turn - combat.turn : 0,\n\t\t// Messy calculation for round changesk\n\t\tturnDeltaWrapped = roundDelta == 0 ? turnDelta : wrapNumber(roundAdjust + turnDelta, forward ? 0 : -(turnCount - 1), forward ? turnCount - 1 : 0);\n\n\t// TODO: This does not behave nicely if larger time changes happen\n\n\tcontext._turnAnnouncer = {\n\t\tturnShift: turnDeltaWrapped,\n\t\troundShift: roundDelta,\n\t\tcombat: combat.id,\n\t};\n});\n\n// Should the handling be wholly in preUpdate?\nHooks.on('updateCombat', processTurn);\nHooks.on('renderChatMessage', chatMessageEvent);\n\nHooks.once('ready', () => {\n\t// console.log(\"~~~ Last Combatant:\", lastCombatant.combatant?.name, { combatant: lastCombatant.combatant }, { spoke: lastCombatant.spoke });\n\tlastCombatant.combatant = game.combat?.combatant ?? null; // Ensure it matches current\n});\n\nHooks.once('init', () => {\n\tif (game.modules.get('quench')?.active)\n\t\tHooks.on('quenchReady', () => import('./modules/quench.mjs'));\n});\n"
  ],
  "mappings": "iDAMO,SAAS,UAAU,CAAC,IAAK,IAAK,IAAK,CACzC,MAAM,MAAQ,IAAM,IAAM,EAAG,MAAQ,IAAM,IAAM,EACjD,MAAM,EAAI,MAAQ,MAAQ,EAC1B,OAAQ,EAAI,EAAI,MAAQ,EAAI,GAAK,qDCPlC,OAAO,cACN,qCACA,eAAe,WAAW,EAAG,SAAU,GAAI,OAAQ,OAAQ,OAAU,CAAC,EAAG,CACxE,SAAS,aAAc,SAAS,cAAc,EAAG,CAChD,GAAG,qBAAqB,QAAS,EAAG,CACnC,OAAO,WAAW,EAAG,EAAG,CAAC,CAAC,EAAE,GAAG,MAAM,CAAC,EACtC,EACD,GAAG,qBAAqB,QAAS,EAAG,CACnC,OAAO,WAAW,EAAG,EAAG,CAAC,CAAC,EAAE,GAAG,MAAM,CAAC,EACtC,EACD,GAAG,sBAAsB,QAAS,EAAG,CACpC,OAAO,WAAW,GAAI,EAAG,CAAC,CAAC,EAAE,GAAG,MAAM,CAAC,EACvC,EACD,GAAG,sBAAsB,QAAS,EAAG,CACpC,OAAO,WAAW,GAAI,EAAG,CAAC,CAAC,EAAE,GAAG,MAAM,CAAC,EACvC,EACD,GAAG,sBAAsB,QAAS,EAAG,CACpC,OAAO,WAAW,GAAI,EAAG,CAAC,CAAC,EAAE,GAAG,MAAM,CAAC,EACvC,EACD,GAAG,yBAAyB,QAAS,EAAG,CACvC,OAAO,WAAW,KAAM,EAAG,EAAE,CAAC,EAAE,GAAG,MAAM,CAAC,EAC1C,EACD,GAAG,wBAAwB,QAAS,EAAG,CACtC,OAAO,WAAW,IAAK,EAAG,EAAE,CAAC,EAAE,GAAG,MAAM,CAAC,EACzC,EACD,GAEF,CAAE,YAAa,KAAK,KAAK,SAAS,yCAAyC,CAAE,CAC9E,IC9BA,IAAM,IAA4B,CACjC,GAAI,6BACJ,QAAS,CACR,UAAW,aACX,aAAc,eACd,cAAe,gBACf,aAAc,eACd,QAAS,UACT,UAAW,YACX,WAAY,YACb,CACD,EAEA,IAAM,gBAAkB,CAAC,MAAO,OAAS,MAAQ,KAAK,MAAM,QAAQ,OAAO,KAAK,MAAM,mBAAmB,EAAG,IAAI,CAAC,EAAI,CAAC,EAEtH,IAAM,WAAa,CAAC,SAAW,OAAO,WAAW,IAAK,OAAO,EAAE,WAAW,IAAK,MAAM,EAAE,WAAW,IAAK,MAAM,EAAE,WAAW,IAAK,QAAQ,EAAE,WAAW,IAAM,QAAQ,EAIlK,IAAM,mBAAqB,WAAW,IAAI,iCAA1C,IACC,oBAAsB,WAAW,IAAI,gCAEtC,IAAI,aAAJ,IAAkB,cAClB,MAAM,KAAK,OAAQ,IAAM,CACxB,YAAY,kBAAkB,EAAE,KAAK,KAAK,aAAe,CAAC,EAC1D,YAAY,mBAAmB,EAAE,KAAK,KAAK,cAAgB,CAAC,EAC5D,EAED,IAAM,cAAgB,CACrB,UAAW,QACP,QAAO,EAAG,CAAE,OAAO,KAAK,WAAW,OAAO,IAC9C,MAAO,KACR,EAKA,SAAS,WAAW,CAAC,QAAS,CAC7B,GAAI,QAAS,CACZ,QAAQ,gBAAgB,EACxB,QAAQ,MAAM,QAAU,MACzB,EAQD,SAAS,2BAA2B,CAAC,GAAI,KAAM,KAAM,CACpD,MAAM,QAAU,KAAK,SAAS,IAAI,IAAI,GAAI,IAAI,QAAQ,OAAO,EAC7D,GAAI,QAAS,KAAK,UAAU,IAAI,SAAS,EAQ1C,SAAS,2BAA2B,CAAC,GAAI,KAAM,KAAM,CACpD,IAAK,KAAM,OACX,KAAK,UAAU,IAAI,cAAe,eAAe,EAEjD,MAAM,OAAS,KAAK,cAAc,iBAAiB,EACnD,IAAK,OAAQ,OAEb,OAAO,cAAc,iBAAiB,GAAG,OAAO,EAEhD,MAAM,QAAU,KAAK,cAAc,kBAAkB,EACrD,IAAK,QAAS,OACd,MAAM,IAAM,QAAQ,cAAc,gBAAgB,EAElD,OAAO,QAAQ,GAAG,EAClB,MAAM,KAAO,SAAS,cAAc,GAAG,EACvC,KAAK,UAAU,IAAI,WAAY,qBAAsB,YAAY,EACjE,KAAK,QAAQ,KAAM,GAAG,EAGtB,MAAM,KAAO,QAAQ,cAAc,gBAAgB,EACnD,GAAI,MAAM,QAAS,CAClB,KAAK,QAAQ,SAAW,KAAK,QAAQ,SACrC,KAAK,QAAQ,MAAQ,KAAK,QAAQ,KACnC,CAGA,YAAY,OAAO,EAQpB,SAAS,yBAAyB,CAAC,GAAI,KAAM,KAAM,CAClD,KAAK,UAAU,IAAI,cAAe,uBAAuB,EAEzD,MAAM,QAAU,KAAK,cAAc,oCAAoC,EAGvE,MAAM,OAAS,KAAK,cAAc,iBAAiB,EACnD,IAAK,OAAQ,OACb,OAAO,UAAU,OAAO,gBAAgB,EACxC,MAAM,GAAK,OAAO,cAAc,aAAa,EAC7C,GAAI,GAAI,CACP,KAAK,MAAQ,GAAG,YAChB,GAAG,OAAO,CACX,CACA,MAAM,UAAY,OAAO,iBAAiB,oCAAoC,EAC9E,WAAW,QAAQ,MAAM,GAAG,MAAM,QAAU,MAAM,EAElD,MAAM,KAAO,SAAS,cAAc,KAAK,EACzC,KAAK,UAAU,IAAI,cAAc,EACjC,MAAM,WAAa,QAAQ,cAAc,mBAAmB,EAC3D,WAAa,QAAQ,cAAc,mBAAmB,EACtD,gBAAkB,QAAQ,cAAc,mBAAmB,EAC3D,WAAa,SAAS,cAAc,MAAM,EAC3C,WAAW,UAAU,IAAI,kBAAkB,EAC3C,WAAW,YAAc,iBAAiB,aAAa,KAAK,GAAK,MACjE,KAAK,OAAO,WAAY,IAAK,WAAY,IAAK,UAAU,EACxD,OAAO,QAAQ,IAAI,EAEnB,GAAI,QAAS,YAAY,OAAO,EAGjC,SAAS,0BAA0B,CAAC,GAAI,MAAO,CAC9C,cAAc,MAAQ,MACtB,cAAc,UAAY,KAAK,QAAQ,oBAAoB,MAAM,KAAK,GAAK,KAQ5E,SAAS,gBAAgB,CAAC,IAAK,MAAO,SAAU,CAC/C,MAAM,KAAO,KAAK,KAAK,KACvB,MAAM,MAAQ,GAAG,QAAQ,IAAI,IAE7B,IAAK,MAAO,CACX,GAAI,MAAQ,GAAG,SAAS,QAAU,cAAc,QAC/C,cAAc,MAAQ,KACvB,MACD,CAEA,MAAM,KAAO,KAAK,QAAQ,mBAAmB,EAC7C,MAAM,UAAU,IAAI,iBAAkB,aAAa,EAEnD,GAAI,MAAM,WACT,0BAA0B,GAAI,KAAM,IAAI,EACpC,QAAI,MAAM,cAAgB,MAAM,MAAO,CAC3C,2BAA2B,GAAI,KAAK,EACpC,4BAA4B,GAAI,KAAM,IAAI,CAC3C,CACK,QAAI,MAAM,aAAc,CAC5B,4BAA4B,GAAI,KAAM,IAAI,CAC3C,CAEA,MAAM,cAAc,aAAa,GAAG,OAAO,EAG3C,GAAI,GAAG,QAAQ,IAAI,GAAI,YAAY,EAAG,CACrC,KAAK,UAAU,IAAI,YAAY,EAE/B,MAAM,OAAS,KAAK,QAAQ,IAAI,GAAG,QAAQ,IAAI,GAAI,QAAQ,CAAC,EAC3D,UAAY,QAAQ,WAAW,IAAI,GAAG,QAAQ,IAAI,GAAI,WAAW,CAAC,EAEnE,IAAK,WAAW,OAAO,mBAAmB,KAAK,KAAM,UAAU,EAAG,OAElE,GAAI,WAAW,MAAO,CACrB,MAAM,KAAO,KAAK,cAAc,wBAAwB,EACxD,GAAI,KAAM,KAAK,YAAc,UAAU,MAAM,IAC9C,CACD,EAGD,IAAI,aAAe,CAAC,EAEpB,SAAS,UAAU,CAAC,KAAM,QAAS,CAClC,GAAI,KAAK,MAAM,OAAS,KAAK,MAAQ,KAAM,OAE3C,MAAM,UAAY,QAAQ,eAC1B,GAAI,WAAW,SAAW,KAAK,QAAQ,OAAO,GAAI,CAEjD,GAAI,UAAU,WAAa,GAAK,UAAU,UAAY,GAAK,UAAU,YAAc,EAClF,MACF,CAEA,MAAQ,KAAM,OAAQ,WAAc,KACpC,GAAI,aAAa,SAAW,WAAa,OAAO,KAAO,aAAa,OAAQ,OAC5E,GAAI,KAAK,OAAO,KAAO,WAAW,OAAO,GAAI,OAC7C,GAAI,aAAa,KAAO,KAAK,OAAO,GAAI,OAExC,aAAe,CAAE,GAAI,KAAK,OAAO,GAAI,OAAQ,OAAO,EAAG,EAEvD,MAAM,GAAK,KAAK,KAAK,SAAS,sCAAsC,EAEpE,MAAM,MAAQ,OAAO,MACpB,MAAQ,KAAK,OAAO,GACpB,MAAQ,KAAK,OAAO,GACpB,MAAQ,KAAK,KAEd,GAAI,QAAU,WAAa,QAAU,UAAW,OAEhD,MAAM,OAAS,WAAW,KAAK,KAAK,UAAU,IAAI,EAElD,MAAM,QAAU,CACf,QAAS,2JAA2J,gDAAgD,kBACpN,QAAS,CAAE,MAAO,MAAO,MAAO,KAAM,EACtC,MAAO,EACL,IAAI,IAAK,CAAE,WAAY,KAAM,MAAO,MAAO,UAAW,KAAK,UAAU,EAAG,CAC1E,CAED,EAEA,YAAY,eAAe,cAAc,QAAS,MAAM,gBAAgB,OAAO,EAE/E,OAAO,QAQR,SAAS,aAAa,CAAC,KAAM,QAAS,CACrC,MAAM,KAAO,CAAC,EACd,GAAI,KAAK,SAAS,IAAI,IAAI,GAAI,IAAI,QAAQ,SAAS,EAAG,CACrD,MAAM,IAAM,WAAW,KAAM,OAAO,EACpC,GAAI,IAAK,KAAK,KAAK,GAAG,CACvB,CAEA,GAAI,KAAK,UAAU,SAAU,OAAO,KACpC,GAAI,KAAK,MAAM,WAAa,MAAQ,KAAK,KAAK,UAAU,KAAO,KAAK,UAAU,GAAI,OAAO,KAEzF,MAAM,QAAU,KAAK,WAAa,CAAE,KAAM,KAAK,KAAK,EAAG,EAAI,YAAY,WAAW,CAAE,MAAO,KAAK,OAAO,SAAU,MAAO,KAAK,KAAM,CAAC,EAEpI,MAAM,QAAU,MAAM,0BAA0B,SAChD,MAAM,eAAiB,KAAK,OAAS,MAAQ,KAAK,OAAO,WAAW,SAAW,QAE/E,MAAM,SAAW,CAChB,QAAS,aAAa,KAAM,CAAE,2BAA4B,KAAM,8BAA+B,IAAK,CAAC,EACrG,QACA,SAAU,eAAiB,aAAe,SAC1C,QAAS,eAAiB,CAAC,EAAI,gBAAgB,KAAK,MAAO,OAAO,EAAE,IAAI,KAAK,EAAE,EAAE,EACjF,MAAO,EACL,IAAI,IAAK,CACT,aAAc,KACd,MAAO,KAAK,OAAO,GACnB,MAAO,KAAK,MACZ,KAAM,KAAK,KACX,OAAQ,KAAK,OAAO,GACpB,UAAW,KAAK,UAAU,GAC1B,WAAY,KAAK,UAClB,CACD,CACD,EAEA,YAAY,cAAc,UAAW,KAAK,OAAS,aAAe,QAAQ,EAC1E,GAAI,SAAS,WAAa,aAAc,OAAO,SAAS,QAExD,KAAK,KAAK,QAAQ,EAElB,OAAO,KAGR,SAAS,wBAAwB,CAAC,OAAQ,CACzC,MAAM,QAAU,YAAY,WAAW,IAAI,EAC3C,MAAM,SAAW,KAAK,SAAS,IAAI,IAAI,GAAI,IAAI,QAAQ,UAAU,EACjE,MAAM,KAAO,CAAE,MAAO,EACtB,GAAI,SAAU,KAAK,QAAU,SAAS,QAAQ,UAAW,OAAO,KAAK,EAChE,UAAK,QAAU,KAAK,KAAK,OAAO,yCAA0C,CAAE,MAAO,OAAO,KAAM,CAAC,EACtG,MAAM,QAAU,CACf,QAAS,cAAc,KAAM,CAAE,2BAA4B,KAAM,8BAA+B,IAAK,CAAC,EACtG,QACA,SAAU,aACV,MAAO,EACL,IAAI,IAAK,CAAE,aAAc,KAAM,MAAO,OAAO,MAAO,OAAQ,OAAO,EAAG,CACxE,CACD,EAGA,IAAK,KAAK,KAAK,KAAM,CAErB,CAEA,OAAO,QAOR,SAAS,oBAAoB,CAAC,OAAQ,QAAS,CAE9C,GAAI,OAAO,+BAAiC,OAAO,MAAO,OAC1D,GAAI,QAAQ,eAAe,YAAc,EAAG,OAC5C,OAAO,8BAAgC,OAAO,MAC9C,OAAO,yBAAyB,MAAM,EAQvC,SAAS,YAAY,CAAC,OAAQ,QAAS,CAItC,MAAM,UAAY,OAAO,UACzB,MAAM,SAAW,WAAW,UAAY,MACxC,MAAM,SAAW,WAAW,MAC5B,IAAK,SAAU,OAEf,MAAM,SAAW,CAChB,UAAW,cAAc,aACrB,SAAQ,EAAG,CAAE,OAAO,KAAK,WAAW,aACpC,MAAK,EAAG,CAAE,OAAO,KAAK,WAAW,UACjC,MAAK,EAAG,CAAE,OAAO,KAAK,WAAW,OACrC,MAAO,cAAc,WAAW,SAAW,MAAS,eAAe,OAAS,KAC7E,EAGA,IAAK,SAAU,CACd,cAAc,UAAY,UAC1B,cAAc,MAAQ,KACvB,CAEA,IAAK,OAAO,QAAS,OAErB,MAAM,KAAO,CACZ,MAAO,UAAU,MACjB,UACA,OACA,KAAM,SAEN,MAAO,SAAS,OAChB,YACI,MAAK,EAAG,CAAE,OAAO,KAAK,QAAQ,UAC9B,KAAI,EAAG,CAAE,OAAO,KAAK,QAAQ,MACjC,KAAM,UAAU,QAAQ,IAAM,KAAK,MAAM,UAAY,KAAK,MAAM,KAAK,KAAK,EAAE,IAAI,KAC5E,OAAM,EAAG,CAAE,OAAO,KAAK,MAAM,MACjC,KAAM,KACN,MAAO,QACH,OAAM,EAAG,CAAE,OAAO,KAAK,WAAW,QAAU,UAC5C,QAAO,EAAG,CAAE,OAAO,KAAK,WAAW,SAAW,OAClD,WAAY,KACb,EAEA,KAAK,KAAO,KAAK,OAAO,MAAQ,UAAU,KAC1C,KAAK,SAAW,UAAU,QAAQ,KAAO,KAAK,MAAM,gBAAgB,QAAQ,IAE5E,MAAM,cAAgB,KAAK,SAAS,IAAI,IAAI,GAAI,IAAI,QAAQ,aAAa,EACzE,MAAM,eAAiB,IAAM,KAAK,MAAQ,CAAC,GAAI,EAAE,EAAE,SAAS,SAAS,WAAW,EAAI,KACpF,MAAM,UAAY,IACb,IAAG,EAAG,CAAE,MAAO,WACf,MAAK,EAAG,CAAE,OAAQ,KAAK,MAAM,mBAC7B,MAAK,EAAG,CAAE,OAAQ,eAAe,MACjC,IAAG,EAAG,CAAE,QAAS,KAAK,OAAO,gBAAkB,eAAe,GACnE,EACA,KAAK,WAAa,UAAU,gBAAkB,MAC9C,GAAI,KAAK,WAAY,KAAK,KAAO,KAAK,KAAK,SAAS,4CAA4C,EAEhG,MAAM,MAAQ,sBAAsB,WAAW,KAAK,IAAI,WACxD,MAAM,SAAW,KAAK,SAAS,IAAI,IAAI,GAAI,IAAI,QAAQ,SAAS,EAChE,GAAI,SAAU,KAAK,MAAQ,SAAS,QAAQ,SAAU,KAAK,EACtD,UAAK,MAAQ,KAAK,KAAK,OAAO,iCAAkC,CAAE,KAAM,KAAM,CAAC,EAEpF,IAAK,KAAK,UAAY,KAAK,SAAS,IAAI,IAAI,GAAI,IAAI,QAAQ,YAAY,EACvE,KAAK,aAAe,KAErB,MAAM,KAAO,cAAc,KAAM,OAAO,EAExC,OAAO,KASR,SAAS,WAAW,CAAC,OAAQ,QAAS,QAAS,OAAQ,CACtD,GAAI,KAAK,KAAK,KAAO,OAAQ,OAG7B,MAAM,KAAO,CAAC,EAGd,GAAI,KAAK,SAAS,IAAI,IAAI,GAAI,IAAI,QAAQ,YAAY,EAAG,CACxD,MAAM,SAAW,qBAAqB,OAAQ,OAAO,EACrD,GAAI,SAAU,KAAK,KAAK,QAAQ,CACjC,CAGA,MAAM,SAAW,aAAa,OAAQ,OAAO,EAC7C,GAAI,UAAU,OAAQ,KAAK,KAAK,GAAG,QAAQ,EAE3C,GAAI,KAAK,OAAQ,YAAY,OAAO,IAAI,EAKzC,MAAM,KAAK,OAAQ,IAAM,CACxB,KAAK,SAAS,SAAS,IAAI,GAAI,IAAI,QAAQ,UAAW,CACrD,KAAM,0CACN,KAAM,yCACN,KAAM,OACN,OAAQ,KACR,MAAO,QACP,QAAS,EACV,CAAC,EAED,KAAK,SAAS,SAAS,IAAI,GAAI,IAAI,QAAQ,WAAY,CACtD,KAAM,2CACN,KAAM,0CACN,KAAM,OACN,OAAQ,KACR,MAAO,QACP,QAAS,EACV,CAAC,EAED,KAAK,SAAS,SAAS,IAAI,GAAI,IAAI,QAAQ,cAAe,CACzD,KAAM,+CACN,KAAM,8CACN,KAAM,OACN,OAAQ,KACR,MAAO,QACP,QAAS,CACR,IAAK,wDACL,MAAO,0DACP,MAAO,0DAEP,IAAK,uDACN,EACA,QAAS,KACV,CAAC,EAED,KAAK,SAAS,SAAS,IAAI,GAAI,IAAI,QAAQ,aAAc,CACxD,KAAM,8CACN,KAAM,6CACN,KAAM,QACN,OAAQ,KACR,MAAO,QACP,QAAS,IACV,CAAC,EAED,KAAK,SAAS,SAAS,IAAI,GAAI,IAAI,QAAQ,UAAW,CACrD,KAAM,4CACN,KAAM,2CACN,KAAM,QACN,OAAQ,KACR,MAAO,QACP,QAAS,MACT,SAAU,CAAC,QAAU,MAAQ,MAAM,GAAG,oBAAqB,gBAAgB,EAAI,MAAM,IAAI,oBAAqB,gBAAgB,CAC/H,CAAC,EAED,KAAK,SAAS,SAAS,IAAI,GAAI,IAAI,QAAQ,aAAc,CACxD,KAAM,8CACN,KAAM,6CACN,KAAM,QACN,OAAQ,KACR,MAAO,QACP,QAAS,KACV,CAAC,EAED,KAAK,SAAS,SAAS,IAAI,GAAI,IAAI,QAAQ,QAAS,CACnD,KAAM,yCACN,KAAM,wCACN,KAAM,QACN,OAAQ,KACR,MAAO,QACP,QAAS,IACV,CAAC,EACD,EAOD,MAAM,GAAG,kBAAmB,SAAS,eAAe,CAAC,OAAQ,WAAY,QAAS,CACjF,MAAM,WAAa,WAAW,QAAU,UAAY,WAAW,MAAQ,OAAO,MAAQ,EACrF,UAAY,OAAO,MAAM,OACzB,YAAc,WAAa,UAC3B,QAAU,YAAc,EACxB,UAAY,WAAW,OAAS,UAAY,WAAW,KAAO,OAAO,KAAO,EAE5E,iBAAmB,YAAc,EAAI,UAAY,WAAW,YAAc,UAAW,QAAU,IAAM,UAAY,GAAI,QAAU,UAAY,EAAI,CAAC,EAIjJ,QAAQ,eAAiB,CACxB,UAAW,iBACX,WAAY,WACZ,OAAQ,OAAO,EAChB,EACA,EAGD,MAAM,GAAG,eAAgB,WAAW,EACpC,MAAM,GAAG,oBAAqB,gBAAgB,EAE9C,MAAM,KAAK,QAAS,IAAM,CAEzB,cAAc,UAAY,KAAK,QAAQ,WAAa,KACpD,EAED,MAAM,KAAK,OAAQ,IAAM,CACxB,GAAI,KAAK,QAAQ,IAAI,QAAQ,GAAG,OAC/B,MAAM,GAAG,cAAe,gEAAoC,EAC7D",
  "debugId": "E4684F041F76407364756E2164756E21",
  "names": []
}