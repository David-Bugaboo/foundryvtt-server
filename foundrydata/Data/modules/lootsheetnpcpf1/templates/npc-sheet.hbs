<form class="pf1 {{cssClass}}" autocomplete="off">

  <!-- HEADER -->
  <header class="sheet-header flexrow">
    <div class="sheet-profile-img">
      {{#if isGM}}<img class="sheet-profile-small" src="{{actor.img}}" data-tooltip="{{actor.name}}" data-edit="img" />{{/if}}
      {{#unless isGM}}<img class="sheet-profile" src="{{actor.img}}" data-tooltip="{{actor.name}}" data-edit="img" />{{/unless}}
    </div>

    <div class="flexcol">
      <h1 class="charname">
        <input name="name" type="text" value="{{actor.name}}" placeholder="{{localize "ls.lootName"}}" />
      </h1>
      <!-- Totals -->
      {{#if (eq lootsheettype "Loot")}}
      <div class="flexrow summary-rows totals">
        <ul class="summary flexrow">
          <li class="item-count {{itemsWarning}}">
            <label>
              <i class="fas fa-box"></i>
              <span class="value">{{localize "ls.totalItems"}}: {{totalItems}} {{#if maxItems}} / {{maxItems}} {{/if}}</span>
            </label>
          </li>
          <li class="item-price">
            <label>
              <i class="fas fa-coins"></i>
              <span class="value">{{localize "ls.totalPrice"}}: {{labels.totalValue}}</span>
            </label>
            {{!-- {{numberFormatAlt totalPrice decimals=3}} --}}
          </li>
        </ul>
        <ul class="summary flexrow">
          <li class="item-weight {{weightWarning}}">
            <label>
              <i class="fas fa-weight-hanging"></i>
              <span class="value">{{localize "ls.totalWeight"}}: {{numberFormatAlt totalWeight decimals=3}} {{#if maxWeight}} / {{numberFormatAlt maxWeight decimals=3}} {{/if}} {{@root.units.weight}}</span>
            </label>
          </li>
          {{#if flags.lootsheetnpcpf1.displaySaleValueEnabled}}
          <li class="adjusted-price">
            <label>
              <i class="fas fa-coins"></i>
              <span class="value">{{localize "ls.adjustedPrice"}}: {{labels.sellValue}}</span>
            </label>
            {{!-- {{numberFormatAlt adjustedPrice decimals=3}} --}}
          </li>
          {{/if}}
        </ul>
      </div>
      {{/if}}
      {{#if isGM}}
        {{#if (eq lootsheettype "Merchant")}}
        <div class="flexrow charbutton">
          <button class="price-modifier" type="button" name="price-modifier" value=""><i class="fa fa-balance-scale"></i> {{localize "ls.priceModifierTitle"}}</button>
        </div>
        {{/if}}
        {{#if (eq lootsheettype "Loot")}}
        <div class="flexcol charbutton">
          <button class="convert-loot" type="button" name="convert-loot" value=""><i class="fa fa-coins"></i> {{localize "ls.convertLootTitle"}}</button>
          <button class="collect-loot" type="button" name="collect-loot" value=""><i class="fa fa-coins"></i> {{localize "ls.collectLootTitle"}}</button>
        </div>
        {{/if}}
      {{/if}}
    </div>
  </header>

  <section class="sheet-lower flexrow">
    <!-- SIDEBAR -->
    {{#if isGM}}
      <section class="sheet-sidebar sidebar">
        {{> "modules/lootsheetnpcpf1/templates/npc-sheet-gmpart.hbs"}}
      </section>
    {{/if}}
    
    <!-- BODY -->
    <section class="sheet-content content">
      {{#unless actor.visible}}
        <span class="warning">{{localize "ls.noAccesToSheet"}}</span>
      {{/unless}}
      
      {{#if actor.visible}}
      <div class="flexcol" style="height: 100%;">
        <nav class="sheet-navigation tabs" data-group="primary">
          <a class="item" data-tab="inventory">{{localize "ls.inventory"}}</a>
          <a class="item" data-tab="biography">{{localize "ls.biography"}}</a>
        </nav>
        <section class="primary-body">
          <!-- INVENTORY -->
          <div class="tab inventory flexcol" data-tab="inventory" data-group="primary">
            <!-- FEATURES -->
            <div class="features" data-group="primary" data-tab="features">
              {{#if (eq lootsheettype "Loot")}}
                <!-- Currency -->
                <div class="inventory-filters">
                  <section class="currency flexrow {{#if hasCurrency}} has-currency{{/if}}">
                    <h3>
                      {{localize "PF1.Currency.Label"}}
                    </h3>
                    {{#each system.currency as |v k|}}
                      <label class="denomination {{k}}" data-tooltip="{{ lookup ../config.currencies k }}">
                        <i class="currency {{k}}"></i>
                        <input type="text" name="system.currency.{{k}}" value="{{v}}" data-dtype="Number"/>
                      </label>
                      
                      <label class="item currency-controls" data-item-id="{{k}}">
                        {{#if ../canAct}}
                          {{#unless @root.isGM}}
                          <a class="currency-controls item-control item-loot" data-tooltip="{{localize "ls.lootCoins"}}"data-op="loot"><i class="fas fa-gem"></i></a>
                          {{else}}
                          <a class="convert-currency" data-type="{{k}}" data-category="currency" data-tooltip="{{localize "PF1.ConvertCurrency"}}"><i class="fas fa-long-arrow-alt-left"></i></a>
                          {{/unless}}
                        {{/if}}
                      </label>
                    {{/each}}
                  </section>
                  <section class="currency flexrow {{#if hasAltCurrency}} has-currency{{/if}}">
                    <h3>
                      {{localize "PF1.Currency.Weightless"}}
                    </h3>
                    {{#each system.altCurrency as |v k|}}
                      <label class="denomination {{k}}" data-tooltip="{{ lookup ../config.currencies k }}">
                        <i class="currency {{k}}"></i>
                        <input type="text" name="system.altCurrency.{{k}}" value="{{v}}" data-dtype="Number"/>
                      </label>
                      
                      <label class="item currency-controls" data-item-id="wl_{{k}}">
                        {{#if ../canAct}}
                          {{#unless @root.isGM}}
                          <a class="currency-controls item-control item-loot" data-tooltip="{{localize "ls.lootCoins"}}" data-op="loot"><i class="fas fa-gem"></i></a>
                          {{else}}
                          <a class="convert-currency" data-type="{{k}}" data-category="altCurrency" data-tooltip="{{localize "PF1.ConvertCurrency"}}"><i class="fas fa-long-arrow-alt-left"></i></a>
                          {{/unless}}
                        {{/if}}
                      </label>
                    {{/each}}
                  </section>
                </div>
              {{/if}}

              {{!-- Inventory Navigation --}}
              {{> "systems/pf1/templates/actors/parts/actor-item-nav-filters.hbs" category="inventory" sections=inventory}}

              <!-- Inventory -->
              <section class="inventory-body {{#unless (eq lootsheettype "Loot")}}merchant-body{{/unless}}">
                <div class="item-groups-list">
                {{#each inventory as |section sid|}}
                {{#unless section._hidden}}
                  <!-- <li class="inventory-header flexrow" data-type="{{section.type}}"> -->
                  <div class="item-list inventory-group flexcol" data-list="{{id}}" data-type="{{create.type}}" data-subtype="{{create.system.subType}}">
                    <li class="item-list-header flexrow items-{{id}}">
                      <div class="item-name">
                        <h3>{{section.label}}</h3>
                      </div>
                      {{#if @root.isGM}}
                        <div class="item-detail item-identified"><i class="icon-pf icon-quill-ink large" data-tooltip="PF1.Identified"></i></div>
                      {{/if}}
                      <div class="item-detail item-weight"><i class="icon-pf icon-weight large" src="systems/pf1/icons/actions/weight.svg" data-tooltip="PF1.ItemWeight"></i></div>
                      <div class="item-detail item-value"><i class="icon-pf icon-coins large" data-tooltip="PF1.Value"></i></div>
                      <div class="item-controls">
                      {{#if @root.isGM}}
                        <a class="item-control item-create" data-tooltip="PF1.CreateItem"  data-create="{{path}}">
                          <i class="fas fa-plus"></i>
                        </a>
                        <a data-action="browse" data-source="{{path}}" data-tooltip="PF1.BrowseItems"><i class="fas fa-folder-plus"></i></a>
                      {{/if}}
                      </div>
                    </li>

                    {{#each section.items as |item iid|}}
                      {{> "inventoryItem" section=section item=item}}
                    {{/each}}
                  </div>
                {{/unless}}
                {{/each}}
                </div>
              </section>
            </div>
          </div>

          <!-- BIOGRAPHY -->
          <div class="tab biography flexcol" data-tab="biography" data-group="primary">
            {{editor biographyHTML target="system.details.biography.value" button=true collaborate=false editable=editable engine="prosemirror"}}
          </div>        
        </section>
      </div>
      {{/if}}
    </section>
  </section>
</form>

{{#*inline "inventoryItem"}}
{{#if (or @root.isGM (not item.document.flags.lootsheetnpcpf1.secret))}}
<li class="item flexrow{{#if disabled}} disabled{{/if}}{{#if isEmpty}} empty{{/if}}{{#if destroyed}} destroyed{{else if isBroken}} broken{{/if}}" data-item-id="{{id}}" data-item-quantity="{{item.quantity}}">
  <div class="item-name flexrow rollable" data-action="toggleItemSummary" data-context-action="editItem">
    <div class="item-image" style="background-image: url({{item.img}})"></div>
    <h4 class="item-name-text{{#if item.empty}} strikethrough-text{{/if}}">
      {{ lootsheetname item.name item.quantity item.document.flags.lootsheetnpcpf1.infinite}}
      {{#if item.broken}}
        <i class="fa fa-heart-broken"></i>
      {{/if}}
    </h4>
  </div>

  {{#if @root.isGM}}
    <div class="item-detail item-identified">
      <a class="item-control item-identify" data-action="toggleIdentified"><span>{{{item.labels.identified}}}</span></a>
    </div>
  {{/if}}

  <div class="item-detail item-weight" data-hover="weight">
    {{#if item.isPhysical}}
    <span>{{item.weight.converted.total}} {{@root.units.weight}}</span>
    {{!-- <span>{{numberFormatAlt item.weight.converted.total decimals=2}} {{@root.units.weight}}</span> --}}
    {{/if}}
  </div>

  <div class="item-detail item-value">
    <span>{{ lootsheetprice item.showPrice @root.priceModifier}} {{@root.config.currency.standard}}</span>
    {{!-- <span>{{localize @root.labels.currency value=item.price}}</span> --}}
  </div>

  <div class="item-controls">
    {{#if (eq @root.lootsheettype "Loot")}}
      {{#if @root.canAct}}
        {{#unless @root.isGM}}
          {{#if quantity}}
          <a class="item-control item-loot" data-action="lootItem" data-tooltip="{{localize "ls.lootItem"}}" data-op="loot"><i class="fas fa-gem"></i></a>
          {{/if}}
        {{/unless}}
      {{/if}}
    {{/if}}
    
    {{#if (eq @root.lootsheettype "Merchant")}}
      {{#if @root.canAct}}
        {{#unless @root.isGM}}
          {{#if quantity}}
          <a class="item-control item-buy" data-action="buyItem" data-tooltip="{{localize "ls.buyItem"}}" data-op="buy"><i class="fas fa-dollar-sign"></i></a>
          {{/if}}
        {{/unless}}
      {{/if}} 
    {{/if}} 
    
    {{#if @root.isGM}}
      <a class="item-control item-visibility" data-action="visibilityItem" data-tooltip="{{localize "ls.itemToggleVisibility"}}">
        {{#if item.document.flags.lootsheetnpcpf1.secret}}<i class="fas fa-eye-slash"></i>{{/if}}
        {{#unless item.document.flags.lootsheetnpcpf1.secret}}<i class="fas fa-eye"></i>{{/unless}}
      </a>
      {{#unless item.document.flags.lootsheetnpcpf1.infinite}}
        <a class="item-control item-quantity-add" data-action="adjustQuantity" data-quantity="1" data-tooltip="PF1.QuantityAdd"><i class="fas fa-plus"></i></a>
        <a class="item-control item-quantity-subtract" data-action="adjustQuantity" data-quantity="-1" data-tooltip="PF1.QuantitySub"><i class="fas fa-minus"></i></a>
        <a class="item-control item-quantity-infinite" data-action="infiniteQuantity"><i class="fas fa-infinity"></i></a>
        <a class="item-control item-split{{#unless item.isStack}} disabled{{/unless}}" data-action="splitItem" data-tooltip="PF1.SplitItem"><i class="fas fa-people-arrows"></i></a>
      {{/unless}}
      {{#if item.document.flags.lootsheetnpcpf1.infinite}}
        <a class="item-control item-quantity-infinite enabled" data-action="infiniteQuantity"><i class="fas fa-infinity"></i></a>
      {{/if}}
      <a class="item-control item-edit" data-action="editItem" data-tooltip="{{localize "ls.editItem"}}"><i class="fas fa-edit"></i></a>
      <a class="item-control item-delete" data-action="deleteItem" data-tooltip="{{localize "ls.deleteItem"}}"><i class="fas fa-trash"></i></a>
    {{/if}}
  </div>
  {{!-- {{#if @root.owner}}
    <div class="item-controls">
      <a class="item-control item-quantity-add" data-tooltip="PF1.QuantityAdd"><i class="fas fa-plus"></i></a>
      <a class="item-control item-quantity-subtract" data-tooltip="PF1.QuantitySub"><i class="fas fa-minus"></i></a>
      <a class="item-control item-edit" data-tooltip="PF1.EditItem"><i class="fas fa-edit"></i></a>
      <a class="item-control item-duplicate" data-tooltip="PF1.DuplicateItem"><i class="fas fa-copy"></i></a>
      <a class="item-control item-split{{#unless item.isStack}} disabled{{/unless}}" data-tooltip="PF1.SplitItem"><i class="fas fa-people-arrows"></i></a>
      <a class="item-control item-give" data-tooltip="PF1.GiveItem"><i class="fas fa-gift"></i></a>
      <a class="item-control item-delete" data-tooltip="PF1.DeleteItem"><i class="fas fa-trash"></i></a>
    </div>
  {{/if}} --}}
</li>
{{/if}}
{{/inline}}